
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../AnritsuSA/">
      
      
        <link rel="next" href="../GimbalGremsyH16/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.25">
    
    
      
        <title>Nodes communication - A2G Measurements Software</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.6543a935.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      
  
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
  
  <style>:root{--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.23 12.004a2.236 2.236 0 0 1-2.235 2.236 2.236 2.236 0 0 1-2.236-2.236 2.236 2.236 0 0 1 2.235-2.236 2.236 2.236 0 0 1 2.236 2.236zm2.648-10.69c-1.346 0-3.107.96-4.888 2.622-1.78-1.653-3.542-2.602-4.887-2.602-.41 0-.783.093-1.106.278-1.375.793-1.683 3.264-.973 6.365C1.98 8.917 0 10.42 0 12.004c0 1.59 1.99 3.097 5.043 4.03-.704 3.113-.39 5.588.988 6.38.32.187.69.275 1.102.275 1.345 0 3.107-.96 4.888-2.624 1.78 1.654 3.542 2.603 4.887 2.603.41 0 .783-.09 1.106-.275 1.374-.792 1.683-3.263.973-6.365C22.02 15.096 24 13.59 24 12.004c0-1.59-1.99-3.097-5.043-4.032.704-3.11.39-5.587-.988-6.38a2.167 2.167 0 0 0-1.092-.278zm-.005 1.09v.006c.225 0 .406.044.558.127.666.382.955 1.835.73 3.704-.054.46-.142.945-.25 1.44a23.476 23.476 0 0 0-3.107-.534A23.892 23.892 0 0 0 12.769 4.7c1.592-1.48 3.087-2.292 4.105-2.295zm-9.77.02c1.012 0 2.514.808 4.11 2.28-.686.72-1.37 1.537-2.02 2.442a22.73 22.73 0 0 0-3.113.538 15.02 15.02 0 0 1-.254-1.42c-.23-1.868.054-3.32.714-3.707.19-.09.4-.127.563-.132zm4.882 3.05c.455.468.91.992 1.36 1.564-.44-.02-.89-.034-1.345-.034-.46 0-.915.01-1.36.034.44-.572.895-1.096 1.345-1.565zM12 8.1c.74 0 1.477.034 2.202.093.406.582.802 1.203 1.183 1.86.372.64.71 1.29 1.018 1.946-.308.655-.646 1.31-1.013 1.95-.38.66-.773 1.288-1.18 1.87a25.64 25.64 0 0 1-4.412.005 26.64 26.64 0 0 1-1.183-1.86c-.372-.64-.71-1.29-1.018-1.946a25.17 25.17 0 0 1 1.013-1.954c.38-.66.773-1.286 1.18-1.868A25.245 25.245 0 0 1 12 8.098zm-3.635.254c-.24.377-.48.763-.704 1.16-.225.39-.435.782-.635 1.174-.265-.656-.49-1.31-.676-1.947.64-.15 1.315-.283 2.015-.386zm7.26 0c.695.103 1.365.23 2.006.387-.18.632-.405 1.282-.66 1.933a25.952 25.952 0 0 0-1.345-2.32zm3.063.675c.484.15.944.317 1.375.498 1.732.74 2.852 1.708 2.852 2.476-.005.768-1.125 1.74-2.857 2.475-.42.18-.88.342-1.355.493a23.966 23.966 0 0 0-1.1-2.98c.45-1.017.81-2.01 1.085-2.964zm-13.395.004c.278.96.645 1.957 1.1 2.98a23.142 23.142 0 0 0-1.086 2.964c-.484-.15-.944-.318-1.37-.5-1.732-.737-2.852-1.706-2.852-2.474 0-.768 1.12-1.742 2.852-2.476.42-.18.88-.342 1.356-.494zm11.678 4.28c.265.657.49 1.312.676 1.948-.64.157-1.316.29-2.016.39a25.819 25.819 0 0 0 1.341-2.338zm-9.945.02c.2.392.41.783.64 1.175.23.39.465.772.705 1.143a22.005 22.005 0 0 1-2.006-.386c.18-.63.406-1.282.66-1.933zM17.92 16.32c.112.493.2.968.254 1.423.23 1.868-.054 3.32-.714 3.708-.147.09-.338.128-.563.128-1.012 0-2.514-.807-4.11-2.28.686-.72 1.37-1.536 2.02-2.44 1.107-.118 2.154-.3 3.113-.54zm-11.83.01c.96.234 2.006.415 3.107.532.66.905 1.345 1.727 2.035 2.446-1.595 1.483-3.092 2.295-4.11 2.295a1.185 1.185 0 0 1-.553-.132c-.666-.38-.955-1.834-.73-3.703.054-.46.142-.944.25-1.438zm4.56.64c.44.02.89.034 1.345.034.46 0 .915-.01 1.36-.034-.44.572-.895 1.095-1.345 1.565-.455-.47-.91-.993-1.36-1.565z"/></svg>');--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.25.18.9.2.73.26.59.3.45.32.34.34.25.34.16.33.1.3.04.26.02.2-.01.13V8.5l-.05.63-.13.55-.21.46-.26.38-.3.31-.33.25-.35.19-.35.14-.33.1-.3.07-.26.04-.21.02H8.77l-.69.05-.59.14-.5.22-.41.27-.33.32-.27.35-.2.36-.15.37-.1.35-.07.32-.04.27-.02.21v3.06H3.17l-.21-.03-.28-.07-.32-.12-.35-.18-.36-.26-.36-.36-.35-.46-.32-.59-.28-.73-.21-.88-.14-1.05-.05-1.23.06-1.22.16-1.04.24-.87.32-.71.36-.57.4-.44.42-.33.42-.24.4-.16.36-.1.32-.05.24-.01h.16l.06.01h8.16v-.83H6.18l-.01-2.75-.02-.37.05-.34.11-.31.17-.28.25-.26.31-.23.38-.2.44-.18.51-.15.58-.12.64-.1.71-.06.77-.04.84-.02 1.27.05zm-6.3 1.98-.23.33-.08.41.08.41.23.34.33.22.41.09.41-.09.33-.22.23-.34.08-.41-.08-.41-.23-.33-.33-.22-.41-.09-.41.09zm13.09 3.95.28.06.32.12.35.18.36.27.36.35.35.47.32.59.28.73.21.88.14 1.04.05 1.23-.06 1.23-.16 1.04-.24.86-.32.71-.36.57-.4.45-.42.33-.42.24-.4.16-.36.09-.32.05-.24.02-.16-.01h-8.22v.82h5.84l.01 2.76.02.36-.05.34-.11.31-.17.29-.25.25-.31.24-.38.2-.44.17-.51.15-.58.13-.64.09-.71.07-.77.04-.84.01-1.27-.04-1.07-.14-.9-.2-.73-.25-.59-.3-.45-.33-.34-.34-.25-.34-.16-.33-.1-.3-.04-.25-.02-.2.01-.13v-5.34l.05-.64.13-.54.21-.46.26-.38.3-.32.33-.24.35-.2.35-.14.33-.1.3-.06.26-.04.21-.02.13-.01h5.84l.69-.05.59-.14.5-.21.41-.28.33-.32.27-.35.2-.36.15-.36.1-.35.07-.32.04-.28.02-.21V6.07h2.09l.14.01zm-6.47 14.25-.23.33-.08.41.08.41.23.33.33.23.41.08.41-.08.33-.23.23-.33.08-.41-.08-.41-.23-.33-.33-.23-.41-.08-.41.08z"/></svg>');--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M1.5 0h21l-1.91 21.563L11.977 24l-8.564-2.438L1.5 0zm7.031 9.75-.232-2.718 10.059.003.23-2.622L5.412 4.41l.698 8.01h9.126l-.326 3.426-2.91.804-2.955-.81-.188-2.11H6.248l.33 4.171L12 19.351l5.379-1.443.744-8.157H8.531z"/></svg>');--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M1.5 0h21l-1.91 21.563L11.977 24l-8.565-2.438L1.5 0zm17.09 4.413L5.41 4.41l.213 2.622 10.125.002-.255 2.716h-6.64l.24 2.573h6.182l-.366 3.523-2.91.804-2.956-.81-.188-2.11h-2.61l.29 3.855L12 19.288l5.373-1.53L18.59 4.414z"/></svg>');--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0V0zm22.034 18.276c-.175-1.095-.888-2.015-3.003-2.873-.736-.345-1.554-.585-1.797-1.14-.091-.33-.105-.51-.046-.705.15-.646.915-.84 1.515-.66.39.12.75.42.976.9 1.034-.676 1.034-.676 1.755-1.125-.27-.42-.404-.601-.586-.78-.63-.705-1.469-1.065-2.834-1.034l-.705.089c-.676.165-1.32.525-1.71 1.005-1.14 1.291-.811 3.541.569 4.471 1.365 1.02 3.361 1.244 3.616 2.205.24 1.17-.87 1.545-1.966 1.41-.811-.18-1.26-.586-1.755-1.336l-1.83 1.051c.21.48.45.689.81 1.109 1.74 1.756 6.09 1.666 6.871-1.004.029-.09.24-.705.074-1.65l.046.067zm-8.983-7.245h-2.248c0 1.938-.009 3.864-.009 5.805 0 1.232.063 2.363-.138 2.711-.33.689-1.18.601-1.566.48-.396-.196-.597-.466-.83-.855-.063-.105-.11-.196-.127-.196l-1.825 1.125c.305.63.75 1.172 1.324 1.517.855.51 2.004.675 3.207.405.783-.226 1.458-.691 1.811-1.411.51-.93.402-2.07.397-3.346.012-2.054 0-4.109 0-6.179l.004-.056z"/></svg>');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M23.546 10.93 13.067.452a1.55 1.55 0 0 0-2.188 0L8.708 2.627l2.76 2.76a1.838 1.838 0 0 1 2.327 2.341l2.658 2.66a1.838 1.838 0 0 1 1.9 3.039 1.837 1.837 0 0 1-2.6 0 1.846 1.846 0 0 1-.404-1.996L12.86 8.955v6.525c.176.086.342.203.488.348a1.848 1.848 0 0 1 0 2.6 1.844 1.844 0 0 1-2.609 0 1.834 1.834 0 0 1 0-2.598c.182-.18.387-.316.605-.406V8.835a1.834 1.834 0 0 1-.996-2.41L7.636 3.7.45 10.881c-.6.605-.6 1.584 0 2.189l10.48 10.477a1.545 1.545 0 0 0 2.186 0l10.43-10.43a1.544 1.544 0 0 0 0-2.187"/></svg>');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M23.181 2.974c.568 0 .923.463.792 1.035l-3.659 15.982c-.13.572-.697 1.035-1.265 1.035H.819c-.568 0-.923-.463-.792-1.035L3.686 4.009c.13-.572.697-1.035 1.265-1.035zm-8.375 9.346c.251-.394.227-.905-.09-1.243L9.122 5.125c-.38-.404-1.037-.407-1.466-.003-.429.402-.468 1.056-.088 1.46l4.662 4.96v.11l-7.42 5.374c-.45.327-.533.977-.187 1.453.346.476.991.597 1.44.27l8.229-5.91c.28-.196.438-.365.514-.52zm-2.796 4.399a.928.928 0 0 0-.934.923c0 .51.418.923.934.923h4.433a.928.928 0 0 0 .934-.923.928.928 0 0 0-.934-.923z"/></svg>');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.25.18.9.2.73.26.59.3.45.32.34.34.25.34.16.33.1.3.04.26.02.2-.01.13V8.5l-.05.63-.13.55-.21.46-.26.38-.3.31-.33.25-.35.19-.35.14-.33.1-.3.07-.26.04-.21.02H8.77l-.69.05-.59.14-.5.22-.41.27-.33.32-.27.35-.2.36-.15.37-.1.35-.07.32-.04.27-.02.21v3.06H3.17l-.21-.03-.28-.07-.32-.12-.35-.18-.36-.26-.36-.36-.35-.46-.32-.59-.28-.73-.21-.88-.14-1.05-.05-1.23.06-1.22.16-1.04.24-.87.32-.71.36-.57.4-.44.42-.33.42-.24.4-.16.36-.1.32-.05.24-.01h.16l.06.01h8.16v-.83H6.18l-.01-2.75-.02-.37.05-.34.11-.31.17-.28.25-.26.31-.23.38-.2.44-.18.51-.15.58-.12.64-.1.71-.06.77-.04.84-.02 1.27.05zm-6.3 1.98-.23.33-.08.41.08.41.23.34.33.22.41.09.41-.09.33-.22.23-.34.08-.41-.08-.41-.23-.33-.33-.22-.41-.09-.41.09zm13.09 3.95.28.06.32.12.35.18.36.27.36.35.35.47.32.59.28.73.21.88.14 1.04.05 1.23-.06 1.23-.16 1.04-.24.86-.32.71-.36.57-.4.45-.42.33-.42.24-.4.16-.36.09-.32.05-.24.02-.16-.01h-8.22v.82h5.84l.01 2.76.02.36-.05.34-.11.31-.17.29-.25.25-.31.24-.38.2-.44.17-.51.15-.58.13-.64.09-.71.07-.77.04-.84.01-1.27-.04-1.07-.14-.9-.2-.73-.25-.59-.3-.45-.33-.34-.34-.25-.34-.16-.33-.1-.3-.04-.25-.02-.2.01-.13v-5.34l.05-.64.13-.54.21-.46.26-.38.3-.32.33-.24.35-.2.35-.14.33-.1.3-.06.26-.04.21-.02.13-.01h5.84l.69-.05.59-.14.5-.21.41-.28.33-.32.27-.35.2-.36.15-.36.1-.35.07-.32.04-.28.02-.21V6.07h2.09l.14.01zm-6.47 14.25-.23.33-.08.41.08.41.23.33.33.23.41.08.41-.08.33-.23.23-.33.08-.41-.08-.41-.23-.33-.33-.23-.41-.08-.41.08z"/></svg>');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 13h-2V7h2m0 10h-2v-2h2M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10A10 10 0 0 0 12 2Z"/></svg>');}</style>



    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#helpera2gmeasurements" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="A2G Measurements Software" class="md-header__button md-logo" aria-label="A2G Measurements Software" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            A2G Measurements Software
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Nodes communication
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="lime" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../GettingStarted/" class="md-tabs__link">
        
  
    
  
  Install

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../MeasurementSystem/" class="md-tabs__link">
          
  
  Measurement system

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../GuideForGUI/" class="md-tabs__link">
          
  
  Guide for using the GUI

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../Troubleshooting/" class="md-tabs__link">
        
  
    
  
  Troubleshooting

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../ChangeComProtocol/" class="md-tabs__link">
          
  
  For developers

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../PlanningMeasurements/" class="md-tabs__link">
          
  
  Measurements

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../GimbalRS2/" class="md-tabs__link">
          
  
  API reference

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="A2G Measurements Software" class="md-nav__button md-logo" aria-label="A2G Measurements Software" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    A2G Measurements Software
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../GettingStarted/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Install
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Measurement system
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Measurement system
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../MeasurementSystem/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Description & connections
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../NodeComponents/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Node components
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../CommunicationProtocol/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Communication between nodes
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Guide for using the GUI
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Guide for using the GUI
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../GuideForGUI/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../QuickStart/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quick Start
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../PanelsGUI/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Panels in GUI
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Troubleshooting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Troubleshooting
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    For developers
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            For developers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ChangeComProtocol/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Extend/change communication protocol
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../EditGUITour/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Change the GUI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../GimbalWebApp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Transition to web app
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Measurements
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Measurements
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../PlanningMeasurements/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Planning tool
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../MeasMethodology/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Measurements methodology
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ReproducePrevMeasurements/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Previous campaings
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" checked>
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="">
            
  
  <span class="md-ellipsis">
    API reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            API reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../GimbalRS2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DJI Ronin RS2 gimbal
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../GpsSignaling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Septentrio GPS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../AnritsuSA/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Anritsu Spectrum Analyzer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Nodes communication
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Nodes communication
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#a2gmeasurements.HelperA2GMeasurements" class="md-nav__link">
    <span class="md-ellipsis">
      HelperA2GMeasurements
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a2gmeasurements.HelperA2GMeasurements.HelperA2GStopCom" class="md-nav__link">
    <span class="md-ellipsis">
      HelperA2GStopCom
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a2gmeasurements.HelperA2GMeasurements.HelperStartA2GCom" class="md-nav__link">
    <span class="md-ellipsis">
      HelperStartA2GCom
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a2gmeasurements.HelperA2GMeasurements.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a2gmeasurements.HelperA2GMeasurements.az_rot_gnd_gimbal_toggle_sig_generator" class="md-nav__link">
    <span class="md-ellipsis">
      az_rot_gnd_gimbal_toggle_sig_generator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a2gmeasurements.HelperA2GMeasurements.decode_message" class="md-nav__link">
    <span class="md-ellipsis">
      decode_message
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a2gmeasurements.HelperA2GMeasurements.do_closed_gui_action" class="md-nav__link">
    <span class="md-ellipsis">
      do_closed_gui_action
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a2gmeasurements.HelperA2GMeasurements.do_finish_meas_drone_rfsoc" class="md-nav__link">
    <span class="md-ellipsis">
      do_finish_meas_drone_rfsoc
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a2gmeasurements.HelperA2GMeasurements.do_follow_mode_gimbal" class="md-nav__link">
    <span class="md-ellipsis">
      do_follow_mode_gimbal
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a2gmeasurements.HelperA2GMeasurements.do_getgps_action" class="md-nav__link">
    <span class="md-ellipsis">
      do_getgps_action
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a2gmeasurements.HelperA2GMeasurements.do_set_irf_action" class="md-nav__link">
    <span class="md-ellipsis">
      do_set_irf_action
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a2gmeasurements.HelperA2GMeasurements.do_set_remote_fm_flag" class="md-nav__link">
    <span class="md-ellipsis">
      do_set_remote_fm_flag
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a2gmeasurements.HelperA2GMeasurements.do_set_remote_stop_fm" class="md-nav__link">
    <span class="md-ellipsis">
      do_set_remote_stop_fm
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a2gmeasurements.HelperA2GMeasurements.do_setgimbal_action" class="md-nav__link">
    <span class="md-ellipsis">
      do_setgimbal_action
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a2gmeasurements.HelperA2GMeasurements.do_start_meas_drone_rfsoc" class="md-nav__link">
    <span class="md-ellipsis">
      do_start_meas_drone_rfsoc
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a2gmeasurements.HelperA2GMeasurements.do_stop_meas_drone_rfsoc" class="md-nav__link">
    <span class="md-ellipsis">
      do_stop_meas_drone_rfsoc
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a2gmeasurements.HelperA2GMeasurements.encode_message" class="md-nav__link">
    <span class="md-ellipsis">
      encode_message
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a2gmeasurements.HelperA2GMeasurements.gimbal_follows_drone" class="md-nav__link">
    <span class="md-ellipsis">
      gimbal_follows_drone
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a2gmeasurements.HelperA2GMeasurements.process_answer_get_gps" class="md-nav__link">
    <span class="md-ellipsis">
      process_answer_get_gps
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a2gmeasurements.HelperA2GMeasurements.socket_receive" class="md-nav__link">
    <span class="md-ellipsis">
      socket_receive
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a2gmeasurements.HelperA2GMeasurements.socket_send_cmd" class="md-nav__link">
    <span class="md-ellipsis">
      socket_send_cmd
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../GimbalGremsyH16/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gremsy H16 gimbal
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../SBUSEncoder/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SBUS encoder
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../RFSoCHandler/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RFSoC communication
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../GUIsetupWin/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Graphical User Interface - Setup window
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../GUIwidgetGallery/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Graphical User Interface - Main window
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Utility functions
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#a2gmeasurements.HelperA2GMeasurements" class="md-nav__link">
    <span class="md-ellipsis">
      HelperA2GMeasurements
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a2gmeasurements.HelperA2GMeasurements.HelperA2GStopCom" class="md-nav__link">
    <span class="md-ellipsis">
      HelperA2GStopCom
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a2gmeasurements.HelperA2GMeasurements.HelperStartA2GCom" class="md-nav__link">
    <span class="md-ellipsis">
      HelperStartA2GCom
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a2gmeasurements.HelperA2GMeasurements.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a2gmeasurements.HelperA2GMeasurements.az_rot_gnd_gimbal_toggle_sig_generator" class="md-nav__link">
    <span class="md-ellipsis">
      az_rot_gnd_gimbal_toggle_sig_generator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a2gmeasurements.HelperA2GMeasurements.decode_message" class="md-nav__link">
    <span class="md-ellipsis">
      decode_message
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a2gmeasurements.HelperA2GMeasurements.do_closed_gui_action" class="md-nav__link">
    <span class="md-ellipsis">
      do_closed_gui_action
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a2gmeasurements.HelperA2GMeasurements.do_finish_meas_drone_rfsoc" class="md-nav__link">
    <span class="md-ellipsis">
      do_finish_meas_drone_rfsoc
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a2gmeasurements.HelperA2GMeasurements.do_follow_mode_gimbal" class="md-nav__link">
    <span class="md-ellipsis">
      do_follow_mode_gimbal
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a2gmeasurements.HelperA2GMeasurements.do_getgps_action" class="md-nav__link">
    <span class="md-ellipsis">
      do_getgps_action
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a2gmeasurements.HelperA2GMeasurements.do_set_irf_action" class="md-nav__link">
    <span class="md-ellipsis">
      do_set_irf_action
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a2gmeasurements.HelperA2GMeasurements.do_set_remote_fm_flag" class="md-nav__link">
    <span class="md-ellipsis">
      do_set_remote_fm_flag
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a2gmeasurements.HelperA2GMeasurements.do_set_remote_stop_fm" class="md-nav__link">
    <span class="md-ellipsis">
      do_set_remote_stop_fm
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a2gmeasurements.HelperA2GMeasurements.do_setgimbal_action" class="md-nav__link">
    <span class="md-ellipsis">
      do_setgimbal_action
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a2gmeasurements.HelperA2GMeasurements.do_start_meas_drone_rfsoc" class="md-nav__link">
    <span class="md-ellipsis">
      do_start_meas_drone_rfsoc
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a2gmeasurements.HelperA2GMeasurements.do_stop_meas_drone_rfsoc" class="md-nav__link">
    <span class="md-ellipsis">
      do_stop_meas_drone_rfsoc
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a2gmeasurements.HelperA2GMeasurements.encode_message" class="md-nav__link">
    <span class="md-ellipsis">
      encode_message
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a2gmeasurements.HelperA2GMeasurements.gimbal_follows_drone" class="md-nav__link">
    <span class="md-ellipsis">
      gimbal_follows_drone
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a2gmeasurements.HelperA2GMeasurements.process_answer_get_gps" class="md-nav__link">
    <span class="md-ellipsis">
      process_answer_get_gps
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a2gmeasurements.HelperA2GMeasurements.socket_receive" class="md-nav__link">
    <span class="md-ellipsis">
      socket_receive
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a2gmeasurements.HelperA2GMeasurements.socket_send_cmd" class="md-nav__link">
    <span class="md-ellipsis">
      socket_send_cmd
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="helpera2gmeasurements">HelperA2GMeasurements</h1>
<h2>Communication between the nodes handler</h2>



<div class="doc doc-object doc-class">



<a id="a2gmeasurements.HelperA2GMeasurements"></a>
    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code>object</code></p>


      <p>Python class for handling the interaction between the multiple devices available in the system: gps, gimbal and rfsoc.</p>
<p>It creates instances of each class handling one of those devices (i.e. GimbalRS2, GpsSignaling).</p>
<p>It creates a wireless TCP connection between the host computers of both nodes (air and ground node) to control devices and retrieve information from them.</p>
<p>It creates a thread (called here communication thread) to handle the communication between the host computers of both nodes.</p>
<ul>
<li>
<p><code>MAX_TIME_EMPTY_SOCKETS</code>: the maximum allowed time to wait if no information was sent over a socket.</p>
</li>
<li>
<p><code>CONN_MUST_OVER_FLAG</code>: a (boolean) flag indicating whether to close or not the connection between the host computers.</p>
</li>
<li>
<p><code>drone_fm_flag</code>: a (boolean) flag set at the GUI indicating whether the air node's gimbal should follow the ground node. In all our documentation, a gimbal is said to be in "follow mode" (don't confuse with DJI's RS2 camera-based follow mode) if it follows the other node. </p>
</li>
<li>
<p><code>PAP_TO_PLOT</code>: a numpy array (of size defined in the method <code>pipeline_operations_rfsoc_rx_ndarray</code>of the class <code>RFSoCRemoteControlFromHost</code>) used to plot the Power Angular Profile (PAP) of the wireless channel in GUI's PAP Panel.</p>
</li>
</ul>

              <details class="quote">
                <summary>Source code in <code>a2gmeasurements.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1465">1465</a></span>
<span class="normal"><a href="#__codelineno-0-1466">1466</a></span>
<span class="normal"><a href="#__codelineno-0-1467">1467</a></span>
<span class="normal"><a href="#__codelineno-0-1468">1468</a></span>
<span class="normal"><a href="#__codelineno-0-1469">1469</a></span>
<span class="normal"><a href="#__codelineno-0-1470">1470</a></span>
<span class="normal"><a href="#__codelineno-0-1471">1471</a></span>
<span class="normal"><a href="#__codelineno-0-1472">1472</a></span>
<span class="normal"><a href="#__codelineno-0-1473">1473</a></span>
<span class="normal"><a href="#__codelineno-0-1474">1474</a></span>
<span class="normal"><a href="#__codelineno-0-1475">1475</a></span>
<span class="normal"><a href="#__codelineno-0-1476">1476</a></span>
<span class="normal"><a href="#__codelineno-0-1477">1477</a></span>
<span class="normal"><a href="#__codelineno-0-1478">1478</a></span>
<span class="normal"><a href="#__codelineno-0-1479">1479</a></span>
<span class="normal"><a href="#__codelineno-0-1480">1480</a></span>
<span class="normal"><a href="#__codelineno-0-1481">1481</a></span>
<span class="normal"><a href="#__codelineno-0-1482">1482</a></span>
<span class="normal"><a href="#__codelineno-0-1483">1483</a></span>
<span class="normal"><a href="#__codelineno-0-1484">1484</a></span>
<span class="normal"><a href="#__codelineno-0-1485">1485</a></span>
<span class="normal"><a href="#__codelineno-0-1486">1486</a></span>
<span class="normal"><a href="#__codelineno-0-1487">1487</a></span>
<span class="normal"><a href="#__codelineno-0-1488">1488</a></span>
<span class="normal"><a href="#__codelineno-0-1489">1489</a></span>
<span class="normal"><a href="#__codelineno-0-1490">1490</a></span>
<span class="normal"><a href="#__codelineno-0-1491">1491</a></span>
<span class="normal"><a href="#__codelineno-0-1492">1492</a></span>
<span class="normal"><a href="#__codelineno-0-1493">1493</a></span>
<span class="normal"><a href="#__codelineno-0-1494">1494</a></span>
<span class="normal"><a href="#__codelineno-0-1495">1495</a></span>
<span class="normal"><a href="#__codelineno-0-1496">1496</a></span>
<span class="normal"><a href="#__codelineno-0-1497">1497</a></span>
<span class="normal"><a href="#__codelineno-0-1498">1498</a></span>
<span class="normal"><a href="#__codelineno-0-1499">1499</a></span>
<span class="normal"><a href="#__codelineno-0-1500">1500</a></span>
<span class="normal"><a href="#__codelineno-0-1501">1501</a></span>
<span class="normal"><a href="#__codelineno-0-1502">1502</a></span>
<span class="normal"><a href="#__codelineno-0-1503">1503</a></span>
<span class="normal"><a href="#__codelineno-0-1504">1504</a></span>
<span class="normal"><a href="#__codelineno-0-1505">1505</a></span>
<span class="normal"><a href="#__codelineno-0-1506">1506</a></span>
<span class="normal"><a href="#__codelineno-0-1507">1507</a></span>
<span class="normal"><a href="#__codelineno-0-1508">1508</a></span>
<span class="normal"><a href="#__codelineno-0-1509">1509</a></span>
<span class="normal"><a href="#__codelineno-0-1510">1510</a></span>
<span class="normal"><a href="#__codelineno-0-1511">1511</a></span>
<span class="normal"><a href="#__codelineno-0-1512">1512</a></span>
<span class="normal"><a href="#__codelineno-0-1513">1513</a></span>
<span class="normal"><a href="#__codelineno-0-1514">1514</a></span>
<span class="normal"><a href="#__codelineno-0-1515">1515</a></span>
<span class="normal"><a href="#__codelineno-0-1516">1516</a></span>
<span class="normal"><a href="#__codelineno-0-1517">1517</a></span>
<span class="normal"><a href="#__codelineno-0-1518">1518</a></span>
<span class="normal"><a href="#__codelineno-0-1519">1519</a></span>
<span class="normal"><a href="#__codelineno-0-1520">1520</a></span>
<span class="normal"><a href="#__codelineno-0-1521">1521</a></span>
<span class="normal"><a href="#__codelineno-0-1522">1522</a></span>
<span class="normal"><a href="#__codelineno-0-1523">1523</a></span>
<span class="normal"><a href="#__codelineno-0-1524">1524</a></span>
<span class="normal"><a href="#__codelineno-0-1525">1525</a></span>
<span class="normal"><a href="#__codelineno-0-1526">1526</a></span>
<span class="normal"><a href="#__codelineno-0-1527">1527</a></span>
<span class="normal"><a href="#__codelineno-0-1528">1528</a></span>
<span class="normal"><a href="#__codelineno-0-1529">1529</a></span>
<span class="normal"><a href="#__codelineno-0-1530">1530</a></span>
<span class="normal"><a href="#__codelineno-0-1531">1531</a></span>
<span class="normal"><a href="#__codelineno-0-1532">1532</a></span>
<span class="normal"><a href="#__codelineno-0-1533">1533</a></span>
<span class="normal"><a href="#__codelineno-0-1534">1534</a></span>
<span class="normal"><a href="#__codelineno-0-1535">1535</a></span>
<span class="normal"><a href="#__codelineno-0-1536">1536</a></span>
<span class="normal"><a href="#__codelineno-0-1537">1537</a></span>
<span class="normal"><a href="#__codelineno-0-1538">1538</a></span>
<span class="normal"><a href="#__codelineno-0-1539">1539</a></span>
<span class="normal"><a href="#__codelineno-0-1540">1540</a></span>
<span class="normal"><a href="#__codelineno-0-1541">1541</a></span>
<span class="normal"><a href="#__codelineno-0-1542">1542</a></span>
<span class="normal"><a href="#__codelineno-0-1543">1543</a></span>
<span class="normal"><a href="#__codelineno-0-1544">1544</a></span>
<span class="normal"><a href="#__codelineno-0-1545">1545</a></span>
<span class="normal"><a href="#__codelineno-0-1546">1546</a></span>
<span class="normal"><a href="#__codelineno-0-1547">1547</a></span>
<span class="normal"><a href="#__codelineno-0-1548">1548</a></span>
<span class="normal"><a href="#__codelineno-0-1549">1549</a></span>
<span class="normal"><a href="#__codelineno-0-1550">1550</a></span>
<span class="normal"><a href="#__codelineno-0-1551">1551</a></span>
<span class="normal"><a href="#__codelineno-0-1552">1552</a></span>
<span class="normal"><a href="#__codelineno-0-1553">1553</a></span>
<span class="normal"><a href="#__codelineno-0-1554">1554</a></span>
<span class="normal"><a href="#__codelineno-0-1555">1555</a></span>
<span class="normal"><a href="#__codelineno-0-1556">1556</a></span>
<span class="normal"><a href="#__codelineno-0-1557">1557</a></span>
<span class="normal"><a href="#__codelineno-0-1558">1558</a></span>
<span class="normal"><a href="#__codelineno-0-1559">1559</a></span>
<span class="normal"><a href="#__codelineno-0-1560">1560</a></span>
<span class="normal"><a href="#__codelineno-0-1561">1561</a></span>
<span class="normal"><a href="#__codelineno-0-1562">1562</a></span>
<span class="normal"><a href="#__codelineno-0-1563">1563</a></span>
<span class="normal"><a href="#__codelineno-0-1564">1564</a></span>
<span class="normal"><a href="#__codelineno-0-1565">1565</a></span>
<span class="normal"><a href="#__codelineno-0-1566">1566</a></span>
<span class="normal"><a href="#__codelineno-0-1567">1567</a></span>
<span class="normal"><a href="#__codelineno-0-1568">1568</a></span>
<span class="normal"><a href="#__codelineno-0-1569">1569</a></span>
<span class="normal"><a href="#__codelineno-0-1570">1570</a></span>
<span class="normal"><a href="#__codelineno-0-1571">1571</a></span>
<span class="normal"><a href="#__codelineno-0-1572">1572</a></span>
<span class="normal"><a href="#__codelineno-0-1573">1573</a></span>
<span class="normal"><a href="#__codelineno-0-1574">1574</a></span>
<span class="normal"><a href="#__codelineno-0-1575">1575</a></span>
<span class="normal"><a href="#__codelineno-0-1576">1576</a></span>
<span class="normal"><a href="#__codelineno-0-1577">1577</a></span>
<span class="normal"><a href="#__codelineno-0-1578">1578</a></span>
<span class="normal"><a href="#__codelineno-0-1579">1579</a></span>
<span class="normal"><a href="#__codelineno-0-1580">1580</a></span>
<span class="normal"><a href="#__codelineno-0-1581">1581</a></span>
<span class="normal"><a href="#__codelineno-0-1582">1582</a></span>
<span class="normal"><a href="#__codelineno-0-1583">1583</a></span>
<span class="normal"><a href="#__codelineno-0-1584">1584</a></span>
<span class="normal"><a href="#__codelineno-0-1585">1585</a></span>
<span class="normal"><a href="#__codelineno-0-1586">1586</a></span>
<span class="normal"><a href="#__codelineno-0-1587">1587</a></span>
<span class="normal"><a href="#__codelineno-0-1588">1588</a></span>
<span class="normal"><a href="#__codelineno-0-1589">1589</a></span>
<span class="normal"><a href="#__codelineno-0-1590">1590</a></span>
<span class="normal"><a href="#__codelineno-0-1591">1591</a></span>
<span class="normal"><a href="#__codelineno-0-1592">1592</a></span>
<span class="normal"><a href="#__codelineno-0-1593">1593</a></span>
<span class="normal"><a href="#__codelineno-0-1594">1594</a></span>
<span class="normal"><a href="#__codelineno-0-1595">1595</a></span>
<span class="normal"><a href="#__codelineno-0-1596">1596</a></span>
<span class="normal"><a href="#__codelineno-0-1597">1597</a></span>
<span class="normal"><a href="#__codelineno-0-1598">1598</a></span>
<span class="normal"><a href="#__codelineno-0-1599">1599</a></span>
<span class="normal"><a href="#__codelineno-0-1600">1600</a></span>
<span class="normal"><a href="#__codelineno-0-1601">1601</a></span>
<span class="normal"><a href="#__codelineno-0-1602">1602</a></span>
<span class="normal"><a href="#__codelineno-0-1603">1603</a></span>
<span class="normal"><a href="#__codelineno-0-1604">1604</a></span>
<span class="normal"><a href="#__codelineno-0-1605">1605</a></span>
<span class="normal"><a href="#__codelineno-0-1606">1606</a></span>
<span class="normal"><a href="#__codelineno-0-1607">1607</a></span>
<span class="normal"><a href="#__codelineno-0-1608">1608</a></span>
<span class="normal"><a href="#__codelineno-0-1609">1609</a></span>
<span class="normal"><a href="#__codelineno-0-1610">1610</a></span>
<span class="normal"><a href="#__codelineno-0-1611">1611</a></span>
<span class="normal"><a href="#__codelineno-0-1612">1612</a></span>
<span class="normal"><a href="#__codelineno-0-1613">1613</a></span>
<span class="normal"><a href="#__codelineno-0-1614">1614</a></span>
<span class="normal"><a href="#__codelineno-0-1615">1615</a></span>
<span class="normal"><a href="#__codelineno-0-1616">1616</a></span>
<span class="normal"><a href="#__codelineno-0-1617">1617</a></span>
<span class="normal"><a href="#__codelineno-0-1618">1618</a></span>
<span class="normal"><a href="#__codelineno-0-1619">1619</a></span>
<span class="normal"><a href="#__codelineno-0-1620">1620</a></span>
<span class="normal"><a href="#__codelineno-0-1621">1621</a></span>
<span class="normal"><a href="#__codelineno-0-1622">1622</a></span>
<span class="normal"><a href="#__codelineno-0-1623">1623</a></span>
<span class="normal"><a href="#__codelineno-0-1624">1624</a></span>
<span class="normal"><a href="#__codelineno-0-1625">1625</a></span>
<span class="normal"><a href="#__codelineno-0-1626">1626</a></span>
<span class="normal"><a href="#__codelineno-0-1627">1627</a></span>
<span class="normal"><a href="#__codelineno-0-1628">1628</a></span>
<span class="normal"><a href="#__codelineno-0-1629">1629</a></span>
<span class="normal"><a href="#__codelineno-0-1630">1630</a></span>
<span class="normal"><a href="#__codelineno-0-1631">1631</a></span>
<span class="normal"><a href="#__codelineno-0-1632">1632</a></span>
<span class="normal"><a href="#__codelineno-0-1633">1633</a></span>
<span class="normal"><a href="#__codelineno-0-1634">1634</a></span>
<span class="normal"><a href="#__codelineno-0-1635">1635</a></span>
<span class="normal"><a href="#__codelineno-0-1636">1636</a></span>
<span class="normal"><a href="#__codelineno-0-1637">1637</a></span>
<span class="normal"><a href="#__codelineno-0-1638">1638</a></span>
<span class="normal"><a href="#__codelineno-0-1639">1639</a></span>
<span class="normal"><a href="#__codelineno-0-1640">1640</a></span>
<span class="normal"><a href="#__codelineno-0-1641">1641</a></span>
<span class="normal"><a href="#__codelineno-0-1642">1642</a></span>
<span class="normal"><a href="#__codelineno-0-1643">1643</a></span>
<span class="normal"><a href="#__codelineno-0-1644">1644</a></span>
<span class="normal"><a href="#__codelineno-0-1645">1645</a></span>
<span class="normal"><a href="#__codelineno-0-1646">1646</a></span>
<span class="normal"><a href="#__codelineno-0-1647">1647</a></span>
<span class="normal"><a href="#__codelineno-0-1648">1648</a></span>
<span class="normal"><a href="#__codelineno-0-1649">1649</a></span>
<span class="normal"><a href="#__codelineno-0-1650">1650</a></span>
<span class="normal"><a href="#__codelineno-0-1651">1651</a></span>
<span class="normal"><a href="#__codelineno-0-1652">1652</a></span>
<span class="normal"><a href="#__codelineno-0-1653">1653</a></span>
<span class="normal"><a href="#__codelineno-0-1654">1654</a></span>
<span class="normal"><a href="#__codelineno-0-1655">1655</a></span>
<span class="normal"><a href="#__codelineno-0-1656">1656</a></span>
<span class="normal"><a href="#__codelineno-0-1657">1657</a></span>
<span class="normal"><a href="#__codelineno-0-1658">1658</a></span>
<span class="normal"><a href="#__codelineno-0-1659">1659</a></span>
<span class="normal"><a href="#__codelineno-0-1660">1660</a></span>
<span class="normal"><a href="#__codelineno-0-1661">1661</a></span>
<span class="normal"><a href="#__codelineno-0-1662">1662</a></span>
<span class="normal"><a href="#__codelineno-0-1663">1663</a></span>
<span class="normal"><a href="#__codelineno-0-1664">1664</a></span>
<span class="normal"><a href="#__codelineno-0-1665">1665</a></span>
<span class="normal"><a href="#__codelineno-0-1666">1666</a></span>
<span class="normal"><a href="#__codelineno-0-1667">1667</a></span>
<span class="normal"><a href="#__codelineno-0-1668">1668</a></span>
<span class="normal"><a href="#__codelineno-0-1669">1669</a></span>
<span class="normal"><a href="#__codelineno-0-1670">1670</a></span>
<span class="normal"><a href="#__codelineno-0-1671">1671</a></span>
<span class="normal"><a href="#__codelineno-0-1672">1672</a></span>
<span class="normal"><a href="#__codelineno-0-1673">1673</a></span>
<span class="normal"><a href="#__codelineno-0-1674">1674</a></span>
<span class="normal"><a href="#__codelineno-0-1675">1675</a></span>
<span class="normal"><a href="#__codelineno-0-1676">1676</a></span>
<span class="normal"><a href="#__codelineno-0-1677">1677</a></span>
<span class="normal"><a href="#__codelineno-0-1678">1678</a></span>
<span class="normal"><a href="#__codelineno-0-1679">1679</a></span>
<span class="normal"><a href="#__codelineno-0-1680">1680</a></span>
<span class="normal"><a href="#__codelineno-0-1681">1681</a></span>
<span class="normal"><a href="#__codelineno-0-1682">1682</a></span>
<span class="normal"><a href="#__codelineno-0-1683">1683</a></span>
<span class="normal"><a href="#__codelineno-0-1684">1684</a></span>
<span class="normal"><a href="#__codelineno-0-1685">1685</a></span>
<span class="normal"><a href="#__codelineno-0-1686">1686</a></span>
<span class="normal"><a href="#__codelineno-0-1687">1687</a></span>
<span class="normal"><a href="#__codelineno-0-1688">1688</a></span>
<span class="normal"><a href="#__codelineno-0-1689">1689</a></span>
<span class="normal"><a href="#__codelineno-0-1690">1690</a></span>
<span class="normal"><a href="#__codelineno-0-1691">1691</a></span>
<span class="normal"><a href="#__codelineno-0-1692">1692</a></span>
<span class="normal"><a href="#__codelineno-0-1693">1693</a></span>
<span class="normal"><a href="#__codelineno-0-1694">1694</a></span>
<span class="normal"><a href="#__codelineno-0-1695">1695</a></span>
<span class="normal"><a href="#__codelineno-0-1696">1696</a></span>
<span class="normal"><a href="#__codelineno-0-1697">1697</a></span>
<span class="normal"><a href="#__codelineno-0-1698">1698</a></span>
<span class="normal"><a href="#__codelineno-0-1699">1699</a></span>
<span class="normal"><a href="#__codelineno-0-1700">1700</a></span>
<span class="normal"><a href="#__codelineno-0-1701">1701</a></span>
<span class="normal"><a href="#__codelineno-0-1702">1702</a></span>
<span class="normal"><a href="#__codelineno-0-1703">1703</a></span>
<span class="normal"><a href="#__codelineno-0-1704">1704</a></span>
<span class="normal"><a href="#__codelineno-0-1705">1705</a></span>
<span class="normal"><a href="#__codelineno-0-1706">1706</a></span>
<span class="normal"><a href="#__codelineno-0-1707">1707</a></span>
<span class="normal"><a href="#__codelineno-0-1708">1708</a></span>
<span class="normal"><a href="#__codelineno-0-1709">1709</a></span>
<span class="normal"><a href="#__codelineno-0-1710">1710</a></span>
<span class="normal"><a href="#__codelineno-0-1711">1711</a></span>
<span class="normal"><a href="#__codelineno-0-1712">1712</a></span>
<span class="normal"><a href="#__codelineno-0-1713">1713</a></span>
<span class="normal"><a href="#__codelineno-0-1714">1714</a></span>
<span class="normal"><a href="#__codelineno-0-1715">1715</a></span>
<span class="normal"><a href="#__codelineno-0-1716">1716</a></span>
<span class="normal"><a href="#__codelineno-0-1717">1717</a></span>
<span class="normal"><a href="#__codelineno-0-1718">1718</a></span>
<span class="normal"><a href="#__codelineno-0-1719">1719</a></span>
<span class="normal"><a href="#__codelineno-0-1720">1720</a></span>
<span class="normal"><a href="#__codelineno-0-1721">1721</a></span>
<span class="normal"><a href="#__codelineno-0-1722">1722</a></span>
<span class="normal"><a href="#__codelineno-0-1723">1723</a></span>
<span class="normal"><a href="#__codelineno-0-1724">1724</a></span>
<span class="normal"><a href="#__codelineno-0-1725">1725</a></span>
<span class="normal"><a href="#__codelineno-0-1726">1726</a></span>
<span class="normal"><a href="#__codelineno-0-1727">1727</a></span>
<span class="normal"><a href="#__codelineno-0-1728">1728</a></span>
<span class="normal"><a href="#__codelineno-0-1729">1729</a></span>
<span class="normal"><a href="#__codelineno-0-1730">1730</a></span>
<span class="normal"><a href="#__codelineno-0-1731">1731</a></span>
<span class="normal"><a href="#__codelineno-0-1732">1732</a></span>
<span class="normal"><a href="#__codelineno-0-1733">1733</a></span>
<span class="normal"><a href="#__codelineno-0-1734">1734</a></span>
<span class="normal"><a href="#__codelineno-0-1735">1735</a></span>
<span class="normal"><a href="#__codelineno-0-1736">1736</a></span>
<span class="normal"><a href="#__codelineno-0-1737">1737</a></span>
<span class="normal"><a href="#__codelineno-0-1738">1738</a></span>
<span class="normal"><a href="#__codelineno-0-1739">1739</a></span>
<span class="normal"><a href="#__codelineno-0-1740">1740</a></span>
<span class="normal"><a href="#__codelineno-0-1741">1741</a></span>
<span class="normal"><a href="#__codelineno-0-1742">1742</a></span>
<span class="normal"><a href="#__codelineno-0-1743">1743</a></span>
<span class="normal"><a href="#__codelineno-0-1744">1744</a></span>
<span class="normal"><a href="#__codelineno-0-1745">1745</a></span>
<span class="normal"><a href="#__codelineno-0-1746">1746</a></span>
<span class="normal"><a href="#__codelineno-0-1747">1747</a></span>
<span class="normal"><a href="#__codelineno-0-1748">1748</a></span>
<span class="normal"><a href="#__codelineno-0-1749">1749</a></span>
<span class="normal"><a href="#__codelineno-0-1750">1750</a></span>
<span class="normal"><a href="#__codelineno-0-1751">1751</a></span>
<span class="normal"><a href="#__codelineno-0-1752">1752</a></span>
<span class="normal"><a href="#__codelineno-0-1753">1753</a></span>
<span class="normal"><a href="#__codelineno-0-1754">1754</a></span>
<span class="normal"><a href="#__codelineno-0-1755">1755</a></span>
<span class="normal"><a href="#__codelineno-0-1756">1756</a></span>
<span class="normal"><a href="#__codelineno-0-1757">1757</a></span>
<span class="normal"><a href="#__codelineno-0-1758">1758</a></span>
<span class="normal"><a href="#__codelineno-0-1759">1759</a></span>
<span class="normal"><a href="#__codelineno-0-1760">1760</a></span>
<span class="normal"><a href="#__codelineno-0-1761">1761</a></span>
<span class="normal"><a href="#__codelineno-0-1762">1762</a></span>
<span class="normal"><a href="#__codelineno-0-1763">1763</a></span>
<span class="normal"><a href="#__codelineno-0-1764">1764</a></span>
<span class="normal"><a href="#__codelineno-0-1765">1765</a></span>
<span class="normal"><a href="#__codelineno-0-1766">1766</a></span>
<span class="normal"><a href="#__codelineno-0-1767">1767</a></span>
<span class="normal"><a href="#__codelineno-0-1768">1768</a></span>
<span class="normal"><a href="#__codelineno-0-1769">1769</a></span>
<span class="normal"><a href="#__codelineno-0-1770">1770</a></span>
<span class="normal"><a href="#__codelineno-0-1771">1771</a></span>
<span class="normal"><a href="#__codelineno-0-1772">1772</a></span>
<span class="normal"><a href="#__codelineno-0-1773">1773</a></span>
<span class="normal"><a href="#__codelineno-0-1774">1774</a></span>
<span class="normal"><a href="#__codelineno-0-1775">1775</a></span>
<span class="normal"><a href="#__codelineno-0-1776">1776</a></span>
<span class="normal"><a href="#__codelineno-0-1777">1777</a></span>
<span class="normal"><a href="#__codelineno-0-1778">1778</a></span>
<span class="normal"><a href="#__codelineno-0-1779">1779</a></span>
<span class="normal"><a href="#__codelineno-0-1780">1780</a></span>
<span class="normal"><a href="#__codelineno-0-1781">1781</a></span>
<span class="normal"><a href="#__codelineno-0-1782">1782</a></span>
<span class="normal"><a href="#__codelineno-0-1783">1783</a></span>
<span class="normal"><a href="#__codelineno-0-1784">1784</a></span>
<span class="normal"><a href="#__codelineno-0-1785">1785</a></span>
<span class="normal"><a href="#__codelineno-0-1786">1786</a></span>
<span class="normal"><a href="#__codelineno-0-1787">1787</a></span>
<span class="normal"><a href="#__codelineno-0-1788">1788</a></span>
<span class="normal"><a href="#__codelineno-0-1789">1789</a></span>
<span class="normal"><a href="#__codelineno-0-1790">1790</a></span>
<span class="normal"><a href="#__codelineno-0-1791">1791</a></span>
<span class="normal"><a href="#__codelineno-0-1792">1792</a></span>
<span class="normal"><a href="#__codelineno-0-1793">1793</a></span>
<span class="normal"><a href="#__codelineno-0-1794">1794</a></span>
<span class="normal"><a href="#__codelineno-0-1795">1795</a></span>
<span class="normal"><a href="#__codelineno-0-1796">1796</a></span>
<span class="normal"><a href="#__codelineno-0-1797">1797</a></span>
<span class="normal"><a href="#__codelineno-0-1798">1798</a></span>
<span class="normal"><a href="#__codelineno-0-1799">1799</a></span>
<span class="normal"><a href="#__codelineno-0-1800">1800</a></span>
<span class="normal"><a href="#__codelineno-0-1801">1801</a></span>
<span class="normal"><a href="#__codelineno-0-1802">1802</a></span>
<span class="normal"><a href="#__codelineno-0-1803">1803</a></span>
<span class="normal"><a href="#__codelineno-0-1804">1804</a></span>
<span class="normal"><a href="#__codelineno-0-1805">1805</a></span>
<span class="normal"><a href="#__codelineno-0-1806">1806</a></span>
<span class="normal"><a href="#__codelineno-0-1807">1807</a></span>
<span class="normal"><a href="#__codelineno-0-1808">1808</a></span>
<span class="normal"><a href="#__codelineno-0-1809">1809</a></span>
<span class="normal"><a href="#__codelineno-0-1810">1810</a></span>
<span class="normal"><a href="#__codelineno-0-1811">1811</a></span>
<span class="normal"><a href="#__codelineno-0-1812">1812</a></span>
<span class="normal"><a href="#__codelineno-0-1813">1813</a></span>
<span class="normal"><a href="#__codelineno-0-1814">1814</a></span>
<span class="normal"><a href="#__codelineno-0-1815">1815</a></span>
<span class="normal"><a href="#__codelineno-0-1816">1816</a></span>
<span class="normal"><a href="#__codelineno-0-1817">1817</a></span>
<span class="normal"><a href="#__codelineno-0-1818">1818</a></span>
<span class="normal"><a href="#__codelineno-0-1819">1819</a></span>
<span class="normal"><a href="#__codelineno-0-1820">1820</a></span>
<span class="normal"><a href="#__codelineno-0-1821">1821</a></span>
<span class="normal"><a href="#__codelineno-0-1822">1822</a></span>
<span class="normal"><a href="#__codelineno-0-1823">1823</a></span>
<span class="normal"><a href="#__codelineno-0-1824">1824</a></span>
<span class="normal"><a href="#__codelineno-0-1825">1825</a></span>
<span class="normal"><a href="#__codelineno-0-1826">1826</a></span>
<span class="normal"><a href="#__codelineno-0-1827">1827</a></span>
<span class="normal"><a href="#__codelineno-0-1828">1828</a></span>
<span class="normal"><a href="#__codelineno-0-1829">1829</a></span>
<span class="normal"><a href="#__codelineno-0-1830">1830</a></span>
<span class="normal"><a href="#__codelineno-0-1831">1831</a></span>
<span class="normal"><a href="#__codelineno-0-1832">1832</a></span>
<span class="normal"><a href="#__codelineno-0-1833">1833</a></span>
<span class="normal"><a href="#__codelineno-0-1834">1834</a></span>
<span class="normal"><a href="#__codelineno-0-1835">1835</a></span>
<span class="normal"><a href="#__codelineno-0-1836">1836</a></span>
<span class="normal"><a href="#__codelineno-0-1837">1837</a></span>
<span class="normal"><a href="#__codelineno-0-1838">1838</a></span>
<span class="normal"><a href="#__codelineno-0-1839">1839</a></span>
<span class="normal"><a href="#__codelineno-0-1840">1840</a></span>
<span class="normal"><a href="#__codelineno-0-1841">1841</a></span>
<span class="normal"><a href="#__codelineno-0-1842">1842</a></span>
<span class="normal"><a href="#__codelineno-0-1843">1843</a></span>
<span class="normal"><a href="#__codelineno-0-1844">1844</a></span>
<span class="normal"><a href="#__codelineno-0-1845">1845</a></span>
<span class="normal"><a href="#__codelineno-0-1846">1846</a></span>
<span class="normal"><a href="#__codelineno-0-1847">1847</a></span>
<span class="normal"><a href="#__codelineno-0-1848">1848</a></span>
<span class="normal"><a href="#__codelineno-0-1849">1849</a></span>
<span class="normal"><a href="#__codelineno-0-1850">1850</a></span>
<span class="normal"><a href="#__codelineno-0-1851">1851</a></span>
<span class="normal"><a href="#__codelineno-0-1852">1852</a></span>
<span class="normal"><a href="#__codelineno-0-1853">1853</a></span>
<span class="normal"><a href="#__codelineno-0-1854">1854</a></span>
<span class="normal"><a href="#__codelineno-0-1855">1855</a></span>
<span class="normal"><a href="#__codelineno-0-1856">1856</a></span>
<span class="normal"><a href="#__codelineno-0-1857">1857</a></span>
<span class="normal"><a href="#__codelineno-0-1858">1858</a></span>
<span class="normal"><a href="#__codelineno-0-1859">1859</a></span>
<span class="normal"><a href="#__codelineno-0-1860">1860</a></span>
<span class="normal"><a href="#__codelineno-0-1861">1861</a></span>
<span class="normal"><a href="#__codelineno-0-1862">1862</a></span>
<span class="normal"><a href="#__codelineno-0-1863">1863</a></span>
<span class="normal"><a href="#__codelineno-0-1864">1864</a></span>
<span class="normal"><a href="#__codelineno-0-1865">1865</a></span>
<span class="normal"><a href="#__codelineno-0-1866">1866</a></span>
<span class="normal"><a href="#__codelineno-0-1867">1867</a></span>
<span class="normal"><a href="#__codelineno-0-1868">1868</a></span>
<span class="normal"><a href="#__codelineno-0-1869">1869</a></span>
<span class="normal"><a href="#__codelineno-0-1870">1870</a></span>
<span class="normal"><a href="#__codelineno-0-1871">1871</a></span>
<span class="normal"><a href="#__codelineno-0-1872">1872</a></span>
<span class="normal"><a href="#__codelineno-0-1873">1873</a></span>
<span class="normal"><a href="#__codelineno-0-1874">1874</a></span>
<span class="normal"><a href="#__codelineno-0-1875">1875</a></span>
<span class="normal"><a href="#__codelineno-0-1876">1876</a></span>
<span class="normal"><a href="#__codelineno-0-1877">1877</a></span>
<span class="normal"><a href="#__codelineno-0-1878">1878</a></span>
<span class="normal"><a href="#__codelineno-0-1879">1879</a></span>
<span class="normal"><a href="#__codelineno-0-1880">1880</a></span>
<span class="normal"><a href="#__codelineno-0-1881">1881</a></span>
<span class="normal"><a href="#__codelineno-0-1882">1882</a></span>
<span class="normal"><a href="#__codelineno-0-1883">1883</a></span>
<span class="normal"><a href="#__codelineno-0-1884">1884</a></span>
<span class="normal"><a href="#__codelineno-0-1885">1885</a></span>
<span class="normal"><a href="#__codelineno-0-1886">1886</a></span>
<span class="normal"><a href="#__codelineno-0-1887">1887</a></span>
<span class="normal"><a href="#__codelineno-0-1888">1888</a></span>
<span class="normal"><a href="#__codelineno-0-1889">1889</a></span>
<span class="normal"><a href="#__codelineno-0-1890">1890</a></span>
<span class="normal"><a href="#__codelineno-0-1891">1891</a></span>
<span class="normal"><a href="#__codelineno-0-1892">1892</a></span>
<span class="normal"><a href="#__codelineno-0-1893">1893</a></span>
<span class="normal"><a href="#__codelineno-0-1894">1894</a></span>
<span class="normal"><a href="#__codelineno-0-1895">1895</a></span>
<span class="normal"><a href="#__codelineno-0-1896">1896</a></span>
<span class="normal"><a href="#__codelineno-0-1897">1897</a></span>
<span class="normal"><a href="#__codelineno-0-1898">1898</a></span>
<span class="normal"><a href="#__codelineno-0-1899">1899</a></span>
<span class="normal"><a href="#__codelineno-0-1900">1900</a></span>
<span class="normal"><a href="#__codelineno-0-1901">1901</a></span>
<span class="normal"><a href="#__codelineno-0-1902">1902</a></span>
<span class="normal"><a href="#__codelineno-0-1903">1903</a></span>
<span class="normal"><a href="#__codelineno-0-1904">1904</a></span>
<span class="normal"><a href="#__codelineno-0-1905">1905</a></span>
<span class="normal"><a href="#__codelineno-0-1906">1906</a></span>
<span class="normal"><a href="#__codelineno-0-1907">1907</a></span>
<span class="normal"><a href="#__codelineno-0-1908">1908</a></span>
<span class="normal"><a href="#__codelineno-0-1909">1909</a></span>
<span class="normal"><a href="#__codelineno-0-1910">1910</a></span>
<span class="normal"><a href="#__codelineno-0-1911">1911</a></span>
<span class="normal"><a href="#__codelineno-0-1912">1912</a></span>
<span class="normal"><a href="#__codelineno-0-1913">1913</a></span>
<span class="normal"><a href="#__codelineno-0-1914">1914</a></span>
<span class="normal"><a href="#__codelineno-0-1915">1915</a></span>
<span class="normal"><a href="#__codelineno-0-1916">1916</a></span>
<span class="normal"><a href="#__codelineno-0-1917">1917</a></span>
<span class="normal"><a href="#__codelineno-0-1918">1918</a></span>
<span class="normal"><a href="#__codelineno-0-1919">1919</a></span>
<span class="normal"><a href="#__codelineno-0-1920">1920</a></span>
<span class="normal"><a href="#__codelineno-0-1921">1921</a></span>
<span class="normal"><a href="#__codelineno-0-1922">1922</a></span>
<span class="normal"><a href="#__codelineno-0-1923">1923</a></span>
<span class="normal"><a href="#__codelineno-0-1924">1924</a></span>
<span class="normal"><a href="#__codelineno-0-1925">1925</a></span>
<span class="normal"><a href="#__codelineno-0-1926">1926</a></span>
<span class="normal"><a href="#__codelineno-0-1927">1927</a></span>
<span class="normal"><a href="#__codelineno-0-1928">1928</a></span>
<span class="normal"><a href="#__codelineno-0-1929">1929</a></span>
<span class="normal"><a href="#__codelineno-0-1930">1930</a></span>
<span class="normal"><a href="#__codelineno-0-1931">1931</a></span>
<span class="normal"><a href="#__codelineno-0-1932">1932</a></span>
<span class="normal"><a href="#__codelineno-0-1933">1933</a></span>
<span class="normal"><a href="#__codelineno-0-1934">1934</a></span>
<span class="normal"><a href="#__codelineno-0-1935">1935</a></span>
<span class="normal"><a href="#__codelineno-0-1936">1936</a></span>
<span class="normal"><a href="#__codelineno-0-1937">1937</a></span>
<span class="normal"><a href="#__codelineno-0-1938">1938</a></span>
<span class="normal"><a href="#__codelineno-0-1939">1939</a></span>
<span class="normal"><a href="#__codelineno-0-1940">1940</a></span>
<span class="normal"><a href="#__codelineno-0-1941">1941</a></span>
<span class="normal"><a href="#__codelineno-0-1942">1942</a></span>
<span class="normal"><a href="#__codelineno-0-1943">1943</a></span>
<span class="normal"><a href="#__codelineno-0-1944">1944</a></span>
<span class="normal"><a href="#__codelineno-0-1945">1945</a></span>
<span class="normal"><a href="#__codelineno-0-1946">1946</a></span>
<span class="normal"><a href="#__codelineno-0-1947">1947</a></span>
<span class="normal"><a href="#__codelineno-0-1948">1948</a></span>
<span class="normal"><a href="#__codelineno-0-1949">1949</a></span>
<span class="normal"><a href="#__codelineno-0-1950">1950</a></span>
<span class="normal"><a href="#__codelineno-0-1951">1951</a></span>
<span class="normal"><a href="#__codelineno-0-1952">1952</a></span>
<span class="normal"><a href="#__codelineno-0-1953">1953</a></span>
<span class="normal"><a href="#__codelineno-0-1954">1954</a></span>
<span class="normal"><a href="#__codelineno-0-1955">1955</a></span>
<span class="normal"><a href="#__codelineno-0-1956">1956</a></span>
<span class="normal"><a href="#__codelineno-0-1957">1957</a></span>
<span class="normal"><a href="#__codelineno-0-1958">1958</a></span>
<span class="normal"><a href="#__codelineno-0-1959">1959</a></span>
<span class="normal"><a href="#__codelineno-0-1960">1960</a></span>
<span class="normal"><a href="#__codelineno-0-1961">1961</a></span>
<span class="normal"><a href="#__codelineno-0-1962">1962</a></span>
<span class="normal"><a href="#__codelineno-0-1963">1963</a></span>
<span class="normal"><a href="#__codelineno-0-1964">1964</a></span>
<span class="normal"><a href="#__codelineno-0-1965">1965</a></span>
<span class="normal"><a href="#__codelineno-0-1966">1966</a></span>
<span class="normal"><a href="#__codelineno-0-1967">1967</a></span>
<span class="normal"><a href="#__codelineno-0-1968">1968</a></span>
<span class="normal"><a href="#__codelineno-0-1969">1969</a></span>
<span class="normal"><a href="#__codelineno-0-1970">1970</a></span>
<span class="normal"><a href="#__codelineno-0-1971">1971</a></span>
<span class="normal"><a href="#__codelineno-0-1972">1972</a></span>
<span class="normal"><a href="#__codelineno-0-1973">1973</a></span>
<span class="normal"><a href="#__codelineno-0-1974">1974</a></span>
<span class="normal"><a href="#__codelineno-0-1975">1975</a></span>
<span class="normal"><a href="#__codelineno-0-1976">1976</a></span>
<span class="normal"><a href="#__codelineno-0-1977">1977</a></span>
<span class="normal"><a href="#__codelineno-0-1978">1978</a></span>
<span class="normal"><a href="#__codelineno-0-1979">1979</a></span>
<span class="normal"><a href="#__codelineno-0-1980">1980</a></span>
<span class="normal"><a href="#__codelineno-0-1981">1981</a></span>
<span class="normal"><a href="#__codelineno-0-1982">1982</a></span>
<span class="normal"><a href="#__codelineno-0-1983">1983</a></span>
<span class="normal"><a href="#__codelineno-0-1984">1984</a></span>
<span class="normal"><a href="#__codelineno-0-1985">1985</a></span>
<span class="normal"><a href="#__codelineno-0-1986">1986</a></span>
<span class="normal"><a href="#__codelineno-0-1987">1987</a></span>
<span class="normal"><a href="#__codelineno-0-1988">1988</a></span>
<span class="normal"><a href="#__codelineno-0-1989">1989</a></span>
<span class="normal"><a href="#__codelineno-0-1990">1990</a></span>
<span class="normal"><a href="#__codelineno-0-1991">1991</a></span>
<span class="normal"><a href="#__codelineno-0-1992">1992</a></span>
<span class="normal"><a href="#__codelineno-0-1993">1993</a></span>
<span class="normal"><a href="#__codelineno-0-1994">1994</a></span>
<span class="normal"><a href="#__codelineno-0-1995">1995</a></span>
<span class="normal"><a href="#__codelineno-0-1996">1996</a></span>
<span class="normal"><a href="#__codelineno-0-1997">1997</a></span>
<span class="normal"><a href="#__codelineno-0-1998">1998</a></span>
<span class="normal"><a href="#__codelineno-0-1999">1999</a></span>
<span class="normal"><a href="#__codelineno-0-2000">2000</a></span>
<span class="normal"><a href="#__codelineno-0-2001">2001</a></span>
<span class="normal"><a href="#__codelineno-0-2002">2002</a></span>
<span class="normal"><a href="#__codelineno-0-2003">2003</a></span>
<span class="normal"><a href="#__codelineno-0-2004">2004</a></span>
<span class="normal"><a href="#__codelineno-0-2005">2005</a></span>
<span class="normal"><a href="#__codelineno-0-2006">2006</a></span>
<span class="normal"><a href="#__codelineno-0-2007">2007</a></span>
<span class="normal"><a href="#__codelineno-0-2008">2008</a></span>
<span class="normal"><a href="#__codelineno-0-2009">2009</a></span>
<span class="normal"><a href="#__codelineno-0-2010">2010</a></span>
<span class="normal"><a href="#__codelineno-0-2011">2011</a></span>
<span class="normal"><a href="#__codelineno-0-2012">2012</a></span>
<span class="normal"><a href="#__codelineno-0-2013">2013</a></span>
<span class="normal"><a href="#__codelineno-0-2014">2014</a></span>
<span class="normal"><a href="#__codelineno-0-2015">2015</a></span>
<span class="normal"><a href="#__codelineno-0-2016">2016</a></span>
<span class="normal"><a href="#__codelineno-0-2017">2017</a></span>
<span class="normal"><a href="#__codelineno-0-2018">2018</a></span>
<span class="normal"><a href="#__codelineno-0-2019">2019</a></span>
<span class="normal"><a href="#__codelineno-0-2020">2020</a></span>
<span class="normal"><a href="#__codelineno-0-2021">2021</a></span>
<span class="normal"><a href="#__codelineno-0-2022">2022</a></span>
<span class="normal"><a href="#__codelineno-0-2023">2023</a></span>
<span class="normal"><a href="#__codelineno-0-2024">2024</a></span>
<span class="normal"><a href="#__codelineno-0-2025">2025</a></span>
<span class="normal"><a href="#__codelineno-0-2026">2026</a></span>
<span class="normal"><a href="#__codelineno-0-2027">2027</a></span>
<span class="normal"><a href="#__codelineno-0-2028">2028</a></span>
<span class="normal"><a href="#__codelineno-0-2029">2029</a></span>
<span class="normal"><a href="#__codelineno-0-2030">2030</a></span>
<span class="normal"><a href="#__codelineno-0-2031">2031</a></span>
<span class="normal"><a href="#__codelineno-0-2032">2032</a></span>
<span class="normal"><a href="#__codelineno-0-2033">2033</a></span>
<span class="normal"><a href="#__codelineno-0-2034">2034</a></span>
<span class="normal"><a href="#__codelineno-0-2035">2035</a></span>
<span class="normal"><a href="#__codelineno-0-2036">2036</a></span>
<span class="normal"><a href="#__codelineno-0-2037">2037</a></span>
<span class="normal"><a href="#__codelineno-0-2038">2038</a></span>
<span class="normal"><a href="#__codelineno-0-2039">2039</a></span>
<span class="normal"><a href="#__codelineno-0-2040">2040</a></span>
<span class="normal"><a href="#__codelineno-0-2041">2041</a></span>
<span class="normal"><a href="#__codelineno-0-2042">2042</a></span>
<span class="normal"><a href="#__codelineno-0-2043">2043</a></span>
<span class="normal"><a href="#__codelineno-0-2044">2044</a></span>
<span class="normal"><a href="#__codelineno-0-2045">2045</a></span>
<span class="normal"><a href="#__codelineno-0-2046">2046</a></span>
<span class="normal"><a href="#__codelineno-0-2047">2047</a></span>
<span class="normal"><a href="#__codelineno-0-2048">2048</a></span>
<span class="normal"><a href="#__codelineno-0-2049">2049</a></span>
<span class="normal"><a href="#__codelineno-0-2050">2050</a></span>
<span class="normal"><a href="#__codelineno-0-2051">2051</a></span>
<span class="normal"><a href="#__codelineno-0-2052">2052</a></span>
<span class="normal"><a href="#__codelineno-0-2053">2053</a></span>
<span class="normal"><a href="#__codelineno-0-2054">2054</a></span>
<span class="normal"><a href="#__codelineno-0-2055">2055</a></span>
<span class="normal"><a href="#__codelineno-0-2056">2056</a></span>
<span class="normal"><a href="#__codelineno-0-2057">2057</a></span>
<span class="normal"><a href="#__codelineno-0-2058">2058</a></span>
<span class="normal"><a href="#__codelineno-0-2059">2059</a></span>
<span class="normal"><a href="#__codelineno-0-2060">2060</a></span>
<span class="normal"><a href="#__codelineno-0-2061">2061</a></span>
<span class="normal"><a href="#__codelineno-0-2062">2062</a></span>
<span class="normal"><a href="#__codelineno-0-2063">2063</a></span>
<span class="normal"><a href="#__codelineno-0-2064">2064</a></span>
<span class="normal"><a href="#__codelineno-0-2065">2065</a></span>
<span class="normal"><a href="#__codelineno-0-2066">2066</a></span>
<span class="normal"><a href="#__codelineno-0-2067">2067</a></span>
<span class="normal"><a href="#__codelineno-0-2068">2068</a></span>
<span class="normal"><a href="#__codelineno-0-2069">2069</a></span>
<span class="normal"><a href="#__codelineno-0-2070">2070</a></span>
<span class="normal"><a href="#__codelineno-0-2071">2071</a></span>
<span class="normal"><a href="#__codelineno-0-2072">2072</a></span>
<span class="normal"><a href="#__codelineno-0-2073">2073</a></span>
<span class="normal"><a href="#__codelineno-0-2074">2074</a></span>
<span class="normal"><a href="#__codelineno-0-2075">2075</a></span>
<span class="normal"><a href="#__codelineno-0-2076">2076</a></span>
<span class="normal"><a href="#__codelineno-0-2077">2077</a></span>
<span class="normal"><a href="#__codelineno-0-2078">2078</a></span>
<span class="normal"><a href="#__codelineno-0-2079">2079</a></span>
<span class="normal"><a href="#__codelineno-0-2080">2080</a></span>
<span class="normal"><a href="#__codelineno-0-2081">2081</a></span>
<span class="normal"><a href="#__codelineno-0-2082">2082</a></span>
<span class="normal"><a href="#__codelineno-0-2083">2083</a></span>
<span class="normal"><a href="#__codelineno-0-2084">2084</a></span>
<span class="normal"><a href="#__codelineno-0-2085">2085</a></span>
<span class="normal"><a href="#__codelineno-0-2086">2086</a></span>
<span class="normal"><a href="#__codelineno-0-2087">2087</a></span>
<span class="normal"><a href="#__codelineno-0-2088">2088</a></span>
<span class="normal"><a href="#__codelineno-0-2089">2089</a></span>
<span class="normal"><a href="#__codelineno-0-2090">2090</a></span>
<span class="normal"><a href="#__codelineno-0-2091">2091</a></span>
<span class="normal"><a href="#__codelineno-0-2092">2092</a></span>
<span class="normal"><a href="#__codelineno-0-2093">2093</a></span>
<span class="normal"><a href="#__codelineno-0-2094">2094</a></span>
<span class="normal"><a href="#__codelineno-0-2095">2095</a></span>
<span class="normal"><a href="#__codelineno-0-2096">2096</a></span>
<span class="normal"><a href="#__codelineno-0-2097">2097</a></span>
<span class="normal"><a href="#__codelineno-0-2098">2098</a></span>
<span class="normal"><a href="#__codelineno-0-2099">2099</a></span>
<span class="normal"><a href="#__codelineno-0-2100">2100</a></span>
<span class="normal"><a href="#__codelineno-0-2101">2101</a></span>
<span class="normal"><a href="#__codelineno-0-2102">2102</a></span>
<span class="normal"><a href="#__codelineno-0-2103">2103</a></span>
<span class="normal"><a href="#__codelineno-0-2104">2104</a></span>
<span class="normal"><a href="#__codelineno-0-2105">2105</a></span>
<span class="normal"><a href="#__codelineno-0-2106">2106</a></span>
<span class="normal"><a href="#__codelineno-0-2107">2107</a></span>
<span class="normal"><a href="#__codelineno-0-2108">2108</a></span>
<span class="normal"><a href="#__codelineno-0-2109">2109</a></span>
<span class="normal"><a href="#__codelineno-0-2110">2110</a></span>
<span class="normal"><a href="#__codelineno-0-2111">2111</a></span>
<span class="normal"><a href="#__codelineno-0-2112">2112</a></span>
<span class="normal"><a href="#__codelineno-0-2113">2113</a></span>
<span class="normal"><a href="#__codelineno-0-2114">2114</a></span>
<span class="normal"><a href="#__codelineno-0-2115">2115</a></span>
<span class="normal"><a href="#__codelineno-0-2116">2116</a></span>
<span class="normal"><a href="#__codelineno-0-2117">2117</a></span>
<span class="normal"><a href="#__codelineno-0-2118">2118</a></span>
<span class="normal"><a href="#__codelineno-0-2119">2119</a></span>
<span class="normal"><a href="#__codelineno-0-2120">2120</a></span>
<span class="normal"><a href="#__codelineno-0-2121">2121</a></span>
<span class="normal"><a href="#__codelineno-0-2122">2122</a></span>
<span class="normal"><a href="#__codelineno-0-2123">2123</a></span>
<span class="normal"><a href="#__codelineno-0-2124">2124</a></span>
<span class="normal"><a href="#__codelineno-0-2125">2125</a></span>
<span class="normal"><a href="#__codelineno-0-2126">2126</a></span>
<span class="normal"><a href="#__codelineno-0-2127">2127</a></span>
<span class="normal"><a href="#__codelineno-0-2128">2128</a></span>
<span class="normal"><a href="#__codelineno-0-2129">2129</a></span>
<span class="normal"><a href="#__codelineno-0-2130">2130</a></span>
<span class="normal"><a href="#__codelineno-0-2131">2131</a></span>
<span class="normal"><a href="#__codelineno-0-2132">2132</a></span>
<span class="normal"><a href="#__codelineno-0-2133">2133</a></span>
<span class="normal"><a href="#__codelineno-0-2134">2134</a></span>
<span class="normal"><a href="#__codelineno-0-2135">2135</a></span>
<span class="normal"><a href="#__codelineno-0-2136">2136</a></span>
<span class="normal"><a href="#__codelineno-0-2137">2137</a></span>
<span class="normal"><a href="#__codelineno-0-2138">2138</a></span>
<span class="normal"><a href="#__codelineno-0-2139">2139</a></span>
<span class="normal"><a href="#__codelineno-0-2140">2140</a></span>
<span class="normal"><a href="#__codelineno-0-2141">2141</a></span>
<span class="normal"><a href="#__codelineno-0-2142">2142</a></span>
<span class="normal"><a href="#__codelineno-0-2143">2143</a></span>
<span class="normal"><a href="#__codelineno-0-2144">2144</a></span>
<span class="normal"><a href="#__codelineno-0-2145">2145</a></span>
<span class="normal"><a href="#__codelineno-0-2146">2146</a></span>
<span class="normal"><a href="#__codelineno-0-2147">2147</a></span>
<span class="normal"><a href="#__codelineno-0-2148">2148</a></span>
<span class="normal"><a href="#__codelineno-0-2149">2149</a></span>
<span class="normal"><a href="#__codelineno-0-2150">2150</a></span>
<span class="normal"><a href="#__codelineno-0-2151">2151</a></span>
<span class="normal"><a href="#__codelineno-0-2152">2152</a></span>
<span class="normal"><a href="#__codelineno-0-2153">2153</a></span>
<span class="normal"><a href="#__codelineno-0-2154">2154</a></span>
<span class="normal"><a href="#__codelineno-0-2155">2155</a></span>
<span class="normal"><a href="#__codelineno-0-2156">2156</a></span>
<span class="normal"><a href="#__codelineno-0-2157">2157</a></span>
<span class="normal"><a href="#__codelineno-0-2158">2158</a></span>
<span class="normal"><a href="#__codelineno-0-2159">2159</a></span>
<span class="normal"><a href="#__codelineno-0-2160">2160</a></span>
<span class="normal"><a href="#__codelineno-0-2161">2161</a></span>
<span class="normal"><a href="#__codelineno-0-2162">2162</a></span>
<span class="normal"><a href="#__codelineno-0-2163">2163</a></span>
<span class="normal"><a href="#__codelineno-0-2164">2164</a></span>
<span class="normal"><a href="#__codelineno-0-2165">2165</a></span>
<span class="normal"><a href="#__codelineno-0-2166">2166</a></span>
<span class="normal"><a href="#__codelineno-0-2167">2167</a></span>
<span class="normal"><a href="#__codelineno-0-2168">2168</a></span>
<span class="normal"><a href="#__codelineno-0-2169">2169</a></span>
<span class="normal"><a href="#__codelineno-0-2170">2170</a></span>
<span class="normal"><a href="#__codelineno-0-2171">2171</a></span>
<span class="normal"><a href="#__codelineno-0-2172">2172</a></span>
<span class="normal"><a href="#__codelineno-0-2173">2173</a></span>
<span class="normal"><a href="#__codelineno-0-2174">2174</a></span>
<span class="normal"><a href="#__codelineno-0-2175">2175</a></span>
<span class="normal"><a href="#__codelineno-0-2176">2176</a></span>
<span class="normal"><a href="#__codelineno-0-2177">2177</a></span>
<span class="normal"><a href="#__codelineno-0-2178">2178</a></span>
<span class="normal"><a href="#__codelineno-0-2179">2179</a></span>
<span class="normal"><a href="#__codelineno-0-2180">2180</a></span>
<span class="normal"><a href="#__codelineno-0-2181">2181</a></span>
<span class="normal"><a href="#__codelineno-0-2182">2182</a></span>
<span class="normal"><a href="#__codelineno-0-2183">2183</a></span>
<span class="normal"><a href="#__codelineno-0-2184">2184</a></span>
<span class="normal"><a href="#__codelineno-0-2185">2185</a></span>
<span class="normal"><a href="#__codelineno-0-2186">2186</a></span>
<span class="normal"><a href="#__codelineno-0-2187">2187</a></span>
<span class="normal"><a href="#__codelineno-0-2188">2188</a></span>
<span class="normal"><a href="#__codelineno-0-2189">2189</a></span>
<span class="normal"><a href="#__codelineno-0-2190">2190</a></span>
<span class="normal"><a href="#__codelineno-0-2191">2191</a></span>
<span class="normal"><a href="#__codelineno-0-2192">2192</a></span>
<span class="normal"><a href="#__codelineno-0-2193">2193</a></span>
<span class="normal"><a href="#__codelineno-0-2194">2194</a></span>
<span class="normal"><a href="#__codelineno-0-2195">2195</a></span>
<span class="normal"><a href="#__codelineno-0-2196">2196</a></span>
<span class="normal"><a href="#__codelineno-0-2197">2197</a></span>
<span class="normal"><a href="#__codelineno-0-2198">2198</a></span>
<span class="normal"><a href="#__codelineno-0-2199">2199</a></span>
<span class="normal"><a href="#__codelineno-0-2200">2200</a></span>
<span class="normal"><a href="#__codelineno-0-2201">2201</a></span>
<span class="normal"><a href="#__codelineno-0-2202">2202</a></span>
<span class="normal"><a href="#__codelineno-0-2203">2203</a></span>
<span class="normal"><a href="#__codelineno-0-2204">2204</a></span>
<span class="normal"><a href="#__codelineno-0-2205">2205</a></span>
<span class="normal"><a href="#__codelineno-0-2206">2206</a></span>
<span class="normal"><a href="#__codelineno-0-2207">2207</a></span>
<span class="normal"><a href="#__codelineno-0-2208">2208</a></span>
<span class="normal"><a href="#__codelineno-0-2209">2209</a></span>
<span class="normal"><a href="#__codelineno-0-2210">2210</a></span>
<span class="normal"><a href="#__codelineno-0-2211">2211</a></span>
<span class="normal"><a href="#__codelineno-0-2212">2212</a></span>
<span class="normal"><a href="#__codelineno-0-2213">2213</a></span>
<span class="normal"><a href="#__codelineno-0-2214">2214</a></span>
<span class="normal"><a href="#__codelineno-0-2215">2215</a></span>
<span class="normal"><a href="#__codelineno-0-2216">2216</a></span>
<span class="normal"><a href="#__codelineno-0-2217">2217</a></span>
<span class="normal"><a href="#__codelineno-0-2218">2218</a></span>
<span class="normal"><a href="#__codelineno-0-2219">2219</a></span>
<span class="normal"><a href="#__codelineno-0-2220">2220</a></span>
<span class="normal"><a href="#__codelineno-0-2221">2221</a></span>
<span class="normal"><a href="#__codelineno-0-2222">2222</a></span>
<span class="normal"><a href="#__codelineno-0-2223">2223</a></span>
<span class="normal"><a href="#__codelineno-0-2224">2224</a></span>
<span class="normal"><a href="#__codelineno-0-2225">2225</a></span>
<span class="normal"><a href="#__codelineno-0-2226">2226</a></span>
<span class="normal"><a href="#__codelineno-0-2227">2227</a></span>
<span class="normal"><a href="#__codelineno-0-2228">2228</a></span>
<span class="normal"><a href="#__codelineno-0-2229">2229</a></span>
<span class="normal"><a href="#__codelineno-0-2230">2230</a></span>
<span class="normal"><a href="#__codelineno-0-2231">2231</a></span>
<span class="normal"><a href="#__codelineno-0-2232">2232</a></span>
<span class="normal"><a href="#__codelineno-0-2233">2233</a></span>
<span class="normal"><a href="#__codelineno-0-2234">2234</a></span>
<span class="normal"><a href="#__codelineno-0-2235">2235</a></span>
<span class="normal"><a href="#__codelineno-0-2236">2236</a></span>
<span class="normal"><a href="#__codelineno-0-2237">2237</a></span>
<span class="normal"><a href="#__codelineno-0-2238">2238</a></span>
<span class="normal"><a href="#__codelineno-0-2239">2239</a></span>
<span class="normal"><a href="#__codelineno-0-2240">2240</a></span>
<span class="normal"><a href="#__codelineno-0-2241">2241</a></span>
<span class="normal"><a href="#__codelineno-0-2242">2242</a></span>
<span class="normal"><a href="#__codelineno-0-2243">2243</a></span>
<span class="normal"><a href="#__codelineno-0-2244">2244</a></span>
<span class="normal"><a href="#__codelineno-0-2245">2245</a></span>
<span class="normal"><a href="#__codelineno-0-2246">2246</a></span>
<span class="normal"><a href="#__codelineno-0-2247">2247</a></span>
<span class="normal"><a href="#__codelineno-0-2248">2248</a></span>
<span class="normal"><a href="#__codelineno-0-2249">2249</a></span>
<span class="normal"><a href="#__codelineno-0-2250">2250</a></span>
<span class="normal"><a href="#__codelineno-0-2251">2251</a></span>
<span class="normal"><a href="#__codelineno-0-2252">2252</a></span>
<span class="normal"><a href="#__codelineno-0-2253">2253</a></span>
<span class="normal"><a href="#__codelineno-0-2254">2254</a></span>
<span class="normal"><a href="#__codelineno-0-2255">2255</a></span>
<span class="normal"><a href="#__codelineno-0-2256">2256</a></span>
<span class="normal"><a href="#__codelineno-0-2257">2257</a></span>
<span class="normal"><a href="#__codelineno-0-2258">2258</a></span>
<span class="normal"><a href="#__codelineno-0-2259">2259</a></span>
<span class="normal"><a href="#__codelineno-0-2260">2260</a></span>
<span class="normal"><a href="#__codelineno-0-2261">2261</a></span>
<span class="normal"><a href="#__codelineno-0-2262">2262</a></span>
<span class="normal"><a href="#__codelineno-0-2263">2263</a></span>
<span class="normal"><a href="#__codelineno-0-2264">2264</a></span>
<span class="normal"><a href="#__codelineno-0-2265">2265</a></span>
<span class="normal"><a href="#__codelineno-0-2266">2266</a></span>
<span class="normal"><a href="#__codelineno-0-2267">2267</a></span>
<span class="normal"><a href="#__codelineno-0-2268">2268</a></span>
<span class="normal"><a href="#__codelineno-0-2269">2269</a></span>
<span class="normal"><a href="#__codelineno-0-2270">2270</a></span>
<span class="normal"><a href="#__codelineno-0-2271">2271</a></span>
<span class="normal"><a href="#__codelineno-0-2272">2272</a></span>
<span class="normal"><a href="#__codelineno-0-2273">2273</a></span>
<span class="normal"><a href="#__codelineno-0-2274">2274</a></span>
<span class="normal"><a href="#__codelineno-0-2275">2275</a></span>
<span class="normal"><a href="#__codelineno-0-2276">2276</a></span>
<span class="normal"><a href="#__codelineno-0-2277">2277</a></span>
<span class="normal"><a href="#__codelineno-0-2278">2278</a></span>
<span class="normal"><a href="#__codelineno-0-2279">2279</a></span>
<span class="normal"><a href="#__codelineno-0-2280">2280</a></span>
<span class="normal"><a href="#__codelineno-0-2281">2281</a></span>
<span class="normal"><a href="#__codelineno-0-2282">2282</a></span>
<span class="normal"><a href="#__codelineno-0-2283">2283</a></span>
<span class="normal"><a href="#__codelineno-0-2284">2284</a></span>
<span class="normal"><a href="#__codelineno-0-2285">2285</a></span>
<span class="normal"><a href="#__codelineno-0-2286">2286</a></span>
<span class="normal"><a href="#__codelineno-0-2287">2287</a></span>
<span class="normal"><a href="#__codelineno-0-2288">2288</a></span>
<span class="normal"><a href="#__codelineno-0-2289">2289</a></span>
<span class="normal"><a href="#__codelineno-0-2290">2290</a></span>
<span class="normal"><a href="#__codelineno-0-2291">2291</a></span>
<span class="normal"><a href="#__codelineno-0-2292">2292</a></span>
<span class="normal"><a href="#__codelineno-0-2293">2293</a></span>
<span class="normal"><a href="#__codelineno-0-2294">2294</a></span>
<span class="normal"><a href="#__codelineno-0-2295">2295</a></span>
<span class="normal"><a href="#__codelineno-0-2296">2296</a></span>
<span class="normal"><a href="#__codelineno-0-2297">2297</a></span>
<span class="normal"><a href="#__codelineno-0-2298">2298</a></span>
<span class="normal"><a href="#__codelineno-0-2299">2299</a></span>
<span class="normal"><a href="#__codelineno-0-2300">2300</a></span>
<span class="normal"><a href="#__codelineno-0-2301">2301</a></span>
<span class="normal"><a href="#__codelineno-0-2302">2302</a></span>
<span class="normal"><a href="#__codelineno-0-2303">2303</a></span>
<span class="normal"><a href="#__codelineno-0-2304">2304</a></span>
<span class="normal"><a href="#__codelineno-0-2305">2305</a></span>
<span class="normal"><a href="#__codelineno-0-2306">2306</a></span>
<span class="normal"><a href="#__codelineno-0-2307">2307</a></span>
<span class="normal"><a href="#__codelineno-0-2308">2308</a></span>
<span class="normal"><a href="#__codelineno-0-2309">2309</a></span>
<span class="normal"><a href="#__codelineno-0-2310">2310</a></span>
<span class="normal"><a href="#__codelineno-0-2311">2311</a></span>
<span class="normal"><a href="#__codelineno-0-2312">2312</a></span>
<span class="normal"><a href="#__codelineno-0-2313">2313</a></span>
<span class="normal"><a href="#__codelineno-0-2314">2314</a></span>
<span class="normal"><a href="#__codelineno-0-2315">2315</a></span>
<span class="normal"><a href="#__codelineno-0-2316">2316</a></span>
<span class="normal"><a href="#__codelineno-0-2317">2317</a></span>
<span class="normal"><a href="#__codelineno-0-2318">2318</a></span>
<span class="normal"><a href="#__codelineno-0-2319">2319</a></span>
<span class="normal"><a href="#__codelineno-0-2320">2320</a></span>
<span class="normal"><a href="#__codelineno-0-2321">2321</a></span>
<span class="normal"><a href="#__codelineno-0-2322">2322</a></span>
<span class="normal"><a href="#__codelineno-0-2323">2323</a></span>
<span class="normal"><a href="#__codelineno-0-2324">2324</a></span>
<span class="normal"><a href="#__codelineno-0-2325">2325</a></span>
<span class="normal"><a href="#__codelineno-0-2326">2326</a></span>
<span class="normal"><a href="#__codelineno-0-2327">2327</a></span>
<span class="normal"><a href="#__codelineno-0-2328">2328</a></span>
<span class="normal"><a href="#__codelineno-0-2329">2329</a></span>
<span class="normal"><a href="#__codelineno-0-2330">2330</a></span>
<span class="normal"><a href="#__codelineno-0-2331">2331</a></span>
<span class="normal"><a href="#__codelineno-0-2332">2332</a></span>
<span class="normal"><a href="#__codelineno-0-2333">2333</a></span>
<span class="normal"><a href="#__codelineno-0-2334">2334</a></span>
<span class="normal"><a href="#__codelineno-0-2335">2335</a></span>
<span class="normal"><a href="#__codelineno-0-2336">2336</a></span>
<span class="normal"><a href="#__codelineno-0-2337">2337</a></span>
<span class="normal"><a href="#__codelineno-0-2338">2338</a></span>
<span class="normal"><a href="#__codelineno-0-2339">2339</a></span>
<span class="normal"><a href="#__codelineno-0-2340">2340</a></span>
<span class="normal"><a href="#__codelineno-0-2341">2341</a></span>
<span class="normal"><a href="#__codelineno-0-2342">2342</a></span>
<span class="normal"><a href="#__codelineno-0-2343">2343</a></span>
<span class="normal"><a href="#__codelineno-0-2344">2344</a></span>
<span class="normal"><a href="#__codelineno-0-2345">2345</a></span>
<span class="normal"><a href="#__codelineno-0-2346">2346</a></span>
<span class="normal"><a href="#__codelineno-0-2347">2347</a></span>
<span class="normal"><a href="#__codelineno-0-2348">2348</a></span>
<span class="normal"><a href="#__codelineno-0-2349">2349</a></span>
<span class="normal"><a href="#__codelineno-0-2350">2350</a></span>
<span class="normal"><a href="#__codelineno-0-2351">2351</a></span>
<span class="normal"><a href="#__codelineno-0-2352">2352</a></span>
<span class="normal"><a href="#__codelineno-0-2353">2353</a></span>
<span class="normal"><a href="#__codelineno-0-2354">2354</a></span>
<span class="normal"><a href="#__codelineno-0-2355">2355</a></span>
<span class="normal"><a href="#__codelineno-0-2356">2356</a></span>
<span class="normal"><a href="#__codelineno-0-2357">2357</a></span>
<span class="normal"><a href="#__codelineno-0-2358">2358</a></span>
<span class="normal"><a href="#__codelineno-0-2359">2359</a></span>
<span class="normal"><a href="#__codelineno-0-2360">2360</a></span>
<span class="normal"><a href="#__codelineno-0-2361">2361</a></span>
<span class="normal"><a href="#__codelineno-0-2362">2362</a></span>
<span class="normal"><a href="#__codelineno-0-2363">2363</a></span>
<span class="normal"><a href="#__codelineno-0-2364">2364</a></span>
<span class="normal"><a href="#__codelineno-0-2365">2365</a></span>
<span class="normal"><a href="#__codelineno-0-2366">2366</a></span>
<span class="normal"><a href="#__codelineno-0-2367">2367</a></span>
<span class="normal"><a href="#__codelineno-0-2368">2368</a></span>
<span class="normal"><a href="#__codelineno-0-2369">2369</a></span>
<span class="normal"><a href="#__codelineno-0-2370">2370</a></span>
<span class="normal"><a href="#__codelineno-0-2371">2371</a></span>
<span class="normal"><a href="#__codelineno-0-2372">2372</a></span>
<span class="normal"><a href="#__codelineno-0-2373">2373</a></span>
<span class="normal"><a href="#__codelineno-0-2374">2374</a></span>
<span class="normal"><a href="#__codelineno-0-2375">2375</a></span>
<span class="normal"><a href="#__codelineno-0-2376">2376</a></span>
<span class="normal"><a href="#__codelineno-0-2377">2377</a></span>
<span class="normal"><a href="#__codelineno-0-2378">2378</a></span>
<span class="normal"><a href="#__codelineno-0-2379">2379</a></span>
<span class="normal"><a href="#__codelineno-0-2380">2380</a></span>
<span class="normal"><a href="#__codelineno-0-2381">2381</a></span>
<span class="normal"><a href="#__codelineno-0-2382">2382</a></span>
<span class="normal"><a href="#__codelineno-0-2383">2383</a></span>
<span class="normal"><a href="#__codelineno-0-2384">2384</a></span>
<span class="normal"><a href="#__codelineno-0-2385">2385</a></span>
<span class="normal"><a href="#__codelineno-0-2386">2386</a></span>
<span class="normal"><a href="#__codelineno-0-2387">2387</a></span>
<span class="normal"><a href="#__codelineno-0-2388">2388</a></span>
<span class="normal"><a href="#__codelineno-0-2389">2389</a></span>
<span class="normal"><a href="#__codelineno-0-2390">2390</a></span>
<span class="normal"><a href="#__codelineno-0-2391">2391</a></span>
<span class="normal"><a href="#__codelineno-0-2392">2392</a></span>
<span class="normal"><a href="#__codelineno-0-2393">2393</a></span>
<span class="normal"><a href="#__codelineno-0-2394">2394</a></span>
<span class="normal"><a href="#__codelineno-0-2395">2395</a></span>
<span class="normal"><a href="#__codelineno-0-2396">2396</a></span>
<span class="normal"><a href="#__codelineno-0-2397">2397</a></span>
<span class="normal"><a href="#__codelineno-0-2398">2398</a></span>
<span class="normal"><a href="#__codelineno-0-2399">2399</a></span>
<span class="normal"><a href="#__codelineno-0-2400">2400</a></span>
<span class="normal"><a href="#__codelineno-0-2401">2401</a></span>
<span class="normal"><a href="#__codelineno-0-2402">2402</a></span>
<span class="normal"><a href="#__codelineno-0-2403">2403</a></span>
<span class="normal"><a href="#__codelineno-0-2404">2404</a></span>
<span class="normal"><a href="#__codelineno-0-2405">2405</a></span>
<span class="normal"><a href="#__codelineno-0-2406">2406</a></span>
<span class="normal"><a href="#__codelineno-0-2407">2407</a></span>
<span class="normal"><a href="#__codelineno-0-2408">2408</a></span>
<span class="normal"><a href="#__codelineno-0-2409">2409</a></span>
<span class="normal"><a href="#__codelineno-0-2410">2410</a></span>
<span class="normal"><a href="#__codelineno-0-2411">2411</a></span>
<span class="normal"><a href="#__codelineno-0-2412">2412</a></span>
<span class="normal"><a href="#__codelineno-0-2413">2413</a></span>
<span class="normal"><a href="#__codelineno-0-2414">2414</a></span>
<span class="normal"><a href="#__codelineno-0-2415">2415</a></span>
<span class="normal"><a href="#__codelineno-0-2416">2416</a></span>
<span class="normal"><a href="#__codelineno-0-2417">2417</a></span>
<span class="normal"><a href="#__codelineno-0-2418">2418</a></span>
<span class="normal"><a href="#__codelineno-0-2419">2419</a></span>
<span class="normal"><a href="#__codelineno-0-2420">2420</a></span>
<span class="normal"><a href="#__codelineno-0-2421">2421</a></span>
<span class="normal"><a href="#__codelineno-0-2422">2422</a></span>
<span class="normal"><a href="#__codelineno-0-2423">2423</a></span>
<span class="normal"><a href="#__codelineno-0-2424">2424</a></span>
<span class="normal"><a href="#__codelineno-0-2425">2425</a></span>
<span class="normal"><a href="#__codelineno-0-2426">2426</a></span>
<span class="normal"><a href="#__codelineno-0-2427">2427</a></span>
<span class="normal"><a href="#__codelineno-0-2428">2428</a></span>
<span class="normal"><a href="#__codelineno-0-2429">2429</a></span>
<span class="normal"><a href="#__codelineno-0-2430">2430</a></span>
<span class="normal"><a href="#__codelineno-0-2431">2431</a></span>
<span class="normal"><a href="#__codelineno-0-2432">2432</a></span>
<span class="normal"><a href="#__codelineno-0-2433">2433</a></span>
<span class="normal"><a href="#__codelineno-0-2434">2434</a></span>
<span class="normal"><a href="#__codelineno-0-2435">2435</a></span>
<span class="normal"><a href="#__codelineno-0-2436">2436</a></span>
<span class="normal"><a href="#__codelineno-0-2437">2437</a></span>
<span class="normal"><a href="#__codelineno-0-2438">2438</a></span>
<span class="normal"><a href="#__codelineno-0-2439">2439</a></span>
<span class="normal"><a href="#__codelineno-0-2440">2440</a></span>
<span class="normal"><a href="#__codelineno-0-2441">2441</a></span>
<span class="normal"><a href="#__codelineno-0-2442">2442</a></span>
<span class="normal"><a href="#__codelineno-0-2443">2443</a></span>
<span class="normal"><a href="#__codelineno-0-2444">2444</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1465"><a id="__codelineno-0-1465" name="__codelineno-0-1465"></a><span class="k">class</span> <span class="nc">HelperA2GMeasurements</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="__span-0-1466"><a id="__codelineno-0-1466" name="__codelineno-0-1466"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-1467"><a id="__codelineno-0-1467" name="__codelineno-0-1467"></a><span class="sd">    Python class for handling the interaction between the multiple devices available in the system: gps, gimbal and rfsoc.</span>
</span><span id="__span-0-1468"><a id="__codelineno-0-1468" name="__codelineno-0-1468"></a>
</span><span id="__span-0-1469"><a id="__codelineno-0-1469" name="__codelineno-0-1469"></a><span class="sd">    It creates instances of each class handling one of those devices (i.e. GimbalRS2, GpsSignaling).</span>
</span><span id="__span-0-1470"><a id="__codelineno-0-1470" name="__codelineno-0-1470"></a>
</span><span id="__span-0-1471"><a id="__codelineno-0-1471" name="__codelineno-0-1471"></a><span class="sd">    It creates a wireless TCP connection between the host computers of both nodes (air and ground node) to control devices and retrieve information from them.</span>
</span><span id="__span-0-1472"><a id="__codelineno-0-1472" name="__codelineno-0-1472"></a>
</span><span id="__span-0-1473"><a id="__codelineno-0-1473" name="__codelineno-0-1473"></a><span class="sd">    It creates a thread (called here communication thread) to handle the communication between the host computers of both nodes.</span>
</span><span id="__span-0-1474"><a id="__codelineno-0-1474" name="__codelineno-0-1474"></a>
</span><span id="__span-0-1475"><a id="__codelineno-0-1475" name="__codelineno-0-1475"></a><span class="sd">    * ``MAX_TIME_EMPTY_SOCKETS``: the maximum allowed time to wait if no information was sent over a socket.</span>
</span><span id="__span-0-1476"><a id="__codelineno-0-1476" name="__codelineno-0-1476"></a>
</span><span id="__span-0-1477"><a id="__codelineno-0-1477" name="__codelineno-0-1477"></a><span class="sd">    * ``CONN_MUST_OVER_FLAG``: a (boolean) flag indicating whether to close or not the connection between the host computers.</span>
</span><span id="__span-0-1478"><a id="__codelineno-0-1478" name="__codelineno-0-1478"></a>
</span><span id="__span-0-1479"><a id="__codelineno-0-1479" name="__codelineno-0-1479"></a><span class="sd">    * ``drone_fm_flag``: a (boolean) flag set at the GUI indicating whether the air node&#39;s gimbal should follow the ground node. In all our documentation, a gimbal is said to be in &quot;follow mode&quot; (don&#39;t confuse with DJI&#39;s RS2 camera-based follow mode) if it follows the other node. </span>
</span><span id="__span-0-1480"><a id="__codelineno-0-1480" name="__codelineno-0-1480"></a>
</span><span id="__span-0-1481"><a id="__codelineno-0-1481" name="__codelineno-0-1481"></a><span class="sd">    * ``PAP_TO_PLOT``: a numpy array (of size defined in the method ``pipeline_operations_rfsoc_rx_ndarray``of the class ``RFSoCRemoteControlFromHost``) used to plot the Power Angular Profile (PAP) of the wireless channel in GUI&#39;s PAP Panel.</span>
</span><span id="__span-0-1482"><a id="__codelineno-0-1482" name="__codelineno-0-1482"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-1483"><a id="__codelineno-0-1483" name="__codelineno-0-1483"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ID</span><span class="p">,</span> <span class="n">SERVER_ADDRESS</span><span class="p">,</span> 
</span><span id="__span-0-1484"><a id="__codelineno-0-1484" name="__codelineno-0-1484"></a>                 <span class="n">DBG_LVL_0</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">DBG_LVL_1</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
</span><span id="__span-0-1485"><a id="__codelineno-0-1485" name="__codelineno-0-1485"></a>                 <span class="n">IsGimbal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">IsGPS</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">IsSignalGenerator</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">IsRFSoC</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-1486"><a id="__codelineno-0-1486" name="__codelineno-0-1486"></a>                 <span class="n">rfsoc_static_ip_address</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="c1">#uses the default ip_adress</span>
</span><span id="__span-0-1487"><a id="__codelineno-0-1487" name="__codelineno-0-1487"></a>                 <span class="n">F0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">L0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-1488"><a id="__codelineno-0-1488" name="__codelineno-0-1488"></a>                 <span class="n">SPEED</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="__span-0-1489"><a id="__codelineno-0-1489" name="__codelineno-0-1489"></a>                 <span class="n">GPS_Stream_Interval</span><span class="o">=</span><span class="s1">&#39;msec500&#39;</span><span class="p">,</span> <span class="n">AVG_CALLBACK_TIME_SOCKET_RECEIVE_FCN</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span>
</span><span id="__span-0-1490"><a id="__codelineno-0-1490" name="__codelineno-0-1490"></a>                 <span class="n">operating_freq</span><span class="o">=</span><span class="mf">57.51e9</span><span class="p">,</span>
</span><span id="__span-0-1491"><a id="__codelineno-0-1491" name="__codelineno-0-1491"></a>                 <span class="n">heading_offset</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span><span id="__span-0-1492"><a id="__codelineno-0-1492" name="__codelineno-0-1492"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-1493"><a id="__codelineno-0-1493" name="__codelineno-0-1493"></a><span class="sd">        Creates instances of classes ``GimbalRS2`` (or ``GimbalGremsyH16``), ``GpsSignaling``, ``RFSoCRemoteControlFromHost`` to control these devices.</span>
</span><span id="__span-0-1494"><a id="__codelineno-0-1494" name="__codelineno-0-1494"></a>
</span><span id="__span-0-1495"><a id="__codelineno-0-1495" name="__codelineno-0-1495"></a><span class="sd">        Args:</span>
</span><span id="__span-0-1496"><a id="__codelineno-0-1496" name="__codelineno-0-1496"></a><span class="sd">            ID (str): either &#39;DRONE&#39; or &#39;GND&#39;.</span>
</span><span id="__span-0-1497"><a id="__codelineno-0-1497" name="__codelineno-0-1497"></a><span class="sd">            SERVER_ADDRESS (str): the IP address of the ground station.</span>
</span><span id="__span-0-1498"><a id="__codelineno-0-1498" name="__codelineno-0-1498"></a><span class="sd">            DBG_LVL_0 (bool, optional): if set, prints some low-level messages usefull for debugging. Defaults to False.</span>
</span><span id="__span-0-1499"><a id="__codelineno-0-1499" name="__codelineno-0-1499"></a><span class="sd">            DBG_LVL_1 (bool, optional): if set, prints some higher-level messages usefull for debugging. Defaults to False.</span>
</span><span id="__span-0-1500"><a id="__codelineno-0-1500" name="__codelineno-0-1500"></a><span class="sd">            IsGimbal (bool, optional): 0 or FALSE, when no gimbal is physically connected to this host computer; 1, when a Ronin RS2 is physically connected; 2, when a Gremsy H16 is physically connected. Defaults to False.</span>
</span><span id="__span-0-1501"><a id="__codelineno-0-1501" name="__codelineno-0-1501"></a><span class="sd">            IsGPS (bool, optional): True if a gps is physically connected to this host computer. False otherwise. Defaults to False.</span>
</span><span id="__span-0-1502"><a id="__codelineno-0-1502" name="__codelineno-0-1502"></a><span class="sd">            IsSignalGenerator (bool, optional): True if a signal generator controlled by pyvisa commands is physically connected to this host computer. False otherwise. Defaults to False.</span>
</span><span id="__span-0-1503"><a id="__codelineno-0-1503" name="__codelineno-0-1503"></a><span class="sd">            IsRFSoC (bool, optional): True if an RFSoC is physically connected to this host computer. False otherwise. Defaults to False.</span>
</span><span id="__span-0-1504"><a id="__codelineno-0-1504" name="__codelineno-0-1504"></a><span class="sd">            rfsoc_static_ip_address (str, optional): IP address of the RFSoC connected to this host computer. Defaults to None.</span>
</span><span id="__span-0-1505"><a id="__codelineno-0-1505" name="__codelineno-0-1505"></a><span class="sd">            L0 (float, optional): parameter of the signal generator. Defaults to None.</span>
</span><span id="__span-0-1506"><a id="__codelineno-0-1506" name="__codelineno-0-1506"></a><span class="sd">            SPEED (int, optional): the speed of the node in m/s. If this node is GROUND it should be 0 (gnd node does not move) as it is by default. This parameter ONLY incides in raising a warning debug print when the speed of the node is higher than the time difference between consecutive SBF sentences. NOT a crutial parameter at all. Stays here for back compatibility. Defaults to 0.</span>
</span><span id="__span-0-1507"><a id="__codelineno-0-1507" name="__codelineno-0-1507"></a><span class="sd">            GPS_Stream_Interval (str, optional): time interval used for the retrieving of the configured SBF sentences in Septentrio&#39;s receiver connected to this host computer. A list of available options is shown in ``start_gps_data_retrieval`` of class ``GpsSignaling``. Defaults to &#39;msec500&#39;.</span>
</span><span id="__span-0-1508"><a id="__codelineno-0-1508" name="__codelineno-0-1508"></a><span class="sd">            AVG_CALLBACK_TIME_SOCKET_RECEIVE_FCN (float, optional): approximated time between calls of the communication thread. This parameter is used in conjunction with ``MAX_TIME_EMPTY_SOCKETS`` to raise an exception when neither side of the communication link is sending any message. Unfortunately, this is a very simple estimate, since the actual time between calls depends on many factors and is does not remain constant between calls. Defaults to 0.001.</span>
</span><span id="__span-0-1509"><a id="__codelineno-0-1509" name="__codelineno-0-1509"></a><span class="sd">            operating_freq (_type_, optional): operating frequency of the Sivers RF-frontend. The range of defined frequencies is defined in the &quot;User Manual EVK06002&quot; of the Sivers EVK (57-71 GHz). Defaults to 57.51e9.</span>
</span><span id="__span-0-1510"><a id="__codelineno-0-1510" name="__codelineno-0-1510"></a><span class="sd">            heading_offset (int, optional): heading offset (check its definition in the ``GpsSignaling.setHeadingOffset`` method). Defaults to 0.</span>
</span><span id="__span-0-1511"><a id="__codelineno-0-1511" name="__codelineno-0-1511"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-0-1512"><a id="__codelineno-0-1512" name="__codelineno-0-1512"></a>
</span><span id="__span-0-1513"><a id="__codelineno-0-1513" name="__codelineno-0-1513"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">AVG_CALLBACK_TIME_SOCKET_RECEIVE_FCN</span> <span class="o">=</span> <span class="n">AVG_CALLBACK_TIME_SOCKET_RECEIVE_FCN</span>
</span><span id="__span-0-1514"><a id="__codelineno-0-1514" name="__codelineno-0-1514"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">MAX_TIME_EMPTY_SOCKETS</span> <span class="o">=</span> <span class="mi">20</span> <span class="c1"># in [s]</span>
</span><span id="__span-0-1515"><a id="__codelineno-0-1515" name="__codelineno-0-1515"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">MAX_NUM_RX_EMPTY_SOCKETS</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MAX_TIME_EMPTY_SOCKETS</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">AVG_CALLBACK_TIME_SOCKET_RECEIVE_FCN</span><span class="p">)</span>
</span><span id="__span-0-1516"><a id="__codelineno-0-1516" name="__codelineno-0-1516"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rxEmptySockCounter</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-0-1517"><a id="__codelineno-0-1517" name="__codelineno-0-1517"></a>
</span><span id="__span-0-1518"><a id="__codelineno-0-1518" name="__codelineno-0-1518"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">=</span> <span class="n">ID</span>
</span><span id="__span-0-1519"><a id="__codelineno-0-1519" name="__codelineno-0-1519"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">SERVER_ADDRESS</span> <span class="o">=</span> <span class="n">SERVER_ADDRESS</span>  
</span><span id="__span-0-1520"><a id="__codelineno-0-1520" name="__codelineno-0-1520"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">SOCKET_BUFFER</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-1521"><a id="__codelineno-0-1521" name="__codelineno-0-1521"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">DBG_LVL_0</span> <span class="o">=</span> <span class="n">DBG_LVL_0</span>
</span><span id="__span-0-1522"><a id="__codelineno-0-1522" name="__codelineno-0-1522"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">DBG_LVL_1</span> <span class="o">=</span> <span class="n">DBG_LVL_1</span>
</span><span id="__span-0-1523"><a id="__codelineno-0-1523" name="__codelineno-0-1523"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">IsGimbal</span> <span class="o">=</span> <span class="n">IsGimbal</span>
</span><span id="__span-0-1524"><a id="__codelineno-0-1524" name="__codelineno-0-1524"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">IsGPS</span> <span class="o">=</span> <span class="n">IsGPS</span>
</span><span id="__span-0-1525"><a id="__codelineno-0-1525" name="__codelineno-0-1525"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">IsRFSoC</span> <span class="o">=</span> <span class="n">IsRFSoC</span>
</span><span id="__span-0-1526"><a id="__codelineno-0-1526" name="__codelineno-0-1526"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">IsSignalGenerator</span> <span class="o">=</span> <span class="n">IsSignalGenerator</span>
</span><span id="__span-0-1527"><a id="__codelineno-0-1527" name="__codelineno-0-1527"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ERR_HELPER_CODE_GPS_HEAD_UNRELATED_2_COORD</span> <span class="o">=</span> <span class="o">-</span><span class="mf">7.5e3</span> 
</span><span id="__span-0-1528"><a id="__codelineno-0-1528" name="__codelineno-0-1528"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ERR_HELPER_CODE_GPS_NOT_KNOWN_DATUM</span> <span class="o">=</span> <span class="o">-</span><span class="mf">8.5e3</span>
</span><span id="__span-0-1529"><a id="__codelineno-0-1529" name="__codelineno-0-1529"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ERR_HELPER_CODE_BOTH_NODES_COORDS_CANTBE_EMPTY</span> <span class="o">=</span> <span class="o">-</span><span class="mf">9.5e3</span>
</span><span id="__span-0-1530"><a id="__codelineno-0-1530" name="__codelineno-0-1530"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">SPEED_NODE</span> <span class="o">=</span> <span class="n">SPEED</span> <span class="c1"># m/s</span>
</span><span id="__span-0-1531"><a id="__codelineno-0-1531" name="__codelineno-0-1531"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">CONN_MUST_OVER_FLAG</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># Usefull for drone side, as its script will poll for looking if this is True</span>
</span><span id="__span-0-1532"><a id="__codelineno-0-1532" name="__codelineno-0-1532"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">PAP_TO_PLOT</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-1533"><a id="__codelineno-0-1533" name="__codelineno-0-1533"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">drone_fm_flag</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="__span-0-1534"><a id="__codelineno-0-1534" name="__codelineno-0-1534"></a>
</span><span id="__span-0-1535"><a id="__codelineno-0-1535" name="__codelineno-0-1535"></a>        <span class="nb">print</span><span class="p">(</span><span class="n">IsGPS</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">IsGPS</span><span class="p">)</span>
</span><span id="__span-0-1536"><a id="__codelineno-0-1536" name="__codelineno-0-1536"></a>
</span><span id="__span-0-1537"><a id="__codelineno-0-1537" name="__codelineno-0-1537"></a>        <span class="k">if</span> <span class="n">IsRFSoC</span><span class="p">:</span>
</span><span id="__span-0-1538"><a id="__codelineno-0-1538" name="__codelineno-0-1538"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">myrfsoc</span> <span class="o">=</span> <span class="n">RFSoCRemoteControlFromHost</span><span class="p">(</span><span class="n">operating_freq</span><span class="o">=</span><span class="n">operating_freq</span><span class="p">,</span> <span class="n">rfsoc_static_ip_address</span><span class="o">=</span><span class="n">rfsoc_static_ip_address</span><span class="p">)</span>
</span><span id="__span-0-1539"><a id="__codelineno-0-1539" name="__codelineno-0-1539"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG]: Created RFSoC class&quot;</span><span class="p">)</span>
</span><span id="__span-0-1540"><a id="__codelineno-0-1540" name="__codelineno-0-1540"></a>        <span class="k">if</span> <span class="n">IsGimbal</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># By default, the TRUE value is GimbalRS2</span>
</span><span id="__span-0-1541"><a id="__codelineno-0-1541" name="__codelineno-0-1541"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">myGimbal</span> <span class="o">=</span> <span class="n">GimbalRS2</span><span class="p">()</span>
</span><span id="__span-0-1542"><a id="__codelineno-0-1542" name="__codelineno-0-1542"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">myGimbal</span><span class="o">.</span><span class="n">start_thread_gimbal</span><span class="p">()</span>
</span><span id="__span-0-1543"><a id="__codelineno-0-1543" name="__codelineno-0-1543"></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="__span-0-1544"><a id="__codelineno-0-1544" name="__codelineno-0-1544"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG]: Created Gimbal class&quot;</span><span class="p">)</span>
</span><span id="__span-0-1545"><a id="__codelineno-0-1545" name="__codelineno-0-1545"></a>        <span class="k">elif</span> <span class="n">IsGimbal</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="__span-0-1546"><a id="__codelineno-0-1546" name="__codelineno-0-1546"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">myGimbal</span> <span class="o">=</span> <span class="n">GimbalGremsyH16</span><span class="p">()</span>
</span><span id="__span-0-1547"><a id="__codelineno-0-1547" name="__codelineno-0-1547"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">myGimbal</span><span class="o">.</span><span class="n">start_thread_gimbal</span><span class="p">()</span>
</span><span id="__span-0-1548"><a id="__codelineno-0-1548" name="__codelineno-0-1548"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG]: Created Gimbal class&quot;</span><span class="p">)</span>
</span><span id="__span-0-1549"><a id="__codelineno-0-1549" name="__codelineno-0-1549"></a>        <span class="k">else</span><span class="p">:</span> <span class="c1"># IsGimbal = False</span>
</span><span id="__span-0-1550"><a id="__codelineno-0-1550" name="__codelineno-0-1550"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG]: No gimbal class is created&quot;</span><span class="p">)</span>
</span><span id="__span-0-1551"><a id="__codelineno-0-1551" name="__codelineno-0-1551"></a>        <span class="k">if</span> <span class="n">IsGPS</span><span class="p">:</span>
</span><span id="__span-0-1552"><a id="__codelineno-0-1552" name="__codelineno-0-1552"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span> <span class="o">=</span> <span class="n">GpsSignaling</span><span class="p">(</span><span class="n">DBG_LVL_2</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">DBG_LVL_1</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">DBG_LVL_0</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-0-1553"><a id="__codelineno-0-1553" name="__codelineno-0-1553"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG]: Created GPS class&quot;</span><span class="p">)</span>
</span><span id="__span-0-1554"><a id="__codelineno-0-1554" name="__codelineno-0-1554"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">serial_connect</span><span class="p">()</span>
</span><span id="__span-0-1555"><a id="__codelineno-0-1555" name="__codelineno-0-1555"></a>
</span><span id="__span-0-1556"><a id="__codelineno-0-1556" name="__codelineno-0-1556"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">GPS_CONN_SUCCESS</span><span class="p">:</span>
</span><span id="__span-0-1557"><a id="__codelineno-0-1557" name="__codelineno-0-1557"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">serial_instance</span><span class="o">.</span><span class="n">reset_input_buffer</span><span class="p">()</span>
</span><span id="__span-0-1558"><a id="__codelineno-0-1558" name="__codelineno-0-1558"></a>
</span><span id="__span-0-1559"><a id="__codelineno-0-1559" name="__codelineno-0-1559"></a>                <span class="c1"># Set the heading offset if any</span>
</span><span id="__span-0-1560"><a id="__codelineno-0-1560" name="__codelineno-0-1560"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">setHeadingOffset</span><span class="p">(</span><span class="n">heading_offset</span><span class="p">)</span>
</span><span id="__span-0-1561"><a id="__codelineno-0-1561" name="__codelineno-0-1561"></a>
</span><span id="__span-0-1562"><a id="__codelineno-0-1562" name="__codelineno-0-1562"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;DRONE&#39;</span><span class="p">:</span>
</span><span id="__span-0-1563"><a id="__codelineno-0-1563" name="__codelineno-0-1563"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">start_gps_data_retrieval</span><span class="p">(</span><span class="n">stream_number</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  <span class="n">msg_type</span><span class="o">=</span><span class="s1">&#39;SBF&#39;</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="n">GPS_Stream_Interval</span><span class="p">,</span> <span class="n">sbf_type</span><span class="o">=</span><span class="s1">&#39;+PVTCartesian+AttEuler&#39;</span><span class="p">)</span>
</span><span id="__span-0-1564"><a id="__codelineno-0-1564" name="__codelineno-0-1564"></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;GROUND&#39;</span><span class="p">:</span>
</span><span id="__span-0-1565"><a id="__codelineno-0-1565" name="__codelineno-0-1565"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">start_gps_data_retrieval</span><span class="p">(</span><span class="n">stream_number</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  <span class="n">msg_type</span><span class="o">=</span><span class="s1">&#39;SBF&#39;</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="n">GPS_Stream_Interval</span><span class="p">,</span> <span class="n">sbf_type</span><span class="o">=</span><span class="s1">&#39;+PVTCartesian+AttEuler&#39;</span><span class="p">)</span>
</span><span id="__span-0-1566"><a id="__codelineno-0-1566" name="__codelineno-0-1566"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG]: started gps stream&quot;</span><span class="p">)</span>
</span><span id="__span-0-1567"><a id="__codelineno-0-1567" name="__codelineno-0-1567"></a>                <span class="c1">#self.mySeptentrioGPS.start_gps_data_retrieval(msg_type=&#39;NMEA&#39;, nmea_type=&#39;GGA&#39;, interval=&#39;sec1&#39;)</span>
</span><span id="__span-0-1568"><a id="__codelineno-0-1568" name="__codelineno-0-1568"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">start_thread_gps</span><span class="p">()</span>
</span><span id="__span-0-1569"><a id="__codelineno-0-1569" name="__codelineno-0-1569"></a>                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="__span-0-1570"><a id="__codelineno-0-1570" name="__codelineno-0-1570"></a>        <span class="k">if</span> <span class="n">IsSignalGenerator</span><span class="p">:</span>
</span><span id="__span-0-1571"><a id="__codelineno-0-1571" name="__codelineno-0-1571"></a>            <span class="n">rm</span> <span class="o">=</span> <span class="n">pyvisa</span><span class="o">.</span><span class="n">ResourceManager</span><span class="p">()</span>
</span><span id="__span-0-1572"><a id="__codelineno-0-1572" name="__codelineno-0-1572"></a>            <span class="n">inst</span> <span class="o">=</span> <span class="n">rm</span><span class="o">.</span><span class="n">open_resource</span><span class="p">(</span><span class="s1">&#39;GPIB0::19::INSTR&#39;</span><span class="p">)</span>
</span><span id="__span-0-1573"><a id="__codelineno-0-1573" name="__codelineno-0-1573"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">inst</span> <span class="o">=</span> <span class="n">inst</span>
</span><span id="__span-0-1574"><a id="__codelineno-0-1574" name="__codelineno-0-1574"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">inst</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;F0 &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">F0</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; GH</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="__span-0-1575"><a id="__codelineno-0-1575" name="__codelineno-0-1575"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">inst</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;L0 &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">L0</span><span class="p">)</span><span class="o">+</span> <span class="s1">&#39; DM</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="__span-0-1576"><a id="__codelineno-0-1576" name="__codelineno-0-1576"></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="__span-0-1577"><a id="__codelineno-0-1577" name="__codelineno-0-1577"></a>
</span><span id="__span-0-1578"><a id="__codelineno-0-1578" name="__codelineno-0-1578"></a>    <span class="k">def</span> <span class="nf">gimbal_follows_drone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">heading</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lat_ground</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lon_ground</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">height_ground</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
</span><span id="__span-0-1579"><a id="__codelineno-0-1579" name="__codelineno-0-1579"></a>                                    <span class="n">lat_drone</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lon_drone</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">height_drone</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fmode</span><span class="o">=</span><span class="mh">0x00</span><span class="p">):</span>
</span><span id="__span-0-1580"><a id="__codelineno-0-1580" name="__codelineno-0-1580"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-1581"><a id="__codelineno-0-1581" name="__codelineno-0-1581"></a><span class="sd">        Computes the yaw, pitch and roll angles required to move the gimbal in this node towards the other node.</span>
</span><span id="__span-0-1582"><a id="__codelineno-0-1582" name="__codelineno-0-1582"></a>
</span><span id="__span-0-1583"><a id="__codelineno-0-1583" name="__codelineno-0-1583"></a><span class="sd">        The caller of this function must guarantee that if ``self.ID == &#39;GROUND&#39;``, the arguments passed to this function are drone coords. The ground coords SHOULD NOT be passed as they will be obtained from this node Septentrio&#39;s receiver.</span>
</span><span id="__span-0-1584"><a id="__codelineno-0-1584" name="__codelineno-0-1584"></a>
</span><span id="__span-0-1585"><a id="__codelineno-0-1585" name="__codelineno-0-1585"></a><span class="sd">        The caller of this function must guarantee that if ``self.ID == &#39;DRONE&#39;``, the arguments passed to this function are ground coords. The drone coords SHOULD NOT be passed as they will be obtained from this node Septentrio&#39;s receiver.</span>
</span><span id="__span-0-1586"><a id="__codelineno-0-1586" name="__codelineno-0-1586"></a>
</span><span id="__span-0-1587"><a id="__codelineno-0-1587" name="__codelineno-0-1587"></a><span class="sd">        If ``IsGPS`` is False (no GPS connected), then ``heading``, ``lat_ground``, ``lon_ground``, ``height_ground``, ``lat_drone``, ``lon_drone``, ``height_drone`` must be provided. </span>
</span><span id="__span-0-1588"><a id="__codelineno-0-1588" name="__codelineno-0-1588"></a>
</span><span id="__span-0-1589"><a id="__codelineno-0-1589" name="__codelineno-0-1589"></a><span class="sd">        In that case, all coordinates provided must be geodetic (lat, lon, alt).</span>
</span><span id="__span-0-1590"><a id="__codelineno-0-1590" name="__codelineno-0-1590"></a>
</span><span id="__span-0-1591"><a id="__codelineno-0-1591" name="__codelineno-0-1591"></a><span class="sd">        Args:</span>
</span><span id="__span-0-1592"><a id="__codelineno-0-1592" name="__codelineno-0-1592"></a><span class="sd">            heading (float, optional): angle between [0, 2*pi] (rads) corresponding to the heading of the line between the two antennas connected to Septentrio&#39;s receiver in this node. Defaults to None.</span>
</span><span id="__span-0-1593"><a id="__codelineno-0-1593" name="__codelineno-0-1593"></a><span class="sd">            lat_ground (float, optional): latitude of the GPS antenna 1 connected to Septentrio&#39;s receiver at the GROUND node. Defaults to None.</span>
</span><span id="__span-0-1594"><a id="__codelineno-0-1594" name="__codelineno-0-1594"></a><span class="sd">            lon_ground (float, optional): longitude of the GPS antenna 1 connected to Septentrio&#39;s receiver at the GROUND node. Defaults to None.</span>
</span><span id="__span-0-1595"><a id="__codelineno-0-1595" name="__codelineno-0-1595"></a><span class="sd">            height_ground (float, optional): height of the GPS antenna 1 connected to Septentrio&#39;s receiver at the GROUND node. Assuming both antennas are placed at the same height, is the altitude (in meters above sea level) of the either of the antennas. Defaults to None.</span>
</span><span id="__span-0-1596"><a id="__codelineno-0-1596" name="__codelineno-0-1596"></a><span class="sd">            lat_drone (float, optional): latitude of the GPS antenna 1 connected to Septentrio&#39;s receiver at the DRONE node. Defaults to None.</span>
</span><span id="__span-0-1597"><a id="__codelineno-0-1597" name="__codelineno-0-1597"></a><span class="sd">            lon_drone (float, optional): longitude of the GPS antenna 1 connected to Septentrio&#39;s receiver at the DRONE node. Defaults to None.</span>
</span><span id="__span-0-1598"><a id="__codelineno-0-1598" name="__codelineno-0-1598"></a><span class="sd">            height_drone (float, optional): height of the GPS antenna 1 connected to Septentrio&#39;s receiver at the DRONE node. Assuming both antennas are placed at the same height, is the altitude (in meters above sea level) of the either of the antennas. Defaults to None.</span>
</span><span id="__span-0-1599"><a id="__codelineno-0-1599" name="__codelineno-0-1599"></a><span class="sd">            fmode (hexadecimal, optional): defines if the gimbal will follow the other node in Azimuth, elevation or both of them. Options are: 0x00, for Azimuth and elevation; 0x01, for Elevation, 0x02, for Azimuth. Defaults to 0x00.</span>
</span><span id="__span-0-1600"><a id="__codelineno-0-1600" name="__codelineno-0-1600"></a>
</span><span id="__span-0-1601"><a id="__codelineno-0-1601" name="__codelineno-0-1601"></a><span class="sd">        Returns:</span>
</span><span id="__span-0-1602"><a id="__codelineno-0-1602" name="__codelineno-0-1602"></a><span class="sd">            yaw_to_set (int, optional): yaw angle to be set at the gimbal of this node, in degrees multiplied by 10 and rounded to the closest integer (i.e. a yaw to set of 45.78 degrees is returned as the yaw value 458)</span>
</span><span id="__span-0-1603"><a id="__codelineno-0-1603" name="__codelineno-0-1603"></a><span class="sd">            pitch_to_set(int, optional): pitch angle to be set at the gimbal of this node, to follow the other node. The actual value is the angle value in degrees multiplied by 10 and rounded to the closest integer (i.e. a yaw to set of 45.78 degrees is returned as the yaw value 458).</span>
</span><span id="__span-0-1604"><a id="__codelineno-0-1604" name="__codelineno-0-1604"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-0-1605"><a id="__codelineno-0-1605" name="__codelineno-0-1605"></a>
</span><span id="__span-0-1606"><a id="__codelineno-0-1606" name="__codelineno-0-1606"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">IsGPS</span><span class="p">:</span>
</span><span id="__span-0-1607"><a id="__codelineno-0-1607" name="__codelineno-0-1607"></a>            <span class="k">if</span> <span class="n">fmode</span> <span class="o">==</span> <span class="mh">0x00</span> <span class="ow">or</span> <span class="n">fmode</span> <span class="o">==</span> <span class="mh">0x02</span><span class="p">:</span>
</span><span id="__span-0-1608"><a id="__codelineno-0-1608" name="__codelineno-0-1608"></a>                <span class="n">coords</span><span class="p">,</span> <span class="n">head_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">get_last_sbf_buffer_info</span><span class="p">(</span><span class="n">what</span><span class="o">=</span><span class="s1">&#39;Both&#39;</span><span class="p">)</span>
</span><span id="__span-0-1609"><a id="__codelineno-0-1609" name="__codelineno-0-1609"></a>
</span><span id="__span-0-1610"><a id="__codelineno-0-1610" name="__codelineno-0-1610"></a>                <span class="k">if</span> <span class="n">coords</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_BUFF_NULL</span><span class="p">:</span>
</span><span id="__span-0-1611"><a id="__codelineno-0-1611" name="__codelineno-0-1611"></a>                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_BUFF_NULL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_BUFF_NULL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_BUFF_NULL</span>
</span><span id="__span-0-1612"><a id="__codelineno-0-1612" name="__codelineno-0-1612"></a>                <span class="k">elif</span> <span class="n">coords</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_SMALL_BUFF_SZ</span><span class="p">:</span>
</span><span id="__span-0-1613"><a id="__codelineno-0-1613" name="__codelineno-0-1613"></a>                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_SMALL_BUFF_SZ</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_SMALL_BUFF_SZ</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_SMALL_BUFF_SZ</span>
</span><span id="__span-0-1614"><a id="__codelineno-0-1614" name="__codelineno-0-1614"></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1615"><a id="__codelineno-0-1615" name="__codelineno-0-1615"></a>                    <span class="n">heading</span> <span class="o">=</span> <span class="n">head_info</span><span class="p">[</span><span class="s1">&#39;Heading&#39;</span><span class="p">]</span>
</span><span id="__span-0-1616"><a id="__codelineno-0-1616" name="__codelineno-0-1616"></a>                    <span class="n">time_tag_heading</span> <span class="o">=</span> <span class="n">head_info</span><span class="p">[</span><span class="s1">&#39;TOW&#39;</span><span class="p">]</span>
</span><span id="__span-0-1617"><a id="__codelineno-0-1617" name="__codelineno-0-1617"></a>                    <span class="n">time_tag_coords</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="s1">&#39;TOW&#39;</span><span class="p">]</span>
</span><span id="__span-0-1618"><a id="__codelineno-0-1618" name="__codelineno-0-1618"></a>                    <span class="n">datum_coordinates</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="s1">&#39;Datum&#39;</span><span class="p">]</span>
</span><span id="__span-0-1619"><a id="__codelineno-0-1619" name="__codelineno-0-1619"></a>            <span class="k">elif</span> <span class="n">fmode</span> <span class="o">==</span> <span class="mh">0x01</span><span class="p">:</span>
</span><span id="__span-0-1620"><a id="__codelineno-0-1620" name="__codelineno-0-1620"></a>                <span class="n">coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">get_last_sbf_buffer_info</span><span class="p">(</span><span class="n">what</span><span class="o">=</span><span class="s1">&#39;Coordinates&#39;</span><span class="p">)</span>
</span><span id="__span-0-1621"><a id="__codelineno-0-1621" name="__codelineno-0-1621"></a>
</span><span id="__span-0-1622"><a id="__codelineno-0-1622" name="__codelineno-0-1622"></a>                <span class="k">if</span> <span class="n">coords</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_BUFF_NULL</span><span class="p">:</span>
</span><span id="__span-0-1623"><a id="__codelineno-0-1623" name="__codelineno-0-1623"></a>                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_BUFF_NULL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_BUFF_NULL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_BUFF_NULL</span>
</span><span id="__span-0-1624"><a id="__codelineno-0-1624" name="__codelineno-0-1624"></a>                <span class="k">elif</span> <span class="n">coords</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_SMALL_BUFF_SZ</span><span class="p">:</span>
</span><span id="__span-0-1625"><a id="__codelineno-0-1625" name="__codelineno-0-1625"></a>                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_SMALL_BUFF_SZ</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_SMALL_BUFF_SZ</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_SMALL_BUFF_SZ</span>
</span><span id="__span-0-1626"><a id="__codelineno-0-1626" name="__codelineno-0-1626"></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1627"><a id="__codelineno-0-1627" name="__codelineno-0-1627"></a>                    <span class="n">time_tag_coords</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="s1">&#39;TOW&#39;</span><span class="p">]</span>
</span><span id="__span-0-1628"><a id="__codelineno-0-1628" name="__codelineno-0-1628"></a>                    <span class="n">datum_coordinates</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="s1">&#39;Datum&#39;</span><span class="p">]</span>
</span><span id="__span-0-1629"><a id="__codelineno-0-1629" name="__codelineno-0-1629"></a>
</span><span id="__span-0-1630"><a id="__codelineno-0-1630" name="__codelineno-0-1630"></a><span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="__span-0-1631"><a id="__codelineno-0-1631" name="__codelineno-0-1631"></a><span class="sd">            Check if the time difference (ms) between the heading and the coordinates info is less</span>
</span><span id="__span-0-1632"><a id="__codelineno-0-1632" name="__codelineno-0-1632"></a><span class="sd">            than the time it takes the node to move a predefined distance with the actual speed.           </span>
</span><span id="__span-0-1633"><a id="__codelineno-0-1633" name="__codelineno-0-1633"></a><span class="sd">            If the node is not moving (self.SPEED = 0) it means the heading info will be always the same</span>
</span><span id="__span-0-1634"><a id="__codelineno-0-1634" name="__codelineno-0-1634"></a><span class="sd">            and the check is not required.</span>
</span><span id="__span-0-1635"><a id="__codelineno-0-1635" name="__codelineno-0-1635"></a><span class="sd">            &#39;&#39;&#39;</span>
</span><span id="__span-0-1636"><a id="__codelineno-0-1636" name="__codelineno-0-1636"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">SPEED_NODE</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-0-1637"><a id="__codelineno-0-1637" name="__codelineno-0-1637"></a>                <span class="n">time_distance_allowed</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># meters</span>
</span><span id="__span-0-1638"><a id="__codelineno-0-1638" name="__codelineno-0-1638"></a>                <span class="k">if</span>  <span class="nb">abs</span><span class="p">(</span><span class="n">time_tag_coords</span> <span class="o">-</span> <span class="n">time_tag_heading</span><span class="p">)</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">time_distance_allowed</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">SPEED_NODE</span><span class="p">)</span><span class="o">*</span><span class="mi">1000</span><span class="p">:</span>
</span><span id="__span-0-1639"><a id="__codelineno-0-1639" name="__codelineno-0-1639"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">[WARNING]: for the time_distance_allowed the heading info of the grounde node does not correspond to the coordinates&#39;</span><span class="p">)</span>
</span><span id="__span-0-1640"><a id="__codelineno-0-1640" name="__codelineno-0-1640"></a>                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ERR_HELPER_CODE_GPS_HEAD_UNRELATED_2_COORD</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ERR_HELPER_CODE_GPS_HEAD_UNRELATED_2_COORD</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ERR_HELPER_CODE_GPS_HEAD_UNRELATED_2_COORD</span>
</span><span id="__span-0-1641"><a id="__codelineno-0-1641" name="__codelineno-0-1641"></a>
</span><span id="__span-0-1642"><a id="__codelineno-0-1642" name="__codelineno-0-1642"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;GROUND&#39;</span><span class="p">:</span>
</span><span id="__span-0-1643"><a id="__codelineno-0-1643" name="__codelineno-0-1643"></a>            <span class="c1"># Convert Geocentric WGS84 to Geodetic to compute distance and Inverse Transform Forward Azimuth (ITFA) </span>
</span><span id="__span-0-1644"><a id="__codelineno-0-1644" name="__codelineno-0-1644"></a>                <span class="k">if</span> <span class="n">datum_coordinates</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-0-1645"><a id="__codelineno-0-1645" name="__codelineno-0-1645"></a>                    <span class="n">lat_ground</span><span class="p">,</span> <span class="n">lon_ground</span><span class="p">,</span> <span class="n">height_ground</span> <span class="o">=</span> <span class="n">geocentric2geodetic</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">])</span>
</span><span id="__span-0-1646"><a id="__codelineno-0-1646" name="__codelineno-0-1646"></a>                <span class="c1"># Geocentric ETRS89</span>
</span><span id="__span-0-1647"><a id="__codelineno-0-1647" name="__codelineno-0-1647"></a>                <span class="k">elif</span> <span class="n">datum_coordinates</span> <span class="o">==</span> <span class="mi">30</span><span class="p">:</span>
</span><span id="__span-0-1648"><a id="__codelineno-0-1648" name="__codelineno-0-1648"></a>                    <span class="n">lat_ground</span><span class="p">,</span> <span class="n">lon_ground</span><span class="p">,</span> <span class="n">height_ground</span> <span class="o">=</span> <span class="n">geocentric2geodetic</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">],</span> <span class="n">EPSG_GEOCENTRIC</span><span class="o">=</span><span class="mi">4346</span><span class="p">)</span>
</span><span id="__span-0-1649"><a id="__codelineno-0-1649" name="__codelineno-0-1649"></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1650"><a id="__codelineno-0-1650" name="__codelineno-0-1650"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">[ERROR]: Not known geocentric datum&#39;</span><span class="p">)</span>
</span><span id="__span-0-1651"><a id="__codelineno-0-1651" name="__codelineno-0-1651"></a>                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ERR_HELPER_CODE_GPS_NOT_KNOWN_DATUM</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ERR_HELPER_CODE_GPS_NOT_KNOWN_DATUM</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ERR_HELPER_CODE_GPS_NOT_KNOWN_DATUM</span>
</span><span id="__span-0-1652"><a id="__codelineno-0-1652" name="__codelineno-0-1652"></a>
</span><span id="__span-0-1653"><a id="__codelineno-0-1653" name="__codelineno-0-1653"></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;DRONE&#39;</span><span class="p">:</span>
</span><span id="__span-0-1654"><a id="__codelineno-0-1654" name="__codelineno-0-1654"></a>                <span class="c1"># Convert Geocentric WGS84 to Geodetic to compute distance and Inverse Transform Forward Azimuth (ITFA) </span>
</span><span id="__span-0-1655"><a id="__codelineno-0-1655" name="__codelineno-0-1655"></a>                <span class="k">if</span> <span class="n">datum_coordinates</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-0-1656"><a id="__codelineno-0-1656" name="__codelineno-0-1656"></a>                    <span class="n">lat_drone</span><span class="p">,</span> <span class="n">lon_drone</span><span class="p">,</span> <span class="n">height_drone</span> <span class="o">=</span> <span class="n">geocentric2geodetic</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">])</span>
</span><span id="__span-0-1657"><a id="__codelineno-0-1657" name="__codelineno-0-1657"></a>                <span class="c1"># Geocentric ETRS89</span>
</span><span id="__span-0-1658"><a id="__codelineno-0-1658" name="__codelineno-0-1658"></a>                <span class="k">elif</span> <span class="n">datum_coordinates</span> <span class="o">==</span> <span class="mi">30</span><span class="p">:</span>
</span><span id="__span-0-1659"><a id="__codelineno-0-1659" name="__codelineno-0-1659"></a>                    <span class="n">lat_drone</span><span class="p">,</span> <span class="n">lon_drone</span><span class="p">,</span> <span class="n">height_drone</span> <span class="o">=</span> <span class="n">geocentric2geodetic</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">],</span> <span class="n">EPSG_GEOCENTRIC</span><span class="o">=</span><span class="mi">4346</span><span class="p">)</span>
</span><span id="__span-0-1660"><a id="__codelineno-0-1660" name="__codelineno-0-1660"></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1661"><a id="__codelineno-0-1661" name="__codelineno-0-1661"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">[ERROR]: Not known geocentric datum&#39;</span><span class="p">)</span>
</span><span id="__span-0-1662"><a id="__codelineno-0-1662" name="__codelineno-0-1662"></a>                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ERR_HELPER_CODE_GPS_NOT_KNOWN_DATUM</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ERR_HELPER_CODE_GPS_NOT_KNOWN_DATUM</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ERR_HELPER_CODE_GPS_NOT_KNOWN_DATUM</span>
</span><span id="__span-0-1663"><a id="__codelineno-0-1663" name="__codelineno-0-1663"></a>        <span class="c1"># Testing mode</span>
</span><span id="__span-0-1664"><a id="__codelineno-0-1664" name="__codelineno-0-1664"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">IsGPS</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="__span-0-1665"><a id="__codelineno-0-1665" name="__codelineno-0-1665"></a>            <span class="c1"># Both coordinates must be provided and must be in geodetic format</span>
</span><span id="__span-0-1666"><a id="__codelineno-0-1666" name="__codelineno-0-1666"></a>            <span class="mi">1</span>
</span><span id="__span-0-1667"><a id="__codelineno-0-1667" name="__codelineno-0-1667"></a>
</span><span id="__span-0-1668"><a id="__codelineno-0-1668" name="__codelineno-0-1668"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">lat_ground</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">lat_drone</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">lon_ground</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">lon_drone</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">height_ground</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">height_drone</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="__span-0-1669"><a id="__codelineno-0-1669" name="__codelineno-0-1669"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[ERROR]: Either ground or drone coordinates MUST be provided&quot;</span><span class="p">)</span>
</span><span id="__span-0-1670"><a id="__codelineno-0-1670" name="__codelineno-0-1670"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ERR_HELPER_CODE_BOTH_NODES_COORDS_CANTBE_EMPTY</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ERR_HELPER_CODE_BOTH_NODES_COORDS_CANTBE_EMPTY</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ERR_HELPER_CODE_BOTH_NODES_COORDS_CANTBE_EMPTY</span>       
</span><span id="__span-0-1671"><a id="__codelineno-0-1671" name="__codelineno-0-1671"></a>
</span><span id="__span-0-1672"><a id="__codelineno-0-1672" name="__codelineno-0-1672"></a>        <span class="k">if</span> <span class="n">fmode</span> <span class="o">==</span> <span class="mh">0x00</span><span class="p">:</span> <span class="c1"># Azimuth and elevation</span>
</span><span id="__span-0-1673"><a id="__codelineno-0-1673" name="__codelineno-0-1673"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;DRONE&#39;</span><span class="p">:</span>
</span><span id="__span-0-1674"><a id="__codelineno-0-1674" name="__codelineno-0-1674"></a>                <span class="n">yaw_to_set</span> <span class="o">=</span> <span class="n">azimuth_difference_between_coordinates</span><span class="p">(</span><span class="n">heading</span><span class="p">,</span> <span class="n">lat_drone</span><span class="p">,</span> <span class="n">lon_drone</span><span class="p">,</span> <span class="n">lat_ground</span><span class="p">,</span> <span class="n">lon_ground</span><span class="p">)</span>
</span><span id="__span-0-1675"><a id="__codelineno-0-1675" name="__codelineno-0-1675"></a>                <span class="n">pitch_to_set</span> <span class="o">=</span> <span class="n">elevation_difference_between_coordinates</span><span class="p">(</span><span class="n">lat_drone</span><span class="p">,</span> <span class="n">lon_drone</span><span class="p">,</span> <span class="n">height_drone</span><span class="p">,</span> <span class="n">lat_ground</span><span class="p">,</span> <span class="n">lon_ground</span><span class="p">,</span> <span class="n">height_ground</span><span class="p">)</span>
</span><span id="__span-0-1676"><a id="__codelineno-0-1676" name="__codelineno-0-1676"></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;GROUND&#39;</span><span class="p">:</span>
</span><span id="__span-0-1677"><a id="__codelineno-0-1677" name="__codelineno-0-1677"></a>                <span class="n">yaw_to_set</span> <span class="o">=</span> <span class="n">azimuth_difference_between_coordinates</span><span class="p">(</span><span class="n">heading</span><span class="p">,</span> <span class="n">lat_ground</span><span class="p">,</span> <span class="n">lon_ground</span><span class="p">,</span> <span class="n">lat_drone</span><span class="p">,</span> <span class="n">lon_drone</span><span class="p">)</span>
</span><span id="__span-0-1678"><a id="__codelineno-0-1678" name="__codelineno-0-1678"></a>                <span class="n">pitch_to_set</span> <span class="o">=</span> <span class="n">elevation_difference_between_coordinates</span><span class="p">(</span><span class="n">lat_ground</span><span class="p">,</span> <span class="n">lon_ground</span><span class="p">,</span> <span class="n">height_ground</span><span class="p">,</span> <span class="n">lat_drone</span><span class="p">,</span> <span class="n">lon_drone</span><span class="p">,</span> <span class="n">height_drone</span><span class="p">)</span>
</span><span id="__span-0-1679"><a id="__codelineno-0-1679" name="__codelineno-0-1679"></a>        <span class="k">elif</span> <span class="n">fmode</span> <span class="o">==</span> <span class="mh">0x02</span><span class="p">:</span> <span class="c1"># Azimuth</span>
</span><span id="__span-0-1680"><a id="__codelineno-0-1680" name="__codelineno-0-1680"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;DRONE&#39;</span><span class="p">:</span>
</span><span id="__span-0-1681"><a id="__codelineno-0-1681" name="__codelineno-0-1681"></a>                <span class="n">yaw_to_set</span> <span class="o">=</span> <span class="n">azimuth_difference_between_coordinates</span><span class="p">(</span><span class="n">heading</span><span class="p">,</span> <span class="n">lat_drone</span><span class="p">,</span> <span class="n">lon_drone</span><span class="p">,</span> <span class="n">lat_ground</span><span class="p">,</span> <span class="n">lon_ground</span><span class="p">)</span>
</span><span id="__span-0-1682"><a id="__codelineno-0-1682" name="__codelineno-0-1682"></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;GROUND&#39;</span><span class="p">:</span>
</span><span id="__span-0-1683"><a id="__codelineno-0-1683" name="__codelineno-0-1683"></a>                <span class="n">yaw_to_set</span> <span class="o">=</span> <span class="n">azimuth_difference_between_coordinates</span><span class="p">(</span><span class="n">heading</span><span class="p">,</span> <span class="n">lat_ground</span><span class="p">,</span> <span class="n">lon_ground</span><span class="p">,</span> <span class="n">lat_drone</span><span class="p">,</span> <span class="n">lon_drone</span><span class="p">)</span>
</span><span id="__span-0-1684"><a id="__codelineno-0-1684" name="__codelineno-0-1684"></a>        <span class="k">elif</span> <span class="n">fmode</span> <span class="o">==</span> <span class="mh">0x01</span><span class="p">:</span> <span class="c1"># Elevation</span>
</span><span id="__span-0-1685"><a id="__codelineno-0-1685" name="__codelineno-0-1685"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;DRONE&#39;</span><span class="p">:</span>
</span><span id="__span-0-1686"><a id="__codelineno-0-1686" name="__codelineno-0-1686"></a>                <span class="n">pitch_to_set</span> <span class="o">=</span> <span class="n">elevation_difference_between_coordinates</span><span class="p">(</span><span class="n">lat_drone</span><span class="p">,</span> <span class="n">lon_drone</span><span class="p">,</span> <span class="n">height_drone</span><span class="p">,</span> <span class="n">lat_ground</span><span class="p">,</span> <span class="n">lon_ground</span><span class="p">,</span> <span class="n">height_ground</span><span class="p">)</span>
</span><span id="__span-0-1687"><a id="__codelineno-0-1687" name="__codelineno-0-1687"></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;GROUND&#39;</span><span class="p">:</span>
</span><span id="__span-0-1688"><a id="__codelineno-0-1688" name="__codelineno-0-1688"></a>                <span class="n">pitch_to_set</span> <span class="o">=</span> <span class="n">elevation_difference_between_coordinates</span><span class="p">(</span><span class="n">lat_ground</span><span class="p">,</span> <span class="n">lon_ground</span><span class="p">,</span> <span class="n">height_ground</span><span class="p">,</span> <span class="n">lat_drone</span><span class="p">,</span> <span class="n">lon_drone</span><span class="p">,</span> <span class="n">height_drone</span><span class="p">)</span>
</span><span id="__span-0-1689"><a id="__codelineno-0-1689" name="__codelineno-0-1689"></a>
</span><span id="__span-0-1690"><a id="__codelineno-0-1690" name="__codelineno-0-1690"></a>        <span class="k">return</span> <span class="n">yaw_to_set</span><span class="p">,</span> <span class="n">pitch_to_set</span>
</span><span id="__span-0-1691"><a id="__codelineno-0-1691" name="__codelineno-0-1691"></a>
</span><span id="__span-0-1692"><a id="__codelineno-0-1692" name="__codelineno-0-1692"></a>    <span class="k">def</span> <span class="nf">do_follow_mode_gimbal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fmode</span><span class="o">=</span><span class="mh">0x00</span><span class="p">):</span>
</span><span id="__span-0-1693"><a id="__codelineno-0-1693" name="__codelineno-0-1693"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-1694"><a id="__codelineno-0-1694" name="__codelineno-0-1694"></a><span class="sd">        Callback function when this node receives a ``FOLLOWGIMBAL`` command.</span>
</span><span id="__span-0-1695"><a id="__codelineno-0-1695" name="__codelineno-0-1695"></a>
</span><span id="__span-0-1696"><a id="__codelineno-0-1696" name="__codelineno-0-1696"></a><span class="sd">        The ``FOLLOWGIMBAL`` command is sent when the other node asks for this node&#39;s GPS information to be able to follow this node&#39;s movement.        </span>
</span><span id="__span-0-1697"><a id="__codelineno-0-1697" name="__codelineno-0-1697"></a>
</span><span id="__span-0-1698"><a id="__codelineno-0-1698" name="__codelineno-0-1698"></a><span class="sd">        Args:</span>
</span><span id="__span-0-1699"><a id="__codelineno-0-1699" name="__codelineno-0-1699"></a><span class="sd">            fmode (hexadecimal, optional): specifies whether the other node shall follow this node&#39;s movement in: 0x00, Elevation and azimuth; 0x01, Only elevation; 0x02, Only azimuth. Defaults to 0x00.</span>
</span><span id="__span-0-1700"><a id="__codelineno-0-1700" name="__codelineno-0-1700"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-0-1701"><a id="__codelineno-0-1701" name="__codelineno-0-1701"></a>
</span><span id="__span-0-1702"><a id="__codelineno-0-1702" name="__codelineno-0-1702"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">do_getgps_action</span><span class="p">(</span><span class="n">follow_mode_gimbal</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmode</span><span class="o">=</span><span class="mh">0x00</span><span class="p">)</span>
</span><span id="__span-0-1703"><a id="__codelineno-0-1703" name="__codelineno-0-1703"></a>
</span><span id="__span-0-1704"><a id="__codelineno-0-1704" name="__codelineno-0-1704"></a>    <span class="k">def</span> <span class="nf">do_getgps_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">follow_mode_gimbal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fmode</span><span class="o">=</span><span class="mh">0x00</span><span class="p">):</span>
</span><span id="__span-0-1705"><a id="__codelineno-0-1705" name="__codelineno-0-1705"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-1706"><a id="__codelineno-0-1706" name="__codelineno-0-1706"></a><span class="sd">        Callback function when this node receives a ``GETGPS`` command.</span>
</span><span id="__span-0-1707"><a id="__codelineno-0-1707" name="__codelineno-0-1707"></a>
</span><span id="__span-0-1708"><a id="__codelineno-0-1708" name="__codelineno-0-1708"></a><span class="sd">        The ``GETGPS`` commmand differentiates from ``FOLLOWGIMBAL`` in that when the other node only request GPS information from this node (i.e. for display the coordinates on a panel of the GUI), the ``follow_mode_gimbal`` is False as well as the ``FMODE`` key of the sent dictionary.</span>
</span><span id="__span-0-1709"><a id="__codelineno-0-1709" name="__codelineno-0-1709"></a>
</span><span id="__span-0-1710"><a id="__codelineno-0-1710" name="__codelineno-0-1710"></a><span class="sd">        Args:</span>
</span><span id="__span-0-1711"><a id="__codelineno-0-1711" name="__codelineno-0-1711"></a><span class="sd">            follow_mode_gimbal (bool, optional): True if other node&#39;s gimbal must follow this node&#39;s movement. Defaults to False.</span>
</span><span id="__span-0-1712"><a id="__codelineno-0-1712" name="__codelineno-0-1712"></a><span class="sd">            fmode (hexadecimal, optional): specifies whether the other node shall follow this node&#39;s movement in: 0x00, Elevation and azimuth; 0x01, Only elevation; 0x02, Only azimuth. Defaults to 0x00.</span>
</span><span id="__span-0-1713"><a id="__codelineno-0-1713" name="__codelineno-0-1713"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-0-1714"><a id="__codelineno-0-1714" name="__codelineno-0-1714"></a>
</span><span id="__span-0-1715"><a id="__codelineno-0-1715" name="__codelineno-0-1715"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DBG_LVL_1</span><span class="p">:</span>
</span><span id="__span-0-1716"><a id="__codelineno-0-1716" name="__codelineno-0-1716"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;THIS (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="si">}</span><span class="s2">) receives a GETGPS command&quot;</span><span class="p">)</span>
</span><span id="__span-0-1717"><a id="__codelineno-0-1717" name="__codelineno-0-1717"></a>
</span><span id="__span-0-1718"><a id="__codelineno-0-1718" name="__codelineno-0-1718"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">IsGPS</span><span class="p">:</span>            
</span><span id="__span-0-1719"><a id="__codelineno-0-1719" name="__codelineno-0-1719"></a>            <span class="c1"># Only need to send to the OTHER station our last coordinates, NOT heading.</span>
</span><span id="__span-0-1720"><a id="__codelineno-0-1720" name="__codelineno-0-1720"></a>            <span class="c1"># Heading info required by the OTHER station is Heading info from the OTHER station</span>
</span><span id="__span-0-1721"><a id="__codelineno-0-1721" name="__codelineno-0-1721"></a>
</span><span id="__span-0-1722"><a id="__codelineno-0-1722" name="__codelineno-0-1722"></a>            <span class="c1"># It has to send over the socket the geocentric/geodetic coordinates</span>
</span><span id="__span-0-1723"><a id="__codelineno-0-1723" name="__codelineno-0-1723"></a>            <span class="c1"># The only way there are no coordinates available is because:</span>
</span><span id="__span-0-1724"><a id="__codelineno-0-1724" name="__codelineno-0-1724"></a>            <span class="c1"># 1) Didn&#39;t start gps thread with PVTCart and AttEuler type of messages</span>
</span><span id="__span-0-1725"><a id="__codelineno-0-1725" name="__codelineno-0-1725"></a>            <span class="c1"># 2) Messages interval is too long and the program executed first than the first message arrived</span>
</span><span id="__span-0-1726"><a id="__codelineno-0-1726" name="__codelineno-0-1726"></a>            <span class="c1"># 3) The receiver is not connected to enough satellites or multipath propagation is very strong, so that ERROR == 1</span>
</span><span id="__span-0-1727"><a id="__codelineno-0-1727" name="__codelineno-0-1727"></a>
</span><span id="__span-0-1728"><a id="__codelineno-0-1728" name="__codelineno-0-1728"></a>            <span class="n">data_to_send</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">get_last_sbf_buffer_info</span><span class="p">(</span><span class="n">what</span><span class="o">=</span><span class="s1">&#39;Coordinates&#39;</span><span class="p">)</span>
</span><span id="__span-0-1729"><a id="__codelineno-0-1729" name="__codelineno-0-1729"></a>
</span><span id="__span-0-1730"><a id="__codelineno-0-1730" name="__codelineno-0-1730"></a>            <span class="k">if</span> <span class="n">data_to_send</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_BUFF_NULL</span><span class="p">:</span>
</span><span id="__span-0-1731"><a id="__codelineno-0-1731" name="__codelineno-0-1731"></a>                <span class="c1"># More verbose</span>
</span><span id="__span-0-1732"><a id="__codelineno-0-1732" name="__codelineno-0-1732"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[WARNING]: This </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="si">}</span><span class="s2"> has nothing on GPS buffer&quot;</span><span class="p">)</span>
</span><span id="__span-0-1733"><a id="__codelineno-0-1733" name="__codelineno-0-1733"></a>                <span class="k">return</span>
</span><span id="__span-0-1734"><a id="__codelineno-0-1734" name="__codelineno-0-1734"></a>
</span><span id="__span-0-1735"><a id="__codelineno-0-1735" name="__codelineno-0-1735"></a>            <span class="k">elif</span> <span class="n">data_to_send</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_NO_COORD_AVAIL</span><span class="p">:</span>
</span><span id="__span-0-1736"><a id="__codelineno-0-1736" name="__codelineno-0-1736"></a>                <span class="c1"># More verbose</span>
</span><span id="__span-0-1737"><a id="__codelineno-0-1737" name="__codelineno-0-1737"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[WARNING]: This </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="si">}</span><span class="s2"> does not have GPS or GPS signals are not available&quot;</span><span class="p">)</span>
</span><span id="__span-0-1738"><a id="__codelineno-0-1738" name="__codelineno-0-1738"></a>                <span class="k">return</span>
</span><span id="__span-0-1739"><a id="__codelineno-0-1739" name="__codelineno-0-1739"></a>
</span><span id="__span-0-1740"><a id="__codelineno-0-1740" name="__codelineno-0-1740"></a>            <span class="k">if</span> <span class="n">follow_mode_gimbal</span><span class="p">:</span>
</span><span id="__span-0-1741"><a id="__codelineno-0-1741" name="__codelineno-0-1741"></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[DEBUG]: Last coordinates retrieved and followgimbal flag set to True to be sent&#39;</span><span class="p">)</span>
</span><span id="__span-0-1742"><a id="__codelineno-0-1742" name="__codelineno-0-1742"></a>                <span class="n">data_to_send</span><span class="p">[</span><span class="s1">&#39;FOLLOW_GIMBAL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x01</span>
</span><span id="__span-0-1743"><a id="__codelineno-0-1743" name="__codelineno-0-1743"></a>                <span class="n">data_to_send</span><span class="p">[</span><span class="s1">&#39;FMODE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fmode</span>
</span><span id="__span-0-1744"><a id="__codelineno-0-1744" name="__codelineno-0-1744"></a>
</span><span id="__span-0-1745"><a id="__codelineno-0-1745" name="__codelineno-0-1745"></a>            <span class="c1"># data_to_send wont be any of the other error codes, because they are not set for &#39;what&#39;==&#39;Coordinates&#39;</span>
</span><span id="__span-0-1746"><a id="__codelineno-0-1746" name="__codelineno-0-1746"></a>            <span class="k">else</span><span class="p">:</span>            
</span><span id="__span-0-1747"><a id="__codelineno-0-1747" name="__codelineno-0-1747"></a>                <span class="n">data_to_send</span><span class="p">[</span><span class="s1">&#39;FOLLOW_GIMBAL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x02</span>
</span><span id="__span-0-1748"><a id="__codelineno-0-1748" name="__codelineno-0-1748"></a>
</span><span id="__span-0-1749"><a id="__codelineno-0-1749" name="__codelineno-0-1749"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;GROUND&#39;</span><span class="p">:</span>
</span><span id="__span-0-1750"><a id="__codelineno-0-1750" name="__codelineno-0-1750"></a>                <span class="n">frame_to_send</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encode_message</span><span class="p">(</span><span class="n">source_id</span><span class="o">=</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">destination_id</span><span class="o">=</span><span class="mh">0x02</span><span class="p">,</span> <span class="n">message_type</span><span class="o">=</span><span class="mh">0x03</span><span class="p">,</span> <span class="n">cmd</span><span class="o">=</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data_to_send</span><span class="p">)</span>
</span><span id="__span-0-1751"><a id="__codelineno-0-1751" name="__codelineno-0-1751"></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;DRONE&#39;</span><span class="p">:</span>
</span><span id="__span-0-1752"><a id="__codelineno-0-1752" name="__codelineno-0-1752"></a>                <span class="n">frame_to_send</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encode_message</span><span class="p">(</span><span class="n">source_id</span><span class="o">=</span><span class="mh">0x02</span><span class="p">,</span> <span class="n">destination_id</span><span class="o">=</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">message_type</span><span class="o">=</span><span class="mh">0x03</span><span class="p">,</span> <span class="n">cmd</span><span class="o">=</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data_to_send</span><span class="p">)</span>
</span><span id="__span-0-1753"><a id="__codelineno-0-1753" name="__codelineno-0-1753"></a>
</span><span id="__span-0-1754"><a id="__codelineno-0-1754" name="__codelineno-0-1754"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DBG_LVL_1</span><span class="p">:</span>
</span><span id="__span-0-1755"><a id="__codelineno-0-1755" name="__codelineno-0-1755"></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">[DEBUG_1]:Received the GETGPS and read the SBF buffer&#39;</span><span class="p">)</span>
</span><span id="__span-0-1756"><a id="__codelineno-0-1756" name="__codelineno-0-1756"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;GROUND&#39;</span><span class="p">:</span>
</span><span id="__span-0-1757"><a id="__codelineno-0-1757" name="__codelineno-0-1757"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">a2g_conn</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">frame_to_send</span><span class="p">)</span>
</span><span id="__span-0-1758"><a id="__codelineno-0-1758" name="__codelineno-0-1758"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;DRONE&#39;</span><span class="p">:</span>
</span><span id="__span-0-1759"><a id="__codelineno-0-1759" name="__codelineno-0-1759"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">frame_to_send</span><span class="p">)</span>
</span><span id="__span-0-1760"><a id="__codelineno-0-1760" name="__codelineno-0-1760"></a>
</span><span id="__span-0-1761"><a id="__codelineno-0-1761" name="__codelineno-0-1761"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DBG_LVL_1</span><span class="p">:</span>
</span><span id="__span-0-1762"><a id="__codelineno-0-1762" name="__codelineno-0-1762"></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">[DEBUG_1]: Sent SBF buffer&#39;</span><span class="p">)</span>
</span><span id="__span-0-1763"><a id="__codelineno-0-1763" name="__codelineno-0-1763"></a>
</span><span id="__span-0-1764"><a id="__codelineno-0-1764" name="__codelineno-0-1764"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1765"><a id="__codelineno-0-1765" name="__codelineno-0-1765"></a>            <span class="c1">#print(&#39;[WARNING]:ASKED for GPS position but no GPS connected: IsGPS is False&#39;)</span>
</span><span id="__span-0-1766"><a id="__codelineno-0-1766" name="__codelineno-0-1766"></a>            <span class="mi">1</span>
</span><span id="__span-0-1767"><a id="__codelineno-0-1767" name="__codelineno-0-1767"></a>
</span><span id="__span-0-1768"><a id="__codelineno-0-1768" name="__codelineno-0-1768"></a>    <span class="k">def</span> <span class="nf">do_setgimbal_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg_data</span><span class="p">):</span>
</span><span id="__span-0-1769"><a id="__codelineno-0-1769" name="__codelineno-0-1769"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-1770"><a id="__codelineno-0-1770" name="__codelineno-0-1770"></a><span class="sd">        Callback function when this node receives a ``SETGIMBAL`` command.</span>
</span><span id="__span-0-1771"><a id="__codelineno-0-1771" name="__codelineno-0-1771"></a>
</span><span id="__span-0-1772"><a id="__codelineno-0-1772" name="__codelineno-0-1772"></a><span class="sd">        Args:</span>
</span><span id="__span-0-1773"><a id="__codelineno-0-1773" name="__codelineno-0-1773"></a><span class="sd">            msg_data (dict): dictionary with keys &#39;YAW&#39;, &#39;PITCH&#39; and &#39;MODE&#39;. The &#39;YAW&#39; values range between [-1800, 1800]. The &#39;PITCH&#39; values are restricted (by software) to the interval [-600, 600] to avoid hits between the case and the gimbal. The &#39;MODE&#39; values are: 0x00, consider &#39;YAW&#39; and/or &#39;PITCH&#39; values as relative to the actual position of the gimbal; 0x01, consider &#39;YAW&#39; and/or &#39;PITCH&#39; values as relative to the absolute 0 (in both azimuth and elevation) position.</span>
</span><span id="__span-0-1774"><a id="__codelineno-0-1774" name="__codelineno-0-1774"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-0-1775"><a id="__codelineno-0-1775" name="__codelineno-0-1775"></a>
</span><span id="__span-0-1776"><a id="__codelineno-0-1776" name="__codelineno-0-1776"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">IsGimbal</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
</span><span id="__span-0-1777"><a id="__codelineno-0-1777" name="__codelineno-0-1777"></a>            <span class="c1"># Unwrap the dictionary containing the yaw and pitch values to be set.</span>
</span><span id="__span-0-1778"><a id="__codelineno-0-1778" name="__codelineno-0-1778"></a>            <span class="c1">#msg_data = json.loads(msg_data)</span>
</span><span id="__span-0-1779"><a id="__codelineno-0-1779" name="__codelineno-0-1779"></a>
</span><span id="__span-0-1780"><a id="__codelineno-0-1780" name="__codelineno-0-1780"></a>            <span class="c1"># Error checking</span>
</span><span id="__span-0-1781"><a id="__codelineno-0-1781" name="__codelineno-0-1781"></a>            <span class="c1">#if &#39;YAW&#39; not in msg_data or &#39;PITCH&#39; not in msg_data or &#39;MODE&#39; not in msg_data:</span>
</span><span id="__span-0-1782"><a id="__codelineno-0-1782" name="__codelineno-0-1782"></a>            <span class="k">if</span> <span class="s1">&#39;YAW&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">msg_data</span> <span class="ow">or</span> <span class="s1">&#39;PITCH&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">msg_data</span><span class="p">:</span>
</span><span id="__span-0-1783"><a id="__codelineno-0-1783" name="__codelineno-0-1783"></a>                <span class="k">if</span> <span class="s1">&#39;MODE&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">msg_data</span><span class="p">:</span>
</span><span id="__span-0-1784"><a id="__codelineno-0-1784" name="__codelineno-0-1784"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[ERROR]: no YAW or PITCH provided&#39;</span><span class="p">)</span>
</span><span id="__span-0-1785"><a id="__codelineno-0-1785" name="__codelineno-0-1785"></a>                    <span class="k">return</span>
</span><span id="__span-0-1786"><a id="__codelineno-0-1786" name="__codelineno-0-1786"></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1787"><a id="__codelineno-0-1787" name="__codelineno-0-1787"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">myGimbal</span><span class="o">.</span><span class="n">change_gimbal_mode</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">msg_data</span><span class="p">[</span><span class="s1">&#39;MODE&#39;</span><span class="p">])</span>                    
</span><span id="__span-0-1788"><a id="__codelineno-0-1788" name="__codelineno-0-1788"></a>            <span class="k">elif</span> <span class="s1">&#39;YAW&#39;</span> <span class="ow">in</span> <span class="n">msg_data</span> <span class="ow">and</span> <span class="s1">&#39;PITCH&#39;</span> <span class="ow">in</span> <span class="n">msg_data</span><span class="p">:</span>
</span><span id="__span-0-1789"><a id="__codelineno-0-1789" name="__codelineno-0-1789"></a>                <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">msg_data</span><span class="p">[</span><span class="s1">&#39;YAW&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1800</span> <span class="ow">or</span> <span class="nb">float</span><span class="p">(</span><span class="n">msg_data</span><span class="p">[</span><span class="s1">&#39;PITCH&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">600</span> <span class="ow">or</span> <span class="nb">float</span><span class="p">(</span><span class="n">msg_data</span><span class="p">[</span><span class="s1">&#39;YAW&#39;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1800</span> <span class="ow">or</span> <span class="nb">float</span><span class="p">(</span><span class="n">msg_data</span><span class="p">[</span><span class="s1">&#39;PITCH&#39;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">600</span><span class="p">:</span>
</span><span id="__span-0-1790"><a id="__codelineno-0-1790" name="__codelineno-0-1790"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[ERROR]: Yaw or pitch angles are outside of range&#39;</span><span class="p">)</span>
</span><span id="__span-0-1791"><a id="__codelineno-0-1791" name="__codelineno-0-1791"></a>                    <span class="k">return</span>
</span><span id="__span-0-1792"><a id="__codelineno-0-1792" name="__codelineno-0-1792"></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1793"><a id="__codelineno-0-1793" name="__codelineno-0-1793"></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">IsGimbal</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># RS2</span>
</span><span id="__span-0-1794"><a id="__codelineno-0-1794" name="__codelineno-0-1794"></a>                        <span class="c1"># Cast to int values as a double check, but values are send as numbers and not as strings.</span>
</span><span id="__span-0-1795"><a id="__codelineno-0-1795" name="__codelineno-0-1795"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">myGimbal</span><span class="o">.</span><span class="n">setPosControl</span><span class="p">(</span><span class="n">yaw</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">msg_data</span><span class="p">[</span><span class="s1">&#39;YAW&#39;</span><span class="p">]),</span> <span class="n">roll</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">pitch</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">msg_data</span><span class="p">[</span><span class="s1">&#39;PITCH&#39;</span><span class="p">]),</span> <span class="n">ctrl_byte</span><span class="o">=</span><span class="n">msg_data</span><span class="p">[</span><span class="s1">&#39;MODE&#39;</span><span class="p">])</span>
</span><span id="__span-0-1796"><a id="__codelineno-0-1796" name="__codelineno-0-1796"></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">IsGimbal</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span> <span class="c1"># Gremsy</span>
</span><span id="__span-0-1797"><a id="__codelineno-0-1797" name="__codelineno-0-1797"></a>                        <span class="c1"># Cast to int values as a double check, but values are send as numbers and not as strings.</span>
</span><span id="__span-0-1798"><a id="__codelineno-0-1798" name="__codelineno-0-1798"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">myGimbal</span><span class="o">.</span><span class="n">setPosControl</span><span class="p">(</span><span class="n">yaw</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">msg_data</span><span class="p">[</span><span class="s1">&#39;YAW&#39;</span><span class="p">]),</span> <span class="n">pitch</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">msg_data</span><span class="p">[</span><span class="s1">&#39;PITCH&#39;</span><span class="p">]),</span> <span class="n">mode</span><span class="o">=</span><span class="n">msg_data</span><span class="p">[</span><span class="s1">&#39;MODE&#39;</span><span class="p">])</span>
</span><span id="__span-0-1799"><a id="__codelineno-0-1799" name="__codelineno-0-1799"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1800"><a id="__codelineno-0-1800" name="__codelineno-0-1800"></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">[WARNING]: Action to SET Gimbal not posible cause there is no gimbal: IsGimbal is False&#39;</span><span class="p">)</span>
</span><span id="__span-0-1801"><a id="__codelineno-0-1801" name="__codelineno-0-1801"></a>
</span><span id="__span-0-1802"><a id="__codelineno-0-1802" name="__codelineno-0-1802"></a>    <span class="k">def</span> <span class="nf">do_start_meas_drone_rfsoc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg_data</span><span class="p">):</span>
</span><span id="__span-0-1803"><a id="__codelineno-0-1803" name="__codelineno-0-1803"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-1804"><a id="__codelineno-0-1804" name="__codelineno-0-1804"></a><span class="sd">        Callback function when this node receives a ``STARTDRONERFSOC`` command.</span>
</span><span id="__span-0-1805"><a id="__codelineno-0-1805" name="__codelineno-0-1805"></a>
</span><span id="__span-0-1806"><a id="__codelineno-0-1806" name="__codelineno-0-1806"></a><span class="sd">        This comand is unidirectional. It is always sent by the ground node to the drone node.</span>
</span><span id="__span-0-1807"><a id="__codelineno-0-1807" name="__codelineno-0-1807"></a>
</span><span id="__span-0-1808"><a id="__codelineno-0-1808" name="__codelineno-0-1808"></a><span class="sd">        The purpose is to start the RFSoC thread (created in ``RFSoCRemoteControlFromHost`` class) responsible for retrieving the measured Channel Impulse Response from the RFSoC.</span>
</span><span id="__span-0-1809"><a id="__codelineno-0-1809" name="__codelineno-0-1809"></a>
</span><span id="__span-0-1810"><a id="__codelineno-0-1810" name="__codelineno-0-1810"></a><span class="sd">        It is assumed that prior to this callback, the ground rfsoc (tx) has started sending the its sounding signal and there were no issues.</span>
</span><span id="__span-0-1811"><a id="__codelineno-0-1811" name="__codelineno-0-1811"></a>
</span><span id="__span-0-1812"><a id="__codelineno-0-1812" name="__codelineno-0-1812"></a><span class="sd">        Args:</span>
</span><span id="__span-0-1813"><a id="__codelineno-0-1813" name="__codelineno-0-1813"></a><span class="sd">            msg_data (dict): dictionary with keys &#39;carrier_freq&#39;, &#39;rx_gain_ctrl_bb1&#39;, &#39;rx_gain_ctrl_bb2&#39;, &#39;rx_gain_ctrl_bb3&#39;, &#39;rx_gain_ctrl_bfrf&#39;. More information about these keys can be found in method ``set_rx_rf`` from ``RFSoCRemoteControlFromHost`` class.</span>
</span><span id="__span-0-1814"><a id="__codelineno-0-1814" name="__codelineno-0-1814"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-0-1815"><a id="__codelineno-0-1815" name="__codelineno-0-1815"></a>
</span><span id="__span-0-1816"><a id="__codelineno-0-1816" name="__codelineno-0-1816"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;DRONE&#39;</span><span class="p">:</span> <span class="c1"># double check that we are in the drone</span>
</span><span id="__span-0-1817"><a id="__codelineno-0-1817" name="__codelineno-0-1817"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG]: Received REQUEST to START measurement&quot;</span><span class="p">)</span>
</span><span id="__span-0-1818"><a id="__codelineno-0-1818" name="__codelineno-0-1818"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">myrfsoc</span><span class="o">.</span><span class="n">start_thread_receive_meas_data</span><span class="p">(</span><span class="n">msg_data</span><span class="p">)</span>
</span><span id="__span-0-1819"><a id="__codelineno-0-1819" name="__codelineno-0-1819"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">STOP_SEND_SETIRF_FLAG</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="__span-0-1820"><a id="__codelineno-0-1820" name="__codelineno-0-1820"></a>
</span><span id="__span-0-1821"><a id="__codelineno-0-1821" name="__codelineno-0-1821"></a>    <span class="k">def</span> <span class="nf">do_stop_meas_drone_rfsoc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-1822"><a id="__codelineno-0-1822" name="__codelineno-0-1822"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-1823"><a id="__codelineno-0-1823" name="__codelineno-0-1823"></a><span class="sd">        Callback function when this node receives a ``STOPDRONERFSOC`` command.</span>
</span><span id="__span-0-1824"><a id="__codelineno-0-1824" name="__codelineno-0-1824"></a>
</span><span id="__span-0-1825"><a id="__codelineno-0-1825" name="__codelineno-0-1825"></a><span class="sd">        This comand is unidirectional. It is always sent by the ground node to the drone node.</span>
</span><span id="__span-0-1826"><a id="__codelineno-0-1826" name="__codelineno-0-1826"></a>
</span><span id="__span-0-1827"><a id="__codelineno-0-1827" name="__codelineno-0-1827"></a><span class="sd">        The purpose is to stop the RFSoC thread.</span>
</span><span id="__span-0-1828"><a id="__codelineno-0-1828" name="__codelineno-0-1828"></a>
</span><span id="__span-0-1829"><a id="__codelineno-0-1829" name="__codelineno-0-1829"></a><span class="sd">        It is assumed that prior to this function, the ground rfsoc (tx) has started sending the its sounding signal and there were no issues.</span>
</span><span id="__span-0-1830"><a id="__codelineno-0-1830" name="__codelineno-0-1830"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-0-1831"><a id="__codelineno-0-1831" name="__codelineno-0-1831"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;DRONE&#39;</span><span class="p">:</span> <span class="c1"># double check that we are in the drone</span>
</span><span id="__span-0-1832"><a id="__codelineno-0-1832" name="__codelineno-0-1832"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG]: Received REQUEST to STOP measurement&quot;</span><span class="p">)</span>
</span><span id="__span-0-1833"><a id="__codelineno-0-1833" name="__codelineno-0-1833"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">myrfsoc</span><span class="o">.</span><span class="n">stop_thread_receive_meas_data</span><span class="p">()</span>
</span><span id="__span-0-1834"><a id="__codelineno-0-1834" name="__codelineno-0-1834"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">STOP_SEND_SETIRF_FLAG</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="__span-0-1835"><a id="__codelineno-0-1835" name="__codelineno-0-1835"></a>
</span><span id="__span-0-1836"><a id="__codelineno-0-1836" name="__codelineno-0-1836"></a>    <span class="k">def</span> <span class="nf">do_finish_meas_drone_rfsoc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-1837"><a id="__codelineno-0-1837" name="__codelineno-0-1837"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-1838"><a id="__codelineno-0-1838" name="__codelineno-0-1838"></a><span class="sd">        Callback function when this node receives a ``FINISHDRONERFSOC`` command.</span>
</span><span id="__span-0-1839"><a id="__codelineno-0-1839" name="__codelineno-0-1839"></a>
</span><span id="__span-0-1840"><a id="__codelineno-0-1840" name="__codelineno-0-1840"></a><span class="sd">        This comand is unidirectional. It is always sent by the ground node to the drone node.</span>
</span><span id="__span-0-1841"><a id="__codelineno-0-1841" name="__codelineno-0-1841"></a>
</span><span id="__span-0-1842"><a id="__codelineno-0-1842" name="__codelineno-0-1842"></a><span class="sd">        The purpose is to finish the experiment (as defined in &quot;Manual A2GMeasurements&quot;). When the experiment is finished the GUI allows the user to end (disconnect) the connection between both nodes.</span>
</span><span id="__span-0-1843"><a id="__codelineno-0-1843" name="__codelineno-0-1843"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-0-1844"><a id="__codelineno-0-1844" name="__codelineno-0-1844"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;DRONE&#39;</span><span class="p">:</span> <span class="c1"># double check that we are in the drone</span>
</span><span id="__span-0-1845"><a id="__codelineno-0-1845" name="__codelineno-0-1845"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG]: Received REQUEST to FINISH measurement&quot;</span><span class="p">)</span>
</span><span id="__span-0-1846"><a id="__codelineno-0-1846" name="__codelineno-0-1846"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">myrfsoc</span><span class="o">.</span><span class="n">finish_measurement</span><span class="p">()</span>
</span><span id="__span-0-1847"><a id="__codelineno-0-1847" name="__codelineno-0-1847"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">STOP_SEND_SETIRF_FLAG</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="__span-0-1848"><a id="__codelineno-0-1848" name="__codelineno-0-1848"></a>
</span><span id="__span-0-1849"><a id="__codelineno-0-1849" name="__codelineno-0-1849"></a>    <span class="k">def</span> <span class="nf">do_set_irf_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg_data</span><span class="p">):</span>
</span><span id="__span-0-1850"><a id="__codelineno-0-1850" name="__codelineno-0-1850"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-1851"><a id="__codelineno-0-1851" name="__codelineno-0-1851"></a><span class="sd">        Callback function when this node receives a ``SETIRF`` command.</span>
</span><span id="__span-0-1852"><a id="__codelineno-0-1852" name="__codelineno-0-1852"></a>
</span><span id="__span-0-1853"><a id="__codelineno-0-1853" name="__codelineno-0-1853"></a><span class="sd">        This comand is unidirectional. It is always sent by the drone node to the ground node.</span>
</span><span id="__span-0-1854"><a id="__codelineno-0-1854" name="__codelineno-0-1854"></a>
</span><span id="__span-0-1855"><a id="__codelineno-0-1855" name="__codelineno-0-1855"></a><span class="sd">        Receives from the drone a subsampled version of the Power Angular Profile for it to be used by the GUI to continuously plot it in its PAP panel.</span>
</span><span id="__span-0-1856"><a id="__codelineno-0-1856" name="__codelineno-0-1856"></a>
</span><span id="__span-0-1857"><a id="__codelineno-0-1857" name="__codelineno-0-1857"></a><span class="sd">        Args:</span>
</span><span id="__span-0-1858"><a id="__codelineno-0-1858" name="__codelineno-0-1858"></a><span class="sd">            msg_data (numpy.ndarray): attribute value ``data_to_visualize`` from ``RFSoCRemoteControlFromHost`` class.</span>
</span><span id="__span-0-1859"><a id="__codelineno-0-1859" name="__codelineno-0-1859"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-0-1860"><a id="__codelineno-0-1860" name="__codelineno-0-1860"></a>
</span><span id="__span-0-1861"><a id="__codelineno-0-1861" name="__codelineno-0-1861"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;GROUND&#39;</span><span class="p">:</span> <span class="c1"># double checj that we are in the gnd</span>
</span><span id="__span-0-1862"><a id="__codelineno-0-1862" name="__codelineno-0-1862"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">PAP_TO_PLOT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">msg_data</span><span class="p">)</span>
</span><span id="__span-0-1863"><a id="__codelineno-0-1863" name="__codelineno-0-1863"></a>
</span><span id="__span-0-1864"><a id="__codelineno-0-1864" name="__codelineno-0-1864"></a>    <span class="k">def</span> <span class="nf">do_closed_gui_action</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-1865"><a id="__codelineno-0-1865" name="__codelineno-0-1865"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-1866"><a id="__codelineno-0-1866" name="__codelineno-0-1866"></a><span class="sd">        Callback function when this node receives a ``CLOSEDGUI`` command.</span>
</span><span id="__span-0-1867"><a id="__codelineno-0-1867" name="__codelineno-0-1867"></a>
</span><span id="__span-0-1868"><a id="__codelineno-0-1868" name="__codelineno-0-1868"></a><span class="sd">        This comand is unidirectional. It is always sent by the ground node to the drone node.</span>
</span><span id="__span-0-1869"><a id="__codelineno-0-1869" name="__codelineno-0-1869"></a>
</span><span id="__span-0-1870"><a id="__codelineno-0-1870" name="__codelineno-0-1870"></a><span class="sd">        Sets a flag indicating (the drone node) that it can end its main script, since the GUI was closed by the user at the ground node.</span>
</span><span id="__span-0-1871"><a id="__codelineno-0-1871" name="__codelineno-0-1871"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-0-1872"><a id="__codelineno-0-1872" name="__codelineno-0-1872"></a>
</span><span id="__span-0-1873"><a id="__codelineno-0-1873" name="__codelineno-0-1873"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;DRONE&#39;</span><span class="p">:</span>
</span><span id="__span-0-1874"><a id="__codelineno-0-1874" name="__codelineno-0-1874"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">CONN_MUST_OVER_FLAG</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="__span-0-1875"><a id="__codelineno-0-1875" name="__codelineno-0-1875"></a>
</span><span id="__span-0-1876"><a id="__codelineno-0-1876" name="__codelineno-0-1876"></a>    <span class="k">def</span> <span class="nf">do_set_remote_fm_flag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="__span-0-1877"><a id="__codelineno-0-1877" name="__codelineno-0-1877"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-1878"><a id="__codelineno-0-1878" name="__codelineno-0-1878"></a><span class="sd">        Callback function when this node receives a ``SETREMOTEFMFLAG`` command.</span>
</span><span id="__span-0-1879"><a id="__codelineno-0-1879" name="__codelineno-0-1879"></a>
</span><span id="__span-0-1880"><a id="__codelineno-0-1880" name="__codelineno-0-1880"></a><span class="sd">        This comand is unidirectional. It is always sent by the ground node to the drone node.</span>
</span><span id="__span-0-1881"><a id="__codelineno-0-1881" name="__codelineno-0-1881"></a>
</span><span id="__span-0-1882"><a id="__codelineno-0-1882" name="__codelineno-0-1882"></a><span class="sd">        Sets the ``drone_fm_flag``. When this flag is set, the drone node can start sending ``FOLLOWGIMBALL`` commands to the ground node to get ground node&#39;s coordinates and be able to follow (drone node) it (ground node).</span>
</span><span id="__span-0-1883"><a id="__codelineno-0-1883" name="__codelineno-0-1883"></a>
</span><span id="__span-0-1884"><a id="__codelineno-0-1884" name="__codelineno-0-1884"></a><span class="sd">        Args:</span>
</span><span id="__span-0-1885"><a id="__codelineno-0-1885" name="__codelineno-0-1885"></a><span class="sd">            data (dict, optional): dictionary with keys &#39;X&#39;, &#39;Y&#39;, &#39;Z&#39;, &#39;FMODE&#39;, &#39;MOBILITY&#39;, corresponding to geocentric coordinates. The mentioned keys and their corresponding values refer to the ground node. The coordinates will be available if the ground node ``MOBILITY`` is ``static`` (0x01). The ``FMODE`` key refers to the wheter the drone gimbal follows the ground node in azimuth (0x02), elevation (0x01) or both (0x00) .Defaults to None.</span>
</span><span id="__span-0-1886"><a id="__codelineno-0-1886" name="__codelineno-0-1886"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-0-1887"><a id="__codelineno-0-1887" name="__codelineno-0-1887"></a>
</span><span id="__span-0-1888"><a id="__codelineno-0-1888" name="__codelineno-0-1888"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;DRONE&#39;</span><span class="p">:</span>
</span><span id="__span-0-1889"><a id="__codelineno-0-1889" name="__codelineno-0-1889"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">drone_fm_flag</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="__span-0-1890"><a id="__codelineno-0-1890" name="__codelineno-0-1890"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">remote_config_for_drone_fm</span> <span class="o">=</span> <span class="n">data</span>
</span><span id="__span-0-1891"><a id="__codelineno-0-1891" name="__codelineno-0-1891"></a>
</span><span id="__span-0-1892"><a id="__codelineno-0-1892" name="__codelineno-0-1892"></a>    <span class="k">def</span> <span class="nf">do_set_remote_stop_fm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-1893"><a id="__codelineno-0-1893" name="__codelineno-0-1893"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-1894"><a id="__codelineno-0-1894" name="__codelineno-0-1894"></a><span class="sd">        Callback function when this node receives a ``SETREMOTESTOPFM`` command.</span>
</span><span id="__span-0-1895"><a id="__codelineno-0-1895" name="__codelineno-0-1895"></a>
</span><span id="__span-0-1896"><a id="__codelineno-0-1896" name="__codelineno-0-1896"></a><span class="sd">        This comand is unidirectional. It is always sent by the ground node to the drone node.</span>
</span><span id="__span-0-1897"><a id="__codelineno-0-1897" name="__codelineno-0-1897"></a>
</span><span id="__span-0-1898"><a id="__codelineno-0-1898" name="__codelineno-0-1898"></a><span class="sd">        Unsets the ``drone_fm_flag`` flag.</span>
</span><span id="__span-0-1899"><a id="__codelineno-0-1899" name="__codelineno-0-1899"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-0-1900"><a id="__codelineno-0-1900" name="__codelineno-0-1900"></a>
</span><span id="__span-0-1901"><a id="__codelineno-0-1901" name="__codelineno-0-1901"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;DRONE&#39;</span><span class="p">:</span>
</span><span id="__span-0-1902"><a id="__codelineno-0-1902" name="__codelineno-0-1902"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">drone_fm_flag</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="__span-0-1903"><a id="__codelineno-0-1903" name="__codelineno-0-1903"></a>
</span><span id="__span-0-1904"><a id="__codelineno-0-1904" name="__codelineno-0-1904"></a>    <span class="k">def</span> <span class="nf">process_answer_get_gps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span><span id="__span-0-1905"><a id="__codelineno-0-1905" name="__codelineno-0-1905"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-1906"><a id="__codelineno-0-1906" name="__codelineno-0-1906"></a><span class="sd">        Callback function when this node receives an ``ANS`` type of message (the equivalent to an acknowledment) from the other node, after this node sent to the other node a ``GETGPS`` or a ``FOLLOWGIMBAL`` command.</span>
</span><span id="__span-0-1907"><a id="__codelineno-0-1907" name="__codelineno-0-1907"></a>
</span><span id="__span-0-1908"><a id="__codelineno-0-1908" name="__codelineno-0-1908"></a><span class="sd">        Args:</span>
</span><span id="__span-0-1909"><a id="__codelineno-0-1909" name="__codelineno-0-1909"></a><span class="sd">            data (dict): dictionary with keys &#39;X&#39;, &#39;Y&#39;, &#39;Z&#39;, &#39;FMODE&#39;, &#39;FOLLOW_GIMBAL&#39;. The values of &#39;X&#39;, &#39;Y&#39;, &#39;Z&#39; are the geocentric coordinates from the other node. &#39;FMODE&#39; is either 0x00 (Elevation and Azimuth), 0x01 (Elevation) or 0x02 (Azimuth). &#39;FOLLOW_GIMBAL&#39; is either True (when the sent command by this node was ``FOLLOWGIMBAL``) or False (when the sent command by this node was ``GETGPS``)</span>
</span><span id="__span-0-1910"><a id="__codelineno-0-1910" name="__codelineno-0-1910"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-0-1911"><a id="__codelineno-0-1911" name="__codelineno-0-1911"></a>
</span><span id="__span-0-1912"><a id="__codelineno-0-1912" name="__codelineno-0-1912"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DBG_LVL_1</span><span class="p">:</span>
</span><span id="__span-0-1913"><a id="__codelineno-0-1913" name="__codelineno-0-1913"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;THIS (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="si">}</span><span class="s2">) receives protocol ANS&quot;</span><span class="p">)</span>
</span><span id="__span-0-1914"><a id="__codelineno-0-1914" name="__codelineno-0-1914"></a>
</span><span id="__span-0-1915"><a id="__codelineno-0-1915" name="__codelineno-0-1915"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span><span class="s1">&#39;DRONE&#39;</span><span class="p">:</span>
</span><span id="__span-0-1916"><a id="__codelineno-0-1916" name="__codelineno-0-1916"></a>            <span class="n">y_gnd</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span>
</span><span id="__span-0-1917"><a id="__codelineno-0-1917" name="__codelineno-0-1917"></a>            <span class="n">x_gnd</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span>
</span><span id="__span-0-1918"><a id="__codelineno-0-1918" name="__codelineno-0-1918"></a>
</span><span id="__span-0-1919"><a id="__codelineno-0-1919" name="__codelineno-0-1919"></a>            <span class="n">datum_coordinates</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Datum&#39;</span><span class="p">]</span>
</span><span id="__span-0-1920"><a id="__codelineno-0-1920" name="__codelineno-0-1920"></a>
</span><span id="__span-0-1921"><a id="__codelineno-0-1921" name="__codelineno-0-1921"></a>            <span class="k">if</span> <span class="n">y_gnd</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_NO_COORD_AVAIL</span> <span class="ow">or</span> <span class="n">x_gnd</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_NO_COORD_AVAIL</span><span class="p">:</span>
</span><span id="__span-0-1922"><a id="__codelineno-0-1922" name="__codelineno-0-1922"></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[ERROR]: no GPS coordinates received from DRONE through socket link&#39;</span><span class="p">)</span>
</span><span id="__span-0-1923"><a id="__codelineno-0-1923" name="__codelineno-0-1923"></a>                <span class="k">return</span>
</span><span id="__span-0-1924"><a id="__codelineno-0-1924" name="__codelineno-0-1924"></a>
</span><span id="__span-0-1925"><a id="__codelineno-0-1925" name="__codelineno-0-1925"></a>                <span class="c1"># THE HEIGHT VALUE IS THE ALTITUDE VALUE OVER THE SEA LEVEL</span>
</span><span id="__span-0-1926"><a id="__codelineno-0-1926" name="__codelineno-0-1926"></a>                <span class="c1"># Z is in geocentric coordinates and does not correspond to the actual height:</span>
</span><span id="__span-0-1927"><a id="__codelineno-0-1927" name="__codelineno-0-1927"></a>                <span class="c1"># Geocentric WGS84</span>
</span><span id="__span-0-1928"><a id="__codelineno-0-1928" name="__codelineno-0-1928"></a>            <span class="k">if</span> <span class="n">datum_coordinates</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-0-1929"><a id="__codelineno-0-1929" name="__codelineno-0-1929"></a>                <span class="n">lat_gnd</span><span class="p">,</span> <span class="n">lon_gnd</span><span class="p">,</span> <span class="n">height_gnd</span> <span class="o">=</span> <span class="n">geocentric2geodetic</span><span class="p">(</span><span class="n">x_gnd</span><span class="p">,</span> <span class="n">y_gnd</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">])</span>
</span><span id="__span-0-1930"><a id="__codelineno-0-1930" name="__codelineno-0-1930"></a>                <span class="c1"># Geocentric ETRS89</span>
</span><span id="__span-0-1931"><a id="__codelineno-0-1931" name="__codelineno-0-1931"></a>            <span class="k">elif</span> <span class="n">datum_coordinates</span> <span class="o">==</span> <span class="mi">30</span><span class="p">:</span>
</span><span id="__span-0-1932"><a id="__codelineno-0-1932" name="__codelineno-0-1932"></a>                <span class="n">lat_gnd</span><span class="p">,</span> <span class="n">lon_gnd</span><span class="p">,</span> <span class="n">height_gnd</span> <span class="o">=</span> <span class="n">geocentric2geodetic</span><span class="p">(</span><span class="n">x_gnd</span><span class="p">,</span> <span class="n">y_gnd</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">],</span> <span class="n">EPSG_GEOCENTRIC</span><span class="o">=</span><span class="mi">4346</span><span class="p">)</span>
</span><span id="__span-0-1933"><a id="__codelineno-0-1933" name="__codelineno-0-1933"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1934"><a id="__codelineno-0-1934" name="__codelineno-0-1934"></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[ERROR]: Not known geocentric datum&#39;</span><span class="p">)</span>
</span><span id="__span-0-1935"><a id="__codelineno-0-1935" name="__codelineno-0-1935"></a>                <span class="k">return</span>
</span><span id="__span-0-1936"><a id="__codelineno-0-1936" name="__codelineno-0-1936"></a>
</span><span id="__span-0-1937"><a id="__codelineno-0-1937" name="__codelineno-0-1937"></a>            <span class="n">yaw_to_set</span><span class="p">,</span> <span class="n">pitch_to_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gimbal_follows_drone</span><span class="p">(</span><span class="n">lat_ground</span><span class="o">=</span><span class="n">lat_gnd</span><span class="p">,</span> <span class="n">lon_ground</span><span class="o">=</span><span class="n">lon_gnd</span><span class="p">,</span> <span class="n">height_ground</span><span class="o">=</span><span class="n">height_gnd</span><span class="p">,</span> <span class="n">fmode</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;FMODE&#39;</span><span class="p">])</span>
</span><span id="__span-0-1938"><a id="__codelineno-0-1938" name="__codelineno-0-1938"></a>
</span><span id="__span-0-1939"><a id="__codelineno-0-1939" name="__codelineno-0-1939"></a>            <span class="k">while</span> <span class="p">((</span><span class="n">yaw_to_set</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_SMALL_BUFF_SZ</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">pitch_to_set</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_SMALL_BUFF_SZ</span><span class="p">)):</span>
</span><span id="__span-0-1940"><a id="__codelineno-0-1940" name="__codelineno-0-1940"></a>                <span class="n">yaw_to_set</span><span class="p">,</span> <span class="n">pitch_to_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gimbal_follows_drone</span><span class="p">(</span><span class="n">lat_ground</span><span class="o">=</span><span class="n">lat_gnd</span><span class="p">,</span> <span class="n">lon_ground</span><span class="o">=</span><span class="n">lon_gnd</span><span class="p">,</span> <span class="n">height_ground</span><span class="o">=</span><span class="n">height_gnd</span><span class="p">,</span> <span class="n">fmode</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;FMODE&#39;</span><span class="p">])</span>
</span><span id="__span-0-1941"><a id="__codelineno-0-1941" name="__codelineno-0-1941"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;GROUND&#39;</span><span class="p">:</span>
</span><span id="__span-0-1942"><a id="__codelineno-0-1942" name="__codelineno-0-1942"></a>            <span class="n">y_drone</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span>
</span><span id="__span-0-1943"><a id="__codelineno-0-1943" name="__codelineno-0-1943"></a>            <span class="n">x_drone</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span>
</span><span id="__span-0-1944"><a id="__codelineno-0-1944" name="__codelineno-0-1944"></a>
</span><span id="__span-0-1945"><a id="__codelineno-0-1945" name="__codelineno-0-1945"></a>            <span class="n">datum_coordinates</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Datum&#39;</span><span class="p">]</span>
</span><span id="__span-0-1946"><a id="__codelineno-0-1946" name="__codelineno-0-1946"></a>
</span><span id="__span-0-1947"><a id="__codelineno-0-1947" name="__codelineno-0-1947"></a>            <span class="k">if</span> <span class="n">y_drone</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_NO_COORD_AVAIL</span> <span class="ow">or</span> <span class="n">x_drone</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_NO_COORD_AVAIL</span><span class="p">:</span>
</span><span id="__span-0-1948"><a id="__codelineno-0-1948" name="__codelineno-0-1948"></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[ERROR]: no GPS coordinates received from DRONE through socket link&#39;</span><span class="p">)</span>
</span><span id="__span-0-1949"><a id="__codelineno-0-1949" name="__codelineno-0-1949"></a>                <span class="k">return</span>
</span><span id="__span-0-1950"><a id="__codelineno-0-1950" name="__codelineno-0-1950"></a>
</span><span id="__span-0-1951"><a id="__codelineno-0-1951" name="__codelineno-0-1951"></a>                <span class="c1"># Z is in geocentric coordinates and does not correspond to the actual height:</span>
</span><span id="__span-0-1952"><a id="__codelineno-0-1952" name="__codelineno-0-1952"></a>                <span class="c1"># Geocentric WGS84</span>
</span><span id="__span-0-1953"><a id="__codelineno-0-1953" name="__codelineno-0-1953"></a>            <span class="k">if</span> <span class="n">datum_coordinates</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-0-1954"><a id="__codelineno-0-1954" name="__codelineno-0-1954"></a>                <span class="n">lat_drone</span><span class="p">,</span> <span class="n">lon_drone</span><span class="p">,</span> <span class="n">height_drone</span> <span class="o">=</span> <span class="n">geocentric2geodetic</span><span class="p">(</span><span class="n">x_drone</span><span class="p">,</span> <span class="n">y_drone</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">])</span>
</span><span id="__span-0-1955"><a id="__codelineno-0-1955" name="__codelineno-0-1955"></a>                <span class="c1"># Geocentric ETRS89</span>
</span><span id="__span-0-1956"><a id="__codelineno-0-1956" name="__codelineno-0-1956"></a>            <span class="k">elif</span> <span class="n">datum_coordinates</span> <span class="o">==</span> <span class="mi">30</span><span class="p">:</span>
</span><span id="__span-0-1957"><a id="__codelineno-0-1957" name="__codelineno-0-1957"></a>                <span class="n">lat_drone</span><span class="p">,</span> <span class="n">lon_drone</span><span class="p">,</span> <span class="n">height_drone</span> <span class="o">=</span> <span class="n">geocentric2geodetic</span><span class="p">(</span><span class="n">x_drone</span><span class="p">,</span> <span class="n">y_drone</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">],</span> <span class="n">EPSG_GEOCENTRIC</span><span class="o">=</span><span class="mi">4346</span><span class="p">)</span>
</span><span id="__span-0-1958"><a id="__codelineno-0-1958" name="__codelineno-0-1958"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1959"><a id="__codelineno-0-1959" name="__codelineno-0-1959"></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[ERROR]: Not known geocentric datum&#39;</span><span class="p">)</span>
</span><span id="__span-0-1960"><a id="__codelineno-0-1960" name="__codelineno-0-1960"></a>                <span class="k">return</span>
</span><span id="__span-0-1961"><a id="__codelineno-0-1961" name="__codelineno-0-1961"></a>
</span><span id="__span-0-1962"><a id="__codelineno-0-1962" name="__codelineno-0-1962"></a>            <span class="c1"># This is for GUI GPS panel to show drone coordinates</span>
</span><span id="__span-0-1963"><a id="__codelineno-0-1963" name="__codelineno-0-1963"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">last_drone_coords_requested</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;LAT&#39;</span><span class="p">:</span> <span class="n">lat_drone</span><span class="p">,</span> <span class="s1">&#39;LON&#39;</span><span class="p">:</span> <span class="n">lon_drone</span><span class="p">}</span>
</span><span id="__span-0-1964"><a id="__codelineno-0-1964" name="__codelineno-0-1964"></a>
</span><span id="__span-0-1965"><a id="__codelineno-0-1965" name="__codelineno-0-1965"></a>            <span class="n">yaw_to_set</span><span class="p">,</span> <span class="n">pitch_to_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gimbal_follows_drone</span><span class="p">(</span><span class="n">lat_drone</span><span class="o">=</span><span class="n">lat_drone</span><span class="p">,</span> <span class="n">lon_drone</span><span class="o">=</span><span class="n">lon_drone</span><span class="p">,</span> <span class="n">height_drone</span><span class="o">=</span><span class="n">height_drone</span><span class="p">,</span> <span class="n">fmode</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;FMODE&#39;</span><span class="p">])</span>
</span><span id="__span-0-1966"><a id="__codelineno-0-1966" name="__codelineno-0-1966"></a>
</span><span id="__span-0-1967"><a id="__codelineno-0-1967" name="__codelineno-0-1967"></a>                <span class="c1"># If error [yaw, pitch] values because not enough gps buffer entries (but gps already has entries, meaning is working), call again the gimbal_follows_drone method</span>
</span><span id="__span-0-1968"><a id="__codelineno-0-1968" name="__codelineno-0-1968"></a>            <span class="k">while</span> <span class="p">((</span><span class="n">yaw_to_set</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_SMALL_BUFF_SZ</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">pitch_to_set</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_SMALL_BUFF_SZ</span><span class="p">)):</span>
</span><span id="__span-0-1969"><a id="__codelineno-0-1969" name="__codelineno-0-1969"></a>                <span class="n">yaw_to_set</span><span class="p">,</span> <span class="n">pitch_to_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gimbal_follows_drone</span><span class="p">(</span><span class="n">lat_drone</span><span class="o">=</span><span class="n">lat_drone</span><span class="p">,</span> <span class="n">lon_drone</span><span class="o">=</span><span class="n">lon_drone</span><span class="p">,</span> <span class="n">height_drone</span><span class="o">=</span><span class="n">height_drone</span><span class="p">,</span> <span class="n">fmode</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;FMODE&#39;</span><span class="p">])</span>
</span><span id="__span-0-1970"><a id="__codelineno-0-1970" name="__codelineno-0-1970"></a>
</span><span id="__span-0-1971"><a id="__codelineno-0-1971" name="__codelineno-0-1971"></a>        <span class="k">if</span> <span class="n">yaw_to_set</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ERR_HELPER_CODE_GPS_HEAD_UNRELATED_2_COORD</span> <span class="ow">or</span> <span class="n">yaw_to_set</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ERR_HELPER_CODE_GPS_NOT_KNOWN_DATUM</span> <span class="ow">or</span> <span class="n">yaw_to_set</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ERR_HELPER_CODE_BOTH_NODES_COORDS_CANTBE_EMPTY</span> <span class="ow">or</span> <span class="n">yaw_to_set</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_BUFF_NULL</span><span class="p">:</span>
</span><span id="__span-0-1972"><a id="__codelineno-0-1972" name="__codelineno-0-1972"></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[ERROR]: one of the error codes of gimbal_follows_drone persists&#39;</span><span class="p">)</span>
</span><span id="__span-0-1973"><a id="__codelineno-0-1973" name="__codelineno-0-1973"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG]: This </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="si">}</span><span class="s2"> gimbal will NOT follow its pair node due to ERROR&quot;</span><span class="p">)</span>
</span><span id="__span-0-1974"><a id="__codelineno-0-1974" name="__codelineno-0-1974"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1975"><a id="__codelineno-0-1975" name="__codelineno-0-1975"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG]: This </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="si">}</span><span class="s2"> YAW to set is: </span><span class="si">{</span><span class="n">yaw_to_set</span><span class="si">}</span><span class="s2">, and PITCH to set is: </span><span class="si">{</span><span class="n">pitch_to_set</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-0-1976"><a id="__codelineno-0-1976" name="__codelineno-0-1976"></a>
</span><span id="__span-0-1977"><a id="__codelineno-0-1977" name="__codelineno-0-1977"></a>            <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;FOLLOW_GIMBAL&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x01</span><span class="p">:</span> <span class="c1"># True, Follow gimbal</span>
</span><span id="__span-0-1978"><a id="__codelineno-0-1978" name="__codelineno-0-1978"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">IsGimbal</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="c1"># There is a gimbal at the node that receives the answer to its command request.</span>
</span><span id="__span-0-1979"><a id="__codelineno-0-1979" name="__codelineno-0-1979"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">myGimbal</span><span class="o">.</span><span class="n">setPosControl</span><span class="p">(</span><span class="n">yaw</span><span class="o">=</span><span class="n">yaw_to_set</span><span class="p">,</span> <span class="n">pitch</span><span class="o">=</span><span class="n">pitch_to_set</span><span class="p">)</span> 
</span><span id="__span-0-1980"><a id="__codelineno-0-1980" name="__codelineno-0-1980"></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG]: This </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="si">}</span><span class="s2"> gimbal WILL follow its pair node as stated by user&quot;</span><span class="p">)</span>
</span><span id="__span-0-1981"><a id="__codelineno-0-1981" name="__codelineno-0-1981"></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1982"><a id="__codelineno-0-1982" name="__codelineno-0-1982"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[WARNING]: No gimbal available, so no rotation will happen&#39;</span><span class="p">)</span>
</span><span id="__span-0-1983"><a id="__codelineno-0-1983" name="__codelineno-0-1983"></a>            <span class="k">elif</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;FOLLOW_GIMBAL&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x02</span><span class="p">:</span> <span class="c1"># False</span>
</span><span id="__span-0-1984"><a id="__codelineno-0-1984" name="__codelineno-0-1984"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG]: This </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="si">}</span><span class="s2"> gimbal will NOT follow its pair node as stated by user&quot;</span><span class="p">)</span>
</span><span id="__span-0-1985"><a id="__codelineno-0-1985" name="__codelineno-0-1985"></a>
</span><span id="__span-0-1986"><a id="__codelineno-0-1986" name="__codelineno-0-1986"></a>    <span class="k">def</span> <span class="nf">decode_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span><span id="__span-0-1987"><a id="__codelineno-0-1987" name="__codelineno-0-1987"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-1988"><a id="__codelineno-0-1988" name="__codelineno-0-1988"></a><span class="sd">        Parses an incoming TCP message and calls the appropriate function to handle it. </span>
</span><span id="__span-0-1989"><a id="__codelineno-0-1989" name="__codelineno-0-1989"></a>
</span><span id="__span-0-1990"><a id="__codelineno-0-1990" name="__codelineno-0-1990"></a><span class="sd">        This function is called by ``socket_receive`` (the communication thread callback).</span>
</span><span id="__span-0-1991"><a id="__codelineno-0-1991" name="__codelineno-0-1991"></a>
</span><span id="__span-0-1992"><a id="__codelineno-0-1992" name="__codelineno-0-1992"></a><span class="sd">        Args:</span>
</span><span id="__span-0-1993"><a id="__codelineno-0-1993" name="__codelineno-0-1993"></a><span class="sd">            data (bytes): raw data to be decoded</span>
</span><span id="__span-0-1994"><a id="__codelineno-0-1994" name="__codelineno-0-1994"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-0-1995"><a id="__codelineno-0-1995" name="__codelineno-0-1995"></a>
</span><span id="__span-0-1996"><a id="__codelineno-0-1996" name="__codelineno-0-1996"></a>        <span class="n">source_id</span><span class="p">,</span> <span class="n">destination_id</span><span class="p">,</span> <span class="n">message_type</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">length</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;BBBBB&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
</span><span id="__span-0-1997"><a id="__codelineno-0-1997" name="__codelineno-0-1997"></a>        <span class="n">data_bytes</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span>
</span><span id="__span-0-1998"><a id="__codelineno-0-1998" name="__codelineno-0-1998"></a>
</span><span id="__span-0-1999"><a id="__codelineno-0-1999" name="__codelineno-0-1999"></a>        <span class="k">if</span> <span class="n">message_type</span> <span class="o">==</span> <span class="mh">0x01</span><span class="p">:</span> <span class="c1"># SHORT cmd type message</span>
</span><span id="__span-0-2000"><a id="__codelineno-0-2000" name="__codelineno-0-2000"></a>            <span class="k">if</span> <span class="n">cmd</span> <span class="o">==</span> <span class="mh">0x01</span> <span class="ow">and</span> <span class="n">length</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># FOLLOWGIMBAL</span>
</span><span id="__span-0-2001"><a id="__codelineno-0-2001" name="__codelineno-0-2001"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG]: THIS </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="si">}</span><span class="s2"> receives FOLLOWGIMBAL cmd&quot;</span><span class="p">)</span>
</span><span id="__span-0-2002"><a id="__codelineno-0-2002" name="__codelineno-0-2002"></a>                <span class="n">data_bytes</span> <span class="o">=</span> <span class="n">data_bytes</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-0-2003"><a id="__codelineno-0-2003" name="__codelineno-0-2003"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">do_follow_mode_gimbal</span><span class="p">(</span><span class="n">fmode</span><span class="o">=</span><span class="n">data_bytes</span><span class="p">)</span>
</span><span id="__span-0-2004"><a id="__codelineno-0-2004" name="__codelineno-0-2004"></a>            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="mh">0x02</span> <span class="ow">and</span> <span class="n">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># GETGPS</span>
</span><span id="__span-0-2005"><a id="__codelineno-0-2005" name="__codelineno-0-2005"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG]: THIS </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="si">}</span><span class="s2"> receives GETGPS cmd&quot;</span><span class="p">)</span>
</span><span id="__span-0-2006"><a id="__codelineno-0-2006" name="__codelineno-0-2006"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">do_getgps_action</span><span class="p">()</span>
</span><span id="__span-0-2007"><a id="__codelineno-0-2007" name="__codelineno-0-2007"></a>            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="mh">0x03</span> <span class="ow">and</span> <span class="n">length</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span> <span class="c1"># SETGIMBAL</span>
</span><span id="__span-0-2008"><a id="__codelineno-0-2008" name="__codelineno-0-2008"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG]: THIS </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="si">}</span><span class="s2"> receives SETGIMBAL cmd&quot;</span><span class="p">)</span>
</span><span id="__span-0-2009"><a id="__codelineno-0-2009" name="__codelineno-0-2009"></a>                <span class="n">data_bytes</span> <span class="o">=</span> <span class="n">data_bytes</span><span class="p">[:</span><span class="mi">13</span><span class="p">]</span> <span class="c1"># 3 float32 array entries + 1 byte</span>
</span><span id="__span-0-2010"><a id="__codelineno-0-2010" name="__codelineno-0-2010"></a>                <span class="n">yaw</span><span class="p">,</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">roll</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;fffB&#39;</span><span class="p">,</span> <span class="n">data_bytes</span><span class="p">)</span>
</span><span id="__span-0-2011"><a id="__codelineno-0-2011" name="__codelineno-0-2011"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">do_setgimbal_action</span><span class="p">({</span><span class="s1">&#39;YAW&#39;</span><span class="p">:</span> <span class="n">yaw</span><span class="p">,</span> <span class="s1">&#39;ROLL&#39;</span><span class="p">:</span> <span class="n">roll</span><span class="p">,</span> <span class="s1">&#39;PITCH&#39;</span><span class="p">:</span> <span class="n">pitch</span><span class="p">,</span> <span class="s1">&#39;MODE&#39;</span><span class="p">:</span> <span class="n">mode</span><span class="p">})</span>
</span><span id="__span-0-2012"><a id="__codelineno-0-2012" name="__codelineno-0-2012"></a>            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="mh">0x04</span> <span class="ow">and</span> <span class="n">length</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span> <span class="c1"># STARTDRONERFSOC</span>
</span><span id="__span-0-2013"><a id="__codelineno-0-2013" name="__codelineno-0-2013"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG]: THIS </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="si">}</span><span class="s2"> receives STARTDRONERFSOC cmd&quot;</span><span class="p">)</span>
</span><span id="__span-0-2014"><a id="__codelineno-0-2014" name="__codelineno-0-2014"></a>                <span class="n">data_bytes</span> <span class="o">=</span> <span class="n">data_bytes</span><span class="p">[:</span><span class="mi">12</span><span class="p">]</span> <span class="c1"># 1 float32 and 4 int16</span>
</span><span id="__span-0-2015"><a id="__codelineno-0-2015" name="__codelineno-0-2015"></a>                <span class="n">carr_freq</span><span class="p">,</span> <span class="n">rx_1</span><span class="p">,</span> <span class="n">rx_2</span><span class="p">,</span> <span class="n">rx_3</span><span class="p">,</span> <span class="n">rx_bfrf</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;fHHHH&#39;</span><span class="p">,</span> <span class="n">data_bytes</span><span class="p">)</span>
</span><span id="__span-0-2016"><a id="__codelineno-0-2016" name="__codelineno-0-2016"></a>
</span><span id="__span-0-2017"><a id="__codelineno-0-2017" name="__codelineno-0-2017"></a>                <span class="c1"># float round-error check</span>
</span><span id="__span-0-2018"><a id="__codelineno-0-2018" name="__codelineno-0-2018"></a>                <span class="k">if</span> <span class="n">carr_freq</span> <span class="o">&gt;</span> <span class="mf">70e9</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">carr_freq</span><span class="o">-</span><span class="mf">70e9</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1500</span><span class="p">:</span> <span class="c1"># float round-error of 1.5 kHz</span>
</span><span id="__span-0-2019"><a id="__codelineno-0-2019" name="__codelineno-0-2019"></a>                    <span class="n">carr_freq</span> <span class="o">=</span> <span class="mf">70e9</span>
</span><span id="__span-0-2020"><a id="__codelineno-0-2020" name="__codelineno-0-2020"></a>                <span class="k">elif</span> <span class="n">carr_freq</span> <span class="o">&lt;</span> <span class="mf">57.51e9</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">carr_freq</span><span class="o">-</span><span class="mf">57.51e9</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1500</span><span class="p">:</span> <span class="c1">#float round-error of 1.5 kHz</span>
</span><span id="__span-0-2021"><a id="__codelineno-0-2021" name="__codelineno-0-2021"></a>                    <span class="n">carr_freq</span> <span class="o">=</span> <span class="mf">57.51e9</span>
</span><span id="__span-0-2022"><a id="__codelineno-0-2022" name="__codelineno-0-2022"></a>                <span class="n">msg_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;carrier_freq&#39;</span><span class="p">:</span> <span class="n">carr_freq</span><span class="p">,</span>
</span><span id="__span-0-2023"><a id="__codelineno-0-2023" name="__codelineno-0-2023"></a>                            <span class="s1">&#39;rx_gain_ctrl_bb1&#39;</span><span class="p">:</span> <span class="n">rx_1</span><span class="p">,</span>
</span><span id="__span-0-2024"><a id="__codelineno-0-2024" name="__codelineno-0-2024"></a>                            <span class="s1">&#39;rx_gain_ctrl_bb2&#39;</span><span class="p">:</span> <span class="n">rx_2</span><span class="p">,</span>
</span><span id="__span-0-2025"><a id="__codelineno-0-2025" name="__codelineno-0-2025"></a>                            <span class="s1">&#39;rx_gain_ctrl_bb3&#39;</span><span class="p">:</span> <span class="n">rx_3</span><span class="p">,</span>
</span><span id="__span-0-2026"><a id="__codelineno-0-2026" name="__codelineno-0-2026"></a>                            <span class="s1">&#39;rx_gain_ctrl_bfrf&#39;</span><span class="p">:</span> <span class="n">rx_bfrf</span><span class="p">}</span>
</span><span id="__span-0-2027"><a id="__codelineno-0-2027" name="__codelineno-0-2027"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">do_start_meas_drone_rfsoc</span><span class="p">(</span><span class="n">msg_data</span><span class="p">)</span>
</span><span id="__span-0-2028"><a id="__codelineno-0-2028" name="__codelineno-0-2028"></a>            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="mh">0x05</span> <span class="ow">and</span> <span class="n">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># STOPDRONERFSOC</span>
</span><span id="__span-0-2029"><a id="__codelineno-0-2029" name="__codelineno-0-2029"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG]: THIS </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="si">}</span><span class="s2"> receives STOPDRONERFSOC cmd&quot;</span><span class="p">)</span>
</span><span id="__span-0-2030"><a id="__codelineno-0-2030" name="__codelineno-0-2030"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">do_stop_meas_drone_rfsoc</span><span class="p">()</span>
</span><span id="__span-0-2031"><a id="__codelineno-0-2031" name="__codelineno-0-2031"></a>            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="mh">0x06</span> <span class="ow">and</span> <span class="n">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># FINISHDRONERFSOC</span>
</span><span id="__span-0-2032"><a id="__codelineno-0-2032" name="__codelineno-0-2032"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG]: THIS </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="si">}</span><span class="s2"> receives FINISHDRONERFSOC cmd&quot;</span><span class="p">)</span>
</span><span id="__span-0-2033"><a id="__codelineno-0-2033" name="__codelineno-0-2033"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">do_finish_meas_drone_rfsoc</span><span class="p">()</span>
</span><span id="__span-0-2034"><a id="__codelineno-0-2034" name="__codelineno-0-2034"></a>            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="mh">0x07</span> <span class="ow">and</span> <span class="n">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># CLOSEDGUI</span>
</span><span id="__span-0-2035"><a id="__codelineno-0-2035" name="__codelineno-0-2035"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG]: THIS </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="si">}</span><span class="s2"> receives CLOSEDGUI cmd&quot;</span><span class="p">)</span>
</span><span id="__span-0-2036"><a id="__codelineno-0-2036" name="__codelineno-0-2036"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">do_closed_gui_action</span><span class="p">()</span>
</span><span id="__span-0-2037"><a id="__codelineno-0-2037" name="__codelineno-0-2037"></a>            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="mh">0x08</span> <span class="ow">and</span> <span class="n">length</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span> <span class="c1"># SETREMOTEFMFLAG</span>
</span><span id="__span-0-2038"><a id="__codelineno-0-2038" name="__codelineno-0-2038"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG]: THIS </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="si">}</span><span class="s2"> receives SETREMOTEFMFLAG cmd&quot;</span><span class="p">)</span>
</span><span id="__span-0-2039"><a id="__codelineno-0-2039" name="__codelineno-0-2039"></a>                <span class="n">data_bytes</span> <span class="o">=</span> <span class="n">data_bytes</span><span class="p">[:</span><span class="mi">26</span><span class="p">]</span> <span class="c1"># 3 float64, 2 hex</span>
</span><span id="__span-0-2040"><a id="__codelineno-0-2040" name="__codelineno-0-2040"></a>                <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">fmode</span><span class="p">,</span><span class="n">mobility</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;dddBB&#39;</span><span class="p">,</span> <span class="n">data_bytes</span><span class="p">)</span>
</span><span id="__span-0-2041"><a id="__codelineno-0-2041" name="__codelineno-0-2041"></a>                <span class="n">mydata</span> <span class="o">=</span><span class="p">{</span><span class="s1">&#39;X&#39;</span><span class="p">:</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span><span class="n">y</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">:</span><span class="n">z</span><span class="p">,</span> <span class="s1">&#39;FMODE&#39;</span><span class="p">:</span> <span class="n">fmode</span><span class="p">,</span> <span class="s1">&#39;MOBILITY&#39;</span><span class="p">:</span> <span class="n">mobility</span><span class="p">}</span>
</span><span id="__span-0-2042"><a id="__codelineno-0-2042" name="__codelineno-0-2042"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">do_set_remote_fm_flag</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mydata</span><span class="p">)</span>
</span><span id="__span-0-2043"><a id="__codelineno-0-2043" name="__codelineno-0-2043"></a>            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="mh">0x09</span> <span class="ow">and</span> <span class="n">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># SETREMOTESTOPFM</span>
</span><span id="__span-0-2044"><a id="__codelineno-0-2044" name="__codelineno-0-2044"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG]: THIS </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="si">}</span><span class="s2"> receives SETREMOTESTOPFM cmd&quot;</span><span class="p">)</span>
</span><span id="__span-0-2045"><a id="__codelineno-0-2045" name="__codelineno-0-2045"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">do_set_remote_stop_fm</span><span class="p">()</span>
</span><span id="__span-0-2046"><a id="__codelineno-0-2046" name="__codelineno-0-2046"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2047"><a id="__codelineno-0-2047" name="__codelineno-0-2047"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[WARNING]: cmd not known when decoding.  No action will be done&quot;</span><span class="p">)</span>
</span><span id="__span-0-2048"><a id="__codelineno-0-2048" name="__codelineno-0-2048"></a>        <span class="k">elif</span> <span class="n">message_type</span> <span class="o">==</span> <span class="mh">0x02</span><span class="p">:</span> <span class="c1"># LONG cmd type msg</span>
</span><span id="__span-0-2049"><a id="__codelineno-0-2049" name="__codelineno-0-2049"></a>            <span class="k">if</span> <span class="n">cmd</span> <span class="o">==</span> <span class="mh">0x01</span><span class="p">:</span> <span class="c1"># SETIRF</span>
</span><span id="__span-0-2050"><a id="__codelineno-0-2050" name="__codelineno-0-2050"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG]: THIS </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="si">}</span><span class="s2"> receives SETIRF cmd. Time snaps: </span><span class="si">{</span><span class="n">length</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-0-2051"><a id="__codelineno-0-2051" name="__codelineno-0-2051"></a>                <span class="n">last</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">length</span><span class="o">*</span><span class="mi">16</span><span class="p">)</span> <span class="c1"># The data type of the array entries is float32 and it will have always 16 beams and variable number of time snapshots</span>
</span><span id="__span-0-2052"><a id="__codelineno-0-2052" name="__codelineno-0-2052"></a>                <span class="n">data_bytes</span> <span class="o">=</span> <span class="n">data_bytes</span><span class="p">[:</span><span class="n">last</span><span class="p">]</span>
</span><span id="__span-0-2053"><a id="__codelineno-0-2053" name="__codelineno-0-2053"></a>                <span class="n">data_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data_bytes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="__span-0-2054"><a id="__codelineno-0-2054" name="__codelineno-0-2054"></a>                <span class="n">data_array</span> <span class="o">=</span> <span class="n">data_array</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">length</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>
</span><span id="__span-0-2055"><a id="__codelineno-0-2055" name="__codelineno-0-2055"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">do_set_irf_action</span><span class="p">(</span><span class="n">data_array</span><span class="p">)</span>
</span><span id="__span-0-2056"><a id="__codelineno-0-2056" name="__codelineno-0-2056"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2057"><a id="__codelineno-0-2057" name="__codelineno-0-2057"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[WARNING]: cmd not known when decoding.  No action will be done&quot;</span><span class="p">)</span>
</span><span id="__span-0-2058"><a id="__codelineno-0-2058" name="__codelineno-0-2058"></a>        <span class="k">elif</span> <span class="n">message_type</span> <span class="o">==</span> <span class="mh">0x03</span><span class="p">:</span> <span class="c1"># ANS type</span>
</span><span id="__span-0-2059"><a id="__codelineno-0-2059" name="__codelineno-0-2059"></a>            <span class="k">if</span> <span class="n">cmd</span> <span class="o">==</span> <span class="mh">0x01</span><span class="p">:</span> <span class="c1"># Response to GETGPS</span>
</span><span id="__span-0-2060"><a id="__codelineno-0-2060" name="__codelineno-0-2060"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;[DEBUG]: THIS (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="si">}</span><span class="s1">) receives ANS to GETGPS cmd&#39;</span><span class="p">)</span>
</span><span id="__span-0-2061"><a id="__codelineno-0-2061" name="__codelineno-0-2061"></a>                <span class="n">data_bytes</span> <span class="o">=</span> <span class="n">data_bytes</span><span class="p">[:</span><span class="mi">27</span><span class="p">]</span>
</span><span id="__span-0-2062"><a id="__codelineno-0-2062" name="__codelineno-0-2062"></a>                <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">datum</span><span class="p">,</span><span class="n">follow_gimbal</span><span class="p">,</span> <span class="n">fmode</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;dddBBB&#39;</span><span class="p">,</span> <span class="n">data_bytes</span><span class="p">)</span>
</span><span id="__span-0-2063"><a id="__codelineno-0-2063" name="__codelineno-0-2063"></a>                <span class="n">msg_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">:</span> <span class="n">z</span><span class="p">,</span> <span class="s1">&#39;Datum&#39;</span><span class="p">:</span> <span class="n">datum</span><span class="p">,</span> <span class="s1">&#39;FOLLOW_GIMBAL&#39;</span><span class="p">:</span> <span class="n">follow_gimbal</span><span class="p">,</span> <span class="s1">&#39;FMODE&#39;</span><span class="p">:</span> <span class="n">fmode</span><span class="p">}</span>
</span><span id="__span-0-2064"><a id="__codelineno-0-2064" name="__codelineno-0-2064"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">process_answer_get_gps</span><span class="p">(</span><span class="n">msg_data</span><span class="p">)</span>
</span><span id="__span-0-2065"><a id="__codelineno-0-2065" name="__codelineno-0-2065"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2066"><a id="__codelineno-0-2066" name="__codelineno-0-2066"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[WARNING]: cmd not known when decoding.  No action will be done&quot;</span><span class="p">)</span>
</span><span id="__span-0-2067"><a id="__codelineno-0-2067" name="__codelineno-0-2067"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2068"><a id="__codelineno-0-2068" name="__codelineno-0-2068"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[WARNING]: message_type not known when decoding. No action will be done&quot;</span><span class="p">)</span>
</span><span id="__span-0-2069"><a id="__codelineno-0-2069" name="__codelineno-0-2069"></a>
</span><span id="__span-0-2070"><a id="__codelineno-0-2070" name="__codelineno-0-2070"></a>    <span class="k">def</span> <span class="nf">encode_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_id</span><span class="p">,</span> <span class="n">destination_id</span><span class="p">,</span> <span class="n">message_type</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="__span-0-2071"><a id="__codelineno-0-2071" name="__codelineno-0-2071"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-2072"><a id="__codelineno-0-2072" name="__codelineno-0-2072"></a><span class="sd">        Encodes a TCP message to be sent. More information about the specific commands is in the section &quot;Communication Protocol&quot; of the &quot;Manual A2GMeasurements&quot;.</span>
</span><span id="__span-0-2073"><a id="__codelineno-0-2073" name="__codelineno-0-2073"></a>
</span><span id="__span-0-2074"><a id="__codelineno-0-2074" name="__codelineno-0-2074"></a><span class="sd">        Args:</span>
</span><span id="__span-0-2075"><a id="__codelineno-0-2075" name="__codelineno-0-2075"></a><span class="sd">            source_id (int): identifies the sender node with a number (this parameter is provided for -potential- future improvements but does not have any functionality).</span>
</span><span id="__span-0-2076"><a id="__codelineno-0-2076" name="__codelineno-0-2076"></a><span class="sd">            destination_id (int): identifies the receiver node with a number (this parameter is provided for -potential- future improvements but does not have any functionality).</span>
</span><span id="__span-0-2077"><a id="__codelineno-0-2077" name="__codelineno-0-2077"></a><span class="sd">            message_type (hexadecimal): 0x01, for a short type of message; 0x02, for a long type of message; 0x03, to answer/acknowledge a received request. More information about this is in &quot;Manual A2GMeasurements&quot;.</span>
</span><span id="__span-0-2078"><a id="__codelineno-0-2078" name="__codelineno-0-2078"></a><span class="sd">            cmd (hexadecimal): one of the supported requests/commands for each ``message_type``. The list of commands is provided in &quot;Manual A2GMeasurements&quot; (Communication Protocol chapter).</span>
</span><span id="__span-0-2079"><a id="__codelineno-0-2079" name="__codelineno-0-2079"></a><span class="sd">            data (dict, optional): additional data required by the request/command. The particular data sent depends on the ``message_type`` and the ``cmd``. More information on &quot;Manual A2GMeasurements&quot; (Communication Protocol chapter). Defaults to None.</span>
</span><span id="__span-0-2080"><a id="__codelineno-0-2080" name="__codelineno-0-2080"></a><span class="sd">        Returns:</span>
</span><span id="__span-0-2081"><a id="__codelineno-0-2081" name="__codelineno-0-2081"></a><span class="sd">            message (bytes): the bytes object representing the message to be sent.</span>
</span><span id="__span-0-2082"><a id="__codelineno-0-2082" name="__codelineno-0-2082"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-0-2083"><a id="__codelineno-0-2083" name="__codelineno-0-2083"></a>
</span><span id="__span-0-2084"><a id="__codelineno-0-2084" name="__codelineno-0-2084"></a>        <span class="k">if</span> <span class="n">message_type</span> <span class="o">==</span> <span class="mh">0x01</span><span class="p">:</span> <span class="c1"># SHORT type of message</span>
</span><span id="__span-0-2085"><a id="__codelineno-0-2085" name="__codelineno-0-2085"></a>            <span class="k">if</span> <span class="n">cmd</span> <span class="o">==</span> <span class="mh">0x01</span><span class="p">:</span> <span class="c1"># FOLLOWGIMBAL</span>
</span><span id="__span-0-2086"><a id="__codelineno-0-2086" name="__codelineno-0-2086"></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;FMODE&#39;</span><span class="p">])</span>
</span><span id="__span-0-2087"><a id="__codelineno-0-2087" name="__codelineno-0-2087"></a>                <span class="n">length</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="__span-0-2088"><a id="__codelineno-0-2088" name="__codelineno-0-2088"></a>                <span class="n">message</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;BBBBB&#39;</span><span class="p">,</span> <span class="n">source_id</span><span class="p">,</span> <span class="n">destination_id</span><span class="p">,</span> <span class="n">message_type</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span> <span class="o">+</span> <span class="n">data</span>
</span><span id="__span-0-2089"><a id="__codelineno-0-2089" name="__codelineno-0-2089"></a>            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="mh">0x02</span><span class="p">:</span> <span class="c1"># GETGPS</span>
</span><span id="__span-0-2090"><a id="__codelineno-0-2090" name="__codelineno-0-2090"></a>                <span class="n">length</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-0-2091"><a id="__codelineno-0-2091" name="__codelineno-0-2091"></a>                <span class="n">message</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;BBBBB&#39;</span><span class="p">,</span> <span class="n">source_id</span><span class="p">,</span> <span class="n">destination_id</span><span class="p">,</span> <span class="n">message_type</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span>
</span><span id="__span-0-2092"><a id="__codelineno-0-2092" name="__codelineno-0-2092"></a>            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="mh">0x03</span> <span class="ow">and</span> <span class="n">data</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span> <span class="c1"># SETGIMBAL</span>
</span><span id="__span-0-2093"><a id="__codelineno-0-2093" name="__codelineno-0-2093"></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;fffB&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;YAW&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;PITCH&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;ROLL&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;MODE&#39;</span><span class="p">])</span>
</span><span id="__span-0-2094"><a id="__codelineno-0-2094" name="__codelineno-0-2094"></a>                <span class="n">length</span> <span class="o">=</span> <span class="mi">4</span>
</span><span id="__span-0-2095"><a id="__codelineno-0-2095" name="__codelineno-0-2095"></a>                <span class="n">message</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;BBBBB&#39;</span><span class="p">,</span> <span class="n">source_id</span><span class="p">,</span> <span class="n">destination_id</span><span class="p">,</span> <span class="n">message_type</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span> <span class="o">+</span> <span class="n">data</span>
</span><span id="__span-0-2096"><a id="__codelineno-0-2096" name="__codelineno-0-2096"></a>            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="mh">0x04</span> <span class="ow">and</span> <span class="n">data</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span> <span class="c1"># STARTDRONERFSOC</span>
</span><span id="__span-0-2097"><a id="__codelineno-0-2097" name="__codelineno-0-2097"></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;fHHHH&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;carrier_freq&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;rx_gain_ctrl_bb1&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;rx_gain_ctrl_bb2&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;rx_gain_ctrl_bb3&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;rx_gain_ctrl_bfrf&#39;</span><span class="p">])</span>
</span><span id="__span-0-2098"><a id="__codelineno-0-2098" name="__codelineno-0-2098"></a>                <span class="n">length</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="__span-0-2099"><a id="__codelineno-0-2099" name="__codelineno-0-2099"></a>                <span class="n">message</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;BBBBB&#39;</span><span class="p">,</span> <span class="n">source_id</span><span class="p">,</span> <span class="n">destination_id</span><span class="p">,</span> <span class="n">message_type</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span> <span class="o">+</span> <span class="n">data</span>
</span><span id="__span-0-2100"><a id="__codelineno-0-2100" name="__codelineno-0-2100"></a>            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="mh">0x05</span><span class="p">:</span> <span class="c1"># STOPDRONERFSOC</span>
</span><span id="__span-0-2101"><a id="__codelineno-0-2101" name="__codelineno-0-2101"></a>                <span class="n">length</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-0-2102"><a id="__codelineno-0-2102" name="__codelineno-0-2102"></a>                <span class="n">message</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;BBBBB&#39;</span><span class="p">,</span> <span class="n">source_id</span><span class="p">,</span> <span class="n">destination_id</span><span class="p">,</span> <span class="n">message_type</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span>
</span><span id="__span-0-2103"><a id="__codelineno-0-2103" name="__codelineno-0-2103"></a>            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="mh">0x06</span><span class="p">:</span> <span class="c1"># FINISHDRONERFSOC</span>
</span><span id="__span-0-2104"><a id="__codelineno-0-2104" name="__codelineno-0-2104"></a>                <span class="n">length</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-0-2105"><a id="__codelineno-0-2105" name="__codelineno-0-2105"></a>                <span class="n">message</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;BBBBB&#39;</span><span class="p">,</span> <span class="n">source_id</span><span class="p">,</span> <span class="n">destination_id</span><span class="p">,</span> <span class="n">message_type</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span>
</span><span id="__span-0-2106"><a id="__codelineno-0-2106" name="__codelineno-0-2106"></a>            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="mh">0x07</span><span class="p">:</span> <span class="c1"># CLOSEDGUI</span>
</span><span id="__span-0-2107"><a id="__codelineno-0-2107" name="__codelineno-0-2107"></a>                <span class="n">length</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-0-2108"><a id="__codelineno-0-2108" name="__codelineno-0-2108"></a>                <span class="n">message</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;BBBBB&#39;</span><span class="p">,</span> <span class="n">source_id</span><span class="p">,</span> <span class="n">destination_id</span><span class="p">,</span> <span class="n">message_type</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span>
</span><span id="__span-0-2109"><a id="__codelineno-0-2109" name="__codelineno-0-2109"></a>            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="mh">0x08</span><span class="p">:</span> <span class="c1"># SETREMOTEFMFLAG</span>
</span><span id="__span-0-2110"><a id="__codelineno-0-2110" name="__codelineno-0-2110"></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;dddBB&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;FMODE&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;MOBILITY&#39;</span><span class="p">])</span>
</span><span id="__span-0-2111"><a id="__codelineno-0-2111" name="__codelineno-0-2111"></a>                <span class="n">length</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="__span-0-2112"><a id="__codelineno-0-2112" name="__codelineno-0-2112"></a>                <span class="n">message</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;BBBBB&#39;</span><span class="p">,</span> <span class="n">source_id</span><span class="p">,</span> <span class="n">destination_id</span><span class="p">,</span> <span class="n">message_type</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span> <span class="o">+</span> <span class="n">data</span>
</span><span id="__span-0-2113"><a id="__codelineno-0-2113" name="__codelineno-0-2113"></a>            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="mh">0x09</span><span class="p">:</span> <span class="c1"># SETREMOTESTOPFM</span>
</span><span id="__span-0-2114"><a id="__codelineno-0-2114" name="__codelineno-0-2114"></a>                <span class="n">length</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-0-2115"><a id="__codelineno-0-2115" name="__codelineno-0-2115"></a>                <span class="n">message</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;BBBBB&#39;</span><span class="p">,</span> <span class="n">source_id</span><span class="p">,</span> <span class="n">destination_id</span><span class="p">,</span> <span class="n">message_type</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span>
</span><span id="__span-0-2116"><a id="__codelineno-0-2116" name="__codelineno-0-2116"></a>        <span class="k">elif</span> <span class="n">message_type</span> <span class="o">==</span> <span class="mh">0x02</span><span class="p">:</span> <span class="c1">#LONG type message</span>
</span><span id="__span-0-2117"><a id="__codelineno-0-2117" name="__codelineno-0-2117"></a>            <span class="k">if</span> <span class="n">cmd</span> <span class="o">==</span> <span class="mh">0x01</span><span class="p">:</span> <span class="c1"># SETIRF</span>
</span><span id="__span-0-2118"><a id="__codelineno-0-2118" name="__codelineno-0-2118"></a>                <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-2119"><a id="__codelineno-0-2119" name="__codelineno-0-2119"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG]: An array must be provided&quot;</span><span class="p">)</span>
</span><span id="__span-0-2120"><a id="__codelineno-0-2120" name="__codelineno-0-2120"></a>                    <span class="k">return</span>
</span><span id="__span-0-2121"><a id="__codelineno-0-2121" name="__codelineno-0-2121"></a>                <span class="n">data_bytes</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
</span><span id="__span-0-2122"><a id="__codelineno-0-2122" name="__codelineno-0-2122"></a>                <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-0-2123"><a id="__codelineno-0-2123" name="__codelineno-0-2123"></a>                <span class="n">message</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;BBBBB&#39;</span><span class="p">,</span> <span class="n">source_id</span><span class="p">,</span> <span class="n">destination_id</span><span class="p">,</span> <span class="n">message_type</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span> <span class="o">+</span> <span class="n">data_bytes</span>
</span><span id="__span-0-2124"><a id="__codelineno-0-2124" name="__codelineno-0-2124"></a>        <span class="k">elif</span> <span class="n">message_type</span> <span class="o">==</span> <span class="mh">0x03</span><span class="p">:</span> <span class="c1"># ANS message type</span>
</span><span id="__span-0-2125"><a id="__codelineno-0-2125" name="__codelineno-0-2125"></a>            <span class="k">if</span> <span class="n">cmd</span> <span class="o">==</span> <span class="mh">0x01</span><span class="p">:</span> <span class="c1"># Response to GETGPS</span>
</span><span id="__span-0-2126"><a id="__codelineno-0-2126" name="__codelineno-0-2126"></a>                <span class="n">message</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;dddBBB&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Datum&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;FOLLOW_GIMBAL&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;FMODE&#39;</span><span class="p">])</span>
</span><span id="__span-0-2127"><a id="__codelineno-0-2127" name="__codelineno-0-2127"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2128"><a id="__codelineno-0-2128" name="__codelineno-0-2128"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG]: message_type not known when encoding.&quot;</span><span class="p">)</span>
</span><span id="__span-0-2129"><a id="__codelineno-0-2129" name="__codelineno-0-2129"></a>            <span class="k">return</span>
</span><span id="__span-0-2130"><a id="__codelineno-0-2130" name="__codelineno-0-2130"></a>
</span><span id="__span-0-2131"><a id="__codelineno-0-2131" name="__codelineno-0-2131"></a>        <span class="k">return</span> <span class="n">message</span>
</span><span id="__span-0-2132"><a id="__codelineno-0-2132" name="__codelineno-0-2132"></a>
</span><span id="__span-0-2133"><a id="__codelineno-0-2133" name="__codelineno-0-2133"></a>    <span class="k">def</span> <span class="nf">socket_receive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stop_event</span><span class="p">):</span>
</span><span id="__span-0-2134"><a id="__codelineno-0-2134" name="__codelineno-0-2134"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-2135"><a id="__codelineno-0-2135" name="__codelineno-0-2135"></a><span class="sd">        The communication thread callback. Calls the parser to decode the most recent TCP message received.</span>
</span><span id="__span-0-2136"><a id="__codelineno-0-2136" name="__codelineno-0-2136"></a>
</span><span id="__span-0-2137"><a id="__codelineno-0-2137" name="__codelineno-0-2137"></a><span class="sd">        The time between calls of this function is OS and hardware dependent.</span>
</span><span id="__span-0-2138"><a id="__codelineno-0-2138" name="__codelineno-0-2138"></a>
</span><span id="__span-0-2139"><a id="__codelineno-0-2139" name="__codelineno-0-2139"></a><span class="sd">        As both nodes can send and receive messages, this thread</span>
</span><span id="__span-0-2140"><a id="__codelineno-0-2140" name="__codelineno-0-2140"></a>
</span><span id="__span-0-2141"><a id="__codelineno-0-2141" name="__codelineno-0-2141"></a><span class="sd">        Args:</span>
</span><span id="__span-0-2142"><a id="__codelineno-0-2142" name="__codelineno-0-2142"></a><span class="sd">            stop_event (threading.Event): when this is set, this function has nothing to execute.</span>
</span><span id="__span-0-2143"><a id="__codelineno-0-2143" name="__codelineno-0-2143"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-0-2144"><a id="__codelineno-0-2144" name="__codelineno-0-2144"></a>
</span><span id="__span-0-2145"><a id="__codelineno-0-2145" name="__codelineno-0-2145"></a>        <span class="c1"># Polling policy for detecting if there has been any message sent.</span>
</span><span id="__span-0-2146"><a id="__codelineno-0-2146" name="__codelineno-0-2146"></a>        <span class="c1"># As th thread is scheduled often in the order of ms, this implementation will raise an exception (if nothing is send) quite often</span>
</span><span id="__span-0-2147"><a id="__codelineno-0-2147" name="__codelineno-0-2147"></a>        <span class="k">while</span> <span class="ow">not</span> <span class="n">stop_event</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
</span><span id="__span-0-2148"><a id="__codelineno-0-2148" name="__codelineno-0-2148"></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-2149"><a id="__codelineno-0-2149" name="__codelineno-0-2149"></a>                <span class="c1"># Send everything in a json serialized packet</span>
</span><span id="__span-0-2150"><a id="__codelineno-0-2150" name="__codelineno-0-2150"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;GROUND&#39;</span><span class="p">:</span>
</span><span id="__span-0-2151"><a id="__codelineno-0-2151" name="__codelineno-0-2151"></a>                    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a2g_conn</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">4096</span><span class="p">)</span> <span class="c1"># Up to 1 message of 63 rows and 16 cols of float32 entries</span>
</span><span id="__span-0-2152"><a id="__codelineno-0-2152" name="__codelineno-0-2152"></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;DRONE&#39;</span><span class="p">:</span>
</span><span id="__span-0-2153"><a id="__codelineno-0-2153" name="__codelineno-0-2153"></a>                    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">4096</span><span class="p">)</span>
</span><span id="__span-0-2154"><a id="__codelineno-0-2154" name="__codelineno-0-2154"></a>                <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
</span><span id="__span-0-2155"><a id="__codelineno-0-2155" name="__codelineno-0-2155"></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DBG_LVL_0</span><span class="p">:</span>
</span><span id="__span-0-2156"><a id="__codelineno-0-2156" name="__codelineno-0-2156"></a>                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">[DEBUG_0]: This is the data received: &#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span><span id="__span-0-2157"><a id="__codelineno-0-2157" name="__codelineno-0-2157"></a>                    <span class="c1">#print(&#39;[DEBUG]: This is the data received: &#39;, len(data[&#39;DATA&#39;]), len(data[&#39;DATA&#39;][0]))</span>
</span><span id="__span-0-2158"><a id="__codelineno-0-2158" name="__codelineno-0-2158"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">decode_message</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-0-2159"><a id="__codelineno-0-2159" name="__codelineno-0-2159"></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2160"><a id="__codelineno-0-2160" name="__codelineno-0-2160"></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DBG_LVL_0</span><span class="p">:</span>
</span><span id="__span-0-2161"><a id="__codelineno-0-2161" name="__codelineno-0-2161"></a>                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">[DEBUG_0]: &quot;data&quot; in &quot;if data&quot; in &quot;socket_receive&quot; is None&#39;</span><span class="p">)</span>
</span><span id="__span-0-2162"><a id="__codelineno-0-2162" name="__codelineno-0-2162"></a>            <span class="c1"># i.e.  Didn&#39;t receive anything</span>
</span><span id="__span-0-2163"><a id="__codelineno-0-2163" name="__codelineno-0-2163"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-2164"><a id="__codelineno-0-2164" name="__codelineno-0-2164"></a>                <span class="c1"># Handle the assumed connection lost</span>
</span><span id="__span-0-2165"><a id="__codelineno-0-2165" name="__codelineno-0-2165"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rxEmptySockCounter</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">MAX_NUM_RX_EMPTY_SOCKETS</span><span class="p">:</span>
</span><span id="__span-0-2166"><a id="__codelineno-0-2166" name="__codelineno-0-2166"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">[WARNING]:SOCKETS HAVE BEEN EMPTY FOR LONG TIME. DRONE MUST COME CLOSER &#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="__span-0-2167"><a id="__codelineno-0-2167" name="__codelineno-0-2167"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">rxEmptySockCounter</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-0-2168"><a id="__codelineno-0-2168" name="__codelineno-0-2168"></a>
</span><span id="__span-0-2169"><a id="__codelineno-0-2169" name="__codelineno-0-2169"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">rxEmptySockCounter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rxEmptySockCounter</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="__span-0-2170"><a id="__codelineno-0-2170" name="__codelineno-0-2170"></a>
</span><span id="__span-0-2171"><a id="__codelineno-0-2171" name="__codelineno-0-2171"></a>                <span class="c1">#traceback.print_exc()</span>
</span><span id="__span-0-2172"><a id="__codelineno-0-2172" name="__codelineno-0-2172"></a><span class="w">                </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="__span-0-2173"><a id="__codelineno-0-2173" name="__codelineno-0-2173"></a><span class="sd">                Types of known errors:</span>
</span><span id="__span-0-2174"><a id="__codelineno-0-2174" name="__codelineno-0-2174"></a><span class="sd">                1. &#39;timed out&#39;</span>
</span><span id="__span-0-2175"><a id="__codelineno-0-2175" name="__codelineno-0-2175"></a>
</span><span id="__span-0-2176"><a id="__codelineno-0-2176" name="__codelineno-0-2176"></a><span class="sd">                *This error is reported in the client but not in the server. Happens when the client hasn&#39;t received anything in a while, so that &#39;recv&#39; function raises the exception.</span>
</span><span id="__span-0-2177"><a id="__codelineno-0-2177" name="__codelineno-0-2177"></a><span class="sd">                *The conn is open and if any node send something again the other node will receive it</span>
</span><span id="__span-0-2178"><a id="__codelineno-0-2178" name="__codelineno-0-2178"></a><span class="sd">                &#39;&#39;&#39;</span>
</span><span id="__span-0-2179"><a id="__codelineno-0-2179" name="__codelineno-0-2179"></a>
</span><span id="__span-0-2180"><a id="__codelineno-0-2180" name="__codelineno-0-2180"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DBG_LVL_0</span><span class="p">:</span>
</span><span id="__span-0-2181"><a id="__codelineno-0-2181" name="__codelineno-0-2181"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[SOCKET RECEIVE EXCEPTION]: &#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="__span-0-2182"><a id="__codelineno-0-2182" name="__codelineno-0-2182"></a>
</span><span id="__span-0-2183"><a id="__codelineno-0-2183" name="__codelineno-0-2183"></a>    <span class="k">def</span> <span class="nf">socket_send_cmd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">type_cmd</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="__span-0-2184"><a id="__codelineno-0-2184" name="__codelineno-0-2184"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-2185"><a id="__codelineno-0-2185" name="__codelineno-0-2185"></a><span class="sd">        Creates a message by the name of the request/command. Wrapper to ``encode_message``.</span>
</span><span id="__span-0-2186"><a id="__codelineno-0-2186" name="__codelineno-0-2186"></a>
</span><span id="__span-0-2187"><a id="__codelineno-0-2187" name="__codelineno-0-2187"></a><span class="sd">        Args:</span>
</span><span id="__span-0-2188"><a id="__codelineno-0-2188" name="__codelineno-0-2188"></a><span class="sd">            type_cmd (int, optional): refers to the ``cmd`` parameter in ``encode_message``. Defaults to None.</span>
</span><span id="__span-0-2189"><a id="__codelineno-0-2189" name="__codelineno-0-2189"></a><span class="sd">            data (int, optional): refers to the ``data`` parameter in ``encode_message``. Defaults to None.</span>
</span><span id="__span-0-2190"><a id="__codelineno-0-2190" name="__codelineno-0-2190"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-0-2191"><a id="__codelineno-0-2191" name="__codelineno-0-2191"></a>
</span><span id="__span-0-2192"><a id="__codelineno-0-2192" name="__codelineno-0-2192"></a>        <span class="k">if</span> <span class="n">type_cmd</span> <span class="o">==</span> <span class="s1">&#39;SETGIMBAL&#39;</span><span class="p">:</span>
</span><span id="__span-0-2193"><a id="__codelineno-0-2193" name="__codelineno-0-2193"></a>            <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encode_message</span><span class="p">(</span><span class="n">source_id</span><span class="o">=</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">destination_id</span><span class="o">=</span><span class="mh">0x02</span><span class="p">,</span> <span class="n">message_type</span><span class="o">=</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">cmd</span><span class="o">=</span><span class="mh">0x03</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-0-2194"><a id="__codelineno-0-2194" name="__codelineno-0-2194"></a>        <span class="k">elif</span> <span class="n">type_cmd</span> <span class="o">==</span> <span class="s1">&#39;FOLLOWGIMBAL&#39;</span><span class="p">:</span>
</span><span id="__span-0-2195"><a id="__codelineno-0-2195" name="__codelineno-0-2195"></a>            <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encode_message</span><span class="p">(</span><span class="n">source_id</span><span class="o">=</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">destination_id</span><span class="o">=</span><span class="mh">0x02</span><span class="p">,</span> <span class="n">message_type</span><span class="o">=</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">cmd</span><span class="o">=</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-0-2196"><a id="__codelineno-0-2196" name="__codelineno-0-2196"></a>        <span class="k">elif</span> <span class="n">type_cmd</span> <span class="o">==</span> <span class="s1">&#39;GETGPS&#39;</span><span class="p">:</span>
</span><span id="__span-0-2197"><a id="__codelineno-0-2197" name="__codelineno-0-2197"></a>            <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encode_message</span><span class="p">(</span><span class="n">source_id</span><span class="o">=</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">destination_id</span><span class="o">=</span><span class="mh">0x02</span><span class="p">,</span> <span class="n">message_type</span><span class="o">=</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">cmd</span><span class="o">=</span><span class="mh">0x02</span><span class="p">)</span>
</span><span id="__span-0-2198"><a id="__codelineno-0-2198" name="__codelineno-0-2198"></a>        <span class="k">elif</span> <span class="n">type_cmd</span> <span class="o">==</span> <span class="s1">&#39;CLOSEDGUI&#39;</span><span class="p">:</span>
</span><span id="__span-0-2199"><a id="__codelineno-0-2199" name="__codelineno-0-2199"></a>            <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encode_message</span><span class="p">(</span><span class="n">source_id</span><span class="o">=</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">destination_id</span><span class="o">=</span><span class="mh">0x02</span><span class="p">,</span> <span class="n">message_type</span><span class="o">=</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">cmd</span><span class="o">=</span><span class="mh">0x07</span><span class="p">)</span>
</span><span id="__span-0-2200"><a id="__codelineno-0-2200" name="__codelineno-0-2200"></a>        <span class="k">elif</span> <span class="n">type_cmd</span> <span class="o">==</span> <span class="s1">&#39;STARTDRONERFSOC&#39;</span><span class="p">:</span>
</span><span id="__span-0-2201"><a id="__codelineno-0-2201" name="__codelineno-0-2201"></a>            <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encode_message</span><span class="p">(</span><span class="n">source_id</span><span class="o">=</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">destination_id</span><span class="o">=</span><span class="mh">0x02</span><span class="p">,</span> <span class="n">message_type</span><span class="o">=</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">cmd</span><span class="o">=</span><span class="mh">0x04</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-0-2202"><a id="__codelineno-0-2202" name="__codelineno-0-2202"></a>        <span class="k">elif</span> <span class="n">type_cmd</span> <span class="o">==</span> <span class="s1">&#39;STOPDRONERFSOC&#39;</span><span class="p">:</span>
</span><span id="__span-0-2203"><a id="__codelineno-0-2203" name="__codelineno-0-2203"></a>            <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encode_message</span><span class="p">(</span><span class="n">source_id</span><span class="o">=</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">destination_id</span><span class="o">=</span><span class="mh">0x02</span><span class="p">,</span> <span class="n">message_type</span><span class="o">=</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">cmd</span><span class="o">=</span><span class="mh">0x05</span><span class="p">)</span>
</span><span id="__span-0-2204"><a id="__codelineno-0-2204" name="__codelineno-0-2204"></a>        <span class="k">elif</span> <span class="n">type_cmd</span> <span class="o">==</span> <span class="s1">&#39;FINISHDRONERFSOC&#39;</span><span class="p">:</span>
</span><span id="__span-0-2205"><a id="__codelineno-0-2205" name="__codelineno-0-2205"></a>            <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encode_message</span><span class="p">(</span><span class="n">source_id</span><span class="o">=</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">destination_id</span><span class="o">=</span><span class="mh">0x02</span><span class="p">,</span> <span class="n">message_type</span><span class="o">=</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">cmd</span><span class="o">=</span><span class="mh">0x06</span><span class="p">)</span>
</span><span id="__span-0-2206"><a id="__codelineno-0-2206" name="__codelineno-0-2206"></a>        <span class="k">elif</span> <span class="n">type_cmd</span> <span class="o">==</span> <span class="s1">&#39;SETIRF&#39;</span><span class="p">:</span>
</span><span id="__span-0-2207"><a id="__codelineno-0-2207" name="__codelineno-0-2207"></a>            <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encode_message</span><span class="p">(</span><span class="n">source_id</span><span class="o">=</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">destination_id</span><span class="o">=</span><span class="mh">0x02</span><span class="p">,</span> <span class="n">message_type</span><span class="o">=</span><span class="mh">0x02</span><span class="p">,</span> <span class="n">cmd</span><span class="o">=</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-0-2208"><a id="__codelineno-0-2208" name="__codelineno-0-2208"></a>        <span class="k">elif</span> <span class="n">type_cmd</span> <span class="o">==</span> <span class="s1">&#39;SETREMOTEFMFLAG&#39;</span><span class="p">:</span>
</span><span id="__span-0-2209"><a id="__codelineno-0-2209" name="__codelineno-0-2209"></a>            <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encode_message</span><span class="p">(</span><span class="n">source_id</span><span class="o">=</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">destination_id</span><span class="o">=</span><span class="mh">0x02</span><span class="p">,</span> <span class="n">message_type</span><span class="o">=</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">cmd</span><span class="o">=</span><span class="mh">0x08</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-0-2210"><a id="__codelineno-0-2210" name="__codelineno-0-2210"></a>        <span class="k">elif</span> <span class="n">type_cmd</span> <span class="o">==</span> <span class="s1">&#39;SETREMOTESTOPFM&#39;</span><span class="p">:</span>
</span><span id="__span-0-2211"><a id="__codelineno-0-2211" name="__codelineno-0-2211"></a>            <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encode_message</span><span class="p">(</span><span class="n">source_id</span><span class="o">=</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">destination_id</span><span class="o">=</span><span class="mh">0x02</span><span class="p">,</span> <span class="n">message_type</span><span class="o">=</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">cmd</span><span class="o">=</span><span class="mh">0x09</span><span class="p">)</span>
</span><span id="__span-0-2212"><a id="__codelineno-0-2212" name="__codelineno-0-2212"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;DRONE&#39;</span><span class="p">:</span>
</span><span id="__span-0-2213"><a id="__codelineno-0-2213" name="__codelineno-0-2213"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
</span><span id="__span-0-2214"><a id="__codelineno-0-2214" name="__codelineno-0-2214"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;GROUND&#39;</span><span class="p">:</span>
</span><span id="__span-0-2215"><a id="__codelineno-0-2215" name="__codelineno-0-2215"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">a2g_conn</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
</span><span id="__span-0-2216"><a id="__codelineno-0-2216" name="__codelineno-0-2216"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG]: This </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="si">}</span><span class="s2"> node sends </span><span class="si">{</span><span class="n">type_cmd</span><span class="si">}</span><span class="s2"> cmd&quot;</span><span class="p">)</span>
</span><span id="__span-0-2217"><a id="__codelineno-0-2217" name="__codelineno-0-2217"></a>
</span><span id="__span-0-2218"><a id="__codelineno-0-2218" name="__codelineno-0-2218"></a>    <span class="k">def</span> <span class="nf">az_rot_gnd_gimbal_toggle_sig_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Naz</span><span class="p">,</span> <span class="n">meas_time</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="__span-0-2219"><a id="__codelineno-0-2219" name="__codelineno-0-2219"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-2220"><a id="__codelineno-0-2220" name="__codelineno-0-2220"></a><span class="sd">        Rotates the ground gimbal into &quot;Naz&quot; azimuth steps, while stopping at each angle step, to turn on the signal generator,</span>
</span><span id="__span-0-2221"><a id="__codelineno-0-2221" name="__codelineno-0-2221"></a><span class="sd">        wait for it &quot;meas_time&quot;[seconds] to send signal, and turn it off again.</span>
</span><span id="__span-0-2222"><a id="__codelineno-0-2222" name="__codelineno-0-2222"></a>
</span><span id="__span-0-2223"><a id="__codelineno-0-2223" name="__codelineno-0-2223"></a><span class="sd">        Args:</span>
</span><span id="__span-0-2224"><a id="__codelineno-0-2224" name="__codelineno-0-2224"></a><span class="sd">            az_now (int): angle where to start the count. It lies between -1800 and 1800</span>
</span><span id="__span-0-2225"><a id="__codelineno-0-2225" name="__codelineno-0-2225"></a><span class="sd">            Naz (int): number of sectors in azimuth circle</span>
</span><span id="__span-0-2226"><a id="__codelineno-0-2226" name="__codelineno-0-2226"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-0-2227"><a id="__codelineno-0-2227" name="__codelineno-0-2227"></a>
</span><span id="__span-0-2228"><a id="__codelineno-0-2228" name="__codelineno-0-2228"></a>        <span class="k">def</span> <span class="nf">fcn_to_execute</span><span class="p">(</span><span class="n">state</span><span class="p">):</span>
</span><span id="__span-0-2229"><a id="__codelineno-0-2229" name="__codelineno-0-2229"></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-2230"><a id="__codelineno-0-2230" name="__codelineno-0-2230"></a><span class="sd">            This local function template must be replaced with the instruction to execute when the ground gimbal</span>
</span><span id="__span-0-2231"><a id="__codelineno-0-2231" name="__codelineno-0-2231"></a><span class="sd">            stops for &#39;meas_time&#39; seconds in a given position. </span>
</span><span id="__span-0-2232"><a id="__codelineno-0-2232" name="__codelineno-0-2232"></a>
</span><span id="__span-0-2233"><a id="__codelineno-0-2233" name="__codelineno-0-2233"></a><span class="sd">            The instruction to execute has to have 2 states: </span>
</span><span id="__span-0-2234"><a id="__codelineno-0-2234" name="__codelineno-0-2234"></a><span class="sd">                &#39;On&#39;) What to execute when ground gimbal just stopped at a new position</span>
</span><span id="__span-0-2235"><a id="__codelineno-0-2235" name="__codelineno-0-2235"></a><span class="sd">                &#39;Off&#39;) What to execute when &#39;meas_time&#39; finishes, and ground gimbal must start again to move to the next position</span>
</span><span id="__span-0-2236"><a id="__codelineno-0-2236" name="__codelineno-0-2236"></a>
</span><span id="__span-0-2237"><a id="__codelineno-0-2237" name="__codelineno-0-2237"></a><span class="sd">            Args:</span>
</span><span id="__span-0-2238"><a id="__codelineno-0-2238" name="__codelineno-0-2238"></a><span class="sd">                state (str): ``On`` or ``Off``</span>
</span><span id="__span-0-2239"><a id="__codelineno-0-2239" name="__codelineno-0-2239"></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="__span-0-2240"><a id="__codelineno-0-2240" name="__codelineno-0-2240"></a>
</span><span id="__span-0-2241"><a id="__codelineno-0-2241" name="__codelineno-0-2241"></a>            <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="s1">&#39;On&#39;</span><span class="p">:</span> <span class="c1"># &#39;On&#39; state</span>
</span><span id="__span-0-2242"><a id="__codelineno-0-2242" name="__codelineno-0-2242"></a>                <span class="c1">#self.inst.write(&#39;RF1\n&#39;)</span>
</span><span id="__span-0-2243"><a id="__codelineno-0-2243" name="__codelineno-0-2243"></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">On state... just print&#39;</span><span class="p">)</span>
</span><span id="__span-0-2244"><a id="__codelineno-0-2244" name="__codelineno-0-2244"></a>            <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="s1">&#39;Off&#39;</span><span class="p">:</span> <span class="c1"># &#39;Off&#39; state</span>
</span><span id="__span-0-2245"><a id="__codelineno-0-2245" name="__codelineno-0-2245"></a>                <span class="c1">#self.inst.write(&#39;RF0\n&#39;)</span>
</span><span id="__span-0-2246"><a id="__codelineno-0-2246" name="__codelineno-0-2246"></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Off state... just print&#39;</span><span class="p">)</span>
</span><span id="__span-0-2247"><a id="__codelineno-0-2247" name="__codelineno-0-2247"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2248"><a id="__codelineno-0-2248" name="__codelineno-0-2248"></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">[ERROR]: function to execute must toggle between two states&#39;</span><span class="p">)</span>
</span><span id="__span-0-2249"><a id="__codelineno-0-2249" name="__codelineno-0-2249"></a>
</span><span id="__span-0-2250"><a id="__codelineno-0-2250" name="__codelineno-0-2250"></a>        <span class="n">aux_ang_buff</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-2251"><a id="__codelineno-0-2251" name="__codelineno-0-2251"></a>        <span class="n">file_to_save</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-2252"><a id="__codelineno-0-2252" name="__codelineno-0-2252"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">IsGimbal</span><span class="o">!=</span><span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">IsGPS</span><span class="p">:</span>
</span><span id="__span-0-2253"><a id="__codelineno-0-2253" name="__codelineno-0-2253"></a>
</span><span id="__span-0-2254"><a id="__codelineno-0-2254" name="__codelineno-0-2254"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DBG_LVL_1</span><span class="p">:</span>
</span><span id="__span-0-2255"><a id="__codelineno-0-2255" name="__codelineno-0-2255"></a>                <span class="c1"># Remember that reques_current_position is a blocking function</span>
</span><span id="__span-0-2256"><a id="__codelineno-0-2256" name="__codelineno-0-2256"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">myGimbal</span><span class="o">.</span><span class="n">request_current_position</span><span class="p">()</span>
</span><span id="__span-0-2257"><a id="__codelineno-0-2257" name="__codelineno-0-2257"></a>                <span class="n">az_now</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">myGimbal</span><span class="o">.</span><span class="n">yaw</span><span class="p">))</span><span class="o">*</span><span class="mi">10</span>
</span><span id="__span-0-2258"><a id="__codelineno-0-2258" name="__codelineno-0-2258"></a>                <span class="n">pitch_now</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">myGimbal</span><span class="o">.</span><span class="n">pitch</span><span class="p">))</span><span class="o">*</span><span class="mi">10</span>
</span><span id="__span-0-2259"><a id="__codelineno-0-2259" name="__codelineno-0-2259"></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">YAW NOW: &#39;</span><span class="p">,</span> <span class="n">az_now</span><span class="p">,</span> <span class="s1">&#39; PITCH NOW: &#39;</span><span class="p">,</span> <span class="n">pitch_now</span><span class="p">)</span>
</span><span id="__span-0-2260"><a id="__codelineno-0-2260" name="__codelineno-0-2260"></a>
</span><span id="__span-0-2261"><a id="__codelineno-0-2261" name="__codelineno-0-2261"></a>            <span class="n">ang_step</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">3600</span><span class="o">/</span><span class="n">Naz</span><span class="p">)</span>
</span><span id="__span-0-2262"><a id="__codelineno-0-2262" name="__codelineno-0-2262"></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Naz</span><span class="p">):</span>                
</span><span id="__span-0-2263"><a id="__codelineno-0-2263" name="__codelineno-0-2263"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">myGimbal</span><span class="o">.</span><span class="n">setPosControl</span><span class="p">(</span><span class="n">yaw</span><span class="o">=</span><span class="n">ang_step</span><span class="p">,</span> <span class="n">roll</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">pitch</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ctrl_byte</span><span class="o">=</span><span class="mh">0x00</span><span class="p">)</span>
</span><span id="__span-0-2264"><a id="__codelineno-0-2264" name="__codelineno-0-2264"></a>
</span><span id="__span-0-2265"><a id="__codelineno-0-2265" name="__codelineno-0-2265"></a>                <span class="c1"># 1. Sleep until ground gimbal reaches the position, before the instruction gets executed</span>
</span><span id="__span-0-2266"><a id="__codelineno-0-2266" name="__codelineno-0-2266"></a>                <span class="c1"># Approximate gimbal speed of 56 deg/s: Max angular movement is 1800 which is done in 3.5 at the actual speed </span>
</span><span id="__span-0-2267"><a id="__codelineno-0-2267" name="__codelineno-0-2267"></a>                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">myGimbal</span><span class="o">.</span><span class="n">TIME2MOVE_180_DEG_YAW</span><span class="p">)</span> 
</span><span id="__span-0-2268"><a id="__codelineno-0-2268" name="__codelineno-0-2268"></a>
</span><span id="__span-0-2269"><a id="__codelineno-0-2269" name="__codelineno-0-2269"></a>                <span class="c1"># 2. Execute instruction state 1</span>
</span><span id="__span-0-2270"><a id="__codelineno-0-2270" name="__codelineno-0-2270"></a>                <span class="n">fcn_to_execute</span><span class="p">(</span><span class="s1">&#39;On&#39;</span><span class="p">)</span>
</span><span id="__span-0-2271"><a id="__codelineno-0-2271" name="__codelineno-0-2271"></a>
</span><span id="__span-0-2272"><a id="__codelineno-0-2272" name="__codelineno-0-2272"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DBG_LVL_1</span><span class="p">:</span>
</span><span id="__span-0-2273"><a id="__codelineno-0-2273" name="__codelineno-0-2273"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">[WARNING]: in iteration &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; of &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">Naz</span><span class="p">)</span>  <span class="o">+</span><span class="s1">&#39;, instruction executed, now block thread for &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">meas_time</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;  [s]&#39;</span><span class="p">)</span>
</span><span id="__span-0-2274"><a id="__codelineno-0-2274" name="__codelineno-0-2274"></a>
</span><span id="__span-0-2275"><a id="__codelineno-0-2275" name="__codelineno-0-2275"></a>                <span class="c1"># 3. Sleep for &#39;meas_time&#39;, waiting for instruction to be executed</span>
</span><span id="__span-0-2276"><a id="__codelineno-0-2276" name="__codelineno-0-2276"></a>                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">meas_time</span><span class="p">)</span>
</span><span id="__span-0-2277"><a id="__codelineno-0-2277" name="__codelineno-0-2277"></a>
</span><span id="__span-0-2278"><a id="__codelineno-0-2278" name="__codelineno-0-2278"></a>                <span class="c1"># 4. Execute instruction state 0</span>
</span><span id="__span-0-2279"><a id="__codelineno-0-2279" name="__codelineno-0-2279"></a>                <span class="n">fcn_to_execute</span><span class="p">(</span><span class="s1">&#39;Off&#39;</span><span class="p">)</span>
</span><span id="__span-0-2280"><a id="__codelineno-0-2280" name="__codelineno-0-2280"></a>
</span><span id="__span-0-2281"><a id="__codelineno-0-2281" name="__codelineno-0-2281"></a>                <span class="c1"># 5. Get last gps coordinates and save them with gimbal info</span>
</span><span id="__span-0-2282"><a id="__codelineno-0-2282" name="__codelineno-0-2282"></a>                <span class="n">coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">get_last_sbf_buffer_info</span><span class="p">(</span><span class="n">what</span><span class="o">=</span><span class="s1">&#39;Coordinates&#39;</span><span class="p">)</span>
</span><span id="__span-0-2283"><a id="__codelineno-0-2283" name="__codelineno-0-2283"></a>
</span><span id="__span-0-2284"><a id="__codelineno-0-2284" name="__codelineno-0-2284"></a>                <span class="k">if</span> <span class="n">coords</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_BUFF_NULL</span><span class="p">:</span>
</span><span id="__span-0-2285"><a id="__codelineno-0-2285" name="__codelineno-0-2285"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">[ERROR]: gps sbf stream not started or not a single entry in buffer yet&#39;</span><span class="p">)</span>
</span><span id="__span-0-2286"><a id="__codelineno-0-2286" name="__codelineno-0-2286"></a>                    <span class="k">return</span> 
</span><span id="__span-0-2287"><a id="__codelineno-0-2287" name="__codelineno-0-2287"></a>                <span class="k">elif</span> <span class="n">coords</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_NO_COORD_AVAIL</span><span class="p">:</span>
</span><span id="__span-0-2288"><a id="__codelineno-0-2288" name="__codelineno-0-2288"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">[ERROR]: gps stream started but not enough satellites or strong multipath propagation interference&#39;</span><span class="p">)</span>
</span><span id="__span-0-2289"><a id="__codelineno-0-2289" name="__codelineno-0-2289"></a>                    <span class="k">return</span> 
</span><span id="__span-0-2290"><a id="__codelineno-0-2290" name="__codelineno-0-2290"></a>                <span class="k">else</span><span class="p">:</span>                    
</span><span id="__span-0-2291"><a id="__codelineno-0-2291" name="__codelineno-0-2291"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">myGimbal</span><span class="o">.</span><span class="n">request_current_position</span><span class="p">()</span>
</span><span id="__span-0-2292"><a id="__codelineno-0-2292" name="__codelineno-0-2292"></a>
</span><span id="__span-0-2293"><a id="__codelineno-0-2293" name="__codelineno-0-2293"></a>                    <span class="n">coords</span><span class="p">[</span><span class="s1">&#39;GROUND_GIMBAL_YAW&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">myGimbal</span><span class="o">.</span><span class="n">yaw</span>
</span><span id="__span-0-2294"><a id="__codelineno-0-2294" name="__codelineno-0-2294"></a>                    <span class="n">coords</span><span class="p">[</span><span class="s1">&#39;GROUND_GIMBAL_PITCH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">myGimbal</span><span class="o">.</span><span class="n">pitch</span>
</span><span id="__span-0-2295"><a id="__codelineno-0-2295" name="__codelineno-0-2295"></a>                    <span class="n">file_to_save</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
</span><span id="__span-0-2296"><a id="__codelineno-0-2296" name="__codelineno-0-2296"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2297"><a id="__codelineno-0-2297" name="__codelineno-0-2297"></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">[ERROR]: To call this function, IsGimbal and IsGPS have to be set&#39;</span><span class="p">)</span>
</span><span id="__span-0-2298"><a id="__codelineno-0-2298" name="__codelineno-0-2298"></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">[WARNING]: No file with coordinates and gimbal yaw, pitch saved&#39;</span><span class="p">)</span>
</span><span id="__span-0-2299"><a id="__codelineno-0-2299" name="__codelineno-0-2299"></a>            <span class="k">return</span> 
</span><span id="__span-0-2300"><a id="__codelineno-0-2300" name="__codelineno-0-2300"></a>
</span><span id="__span-0-2301"><a id="__codelineno-0-2301" name="__codelineno-0-2301"></a>        <span class="n">file_to_save</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">file_to_save</span><span class="p">)</span>
</span><span id="__span-0-2302"><a id="__codelineno-0-2302" name="__codelineno-0-2302"></a>        <span class="n">fid</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.json&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="c1"># this overwrites the file</span>
</span><span id="__span-0-2303"><a id="__codelineno-0-2303" name="__codelineno-0-2303"></a>        <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">file_to_save</span><span class="p">)</span>
</span><span id="__span-0-2304"><a id="__codelineno-0-2304" name="__codelineno-0-2304"></a>        <span class="n">fid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="__span-0-2305"><a id="__codelineno-0-2305" name="__codelineno-0-2305"></a>
</span><span id="__span-0-2306"><a id="__codelineno-0-2306" name="__codelineno-0-2306"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DBG_LVL_1</span><span class="p">:</span>
</span><span id="__span-0-2307"><a id="__codelineno-0-2307" name="__codelineno-0-2307"></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">File &#39;</span> <span class="o">+</span> <span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39; saved&#39;</span><span class="p">)</span>
</span><span id="__span-0-2308"><a id="__codelineno-0-2308" name="__codelineno-0-2308"></a>
</span><span id="__span-0-2309"><a id="__codelineno-0-2309" name="__codelineno-0-2309"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Naz</span><span class="p">):</span>
</span><span id="__span-0-2310"><a id="__codelineno-0-2310" name="__codelineno-0-2310"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">myGimbal</span><span class="o">.</span><span class="n">setPosControl</span><span class="p">(</span><span class="n">yaw</span><span class="o">=-</span><span class="n">ang_step</span><span class="p">,</span> <span class="n">pitch</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">roll</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ctrl_byte</span><span class="o">=</span><span class="mh">0x00</span><span class="p">)</span>
</span><span id="__span-0-2311"><a id="__codelineno-0-2311" name="__codelineno-0-2311"></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">myGimbal</span><span class="o">.</span><span class="n">TIME2MOVE_180_DEG_YAW</span><span class="p">)</span>
</span><span id="__span-0-2312"><a id="__codelineno-0-2312" name="__codelineno-0-2312"></a>
</span><span id="__span-0-2313"><a id="__codelineno-0-2313" name="__codelineno-0-2313"></a>    <span class="k">def</span> <span class="nf">HelperStartA2GCom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">PORT</span><span class="o">=</span><span class="mi">10000</span><span class="p">):</span>
</span><span id="__span-0-2314"><a id="__codelineno-0-2314" name="__codelineno-0-2314"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-2315"><a id="__codelineno-0-2315" name="__codelineno-0-2315"></a><span class="sd">        Starts the socket binding, listening and accepting for server side, or connecting for client side. The ground node works as the server while the drone as the client.</span>
</span><span id="__span-0-2316"><a id="__codelineno-0-2316" name="__codelineno-0-2316"></a>
</span><span id="__span-0-2317"><a id="__codelineno-0-2317" name="__codelineno-0-2317"></a><span class="sd">        Creates and starts the thread handling the socket messages.</span>
</span><span id="__span-0-2318"><a id="__codelineno-0-2318" name="__codelineno-0-2318"></a>
</span><span id="__span-0-2319"><a id="__codelineno-0-2319" name="__codelineno-0-2319"></a><span class="sd">        Args:</span>
</span><span id="__span-0-2320"><a id="__codelineno-0-2320" name="__codelineno-0-2320"></a><span class="sd">            PORT (int, optional): TCP port. Defaults to 10000.</span>
</span><span id="__span-0-2321"><a id="__codelineno-0-2321" name="__codelineno-0-2321"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-0-2322"><a id="__codelineno-0-2322" name="__codelineno-0-2322"></a>
</span><span id="__span-0-2323"><a id="__codelineno-0-2323" name="__codelineno-0-2323"></a>        <span class="n">socket_poll_cnt</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="__span-0-2324"><a id="__codelineno-0-2324" name="__codelineno-0-2324"></a>
</span><span id="__span-0-2325"><a id="__codelineno-0-2325" name="__codelineno-0-2325"></a>        <span class="c1"># If we know for sure that there will be a client request for connection, we can keep this number low</span>
</span><span id="__span-0-2326"><a id="__codelineno-0-2326" name="__codelineno-0-2326"></a>        <span class="n">MAX_NUM_SOCKET_POLLS</span> <span class="o">=</span> <span class="mi">100</span>
</span><span id="__span-0-2327"><a id="__codelineno-0-2327" name="__codelineno-0-2327"></a>
</span><span id="__span-0-2328"><a id="__codelineno-0-2328" name="__codelineno-0-2328"></a>        <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
</span><span id="__span-0-2329"><a id="__codelineno-0-2329" name="__codelineno-0-2329"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">socket</span> <span class="o">=</span> <span class="n">s</span>
</span><span id="__span-0-2330"><a id="__codelineno-0-2330" name="__codelineno-0-2330"></a>
</span><span id="__span-0-2331"><a id="__codelineno-0-2331" name="__codelineno-0-2331"></a>        <span class="c1"># We need to use a timeout, because otherwise socket.accept() will block the GUI</span>
</span><span id="__span-0-2332"><a id="__codelineno-0-2332" name="__codelineno-0-2332"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> 
</span><span id="__span-0-2333"><a id="__codelineno-0-2333" name="__codelineno-0-2333"></a>
</span><span id="__span-0-2334"><a id="__codelineno-0-2334" name="__codelineno-0-2334"></a>        <span class="c1"># CLIENT</span>
</span><span id="__span-0-2335"><a id="__codelineno-0-2335" name="__codelineno-0-2335"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;DRONE&#39;</span><span class="p">:</span>
</span><span id="__span-0-2336"><a id="__codelineno-0-2336" name="__codelineno-0-2336"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">SERVER_ADDRESS</span><span class="p">,</span> <span class="n">PORT</span><span class="p">))</span>
</span><span id="__span-0-2337"><a id="__codelineno-0-2337" name="__codelineno-0-2337"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DBG_LVL_1</span><span class="p">:</span>
</span><span id="__span-0-2338"><a id="__codelineno-0-2338" name="__codelineno-0-2338"></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CONNECTION ESTABLISHED with SERVER &#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SERVER_ADDRESS</span><span class="p">)</span>
</span><span id="__span-0-2339"><a id="__codelineno-0-2339" name="__codelineno-0-2339"></a>
</span><span id="__span-0-2340"><a id="__codelineno-0-2340" name="__codelineno-0-2340"></a>        <span class="c1"># SERVER</span>
</span><span id="__span-0-2341"><a id="__codelineno-0-2341" name="__codelineno-0-2341"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;GROUND&#39;</span><span class="p">:</span>            
</span><span id="__span-0-2342"><a id="__codelineno-0-2342" name="__codelineno-0-2342"></a>
</span><span id="__span-0-2343"><a id="__codelineno-0-2343" name="__codelineno-0-2343"></a>            <span class="c1"># Bind the socket to the port</span>
</span><span id="__span-0-2344"><a id="__codelineno-0-2344" name="__codelineno-0-2344"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">bind</span><span class="p">((</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">PORT</span><span class="p">))</span>
</span><span id="__span-0-2345"><a id="__codelineno-0-2345" name="__codelineno-0-2345"></a>
</span><span id="__span-0-2346"><a id="__codelineno-0-2346" name="__codelineno-0-2346"></a>            <span class="c1"># Listen for incoming connections. As there is one and only one client, we don&#39;t need a loop of ``socket.listen()`` calls.</span>
</span><span id="__span-0-2347"><a id="__codelineno-0-2347" name="__codelineno-0-2347"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">listen</span><span class="p">()</span>
</span><span id="__span-0-2348"><a id="__codelineno-0-2348" name="__codelineno-0-2348"></a>
</span><span id="__span-0-2349"><a id="__codelineno-0-2349" name="__codelineno-0-2349"></a>            <span class="c1"># There is no need for an endless loop</span>
</span><span id="__span-0-2350"><a id="__codelineno-0-2350" name="__codelineno-0-2350"></a>            <span class="k">while</span><span class="p">(</span><span class="n">socket_poll_cnt</span> <span class="o">&lt;</span> <span class="n">MAX_NUM_SOCKET_POLLS</span><span class="p">):</span>
</span><span id="__span-0-2351"><a id="__codelineno-0-2351" name="__codelineno-0-2351"></a>                <span class="k">try</span><span class="p">:</span> 
</span><span id="__span-0-2352"><a id="__codelineno-0-2352" name="__codelineno-0-2352"></a>                    <span class="c1"># Blocks until timeout</span>
</span><span id="__span-0-2353"><a id="__codelineno-0-2353" name="__codelineno-0-2353"></a>                    <span class="n">a2g_connection</span><span class="p">,</span> <span class="n">client_address</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
</span><span id="__span-0-2354"><a id="__codelineno-0-2354" name="__codelineno-0-2354"></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">es</span><span class="p">:</span>
</span><span id="__span-0-2355"><a id="__codelineno-0-2355" name="__codelineno-0-2355"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG]: No client has been seen there. Poll again for a connection. POLL NUMBER: &quot;</span><span class="p">,</span> <span class="n">socket_poll_cnt</span><span class="p">)</span>
</span><span id="__span-0-2356"><a id="__codelineno-0-2356" name="__codelineno-0-2356"></a>                    <span class="n">socket_poll_cnt</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-0-2357"><a id="__codelineno-0-2357" name="__codelineno-0-2357"></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2358"><a id="__codelineno-0-2358" name="__codelineno-0-2358"></a>                    <span class="k">break</span>    
</span><span id="__span-0-2359"><a id="__codelineno-0-2359" name="__codelineno-0-2359"></a>
</span><span id="__span-0-2360"><a id="__codelineno-0-2360" name="__codelineno-0-2360"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DBG_LVL_1</span><span class="p">:</span>
</span><span id="__span-0-2361"><a id="__codelineno-0-2361" name="__codelineno-0-2361"></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CONNECTION ESTABLISHED with CLIENT &#39;</span><span class="p">,</span> <span class="n">client_address</span><span class="p">)</span>
</span><span id="__span-0-2362"><a id="__codelineno-0-2362" name="__codelineno-0-2362"></a>
</span><span id="__span-0-2363"><a id="__codelineno-0-2363" name="__codelineno-0-2363"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">a2g_conn</span> <span class="o">=</span> <span class="n">a2g_connection</span>
</span><span id="__span-0-2364"><a id="__codelineno-0-2364" name="__codelineno-0-2364"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">CLIENT_ADDRESS</span> <span class="o">=</span> <span class="n">client_address</span>
</span><span id="__span-0-2365"><a id="__codelineno-0-2365" name="__codelineno-0-2365"></a>
</span><span id="__span-0-2366"><a id="__codelineno-0-2366" name="__codelineno-0-2366"></a>        <span class="c1"># This runs a thread that constantly checks for received messages</span>
</span><span id="__span-0-2367"><a id="__codelineno-0-2367" name="__codelineno-0-2367"></a>        <span class="c1"># If there are no messages thre will be an error</span>
</span><span id="__span-0-2368"><a id="__codelineno-0-2368" name="__codelineno-0-2368"></a>        <span class="c1"># The error might be because there is no sent package(but there is still connection) or because there is no connection anymore</span>
</span><span id="__span-0-2369"><a id="__codelineno-0-2369" name="__codelineno-0-2369"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">event_stop_thread_helper</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
</span><span id="__span-0-2370"><a id="__codelineno-0-2370" name="__codelineno-0-2370"></a>        <span class="n">thread_rx_helper</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">socket_receive</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">event_stop_thread_helper</span><span class="p">,))</span>
</span><span id="__span-0-2371"><a id="__codelineno-0-2371" name="__codelineno-0-2371"></a>        <span class="n">thread_rx_helper</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span id="__span-0-2372"><a id="__codelineno-0-2372" name="__codelineno-0-2372"></a>
</span><span id="__span-0-2373"><a id="__codelineno-0-2373" name="__codelineno-0-2373"></a>    <span class="k">def</span> <span class="nf">HelperA2GStopCom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">DISC_WHAT</span><span class="o">=</span><span class="s1">&#39;ALL&#39;</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
</span><span id="__span-0-2374"><a id="__codelineno-0-2374" name="__codelineno-0-2374"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-2375"><a id="__codelineno-0-2375" name="__codelineno-0-2375"></a><span class="sd">        Stops connection with all the devices or the specified ones in the variable &#39;DISC_WHAT.</span>
</span><span id="__span-0-2376"><a id="__codelineno-0-2376" name="__codelineno-0-2376"></a>
</span><span id="__span-0-2377"><a id="__codelineno-0-2377" name="__codelineno-0-2377"></a><span class="sd">        When called, no matter which is the value of ``DISC_WHAT``, always close the TCP socket.</span>
</span><span id="__span-0-2378"><a id="__codelineno-0-2378" name="__codelineno-0-2378"></a>
</span><span id="__span-0-2379"><a id="__codelineno-0-2379" name="__codelineno-0-2379"></a><span class="sd">        Args:</span>
</span><span id="__span-0-2380"><a id="__codelineno-0-2380" name="__codelineno-0-2380"></a><span class="sd">            DISC_WHAT (str, optional): specifies with which/s device/s the connection must be ended. Options are: ``GIMBAL``, ``GPS``, ``RFSOC``, ``SG``, ``ALL``. Defaults to ``ALL``.</span>
</span><span id="__span-0-2381"><a id="__codelineno-0-2381" name="__codelineno-0-2381"></a><span class="sd">            stream (int, optional): gps stream to be closed. Assuming there is only one gps stream created at ``__init__`` of this class (which is the default operation) when creating the instance of the ``GpsSignaling`` class, this will close all the gps streams. Defaults to 1.</span>
</span><span id="__span-0-2382"><a id="__codelineno-0-2382" name="__codelineno-0-2382"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-0-2383"><a id="__codelineno-0-2383" name="__codelineno-0-2383"></a>
</span><span id="__span-0-2384"><a id="__codelineno-0-2384" name="__codelineno-0-2384"></a>        <span class="k">try</span><span class="p">:</span>   
</span><span id="__span-0-2385"><a id="__codelineno-0-2385" name="__codelineno-0-2385"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">event_stop_thread_helper</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
</span><span id="__span-0-2386"><a id="__codelineno-0-2386" name="__codelineno-0-2386"></a>
</span><span id="__span-0-2387"><a id="__codelineno-0-2387" name="__codelineno-0-2387"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;DRONE&#39;</span><span class="p">:</span>
</span><span id="__span-0-2388"><a id="__codelineno-0-2388" name="__codelineno-0-2388"></a>                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;socket&#39;</span><span class="p">):</span>
</span><span id="__span-0-2389"><a id="__codelineno-0-2389" name="__codelineno-0-2389"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="__span-0-2390"><a id="__codelineno-0-2390" name="__codelineno-0-2390"></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;GROUND&#39;</span><span class="p">:</span>
</span><span id="__span-0-2391"><a id="__codelineno-0-2391" name="__codelineno-0-2391"></a>                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;a2g_conn&#39;</span><span class="p">):</span>
</span><span id="__span-0-2392"><a id="__codelineno-0-2392" name="__codelineno-0-2392"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">a2g_conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="__span-0-2393"><a id="__codelineno-0-2393" name="__codelineno-0-2393"></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="__span-0-2394"><a id="__codelineno-0-2394" name="__codelineno-0-2394"></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">[DEBUG]: ERROR closing connection: probably NO SOCKET created&#39;</span><span class="p">)</span>         
</span><span id="__span-0-2395"><a id="__codelineno-0-2395" name="__codelineno-0-2395"></a>
</span><span id="__span-0-2396"><a id="__codelineno-0-2396" name="__codelineno-0-2396"></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">DISC_WHAT</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="__span-0-2397"><a id="__codelineno-0-2397" name="__codelineno-0-2397"></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">DISC_WHAT</span><span class="p">:</span>
</span><span id="__span-0-2398"><a id="__codelineno-0-2398" name="__codelineno-0-2398"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">IsGimbal</span><span class="o">!=</span><span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="s1">&#39;GIMBAL&#39;</span><span class="p">):</span>  
</span><span id="__span-0-2399"><a id="__codelineno-0-2399" name="__codelineno-0-2399"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">myGimbal</span><span class="o">.</span><span class="n">stop_thread_gimbal</span><span class="p">()</span>
</span><span id="__span-0-2400"><a id="__codelineno-0-2400" name="__codelineno-0-2400"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[DEBUG]: Disconnecting gimbal&#39;</span><span class="p">)</span>
</span><span id="__span-0-2401"><a id="__codelineno-0-2401" name="__codelineno-0-2401"></a>                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>
</span><span id="__span-0-2402"><a id="__codelineno-0-2402" name="__codelineno-0-2402"></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;GROUND&#39;</span><span class="p">:</span>
</span><span id="__span-0-2403"><a id="__codelineno-0-2403" name="__codelineno-0-2403"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">myGimbal</span><span class="o">.</span><span class="n">actual_bus</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</span><span id="__span-0-2404"><a id="__codelineno-0-2404" name="__codelineno-0-2404"></a>
</span><span id="__span-0-2405"><a id="__codelineno-0-2405" name="__codelineno-0-2405"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">IsGPS</span> <span class="ow">and</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="s1">&#39;GPS&#39;</span><span class="p">):</span>  
</span><span id="__span-0-2406"><a id="__codelineno-0-2406" name="__codelineno-0-2406"></a>                    <span class="k">for</span> <span class="n">stream_info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">stream_info</span><span class="p">:</span>
</span><span id="__span-0-2407"><a id="__codelineno-0-2407" name="__codelineno-0-2407"></a>                        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;stream_number&#39;</span><span class="p">]):</span>
</span><span id="__span-0-2408"><a id="__codelineno-0-2408" name="__codelineno-0-2408"></a>                            <span class="n">msg_type</span> <span class="o">=</span> <span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;msg_type&#39;</span><span class="p">]</span>
</span><span id="__span-0-2409"><a id="__codelineno-0-2409" name="__codelineno-0-2409"></a>                            <span class="n">interface</span> <span class="o">=</span> <span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;interface&#39;</span><span class="p">]</span>
</span><span id="__span-0-2410"><a id="__codelineno-0-2410" name="__codelineno-0-2410"></a>
</span><span id="__span-0-2411"><a id="__codelineno-0-2411" name="__codelineno-0-2411"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">stop_gps_data_retrieval</span><span class="p">(</span><span class="n">stream_number</span><span class="o">=</span><span class="n">stream</span><span class="p">,</span> <span class="n">msg_type</span><span class="o">=</span><span class="n">msg_type</span><span class="p">,</span> <span class="n">interface</span><span class="o">=</span><span class="n">interface</span><span class="p">)</span>
</span><span id="__span-0-2412"><a id="__codelineno-0-2412" name="__codelineno-0-2412"></a>                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">[DEBUG]: Stoping GPS stream&#39;</span><span class="p">)</span>
</span><span id="__span-0-2413"><a id="__codelineno-0-2413" name="__codelineno-0-2413"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">stop_thread_gps</span><span class="p">()</span>      
</span><span id="__span-0-2414"><a id="__codelineno-0-2414" name="__codelineno-0-2414"></a>
</span><span id="__span-0-2415"><a id="__codelineno-0-2415" name="__codelineno-0-2415"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">IsSignalGenerator</span> <span class="ow">and</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="s1">&#39;SG&#39;</span><span class="p">):</span>
</span><span id="__span-0-2416"><a id="__codelineno-0-2416" name="__codelineno-0-2416"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">inst</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;RF0</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>   
</span><span id="__span-0-2417"><a id="__codelineno-0-2417" name="__codelineno-0-2417"></a>
</span><span id="__span-0-2418"><a id="__codelineno-0-2418" name="__codelineno-0-2418"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">IsRFSoC</span> <span class="ow">and</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="s1">&#39;RFSOC&#39;</span><span class="p">):</span>
</span><span id="__span-0-2419"><a id="__codelineno-0-2419" name="__codelineno-0-2419"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">myrfsoc</span><span class="o">.</span><span class="n">radio_control</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="__span-0-2420"><a id="__codelineno-0-2420" name="__codelineno-0-2420"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">myrfsoc</span><span class="o">.</span><span class="n">radio_data</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="__span-0-2421"><a id="__codelineno-0-2421" name="__codelineno-0-2421"></a>        <span class="k">else</span><span class="p">:</span> <span class="c1"># backwards compatibility</span>
</span><span id="__span-0-2422"><a id="__codelineno-0-2422" name="__codelineno-0-2422"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">IsGimbal</span><span class="o">!=</span><span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="n">DISC_WHAT</span><span class="o">==</span><span class="s1">&#39;ALL&#39;</span> <span class="ow">or</span> <span class="n">DISC_WHAT</span> <span class="o">==</span> <span class="s1">&#39;GIMBAL&#39;</span><span class="p">):</span>  
</span><span id="__span-0-2423"><a id="__codelineno-0-2423" name="__codelineno-0-2423"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">myGimbal</span><span class="o">.</span><span class="n">stop_thread_gimbal</span><span class="p">()</span>
</span><span id="__span-0-2424"><a id="__codelineno-0-2424" name="__codelineno-0-2424"></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">[DEBUG]: Disconnecting gimbal&#39;</span><span class="p">)</span>
</span><span id="__span-0-2425"><a id="__codelineno-0-2425" name="__codelineno-0-2425"></a>                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>
</span><span id="__span-0-2426"><a id="__codelineno-0-2426" name="__codelineno-0-2426"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;GROUND&#39;</span><span class="p">:</span>
</span><span id="__span-0-2427"><a id="__codelineno-0-2427" name="__codelineno-0-2427"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">myGimbal</span><span class="o">.</span><span class="n">actual_bus</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</span><span id="__span-0-2428"><a id="__codelineno-0-2428" name="__codelineno-0-2428"></a>
</span><span id="__span-0-2429"><a id="__codelineno-0-2429" name="__codelineno-0-2429"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">IsGPS</span> <span class="ow">and</span> <span class="p">(</span><span class="n">DISC_WHAT</span><span class="o">==</span><span class="s1">&#39;ALL&#39;</span> <span class="ow">or</span> <span class="n">DISC_WHAT</span> <span class="o">==</span> <span class="s1">&#39;GPS&#39;</span><span class="p">):</span>  
</span><span id="__span-0-2430"><a id="__codelineno-0-2430" name="__codelineno-0-2430"></a>                <span class="k">for</span> <span class="n">stream_info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">stream_info</span><span class="p">:</span>
</span><span id="__span-0-2431"><a id="__codelineno-0-2431" name="__codelineno-0-2431"></a>                    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;stream_number&#39;</span><span class="p">]):</span>
</span><span id="__span-0-2432"><a id="__codelineno-0-2432" name="__codelineno-0-2432"></a>                        <span class="n">msg_type</span> <span class="o">=</span> <span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;msg_type&#39;</span><span class="p">]</span>
</span><span id="__span-0-2433"><a id="__codelineno-0-2433" name="__codelineno-0-2433"></a>                        <span class="n">interface</span> <span class="o">=</span> <span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;interface&#39;</span><span class="p">]</span>
</span><span id="__span-0-2434"><a id="__codelineno-0-2434" name="__codelineno-0-2434"></a>
</span><span id="__span-0-2435"><a id="__codelineno-0-2435" name="__codelineno-0-2435"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">stop_gps_data_retrieval</span><span class="p">(</span><span class="n">stream_number</span><span class="o">=</span><span class="n">stream</span><span class="p">,</span> <span class="n">msg_type</span><span class="o">=</span><span class="n">msg_type</span><span class="p">,</span> <span class="n">interface</span><span class="o">=</span><span class="n">interface</span><span class="p">)</span>
</span><span id="__span-0-2436"><a id="__codelineno-0-2436" name="__codelineno-0-2436"></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">[DEBUG]: Stoping GPS stream&#39;</span><span class="p">)</span>
</span><span id="__span-0-2437"><a id="__codelineno-0-2437" name="__codelineno-0-2437"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">stop_thread_gps</span><span class="p">()</span>      
</span><span id="__span-0-2438"><a id="__codelineno-0-2438" name="__codelineno-0-2438"></a>
</span><span id="__span-0-2439"><a id="__codelineno-0-2439" name="__codelineno-0-2439"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">IsSignalGenerator</span> <span class="ow">and</span> <span class="p">(</span><span class="n">DISC_WHAT</span><span class="o">==</span><span class="s1">&#39;ALL&#39;</span> <span class="ow">or</span> <span class="n">DISC_WHAT</span> <span class="o">==</span> <span class="s1">&#39;SG&#39;</span><span class="p">):</span> 
</span><span id="__span-0-2440"><a id="__codelineno-0-2440" name="__codelineno-0-2440"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">inst</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;RF0</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>   
</span><span id="__span-0-2441"><a id="__codelineno-0-2441" name="__codelineno-0-2441"></a>
</span><span id="__span-0-2442"><a id="__codelineno-0-2442" name="__codelineno-0-2442"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">IsRFSoC</span> <span class="ow">and</span> <span class="p">(</span><span class="n">DISC_WHAT</span><span class="o">==</span><span class="s1">&#39;ALL&#39;</span> <span class="ow">or</span> <span class="n">DISC_WHAT</span> <span class="o">==</span> <span class="s1">&#39;RFSOC&#39;</span><span class="p">):</span>
</span><span id="__span-0-2443"><a id="__codelineno-0-2443" name="__codelineno-0-2443"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">myrfsoc</span><span class="o">.</span><span class="n">radio_control</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="__span-0-2444"><a id="__codelineno-0-2444" name="__codelineno-0-2444"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">myrfsoc</span><span class="o">.</span><span class="n">radio_data</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="a2gmeasurements.HelperA2GMeasurements.HelperA2GStopCom" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">HelperA2GStopCom</span><span class="p">(</span><span class="n">DISC_WHAT</span><span class="o">=</span><span class="s1">&#39;ALL&#39;</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Stops connection with all the devices or the specified ones in the variable 'DISC_WHAT.</p>
<p>When called, no matter which is the value of <code>DISC_WHAT</code>, always close the TCP socket.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>DISC_WHAT</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>specifies with which/s device/s the connection must be ended. Options are: <code>GIMBAL</code>, <code>GPS</code>, <code>RFSOC</code>, <code>SG</code>, <code>ALL</code>. Defaults to <code>ALL</code>.</p>
              </div>
            </td>
            <td>
                  <code>&#39;ALL&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>stream</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>gps stream to be closed. Assuming there is only one gps stream created at <code>__init__</code> of this class (which is the default operation) when creating the instance of the <code>GpsSignaling</code> class, this will close all the gps streams. Defaults to 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>a2gmeasurements.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-2373">2373</a></span>
<span class="normal"><a href="#__codelineno-0-2374">2374</a></span>
<span class="normal"><a href="#__codelineno-0-2375">2375</a></span>
<span class="normal"><a href="#__codelineno-0-2376">2376</a></span>
<span class="normal"><a href="#__codelineno-0-2377">2377</a></span>
<span class="normal"><a href="#__codelineno-0-2378">2378</a></span>
<span class="normal"><a href="#__codelineno-0-2379">2379</a></span>
<span class="normal"><a href="#__codelineno-0-2380">2380</a></span>
<span class="normal"><a href="#__codelineno-0-2381">2381</a></span>
<span class="normal"><a href="#__codelineno-0-2382">2382</a></span>
<span class="normal"><a href="#__codelineno-0-2383">2383</a></span>
<span class="normal"><a href="#__codelineno-0-2384">2384</a></span>
<span class="normal"><a href="#__codelineno-0-2385">2385</a></span>
<span class="normal"><a href="#__codelineno-0-2386">2386</a></span>
<span class="normal"><a href="#__codelineno-0-2387">2387</a></span>
<span class="normal"><a href="#__codelineno-0-2388">2388</a></span>
<span class="normal"><a href="#__codelineno-0-2389">2389</a></span>
<span class="normal"><a href="#__codelineno-0-2390">2390</a></span>
<span class="normal"><a href="#__codelineno-0-2391">2391</a></span>
<span class="normal"><a href="#__codelineno-0-2392">2392</a></span>
<span class="normal"><a href="#__codelineno-0-2393">2393</a></span>
<span class="normal"><a href="#__codelineno-0-2394">2394</a></span>
<span class="normal"><a href="#__codelineno-0-2395">2395</a></span>
<span class="normal"><a href="#__codelineno-0-2396">2396</a></span>
<span class="normal"><a href="#__codelineno-0-2397">2397</a></span>
<span class="normal"><a href="#__codelineno-0-2398">2398</a></span>
<span class="normal"><a href="#__codelineno-0-2399">2399</a></span>
<span class="normal"><a href="#__codelineno-0-2400">2400</a></span>
<span class="normal"><a href="#__codelineno-0-2401">2401</a></span>
<span class="normal"><a href="#__codelineno-0-2402">2402</a></span>
<span class="normal"><a href="#__codelineno-0-2403">2403</a></span>
<span class="normal"><a href="#__codelineno-0-2404">2404</a></span>
<span class="normal"><a href="#__codelineno-0-2405">2405</a></span>
<span class="normal"><a href="#__codelineno-0-2406">2406</a></span>
<span class="normal"><a href="#__codelineno-0-2407">2407</a></span>
<span class="normal"><a href="#__codelineno-0-2408">2408</a></span>
<span class="normal"><a href="#__codelineno-0-2409">2409</a></span>
<span class="normal"><a href="#__codelineno-0-2410">2410</a></span>
<span class="normal"><a href="#__codelineno-0-2411">2411</a></span>
<span class="normal"><a href="#__codelineno-0-2412">2412</a></span>
<span class="normal"><a href="#__codelineno-0-2413">2413</a></span>
<span class="normal"><a href="#__codelineno-0-2414">2414</a></span>
<span class="normal"><a href="#__codelineno-0-2415">2415</a></span>
<span class="normal"><a href="#__codelineno-0-2416">2416</a></span>
<span class="normal"><a href="#__codelineno-0-2417">2417</a></span>
<span class="normal"><a href="#__codelineno-0-2418">2418</a></span>
<span class="normal"><a href="#__codelineno-0-2419">2419</a></span>
<span class="normal"><a href="#__codelineno-0-2420">2420</a></span>
<span class="normal"><a href="#__codelineno-0-2421">2421</a></span>
<span class="normal"><a href="#__codelineno-0-2422">2422</a></span>
<span class="normal"><a href="#__codelineno-0-2423">2423</a></span>
<span class="normal"><a href="#__codelineno-0-2424">2424</a></span>
<span class="normal"><a href="#__codelineno-0-2425">2425</a></span>
<span class="normal"><a href="#__codelineno-0-2426">2426</a></span>
<span class="normal"><a href="#__codelineno-0-2427">2427</a></span>
<span class="normal"><a href="#__codelineno-0-2428">2428</a></span>
<span class="normal"><a href="#__codelineno-0-2429">2429</a></span>
<span class="normal"><a href="#__codelineno-0-2430">2430</a></span>
<span class="normal"><a href="#__codelineno-0-2431">2431</a></span>
<span class="normal"><a href="#__codelineno-0-2432">2432</a></span>
<span class="normal"><a href="#__codelineno-0-2433">2433</a></span>
<span class="normal"><a href="#__codelineno-0-2434">2434</a></span>
<span class="normal"><a href="#__codelineno-0-2435">2435</a></span>
<span class="normal"><a href="#__codelineno-0-2436">2436</a></span>
<span class="normal"><a href="#__codelineno-0-2437">2437</a></span>
<span class="normal"><a href="#__codelineno-0-2438">2438</a></span>
<span class="normal"><a href="#__codelineno-0-2439">2439</a></span>
<span class="normal"><a href="#__codelineno-0-2440">2440</a></span>
<span class="normal"><a href="#__codelineno-0-2441">2441</a></span>
<span class="normal"><a href="#__codelineno-0-2442">2442</a></span>
<span class="normal"><a href="#__codelineno-0-2443">2443</a></span>
<span class="normal"><a href="#__codelineno-0-2444">2444</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-2373"><a id="__codelineno-0-2373" name="__codelineno-0-2373"></a><span class="k">def</span> <span class="nf">HelperA2GStopCom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">DISC_WHAT</span><span class="o">=</span><span class="s1">&#39;ALL&#39;</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
</span><span id="__span-0-2374"><a id="__codelineno-0-2374" name="__codelineno-0-2374"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-2375"><a id="__codelineno-0-2375" name="__codelineno-0-2375"></a><span class="sd">    Stops connection with all the devices or the specified ones in the variable &#39;DISC_WHAT.</span>
</span><span id="__span-0-2376"><a id="__codelineno-0-2376" name="__codelineno-0-2376"></a>
</span><span id="__span-0-2377"><a id="__codelineno-0-2377" name="__codelineno-0-2377"></a><span class="sd">    When called, no matter which is the value of ``DISC_WHAT``, always close the TCP socket.</span>
</span><span id="__span-0-2378"><a id="__codelineno-0-2378" name="__codelineno-0-2378"></a>
</span><span id="__span-0-2379"><a id="__codelineno-0-2379" name="__codelineno-0-2379"></a><span class="sd">    Args:</span>
</span><span id="__span-0-2380"><a id="__codelineno-0-2380" name="__codelineno-0-2380"></a><span class="sd">        DISC_WHAT (str, optional): specifies with which/s device/s the connection must be ended. Options are: ``GIMBAL``, ``GPS``, ``RFSOC``, ``SG``, ``ALL``. Defaults to ``ALL``.</span>
</span><span id="__span-0-2381"><a id="__codelineno-0-2381" name="__codelineno-0-2381"></a><span class="sd">        stream (int, optional): gps stream to be closed. Assuming there is only one gps stream created at ``__init__`` of this class (which is the default operation) when creating the instance of the ``GpsSignaling`` class, this will close all the gps streams. Defaults to 1.</span>
</span><span id="__span-0-2382"><a id="__codelineno-0-2382" name="__codelineno-0-2382"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-2383"><a id="__codelineno-0-2383" name="__codelineno-0-2383"></a>
</span><span id="__span-0-2384"><a id="__codelineno-0-2384" name="__codelineno-0-2384"></a>    <span class="k">try</span><span class="p">:</span>   
</span><span id="__span-0-2385"><a id="__codelineno-0-2385" name="__codelineno-0-2385"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">event_stop_thread_helper</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
</span><span id="__span-0-2386"><a id="__codelineno-0-2386" name="__codelineno-0-2386"></a>
</span><span id="__span-0-2387"><a id="__codelineno-0-2387" name="__codelineno-0-2387"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;DRONE&#39;</span><span class="p">:</span>
</span><span id="__span-0-2388"><a id="__codelineno-0-2388" name="__codelineno-0-2388"></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;socket&#39;</span><span class="p">):</span>
</span><span id="__span-0-2389"><a id="__codelineno-0-2389" name="__codelineno-0-2389"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="__span-0-2390"><a id="__codelineno-0-2390" name="__codelineno-0-2390"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;GROUND&#39;</span><span class="p">:</span>
</span><span id="__span-0-2391"><a id="__codelineno-0-2391" name="__codelineno-0-2391"></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;a2g_conn&#39;</span><span class="p">):</span>
</span><span id="__span-0-2392"><a id="__codelineno-0-2392" name="__codelineno-0-2392"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">a2g_conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="__span-0-2393"><a id="__codelineno-0-2393" name="__codelineno-0-2393"></a>    <span class="k">except</span><span class="p">:</span>
</span><span id="__span-0-2394"><a id="__codelineno-0-2394" name="__codelineno-0-2394"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">[DEBUG]: ERROR closing connection: probably NO SOCKET created&#39;</span><span class="p">)</span>         
</span><span id="__span-0-2395"><a id="__codelineno-0-2395" name="__codelineno-0-2395"></a>
</span><span id="__span-0-2396"><a id="__codelineno-0-2396" name="__codelineno-0-2396"></a>    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">DISC_WHAT</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="__span-0-2397"><a id="__codelineno-0-2397" name="__codelineno-0-2397"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">DISC_WHAT</span><span class="p">:</span>
</span><span id="__span-0-2398"><a id="__codelineno-0-2398" name="__codelineno-0-2398"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">IsGimbal</span><span class="o">!=</span><span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="s1">&#39;GIMBAL&#39;</span><span class="p">):</span>  
</span><span id="__span-0-2399"><a id="__codelineno-0-2399" name="__codelineno-0-2399"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">myGimbal</span><span class="o">.</span><span class="n">stop_thread_gimbal</span><span class="p">()</span>
</span><span id="__span-0-2400"><a id="__codelineno-0-2400" name="__codelineno-0-2400"></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[DEBUG]: Disconnecting gimbal&#39;</span><span class="p">)</span>
</span><span id="__span-0-2401"><a id="__codelineno-0-2401" name="__codelineno-0-2401"></a>                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>
</span><span id="__span-0-2402"><a id="__codelineno-0-2402" name="__codelineno-0-2402"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;GROUND&#39;</span><span class="p">:</span>
</span><span id="__span-0-2403"><a id="__codelineno-0-2403" name="__codelineno-0-2403"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">myGimbal</span><span class="o">.</span><span class="n">actual_bus</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</span><span id="__span-0-2404"><a id="__codelineno-0-2404" name="__codelineno-0-2404"></a>
</span><span id="__span-0-2405"><a id="__codelineno-0-2405" name="__codelineno-0-2405"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">IsGPS</span> <span class="ow">and</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="s1">&#39;GPS&#39;</span><span class="p">):</span>  
</span><span id="__span-0-2406"><a id="__codelineno-0-2406" name="__codelineno-0-2406"></a>                <span class="k">for</span> <span class="n">stream_info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">stream_info</span><span class="p">:</span>
</span><span id="__span-0-2407"><a id="__codelineno-0-2407" name="__codelineno-0-2407"></a>                    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;stream_number&#39;</span><span class="p">]):</span>
</span><span id="__span-0-2408"><a id="__codelineno-0-2408" name="__codelineno-0-2408"></a>                        <span class="n">msg_type</span> <span class="o">=</span> <span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;msg_type&#39;</span><span class="p">]</span>
</span><span id="__span-0-2409"><a id="__codelineno-0-2409" name="__codelineno-0-2409"></a>                        <span class="n">interface</span> <span class="o">=</span> <span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;interface&#39;</span><span class="p">]</span>
</span><span id="__span-0-2410"><a id="__codelineno-0-2410" name="__codelineno-0-2410"></a>
</span><span id="__span-0-2411"><a id="__codelineno-0-2411" name="__codelineno-0-2411"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">stop_gps_data_retrieval</span><span class="p">(</span><span class="n">stream_number</span><span class="o">=</span><span class="n">stream</span><span class="p">,</span> <span class="n">msg_type</span><span class="o">=</span><span class="n">msg_type</span><span class="p">,</span> <span class="n">interface</span><span class="o">=</span><span class="n">interface</span><span class="p">)</span>
</span><span id="__span-0-2412"><a id="__codelineno-0-2412" name="__codelineno-0-2412"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">[DEBUG]: Stoping GPS stream&#39;</span><span class="p">)</span>
</span><span id="__span-0-2413"><a id="__codelineno-0-2413" name="__codelineno-0-2413"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">stop_thread_gps</span><span class="p">()</span>      
</span><span id="__span-0-2414"><a id="__codelineno-0-2414" name="__codelineno-0-2414"></a>
</span><span id="__span-0-2415"><a id="__codelineno-0-2415" name="__codelineno-0-2415"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">IsSignalGenerator</span> <span class="ow">and</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="s1">&#39;SG&#39;</span><span class="p">):</span>
</span><span id="__span-0-2416"><a id="__codelineno-0-2416" name="__codelineno-0-2416"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">inst</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;RF0</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>   
</span><span id="__span-0-2417"><a id="__codelineno-0-2417" name="__codelineno-0-2417"></a>
</span><span id="__span-0-2418"><a id="__codelineno-0-2418" name="__codelineno-0-2418"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">IsRFSoC</span> <span class="ow">and</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="s1">&#39;RFSOC&#39;</span><span class="p">):</span>
</span><span id="__span-0-2419"><a id="__codelineno-0-2419" name="__codelineno-0-2419"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">myrfsoc</span><span class="o">.</span><span class="n">radio_control</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="__span-0-2420"><a id="__codelineno-0-2420" name="__codelineno-0-2420"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">myrfsoc</span><span class="o">.</span><span class="n">radio_data</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="__span-0-2421"><a id="__codelineno-0-2421" name="__codelineno-0-2421"></a>    <span class="k">else</span><span class="p">:</span> <span class="c1"># backwards compatibility</span>
</span><span id="__span-0-2422"><a id="__codelineno-0-2422" name="__codelineno-0-2422"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">IsGimbal</span><span class="o">!=</span><span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="n">DISC_WHAT</span><span class="o">==</span><span class="s1">&#39;ALL&#39;</span> <span class="ow">or</span> <span class="n">DISC_WHAT</span> <span class="o">==</span> <span class="s1">&#39;GIMBAL&#39;</span><span class="p">):</span>  
</span><span id="__span-0-2423"><a id="__codelineno-0-2423" name="__codelineno-0-2423"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">myGimbal</span><span class="o">.</span><span class="n">stop_thread_gimbal</span><span class="p">()</span>
</span><span id="__span-0-2424"><a id="__codelineno-0-2424" name="__codelineno-0-2424"></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">[DEBUG]: Disconnecting gimbal&#39;</span><span class="p">)</span>
</span><span id="__span-0-2425"><a id="__codelineno-0-2425" name="__codelineno-0-2425"></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>
</span><span id="__span-0-2426"><a id="__codelineno-0-2426" name="__codelineno-0-2426"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;GROUND&#39;</span><span class="p">:</span>
</span><span id="__span-0-2427"><a id="__codelineno-0-2427" name="__codelineno-0-2427"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">myGimbal</span><span class="o">.</span><span class="n">actual_bus</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</span><span id="__span-0-2428"><a id="__codelineno-0-2428" name="__codelineno-0-2428"></a>
</span><span id="__span-0-2429"><a id="__codelineno-0-2429" name="__codelineno-0-2429"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">IsGPS</span> <span class="ow">and</span> <span class="p">(</span><span class="n">DISC_WHAT</span><span class="o">==</span><span class="s1">&#39;ALL&#39;</span> <span class="ow">or</span> <span class="n">DISC_WHAT</span> <span class="o">==</span> <span class="s1">&#39;GPS&#39;</span><span class="p">):</span>  
</span><span id="__span-0-2430"><a id="__codelineno-0-2430" name="__codelineno-0-2430"></a>            <span class="k">for</span> <span class="n">stream_info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">stream_info</span><span class="p">:</span>
</span><span id="__span-0-2431"><a id="__codelineno-0-2431" name="__codelineno-0-2431"></a>                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;stream_number&#39;</span><span class="p">]):</span>
</span><span id="__span-0-2432"><a id="__codelineno-0-2432" name="__codelineno-0-2432"></a>                    <span class="n">msg_type</span> <span class="o">=</span> <span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;msg_type&#39;</span><span class="p">]</span>
</span><span id="__span-0-2433"><a id="__codelineno-0-2433" name="__codelineno-0-2433"></a>                    <span class="n">interface</span> <span class="o">=</span> <span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;interface&#39;</span><span class="p">]</span>
</span><span id="__span-0-2434"><a id="__codelineno-0-2434" name="__codelineno-0-2434"></a>
</span><span id="__span-0-2435"><a id="__codelineno-0-2435" name="__codelineno-0-2435"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">stop_gps_data_retrieval</span><span class="p">(</span><span class="n">stream_number</span><span class="o">=</span><span class="n">stream</span><span class="p">,</span> <span class="n">msg_type</span><span class="o">=</span><span class="n">msg_type</span><span class="p">,</span> <span class="n">interface</span><span class="o">=</span><span class="n">interface</span><span class="p">)</span>
</span><span id="__span-0-2436"><a id="__codelineno-0-2436" name="__codelineno-0-2436"></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">[DEBUG]: Stoping GPS stream&#39;</span><span class="p">)</span>
</span><span id="__span-0-2437"><a id="__codelineno-0-2437" name="__codelineno-0-2437"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">stop_thread_gps</span><span class="p">()</span>      
</span><span id="__span-0-2438"><a id="__codelineno-0-2438" name="__codelineno-0-2438"></a>
</span><span id="__span-0-2439"><a id="__codelineno-0-2439" name="__codelineno-0-2439"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">IsSignalGenerator</span> <span class="ow">and</span> <span class="p">(</span><span class="n">DISC_WHAT</span><span class="o">==</span><span class="s1">&#39;ALL&#39;</span> <span class="ow">or</span> <span class="n">DISC_WHAT</span> <span class="o">==</span> <span class="s1">&#39;SG&#39;</span><span class="p">):</span> 
</span><span id="__span-0-2440"><a id="__codelineno-0-2440" name="__codelineno-0-2440"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">inst</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;RF0</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>   
</span><span id="__span-0-2441"><a id="__codelineno-0-2441" name="__codelineno-0-2441"></a>
</span><span id="__span-0-2442"><a id="__codelineno-0-2442" name="__codelineno-0-2442"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">IsRFSoC</span> <span class="ow">and</span> <span class="p">(</span><span class="n">DISC_WHAT</span><span class="o">==</span><span class="s1">&#39;ALL&#39;</span> <span class="ow">or</span> <span class="n">DISC_WHAT</span> <span class="o">==</span> <span class="s1">&#39;RFSOC&#39;</span><span class="p">):</span>
</span><span id="__span-0-2443"><a id="__codelineno-0-2443" name="__codelineno-0-2443"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">myrfsoc</span><span class="o">.</span><span class="n">radio_control</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="__span-0-2444"><a id="__codelineno-0-2444" name="__codelineno-0-2444"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">myrfsoc</span><span class="o">.</span><span class="n">radio_data</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="a2gmeasurements.HelperA2GMeasurements.HelperStartA2GCom" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">HelperStartA2GCom</span><span class="p">(</span><span class="n">PORT</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Starts the socket binding, listening and accepting for server side, or connecting for client side. The ground node works as the server while the drone as the client.</p>
<p>Creates and starts the thread handling the socket messages.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>PORT</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>TCP port. Defaults to 10000.</p>
              </div>
            </td>
            <td>
                  <code>10000</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>a2gmeasurements.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-2313">2313</a></span>
<span class="normal"><a href="#__codelineno-0-2314">2314</a></span>
<span class="normal"><a href="#__codelineno-0-2315">2315</a></span>
<span class="normal"><a href="#__codelineno-0-2316">2316</a></span>
<span class="normal"><a href="#__codelineno-0-2317">2317</a></span>
<span class="normal"><a href="#__codelineno-0-2318">2318</a></span>
<span class="normal"><a href="#__codelineno-0-2319">2319</a></span>
<span class="normal"><a href="#__codelineno-0-2320">2320</a></span>
<span class="normal"><a href="#__codelineno-0-2321">2321</a></span>
<span class="normal"><a href="#__codelineno-0-2322">2322</a></span>
<span class="normal"><a href="#__codelineno-0-2323">2323</a></span>
<span class="normal"><a href="#__codelineno-0-2324">2324</a></span>
<span class="normal"><a href="#__codelineno-0-2325">2325</a></span>
<span class="normal"><a href="#__codelineno-0-2326">2326</a></span>
<span class="normal"><a href="#__codelineno-0-2327">2327</a></span>
<span class="normal"><a href="#__codelineno-0-2328">2328</a></span>
<span class="normal"><a href="#__codelineno-0-2329">2329</a></span>
<span class="normal"><a href="#__codelineno-0-2330">2330</a></span>
<span class="normal"><a href="#__codelineno-0-2331">2331</a></span>
<span class="normal"><a href="#__codelineno-0-2332">2332</a></span>
<span class="normal"><a href="#__codelineno-0-2333">2333</a></span>
<span class="normal"><a href="#__codelineno-0-2334">2334</a></span>
<span class="normal"><a href="#__codelineno-0-2335">2335</a></span>
<span class="normal"><a href="#__codelineno-0-2336">2336</a></span>
<span class="normal"><a href="#__codelineno-0-2337">2337</a></span>
<span class="normal"><a href="#__codelineno-0-2338">2338</a></span>
<span class="normal"><a href="#__codelineno-0-2339">2339</a></span>
<span class="normal"><a href="#__codelineno-0-2340">2340</a></span>
<span class="normal"><a href="#__codelineno-0-2341">2341</a></span>
<span class="normal"><a href="#__codelineno-0-2342">2342</a></span>
<span class="normal"><a href="#__codelineno-0-2343">2343</a></span>
<span class="normal"><a href="#__codelineno-0-2344">2344</a></span>
<span class="normal"><a href="#__codelineno-0-2345">2345</a></span>
<span class="normal"><a href="#__codelineno-0-2346">2346</a></span>
<span class="normal"><a href="#__codelineno-0-2347">2347</a></span>
<span class="normal"><a href="#__codelineno-0-2348">2348</a></span>
<span class="normal"><a href="#__codelineno-0-2349">2349</a></span>
<span class="normal"><a href="#__codelineno-0-2350">2350</a></span>
<span class="normal"><a href="#__codelineno-0-2351">2351</a></span>
<span class="normal"><a href="#__codelineno-0-2352">2352</a></span>
<span class="normal"><a href="#__codelineno-0-2353">2353</a></span>
<span class="normal"><a href="#__codelineno-0-2354">2354</a></span>
<span class="normal"><a href="#__codelineno-0-2355">2355</a></span>
<span class="normal"><a href="#__codelineno-0-2356">2356</a></span>
<span class="normal"><a href="#__codelineno-0-2357">2357</a></span>
<span class="normal"><a href="#__codelineno-0-2358">2358</a></span>
<span class="normal"><a href="#__codelineno-0-2359">2359</a></span>
<span class="normal"><a href="#__codelineno-0-2360">2360</a></span>
<span class="normal"><a href="#__codelineno-0-2361">2361</a></span>
<span class="normal"><a href="#__codelineno-0-2362">2362</a></span>
<span class="normal"><a href="#__codelineno-0-2363">2363</a></span>
<span class="normal"><a href="#__codelineno-0-2364">2364</a></span>
<span class="normal"><a href="#__codelineno-0-2365">2365</a></span>
<span class="normal"><a href="#__codelineno-0-2366">2366</a></span>
<span class="normal"><a href="#__codelineno-0-2367">2367</a></span>
<span class="normal"><a href="#__codelineno-0-2368">2368</a></span>
<span class="normal"><a href="#__codelineno-0-2369">2369</a></span>
<span class="normal"><a href="#__codelineno-0-2370">2370</a></span>
<span class="normal"><a href="#__codelineno-0-2371">2371</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-2313"><a id="__codelineno-0-2313" name="__codelineno-0-2313"></a><span class="k">def</span> <span class="nf">HelperStartA2GCom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">PORT</span><span class="o">=</span><span class="mi">10000</span><span class="p">):</span>
</span><span id="__span-0-2314"><a id="__codelineno-0-2314" name="__codelineno-0-2314"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-2315"><a id="__codelineno-0-2315" name="__codelineno-0-2315"></a><span class="sd">    Starts the socket binding, listening and accepting for server side, or connecting for client side. The ground node works as the server while the drone as the client.</span>
</span><span id="__span-0-2316"><a id="__codelineno-0-2316" name="__codelineno-0-2316"></a>
</span><span id="__span-0-2317"><a id="__codelineno-0-2317" name="__codelineno-0-2317"></a><span class="sd">    Creates and starts the thread handling the socket messages.</span>
</span><span id="__span-0-2318"><a id="__codelineno-0-2318" name="__codelineno-0-2318"></a>
</span><span id="__span-0-2319"><a id="__codelineno-0-2319" name="__codelineno-0-2319"></a><span class="sd">    Args:</span>
</span><span id="__span-0-2320"><a id="__codelineno-0-2320" name="__codelineno-0-2320"></a><span class="sd">        PORT (int, optional): TCP port. Defaults to 10000.</span>
</span><span id="__span-0-2321"><a id="__codelineno-0-2321" name="__codelineno-0-2321"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-2322"><a id="__codelineno-0-2322" name="__codelineno-0-2322"></a>
</span><span id="__span-0-2323"><a id="__codelineno-0-2323" name="__codelineno-0-2323"></a>    <span class="n">socket_poll_cnt</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="__span-0-2324"><a id="__codelineno-0-2324" name="__codelineno-0-2324"></a>
</span><span id="__span-0-2325"><a id="__codelineno-0-2325" name="__codelineno-0-2325"></a>    <span class="c1"># If we know for sure that there will be a client request for connection, we can keep this number low</span>
</span><span id="__span-0-2326"><a id="__codelineno-0-2326" name="__codelineno-0-2326"></a>    <span class="n">MAX_NUM_SOCKET_POLLS</span> <span class="o">=</span> <span class="mi">100</span>
</span><span id="__span-0-2327"><a id="__codelineno-0-2327" name="__codelineno-0-2327"></a>
</span><span id="__span-0-2328"><a id="__codelineno-0-2328" name="__codelineno-0-2328"></a>    <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
</span><span id="__span-0-2329"><a id="__codelineno-0-2329" name="__codelineno-0-2329"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">socket</span> <span class="o">=</span> <span class="n">s</span>
</span><span id="__span-0-2330"><a id="__codelineno-0-2330" name="__codelineno-0-2330"></a>
</span><span id="__span-0-2331"><a id="__codelineno-0-2331" name="__codelineno-0-2331"></a>    <span class="c1"># We need to use a timeout, because otherwise socket.accept() will block the GUI</span>
</span><span id="__span-0-2332"><a id="__codelineno-0-2332" name="__codelineno-0-2332"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> 
</span><span id="__span-0-2333"><a id="__codelineno-0-2333" name="__codelineno-0-2333"></a>
</span><span id="__span-0-2334"><a id="__codelineno-0-2334" name="__codelineno-0-2334"></a>    <span class="c1"># CLIENT</span>
</span><span id="__span-0-2335"><a id="__codelineno-0-2335" name="__codelineno-0-2335"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;DRONE&#39;</span><span class="p">:</span>
</span><span id="__span-0-2336"><a id="__codelineno-0-2336" name="__codelineno-0-2336"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">SERVER_ADDRESS</span><span class="p">,</span> <span class="n">PORT</span><span class="p">))</span>
</span><span id="__span-0-2337"><a id="__codelineno-0-2337" name="__codelineno-0-2337"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DBG_LVL_1</span><span class="p">:</span>
</span><span id="__span-0-2338"><a id="__codelineno-0-2338" name="__codelineno-0-2338"></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CONNECTION ESTABLISHED with SERVER &#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SERVER_ADDRESS</span><span class="p">)</span>
</span><span id="__span-0-2339"><a id="__codelineno-0-2339" name="__codelineno-0-2339"></a>
</span><span id="__span-0-2340"><a id="__codelineno-0-2340" name="__codelineno-0-2340"></a>    <span class="c1"># SERVER</span>
</span><span id="__span-0-2341"><a id="__codelineno-0-2341" name="__codelineno-0-2341"></a>    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;GROUND&#39;</span><span class="p">:</span>            
</span><span id="__span-0-2342"><a id="__codelineno-0-2342" name="__codelineno-0-2342"></a>
</span><span id="__span-0-2343"><a id="__codelineno-0-2343" name="__codelineno-0-2343"></a>        <span class="c1"># Bind the socket to the port</span>
</span><span id="__span-0-2344"><a id="__codelineno-0-2344" name="__codelineno-0-2344"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">bind</span><span class="p">((</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">PORT</span><span class="p">))</span>
</span><span id="__span-0-2345"><a id="__codelineno-0-2345" name="__codelineno-0-2345"></a>
</span><span id="__span-0-2346"><a id="__codelineno-0-2346" name="__codelineno-0-2346"></a>        <span class="c1"># Listen for incoming connections. As there is one and only one client, we don&#39;t need a loop of ``socket.listen()`` calls.</span>
</span><span id="__span-0-2347"><a id="__codelineno-0-2347" name="__codelineno-0-2347"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">listen</span><span class="p">()</span>
</span><span id="__span-0-2348"><a id="__codelineno-0-2348" name="__codelineno-0-2348"></a>
</span><span id="__span-0-2349"><a id="__codelineno-0-2349" name="__codelineno-0-2349"></a>        <span class="c1"># There is no need for an endless loop</span>
</span><span id="__span-0-2350"><a id="__codelineno-0-2350" name="__codelineno-0-2350"></a>        <span class="k">while</span><span class="p">(</span><span class="n">socket_poll_cnt</span> <span class="o">&lt;</span> <span class="n">MAX_NUM_SOCKET_POLLS</span><span class="p">):</span>
</span><span id="__span-0-2351"><a id="__codelineno-0-2351" name="__codelineno-0-2351"></a>            <span class="k">try</span><span class="p">:</span> 
</span><span id="__span-0-2352"><a id="__codelineno-0-2352" name="__codelineno-0-2352"></a>                <span class="c1"># Blocks until timeout</span>
</span><span id="__span-0-2353"><a id="__codelineno-0-2353" name="__codelineno-0-2353"></a>                <span class="n">a2g_connection</span><span class="p">,</span> <span class="n">client_address</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
</span><span id="__span-0-2354"><a id="__codelineno-0-2354" name="__codelineno-0-2354"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">es</span><span class="p">:</span>
</span><span id="__span-0-2355"><a id="__codelineno-0-2355" name="__codelineno-0-2355"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG]: No client has been seen there. Poll again for a connection. POLL NUMBER: &quot;</span><span class="p">,</span> <span class="n">socket_poll_cnt</span><span class="p">)</span>
</span><span id="__span-0-2356"><a id="__codelineno-0-2356" name="__codelineno-0-2356"></a>                <span class="n">socket_poll_cnt</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-0-2357"><a id="__codelineno-0-2357" name="__codelineno-0-2357"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2358"><a id="__codelineno-0-2358" name="__codelineno-0-2358"></a>                <span class="k">break</span>    
</span><span id="__span-0-2359"><a id="__codelineno-0-2359" name="__codelineno-0-2359"></a>
</span><span id="__span-0-2360"><a id="__codelineno-0-2360" name="__codelineno-0-2360"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DBG_LVL_1</span><span class="p">:</span>
</span><span id="__span-0-2361"><a id="__codelineno-0-2361" name="__codelineno-0-2361"></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CONNECTION ESTABLISHED with CLIENT &#39;</span><span class="p">,</span> <span class="n">client_address</span><span class="p">)</span>
</span><span id="__span-0-2362"><a id="__codelineno-0-2362" name="__codelineno-0-2362"></a>
</span><span id="__span-0-2363"><a id="__codelineno-0-2363" name="__codelineno-0-2363"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">a2g_conn</span> <span class="o">=</span> <span class="n">a2g_connection</span>
</span><span id="__span-0-2364"><a id="__codelineno-0-2364" name="__codelineno-0-2364"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">CLIENT_ADDRESS</span> <span class="o">=</span> <span class="n">client_address</span>
</span><span id="__span-0-2365"><a id="__codelineno-0-2365" name="__codelineno-0-2365"></a>
</span><span id="__span-0-2366"><a id="__codelineno-0-2366" name="__codelineno-0-2366"></a>    <span class="c1"># This runs a thread that constantly checks for received messages</span>
</span><span id="__span-0-2367"><a id="__codelineno-0-2367" name="__codelineno-0-2367"></a>    <span class="c1"># If there are no messages thre will be an error</span>
</span><span id="__span-0-2368"><a id="__codelineno-0-2368" name="__codelineno-0-2368"></a>    <span class="c1"># The error might be because there is no sent package(but there is still connection) or because there is no connection anymore</span>
</span><span id="__span-0-2369"><a id="__codelineno-0-2369" name="__codelineno-0-2369"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">event_stop_thread_helper</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
</span><span id="__span-0-2370"><a id="__codelineno-0-2370" name="__codelineno-0-2370"></a>    <span class="n">thread_rx_helper</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">socket_receive</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">event_stop_thread_helper</span><span class="p">,))</span>
</span><span id="__span-0-2371"><a id="__codelineno-0-2371" name="__codelineno-0-2371"></a>    <span class="n">thread_rx_helper</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="a2gmeasurements.HelperA2GMeasurements.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="n">SERVER_ADDRESS</span><span class="p">,</span> <span class="n">DBG_LVL_0</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">DBG_LVL_1</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">IsGimbal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">IsGPS</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">IsSignalGenerator</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">IsRFSoC</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">rfsoc_static_ip_address</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">F0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">L0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">SPEED</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">GPS_Stream_Interval</span><span class="o">=</span><span class="s1">&#39;msec500&#39;</span><span class="p">,</span> <span class="n">AVG_CALLBACK_TIME_SOCKET_RECEIVE_FCN</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">operating_freq</span><span class="o">=</span><span class="mf">57510000000.0</span><span class="p">,</span> <span class="n">heading_offset</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Creates instances of classes <code>GimbalRS2</code> (or <code>GimbalGremsyH16</code>), <code>GpsSignaling</code>, <code>RFSoCRemoteControlFromHost</code> to control these devices.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>ID</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>either 'DRONE' or 'GND'.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>SERVER_ADDRESS</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the IP address of the ground station.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>DBG_LVL_0</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if set, prints some low-level messages usefull for debugging. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>DBG_LVL_1</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if set, prints some higher-level messages usefull for debugging. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>IsGimbal</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>0 or FALSE, when no gimbal is physically connected to this host computer; 1, when a Ronin RS2 is physically connected; 2, when a Gremsy H16 is physically connected. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>IsGPS</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if a gps is physically connected to this host computer. False otherwise. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>IsSignalGenerator</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if a signal generator controlled by pyvisa commands is physically connected to this host computer. False otherwise. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>IsRFSoC</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if an RFSoC is physically connected to this host computer. False otherwise. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>rfsoc_static_ip_address</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>IP address of the RFSoC connected to this host computer. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>L0</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>parameter of the signal generator. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>SPEED</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the speed of the node in m/s. If this node is GROUND it should be 0 (gnd node does not move) as it is by default. This parameter ONLY incides in raising a warning debug print when the speed of the node is higher than the time difference between consecutive SBF sentences. NOT a crutial parameter at all. Stays here for back compatibility. Defaults to 0.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>GPS_Stream_Interval</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>time interval used for the retrieving of the configured SBF sentences in Septentrio's receiver connected to this host computer. A list of available options is shown in <code>start_gps_data_retrieval</code> of class <code>GpsSignaling</code>. Defaults to 'msec500'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;msec500&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>AVG_CALLBACK_TIME_SOCKET_RECEIVE_FCN</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>approximated time between calls of the communication thread. This parameter is used in conjunction with <code>MAX_TIME_EMPTY_SOCKETS</code> to raise an exception when neither side of the communication link is sending any message. Unfortunately, this is a very simple estimate, since the actual time between calls depends on many factors and is does not remain constant between calls. Defaults to 0.001.</p>
              </div>
            </td>
            <td>
                  <code>0.001</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>operating_freq</code></td>
            <td>
                  <code>_type_</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>operating frequency of the Sivers RF-frontend. The range of defined frequencies is defined in the "User Manual EVK06002" of the Sivers EVK (57-71 GHz). Defaults to 57.51e9.</p>
              </div>
            </td>
            <td>
                  <code>57510000000.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>heading_offset</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>heading offset (check its definition in the <code>GpsSignaling.setHeadingOffset</code> method). Defaults to 0.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>a2gmeasurements.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1483">1483</a></span>
<span class="normal"><a href="#__codelineno-0-1484">1484</a></span>
<span class="normal"><a href="#__codelineno-0-1485">1485</a></span>
<span class="normal"><a href="#__codelineno-0-1486">1486</a></span>
<span class="normal"><a href="#__codelineno-0-1487">1487</a></span>
<span class="normal"><a href="#__codelineno-0-1488">1488</a></span>
<span class="normal"><a href="#__codelineno-0-1489">1489</a></span>
<span class="normal"><a href="#__codelineno-0-1490">1490</a></span>
<span class="normal"><a href="#__codelineno-0-1491">1491</a></span>
<span class="normal"><a href="#__codelineno-0-1492">1492</a></span>
<span class="normal"><a href="#__codelineno-0-1493">1493</a></span>
<span class="normal"><a href="#__codelineno-0-1494">1494</a></span>
<span class="normal"><a href="#__codelineno-0-1495">1495</a></span>
<span class="normal"><a href="#__codelineno-0-1496">1496</a></span>
<span class="normal"><a href="#__codelineno-0-1497">1497</a></span>
<span class="normal"><a href="#__codelineno-0-1498">1498</a></span>
<span class="normal"><a href="#__codelineno-0-1499">1499</a></span>
<span class="normal"><a href="#__codelineno-0-1500">1500</a></span>
<span class="normal"><a href="#__codelineno-0-1501">1501</a></span>
<span class="normal"><a href="#__codelineno-0-1502">1502</a></span>
<span class="normal"><a href="#__codelineno-0-1503">1503</a></span>
<span class="normal"><a href="#__codelineno-0-1504">1504</a></span>
<span class="normal"><a href="#__codelineno-0-1505">1505</a></span>
<span class="normal"><a href="#__codelineno-0-1506">1506</a></span>
<span class="normal"><a href="#__codelineno-0-1507">1507</a></span>
<span class="normal"><a href="#__codelineno-0-1508">1508</a></span>
<span class="normal"><a href="#__codelineno-0-1509">1509</a></span>
<span class="normal"><a href="#__codelineno-0-1510">1510</a></span>
<span class="normal"><a href="#__codelineno-0-1511">1511</a></span>
<span class="normal"><a href="#__codelineno-0-1512">1512</a></span>
<span class="normal"><a href="#__codelineno-0-1513">1513</a></span>
<span class="normal"><a href="#__codelineno-0-1514">1514</a></span>
<span class="normal"><a href="#__codelineno-0-1515">1515</a></span>
<span class="normal"><a href="#__codelineno-0-1516">1516</a></span>
<span class="normal"><a href="#__codelineno-0-1517">1517</a></span>
<span class="normal"><a href="#__codelineno-0-1518">1518</a></span>
<span class="normal"><a href="#__codelineno-0-1519">1519</a></span>
<span class="normal"><a href="#__codelineno-0-1520">1520</a></span>
<span class="normal"><a href="#__codelineno-0-1521">1521</a></span>
<span class="normal"><a href="#__codelineno-0-1522">1522</a></span>
<span class="normal"><a href="#__codelineno-0-1523">1523</a></span>
<span class="normal"><a href="#__codelineno-0-1524">1524</a></span>
<span class="normal"><a href="#__codelineno-0-1525">1525</a></span>
<span class="normal"><a href="#__codelineno-0-1526">1526</a></span>
<span class="normal"><a href="#__codelineno-0-1527">1527</a></span>
<span class="normal"><a href="#__codelineno-0-1528">1528</a></span>
<span class="normal"><a href="#__codelineno-0-1529">1529</a></span>
<span class="normal"><a href="#__codelineno-0-1530">1530</a></span>
<span class="normal"><a href="#__codelineno-0-1531">1531</a></span>
<span class="normal"><a href="#__codelineno-0-1532">1532</a></span>
<span class="normal"><a href="#__codelineno-0-1533">1533</a></span>
<span class="normal"><a href="#__codelineno-0-1534">1534</a></span>
<span class="normal"><a href="#__codelineno-0-1535">1535</a></span>
<span class="normal"><a href="#__codelineno-0-1536">1536</a></span>
<span class="normal"><a href="#__codelineno-0-1537">1537</a></span>
<span class="normal"><a href="#__codelineno-0-1538">1538</a></span>
<span class="normal"><a href="#__codelineno-0-1539">1539</a></span>
<span class="normal"><a href="#__codelineno-0-1540">1540</a></span>
<span class="normal"><a href="#__codelineno-0-1541">1541</a></span>
<span class="normal"><a href="#__codelineno-0-1542">1542</a></span>
<span class="normal"><a href="#__codelineno-0-1543">1543</a></span>
<span class="normal"><a href="#__codelineno-0-1544">1544</a></span>
<span class="normal"><a href="#__codelineno-0-1545">1545</a></span>
<span class="normal"><a href="#__codelineno-0-1546">1546</a></span>
<span class="normal"><a href="#__codelineno-0-1547">1547</a></span>
<span class="normal"><a href="#__codelineno-0-1548">1548</a></span>
<span class="normal"><a href="#__codelineno-0-1549">1549</a></span>
<span class="normal"><a href="#__codelineno-0-1550">1550</a></span>
<span class="normal"><a href="#__codelineno-0-1551">1551</a></span>
<span class="normal"><a href="#__codelineno-0-1552">1552</a></span>
<span class="normal"><a href="#__codelineno-0-1553">1553</a></span>
<span class="normal"><a href="#__codelineno-0-1554">1554</a></span>
<span class="normal"><a href="#__codelineno-0-1555">1555</a></span>
<span class="normal"><a href="#__codelineno-0-1556">1556</a></span>
<span class="normal"><a href="#__codelineno-0-1557">1557</a></span>
<span class="normal"><a href="#__codelineno-0-1558">1558</a></span>
<span class="normal"><a href="#__codelineno-0-1559">1559</a></span>
<span class="normal"><a href="#__codelineno-0-1560">1560</a></span>
<span class="normal"><a href="#__codelineno-0-1561">1561</a></span>
<span class="normal"><a href="#__codelineno-0-1562">1562</a></span>
<span class="normal"><a href="#__codelineno-0-1563">1563</a></span>
<span class="normal"><a href="#__codelineno-0-1564">1564</a></span>
<span class="normal"><a href="#__codelineno-0-1565">1565</a></span>
<span class="normal"><a href="#__codelineno-0-1566">1566</a></span>
<span class="normal"><a href="#__codelineno-0-1567">1567</a></span>
<span class="normal"><a href="#__codelineno-0-1568">1568</a></span>
<span class="normal"><a href="#__codelineno-0-1569">1569</a></span>
<span class="normal"><a href="#__codelineno-0-1570">1570</a></span>
<span class="normal"><a href="#__codelineno-0-1571">1571</a></span>
<span class="normal"><a href="#__codelineno-0-1572">1572</a></span>
<span class="normal"><a href="#__codelineno-0-1573">1573</a></span>
<span class="normal"><a href="#__codelineno-0-1574">1574</a></span>
<span class="normal"><a href="#__codelineno-0-1575">1575</a></span>
<span class="normal"><a href="#__codelineno-0-1576">1576</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1483"><a id="__codelineno-0-1483" name="__codelineno-0-1483"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ID</span><span class="p">,</span> <span class="n">SERVER_ADDRESS</span><span class="p">,</span> 
</span><span id="__span-0-1484"><a id="__codelineno-0-1484" name="__codelineno-0-1484"></a>             <span class="n">DBG_LVL_0</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">DBG_LVL_1</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
</span><span id="__span-0-1485"><a id="__codelineno-0-1485" name="__codelineno-0-1485"></a>             <span class="n">IsGimbal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">IsGPS</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">IsSignalGenerator</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">IsRFSoC</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-1486"><a id="__codelineno-0-1486" name="__codelineno-0-1486"></a>             <span class="n">rfsoc_static_ip_address</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="c1">#uses the default ip_adress</span>
</span><span id="__span-0-1487"><a id="__codelineno-0-1487" name="__codelineno-0-1487"></a>             <span class="n">F0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">L0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-1488"><a id="__codelineno-0-1488" name="__codelineno-0-1488"></a>             <span class="n">SPEED</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="__span-0-1489"><a id="__codelineno-0-1489" name="__codelineno-0-1489"></a>             <span class="n">GPS_Stream_Interval</span><span class="o">=</span><span class="s1">&#39;msec500&#39;</span><span class="p">,</span> <span class="n">AVG_CALLBACK_TIME_SOCKET_RECEIVE_FCN</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span>
</span><span id="__span-0-1490"><a id="__codelineno-0-1490" name="__codelineno-0-1490"></a>             <span class="n">operating_freq</span><span class="o">=</span><span class="mf">57.51e9</span><span class="p">,</span>
</span><span id="__span-0-1491"><a id="__codelineno-0-1491" name="__codelineno-0-1491"></a>             <span class="n">heading_offset</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span><span id="__span-0-1492"><a id="__codelineno-0-1492" name="__codelineno-0-1492"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-1493"><a id="__codelineno-0-1493" name="__codelineno-0-1493"></a><span class="sd">    Creates instances of classes ``GimbalRS2`` (or ``GimbalGremsyH16``), ``GpsSignaling``, ``RFSoCRemoteControlFromHost`` to control these devices.</span>
</span><span id="__span-0-1494"><a id="__codelineno-0-1494" name="__codelineno-0-1494"></a>
</span><span id="__span-0-1495"><a id="__codelineno-0-1495" name="__codelineno-0-1495"></a><span class="sd">    Args:</span>
</span><span id="__span-0-1496"><a id="__codelineno-0-1496" name="__codelineno-0-1496"></a><span class="sd">        ID (str): either &#39;DRONE&#39; or &#39;GND&#39;.</span>
</span><span id="__span-0-1497"><a id="__codelineno-0-1497" name="__codelineno-0-1497"></a><span class="sd">        SERVER_ADDRESS (str): the IP address of the ground station.</span>
</span><span id="__span-0-1498"><a id="__codelineno-0-1498" name="__codelineno-0-1498"></a><span class="sd">        DBG_LVL_0 (bool, optional): if set, prints some low-level messages usefull for debugging. Defaults to False.</span>
</span><span id="__span-0-1499"><a id="__codelineno-0-1499" name="__codelineno-0-1499"></a><span class="sd">        DBG_LVL_1 (bool, optional): if set, prints some higher-level messages usefull for debugging. Defaults to False.</span>
</span><span id="__span-0-1500"><a id="__codelineno-0-1500" name="__codelineno-0-1500"></a><span class="sd">        IsGimbal (bool, optional): 0 or FALSE, when no gimbal is physically connected to this host computer; 1, when a Ronin RS2 is physically connected; 2, when a Gremsy H16 is physically connected. Defaults to False.</span>
</span><span id="__span-0-1501"><a id="__codelineno-0-1501" name="__codelineno-0-1501"></a><span class="sd">        IsGPS (bool, optional): True if a gps is physically connected to this host computer. False otherwise. Defaults to False.</span>
</span><span id="__span-0-1502"><a id="__codelineno-0-1502" name="__codelineno-0-1502"></a><span class="sd">        IsSignalGenerator (bool, optional): True if a signal generator controlled by pyvisa commands is physically connected to this host computer. False otherwise. Defaults to False.</span>
</span><span id="__span-0-1503"><a id="__codelineno-0-1503" name="__codelineno-0-1503"></a><span class="sd">        IsRFSoC (bool, optional): True if an RFSoC is physically connected to this host computer. False otherwise. Defaults to False.</span>
</span><span id="__span-0-1504"><a id="__codelineno-0-1504" name="__codelineno-0-1504"></a><span class="sd">        rfsoc_static_ip_address (str, optional): IP address of the RFSoC connected to this host computer. Defaults to None.</span>
</span><span id="__span-0-1505"><a id="__codelineno-0-1505" name="__codelineno-0-1505"></a><span class="sd">        L0 (float, optional): parameter of the signal generator. Defaults to None.</span>
</span><span id="__span-0-1506"><a id="__codelineno-0-1506" name="__codelineno-0-1506"></a><span class="sd">        SPEED (int, optional): the speed of the node in m/s. If this node is GROUND it should be 0 (gnd node does not move) as it is by default. This parameter ONLY incides in raising a warning debug print when the speed of the node is higher than the time difference between consecutive SBF sentences. NOT a crutial parameter at all. Stays here for back compatibility. Defaults to 0.</span>
</span><span id="__span-0-1507"><a id="__codelineno-0-1507" name="__codelineno-0-1507"></a><span class="sd">        GPS_Stream_Interval (str, optional): time interval used for the retrieving of the configured SBF sentences in Septentrio&#39;s receiver connected to this host computer. A list of available options is shown in ``start_gps_data_retrieval`` of class ``GpsSignaling``. Defaults to &#39;msec500&#39;.</span>
</span><span id="__span-0-1508"><a id="__codelineno-0-1508" name="__codelineno-0-1508"></a><span class="sd">        AVG_CALLBACK_TIME_SOCKET_RECEIVE_FCN (float, optional): approximated time between calls of the communication thread. This parameter is used in conjunction with ``MAX_TIME_EMPTY_SOCKETS`` to raise an exception when neither side of the communication link is sending any message. Unfortunately, this is a very simple estimate, since the actual time between calls depends on many factors and is does not remain constant between calls. Defaults to 0.001.</span>
</span><span id="__span-0-1509"><a id="__codelineno-0-1509" name="__codelineno-0-1509"></a><span class="sd">        operating_freq (_type_, optional): operating frequency of the Sivers RF-frontend. The range of defined frequencies is defined in the &quot;User Manual EVK06002&quot; of the Sivers EVK (57-71 GHz). Defaults to 57.51e9.</span>
</span><span id="__span-0-1510"><a id="__codelineno-0-1510" name="__codelineno-0-1510"></a><span class="sd">        heading_offset (int, optional): heading offset (check its definition in the ``GpsSignaling.setHeadingOffset`` method). Defaults to 0.</span>
</span><span id="__span-0-1511"><a id="__codelineno-0-1511" name="__codelineno-0-1511"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-1512"><a id="__codelineno-0-1512" name="__codelineno-0-1512"></a>
</span><span id="__span-0-1513"><a id="__codelineno-0-1513" name="__codelineno-0-1513"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">AVG_CALLBACK_TIME_SOCKET_RECEIVE_FCN</span> <span class="o">=</span> <span class="n">AVG_CALLBACK_TIME_SOCKET_RECEIVE_FCN</span>
</span><span id="__span-0-1514"><a id="__codelineno-0-1514" name="__codelineno-0-1514"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">MAX_TIME_EMPTY_SOCKETS</span> <span class="o">=</span> <span class="mi">20</span> <span class="c1"># in [s]</span>
</span><span id="__span-0-1515"><a id="__codelineno-0-1515" name="__codelineno-0-1515"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">MAX_NUM_RX_EMPTY_SOCKETS</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MAX_TIME_EMPTY_SOCKETS</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">AVG_CALLBACK_TIME_SOCKET_RECEIVE_FCN</span><span class="p">)</span>
</span><span id="__span-0-1516"><a id="__codelineno-0-1516" name="__codelineno-0-1516"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">rxEmptySockCounter</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-0-1517"><a id="__codelineno-0-1517" name="__codelineno-0-1517"></a>
</span><span id="__span-0-1518"><a id="__codelineno-0-1518" name="__codelineno-0-1518"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">=</span> <span class="n">ID</span>
</span><span id="__span-0-1519"><a id="__codelineno-0-1519" name="__codelineno-0-1519"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">SERVER_ADDRESS</span> <span class="o">=</span> <span class="n">SERVER_ADDRESS</span>  
</span><span id="__span-0-1520"><a id="__codelineno-0-1520" name="__codelineno-0-1520"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">SOCKET_BUFFER</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-1521"><a id="__codelineno-0-1521" name="__codelineno-0-1521"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">DBG_LVL_0</span> <span class="o">=</span> <span class="n">DBG_LVL_0</span>
</span><span id="__span-0-1522"><a id="__codelineno-0-1522" name="__codelineno-0-1522"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">DBG_LVL_1</span> <span class="o">=</span> <span class="n">DBG_LVL_1</span>
</span><span id="__span-0-1523"><a id="__codelineno-0-1523" name="__codelineno-0-1523"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">IsGimbal</span> <span class="o">=</span> <span class="n">IsGimbal</span>
</span><span id="__span-0-1524"><a id="__codelineno-0-1524" name="__codelineno-0-1524"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">IsGPS</span> <span class="o">=</span> <span class="n">IsGPS</span>
</span><span id="__span-0-1525"><a id="__codelineno-0-1525" name="__codelineno-0-1525"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">IsRFSoC</span> <span class="o">=</span> <span class="n">IsRFSoC</span>
</span><span id="__span-0-1526"><a id="__codelineno-0-1526" name="__codelineno-0-1526"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">IsSignalGenerator</span> <span class="o">=</span> <span class="n">IsSignalGenerator</span>
</span><span id="__span-0-1527"><a id="__codelineno-0-1527" name="__codelineno-0-1527"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">ERR_HELPER_CODE_GPS_HEAD_UNRELATED_2_COORD</span> <span class="o">=</span> <span class="o">-</span><span class="mf">7.5e3</span> 
</span><span id="__span-0-1528"><a id="__codelineno-0-1528" name="__codelineno-0-1528"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">ERR_HELPER_CODE_GPS_NOT_KNOWN_DATUM</span> <span class="o">=</span> <span class="o">-</span><span class="mf">8.5e3</span>
</span><span id="__span-0-1529"><a id="__codelineno-0-1529" name="__codelineno-0-1529"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">ERR_HELPER_CODE_BOTH_NODES_COORDS_CANTBE_EMPTY</span> <span class="o">=</span> <span class="o">-</span><span class="mf">9.5e3</span>
</span><span id="__span-0-1530"><a id="__codelineno-0-1530" name="__codelineno-0-1530"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">SPEED_NODE</span> <span class="o">=</span> <span class="n">SPEED</span> <span class="c1"># m/s</span>
</span><span id="__span-0-1531"><a id="__codelineno-0-1531" name="__codelineno-0-1531"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">CONN_MUST_OVER_FLAG</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># Usefull for drone side, as its script will poll for looking if this is True</span>
</span><span id="__span-0-1532"><a id="__codelineno-0-1532" name="__codelineno-0-1532"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">PAP_TO_PLOT</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-1533"><a id="__codelineno-0-1533" name="__codelineno-0-1533"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">drone_fm_flag</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="__span-0-1534"><a id="__codelineno-0-1534" name="__codelineno-0-1534"></a>
</span><span id="__span-0-1535"><a id="__codelineno-0-1535" name="__codelineno-0-1535"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">IsGPS</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">IsGPS</span><span class="p">)</span>
</span><span id="__span-0-1536"><a id="__codelineno-0-1536" name="__codelineno-0-1536"></a>
</span><span id="__span-0-1537"><a id="__codelineno-0-1537" name="__codelineno-0-1537"></a>    <span class="k">if</span> <span class="n">IsRFSoC</span><span class="p">:</span>
</span><span id="__span-0-1538"><a id="__codelineno-0-1538" name="__codelineno-0-1538"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">myrfsoc</span> <span class="o">=</span> <span class="n">RFSoCRemoteControlFromHost</span><span class="p">(</span><span class="n">operating_freq</span><span class="o">=</span><span class="n">operating_freq</span><span class="p">,</span> <span class="n">rfsoc_static_ip_address</span><span class="o">=</span><span class="n">rfsoc_static_ip_address</span><span class="p">)</span>
</span><span id="__span-0-1539"><a id="__codelineno-0-1539" name="__codelineno-0-1539"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG]: Created RFSoC class&quot;</span><span class="p">)</span>
</span><span id="__span-0-1540"><a id="__codelineno-0-1540" name="__codelineno-0-1540"></a>    <span class="k">if</span> <span class="n">IsGimbal</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># By default, the TRUE value is GimbalRS2</span>
</span><span id="__span-0-1541"><a id="__codelineno-0-1541" name="__codelineno-0-1541"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">myGimbal</span> <span class="o">=</span> <span class="n">GimbalRS2</span><span class="p">()</span>
</span><span id="__span-0-1542"><a id="__codelineno-0-1542" name="__codelineno-0-1542"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">myGimbal</span><span class="o">.</span><span class="n">start_thread_gimbal</span><span class="p">()</span>
</span><span id="__span-0-1543"><a id="__codelineno-0-1543" name="__codelineno-0-1543"></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="__span-0-1544"><a id="__codelineno-0-1544" name="__codelineno-0-1544"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG]: Created Gimbal class&quot;</span><span class="p">)</span>
</span><span id="__span-0-1545"><a id="__codelineno-0-1545" name="__codelineno-0-1545"></a>    <span class="k">elif</span> <span class="n">IsGimbal</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="__span-0-1546"><a id="__codelineno-0-1546" name="__codelineno-0-1546"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">myGimbal</span> <span class="o">=</span> <span class="n">GimbalGremsyH16</span><span class="p">()</span>
</span><span id="__span-0-1547"><a id="__codelineno-0-1547" name="__codelineno-0-1547"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">myGimbal</span><span class="o">.</span><span class="n">start_thread_gimbal</span><span class="p">()</span>
</span><span id="__span-0-1548"><a id="__codelineno-0-1548" name="__codelineno-0-1548"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG]: Created Gimbal class&quot;</span><span class="p">)</span>
</span><span id="__span-0-1549"><a id="__codelineno-0-1549" name="__codelineno-0-1549"></a>    <span class="k">else</span><span class="p">:</span> <span class="c1"># IsGimbal = False</span>
</span><span id="__span-0-1550"><a id="__codelineno-0-1550" name="__codelineno-0-1550"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG]: No gimbal class is created&quot;</span><span class="p">)</span>
</span><span id="__span-0-1551"><a id="__codelineno-0-1551" name="__codelineno-0-1551"></a>    <span class="k">if</span> <span class="n">IsGPS</span><span class="p">:</span>
</span><span id="__span-0-1552"><a id="__codelineno-0-1552" name="__codelineno-0-1552"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span> <span class="o">=</span> <span class="n">GpsSignaling</span><span class="p">(</span><span class="n">DBG_LVL_2</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">DBG_LVL_1</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">DBG_LVL_0</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-0-1553"><a id="__codelineno-0-1553" name="__codelineno-0-1553"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG]: Created GPS class&quot;</span><span class="p">)</span>
</span><span id="__span-0-1554"><a id="__codelineno-0-1554" name="__codelineno-0-1554"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">serial_connect</span><span class="p">()</span>
</span><span id="__span-0-1555"><a id="__codelineno-0-1555" name="__codelineno-0-1555"></a>
</span><span id="__span-0-1556"><a id="__codelineno-0-1556" name="__codelineno-0-1556"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">GPS_CONN_SUCCESS</span><span class="p">:</span>
</span><span id="__span-0-1557"><a id="__codelineno-0-1557" name="__codelineno-0-1557"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">serial_instance</span><span class="o">.</span><span class="n">reset_input_buffer</span><span class="p">()</span>
</span><span id="__span-0-1558"><a id="__codelineno-0-1558" name="__codelineno-0-1558"></a>
</span><span id="__span-0-1559"><a id="__codelineno-0-1559" name="__codelineno-0-1559"></a>            <span class="c1"># Set the heading offset if any</span>
</span><span id="__span-0-1560"><a id="__codelineno-0-1560" name="__codelineno-0-1560"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">setHeadingOffset</span><span class="p">(</span><span class="n">heading_offset</span><span class="p">)</span>
</span><span id="__span-0-1561"><a id="__codelineno-0-1561" name="__codelineno-0-1561"></a>
</span><span id="__span-0-1562"><a id="__codelineno-0-1562" name="__codelineno-0-1562"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;DRONE&#39;</span><span class="p">:</span>
</span><span id="__span-0-1563"><a id="__codelineno-0-1563" name="__codelineno-0-1563"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">start_gps_data_retrieval</span><span class="p">(</span><span class="n">stream_number</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  <span class="n">msg_type</span><span class="o">=</span><span class="s1">&#39;SBF&#39;</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="n">GPS_Stream_Interval</span><span class="p">,</span> <span class="n">sbf_type</span><span class="o">=</span><span class="s1">&#39;+PVTCartesian+AttEuler&#39;</span><span class="p">)</span>
</span><span id="__span-0-1564"><a id="__codelineno-0-1564" name="__codelineno-0-1564"></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;GROUND&#39;</span><span class="p">:</span>
</span><span id="__span-0-1565"><a id="__codelineno-0-1565" name="__codelineno-0-1565"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">start_gps_data_retrieval</span><span class="p">(</span><span class="n">stream_number</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  <span class="n">msg_type</span><span class="o">=</span><span class="s1">&#39;SBF&#39;</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="n">GPS_Stream_Interval</span><span class="p">,</span> <span class="n">sbf_type</span><span class="o">=</span><span class="s1">&#39;+PVTCartesian+AttEuler&#39;</span><span class="p">)</span>
</span><span id="__span-0-1566"><a id="__codelineno-0-1566" name="__codelineno-0-1566"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG]: started gps stream&quot;</span><span class="p">)</span>
</span><span id="__span-0-1567"><a id="__codelineno-0-1567" name="__codelineno-0-1567"></a>            <span class="c1">#self.mySeptentrioGPS.start_gps_data_retrieval(msg_type=&#39;NMEA&#39;, nmea_type=&#39;GGA&#39;, interval=&#39;sec1&#39;)</span>
</span><span id="__span-0-1568"><a id="__codelineno-0-1568" name="__codelineno-0-1568"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">start_thread_gps</span><span class="p">()</span>
</span><span id="__span-0-1569"><a id="__codelineno-0-1569" name="__codelineno-0-1569"></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="__span-0-1570"><a id="__codelineno-0-1570" name="__codelineno-0-1570"></a>    <span class="k">if</span> <span class="n">IsSignalGenerator</span><span class="p">:</span>
</span><span id="__span-0-1571"><a id="__codelineno-0-1571" name="__codelineno-0-1571"></a>        <span class="n">rm</span> <span class="o">=</span> <span class="n">pyvisa</span><span class="o">.</span><span class="n">ResourceManager</span><span class="p">()</span>
</span><span id="__span-0-1572"><a id="__codelineno-0-1572" name="__codelineno-0-1572"></a>        <span class="n">inst</span> <span class="o">=</span> <span class="n">rm</span><span class="o">.</span><span class="n">open_resource</span><span class="p">(</span><span class="s1">&#39;GPIB0::19::INSTR&#39;</span><span class="p">)</span>
</span><span id="__span-0-1573"><a id="__codelineno-0-1573" name="__codelineno-0-1573"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">inst</span> <span class="o">=</span> <span class="n">inst</span>
</span><span id="__span-0-1574"><a id="__codelineno-0-1574" name="__codelineno-0-1574"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">inst</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;F0 &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">F0</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; GH</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="__span-0-1575"><a id="__codelineno-0-1575" name="__codelineno-0-1575"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">inst</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;L0 &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">L0</span><span class="p">)</span><span class="o">+</span> <span class="s1">&#39; DM</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="__span-0-1576"><a id="__codelineno-0-1576" name="__codelineno-0-1576"></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="a2gmeasurements.HelperA2GMeasurements.az_rot_gnd_gimbal_toggle_sig_generator" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">az_rot_gnd_gimbal_toggle_sig_generator</span><span class="p">(</span><span class="n">Naz</span><span class="p">,</span> <span class="n">meas_time</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Rotates the ground gimbal into "Naz" azimuth steps, while stopping at each angle step, to turn on the signal generator,
wait for it "meas_time"[seconds] to send signal, and turn it off again.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>az_now</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>angle where to start the count. It lies between -1800 and 1800</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>Naz</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>number of sectors in azimuth circle</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>a2gmeasurements.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-2218">2218</a></span>
<span class="normal"><a href="#__codelineno-0-2219">2219</a></span>
<span class="normal"><a href="#__codelineno-0-2220">2220</a></span>
<span class="normal"><a href="#__codelineno-0-2221">2221</a></span>
<span class="normal"><a href="#__codelineno-0-2222">2222</a></span>
<span class="normal"><a href="#__codelineno-0-2223">2223</a></span>
<span class="normal"><a href="#__codelineno-0-2224">2224</a></span>
<span class="normal"><a href="#__codelineno-0-2225">2225</a></span>
<span class="normal"><a href="#__codelineno-0-2226">2226</a></span>
<span class="normal"><a href="#__codelineno-0-2227">2227</a></span>
<span class="normal"><a href="#__codelineno-0-2228">2228</a></span>
<span class="normal"><a href="#__codelineno-0-2229">2229</a></span>
<span class="normal"><a href="#__codelineno-0-2230">2230</a></span>
<span class="normal"><a href="#__codelineno-0-2231">2231</a></span>
<span class="normal"><a href="#__codelineno-0-2232">2232</a></span>
<span class="normal"><a href="#__codelineno-0-2233">2233</a></span>
<span class="normal"><a href="#__codelineno-0-2234">2234</a></span>
<span class="normal"><a href="#__codelineno-0-2235">2235</a></span>
<span class="normal"><a href="#__codelineno-0-2236">2236</a></span>
<span class="normal"><a href="#__codelineno-0-2237">2237</a></span>
<span class="normal"><a href="#__codelineno-0-2238">2238</a></span>
<span class="normal"><a href="#__codelineno-0-2239">2239</a></span>
<span class="normal"><a href="#__codelineno-0-2240">2240</a></span>
<span class="normal"><a href="#__codelineno-0-2241">2241</a></span>
<span class="normal"><a href="#__codelineno-0-2242">2242</a></span>
<span class="normal"><a href="#__codelineno-0-2243">2243</a></span>
<span class="normal"><a href="#__codelineno-0-2244">2244</a></span>
<span class="normal"><a href="#__codelineno-0-2245">2245</a></span>
<span class="normal"><a href="#__codelineno-0-2246">2246</a></span>
<span class="normal"><a href="#__codelineno-0-2247">2247</a></span>
<span class="normal"><a href="#__codelineno-0-2248">2248</a></span>
<span class="normal"><a href="#__codelineno-0-2249">2249</a></span>
<span class="normal"><a href="#__codelineno-0-2250">2250</a></span>
<span class="normal"><a href="#__codelineno-0-2251">2251</a></span>
<span class="normal"><a href="#__codelineno-0-2252">2252</a></span>
<span class="normal"><a href="#__codelineno-0-2253">2253</a></span>
<span class="normal"><a href="#__codelineno-0-2254">2254</a></span>
<span class="normal"><a href="#__codelineno-0-2255">2255</a></span>
<span class="normal"><a href="#__codelineno-0-2256">2256</a></span>
<span class="normal"><a href="#__codelineno-0-2257">2257</a></span>
<span class="normal"><a href="#__codelineno-0-2258">2258</a></span>
<span class="normal"><a href="#__codelineno-0-2259">2259</a></span>
<span class="normal"><a href="#__codelineno-0-2260">2260</a></span>
<span class="normal"><a href="#__codelineno-0-2261">2261</a></span>
<span class="normal"><a href="#__codelineno-0-2262">2262</a></span>
<span class="normal"><a href="#__codelineno-0-2263">2263</a></span>
<span class="normal"><a href="#__codelineno-0-2264">2264</a></span>
<span class="normal"><a href="#__codelineno-0-2265">2265</a></span>
<span class="normal"><a href="#__codelineno-0-2266">2266</a></span>
<span class="normal"><a href="#__codelineno-0-2267">2267</a></span>
<span class="normal"><a href="#__codelineno-0-2268">2268</a></span>
<span class="normal"><a href="#__codelineno-0-2269">2269</a></span>
<span class="normal"><a href="#__codelineno-0-2270">2270</a></span>
<span class="normal"><a href="#__codelineno-0-2271">2271</a></span>
<span class="normal"><a href="#__codelineno-0-2272">2272</a></span>
<span class="normal"><a href="#__codelineno-0-2273">2273</a></span>
<span class="normal"><a href="#__codelineno-0-2274">2274</a></span>
<span class="normal"><a href="#__codelineno-0-2275">2275</a></span>
<span class="normal"><a href="#__codelineno-0-2276">2276</a></span>
<span class="normal"><a href="#__codelineno-0-2277">2277</a></span>
<span class="normal"><a href="#__codelineno-0-2278">2278</a></span>
<span class="normal"><a href="#__codelineno-0-2279">2279</a></span>
<span class="normal"><a href="#__codelineno-0-2280">2280</a></span>
<span class="normal"><a href="#__codelineno-0-2281">2281</a></span>
<span class="normal"><a href="#__codelineno-0-2282">2282</a></span>
<span class="normal"><a href="#__codelineno-0-2283">2283</a></span>
<span class="normal"><a href="#__codelineno-0-2284">2284</a></span>
<span class="normal"><a href="#__codelineno-0-2285">2285</a></span>
<span class="normal"><a href="#__codelineno-0-2286">2286</a></span>
<span class="normal"><a href="#__codelineno-0-2287">2287</a></span>
<span class="normal"><a href="#__codelineno-0-2288">2288</a></span>
<span class="normal"><a href="#__codelineno-0-2289">2289</a></span>
<span class="normal"><a href="#__codelineno-0-2290">2290</a></span>
<span class="normal"><a href="#__codelineno-0-2291">2291</a></span>
<span class="normal"><a href="#__codelineno-0-2292">2292</a></span>
<span class="normal"><a href="#__codelineno-0-2293">2293</a></span>
<span class="normal"><a href="#__codelineno-0-2294">2294</a></span>
<span class="normal"><a href="#__codelineno-0-2295">2295</a></span>
<span class="normal"><a href="#__codelineno-0-2296">2296</a></span>
<span class="normal"><a href="#__codelineno-0-2297">2297</a></span>
<span class="normal"><a href="#__codelineno-0-2298">2298</a></span>
<span class="normal"><a href="#__codelineno-0-2299">2299</a></span>
<span class="normal"><a href="#__codelineno-0-2300">2300</a></span>
<span class="normal"><a href="#__codelineno-0-2301">2301</a></span>
<span class="normal"><a href="#__codelineno-0-2302">2302</a></span>
<span class="normal"><a href="#__codelineno-0-2303">2303</a></span>
<span class="normal"><a href="#__codelineno-0-2304">2304</a></span>
<span class="normal"><a href="#__codelineno-0-2305">2305</a></span>
<span class="normal"><a href="#__codelineno-0-2306">2306</a></span>
<span class="normal"><a href="#__codelineno-0-2307">2307</a></span>
<span class="normal"><a href="#__codelineno-0-2308">2308</a></span>
<span class="normal"><a href="#__codelineno-0-2309">2309</a></span>
<span class="normal"><a href="#__codelineno-0-2310">2310</a></span>
<span class="normal"><a href="#__codelineno-0-2311">2311</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-2218"><a id="__codelineno-0-2218" name="__codelineno-0-2218"></a><span class="k">def</span> <span class="nf">az_rot_gnd_gimbal_toggle_sig_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Naz</span><span class="p">,</span> <span class="n">meas_time</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="__span-0-2219"><a id="__codelineno-0-2219" name="__codelineno-0-2219"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-2220"><a id="__codelineno-0-2220" name="__codelineno-0-2220"></a><span class="sd">    Rotates the ground gimbal into &quot;Naz&quot; azimuth steps, while stopping at each angle step, to turn on the signal generator,</span>
</span><span id="__span-0-2221"><a id="__codelineno-0-2221" name="__codelineno-0-2221"></a><span class="sd">    wait for it &quot;meas_time&quot;[seconds] to send signal, and turn it off again.</span>
</span><span id="__span-0-2222"><a id="__codelineno-0-2222" name="__codelineno-0-2222"></a>
</span><span id="__span-0-2223"><a id="__codelineno-0-2223" name="__codelineno-0-2223"></a><span class="sd">    Args:</span>
</span><span id="__span-0-2224"><a id="__codelineno-0-2224" name="__codelineno-0-2224"></a><span class="sd">        az_now (int): angle where to start the count. It lies between -1800 and 1800</span>
</span><span id="__span-0-2225"><a id="__codelineno-0-2225" name="__codelineno-0-2225"></a><span class="sd">        Naz (int): number of sectors in azimuth circle</span>
</span><span id="__span-0-2226"><a id="__codelineno-0-2226" name="__codelineno-0-2226"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-2227"><a id="__codelineno-0-2227" name="__codelineno-0-2227"></a>
</span><span id="__span-0-2228"><a id="__codelineno-0-2228" name="__codelineno-0-2228"></a>    <span class="k">def</span> <span class="nf">fcn_to_execute</span><span class="p">(</span><span class="n">state</span><span class="p">):</span>
</span><span id="__span-0-2229"><a id="__codelineno-0-2229" name="__codelineno-0-2229"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-2230"><a id="__codelineno-0-2230" name="__codelineno-0-2230"></a><span class="sd">        This local function template must be replaced with the instruction to execute when the ground gimbal</span>
</span><span id="__span-0-2231"><a id="__codelineno-0-2231" name="__codelineno-0-2231"></a><span class="sd">        stops for &#39;meas_time&#39; seconds in a given position. </span>
</span><span id="__span-0-2232"><a id="__codelineno-0-2232" name="__codelineno-0-2232"></a>
</span><span id="__span-0-2233"><a id="__codelineno-0-2233" name="__codelineno-0-2233"></a><span class="sd">        The instruction to execute has to have 2 states: </span>
</span><span id="__span-0-2234"><a id="__codelineno-0-2234" name="__codelineno-0-2234"></a><span class="sd">            &#39;On&#39;) What to execute when ground gimbal just stopped at a new position</span>
</span><span id="__span-0-2235"><a id="__codelineno-0-2235" name="__codelineno-0-2235"></a><span class="sd">            &#39;Off&#39;) What to execute when &#39;meas_time&#39; finishes, and ground gimbal must start again to move to the next position</span>
</span><span id="__span-0-2236"><a id="__codelineno-0-2236" name="__codelineno-0-2236"></a>
</span><span id="__span-0-2237"><a id="__codelineno-0-2237" name="__codelineno-0-2237"></a><span class="sd">        Args:</span>
</span><span id="__span-0-2238"><a id="__codelineno-0-2238" name="__codelineno-0-2238"></a><span class="sd">            state (str): ``On`` or ``Off``</span>
</span><span id="__span-0-2239"><a id="__codelineno-0-2239" name="__codelineno-0-2239"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-0-2240"><a id="__codelineno-0-2240" name="__codelineno-0-2240"></a>
</span><span id="__span-0-2241"><a id="__codelineno-0-2241" name="__codelineno-0-2241"></a>        <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="s1">&#39;On&#39;</span><span class="p">:</span> <span class="c1"># &#39;On&#39; state</span>
</span><span id="__span-0-2242"><a id="__codelineno-0-2242" name="__codelineno-0-2242"></a>            <span class="c1">#self.inst.write(&#39;RF1\n&#39;)</span>
</span><span id="__span-0-2243"><a id="__codelineno-0-2243" name="__codelineno-0-2243"></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">On state... just print&#39;</span><span class="p">)</span>
</span><span id="__span-0-2244"><a id="__codelineno-0-2244" name="__codelineno-0-2244"></a>        <span class="k">elif</span> <span class="n">state</span> <span class="o">==</span> <span class="s1">&#39;Off&#39;</span><span class="p">:</span> <span class="c1"># &#39;Off&#39; state</span>
</span><span id="__span-0-2245"><a id="__codelineno-0-2245" name="__codelineno-0-2245"></a>            <span class="c1">#self.inst.write(&#39;RF0\n&#39;)</span>
</span><span id="__span-0-2246"><a id="__codelineno-0-2246" name="__codelineno-0-2246"></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Off state... just print&#39;</span><span class="p">)</span>
</span><span id="__span-0-2247"><a id="__codelineno-0-2247" name="__codelineno-0-2247"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2248"><a id="__codelineno-0-2248" name="__codelineno-0-2248"></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">[ERROR]: function to execute must toggle between two states&#39;</span><span class="p">)</span>
</span><span id="__span-0-2249"><a id="__codelineno-0-2249" name="__codelineno-0-2249"></a>
</span><span id="__span-0-2250"><a id="__codelineno-0-2250" name="__codelineno-0-2250"></a>    <span class="n">aux_ang_buff</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-2251"><a id="__codelineno-0-2251" name="__codelineno-0-2251"></a>    <span class="n">file_to_save</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-2252"><a id="__codelineno-0-2252" name="__codelineno-0-2252"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">IsGimbal</span><span class="o">!=</span><span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">IsGPS</span><span class="p">:</span>
</span><span id="__span-0-2253"><a id="__codelineno-0-2253" name="__codelineno-0-2253"></a>
</span><span id="__span-0-2254"><a id="__codelineno-0-2254" name="__codelineno-0-2254"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DBG_LVL_1</span><span class="p">:</span>
</span><span id="__span-0-2255"><a id="__codelineno-0-2255" name="__codelineno-0-2255"></a>            <span class="c1"># Remember that reques_current_position is a blocking function</span>
</span><span id="__span-0-2256"><a id="__codelineno-0-2256" name="__codelineno-0-2256"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">myGimbal</span><span class="o">.</span><span class="n">request_current_position</span><span class="p">()</span>
</span><span id="__span-0-2257"><a id="__codelineno-0-2257" name="__codelineno-0-2257"></a>            <span class="n">az_now</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">myGimbal</span><span class="o">.</span><span class="n">yaw</span><span class="p">))</span><span class="o">*</span><span class="mi">10</span>
</span><span id="__span-0-2258"><a id="__codelineno-0-2258" name="__codelineno-0-2258"></a>            <span class="n">pitch_now</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">myGimbal</span><span class="o">.</span><span class="n">pitch</span><span class="p">))</span><span class="o">*</span><span class="mi">10</span>
</span><span id="__span-0-2259"><a id="__codelineno-0-2259" name="__codelineno-0-2259"></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">YAW NOW: &#39;</span><span class="p">,</span> <span class="n">az_now</span><span class="p">,</span> <span class="s1">&#39; PITCH NOW: &#39;</span><span class="p">,</span> <span class="n">pitch_now</span><span class="p">)</span>
</span><span id="__span-0-2260"><a id="__codelineno-0-2260" name="__codelineno-0-2260"></a>
</span><span id="__span-0-2261"><a id="__codelineno-0-2261" name="__codelineno-0-2261"></a>        <span class="n">ang_step</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">3600</span><span class="o">/</span><span class="n">Naz</span><span class="p">)</span>
</span><span id="__span-0-2262"><a id="__codelineno-0-2262" name="__codelineno-0-2262"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Naz</span><span class="p">):</span>                
</span><span id="__span-0-2263"><a id="__codelineno-0-2263" name="__codelineno-0-2263"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">myGimbal</span><span class="o">.</span><span class="n">setPosControl</span><span class="p">(</span><span class="n">yaw</span><span class="o">=</span><span class="n">ang_step</span><span class="p">,</span> <span class="n">roll</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">pitch</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ctrl_byte</span><span class="o">=</span><span class="mh">0x00</span><span class="p">)</span>
</span><span id="__span-0-2264"><a id="__codelineno-0-2264" name="__codelineno-0-2264"></a>
</span><span id="__span-0-2265"><a id="__codelineno-0-2265" name="__codelineno-0-2265"></a>            <span class="c1"># 1. Sleep until ground gimbal reaches the position, before the instruction gets executed</span>
</span><span id="__span-0-2266"><a id="__codelineno-0-2266" name="__codelineno-0-2266"></a>            <span class="c1"># Approximate gimbal speed of 56 deg/s: Max angular movement is 1800 which is done in 3.5 at the actual speed </span>
</span><span id="__span-0-2267"><a id="__codelineno-0-2267" name="__codelineno-0-2267"></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">myGimbal</span><span class="o">.</span><span class="n">TIME2MOVE_180_DEG_YAW</span><span class="p">)</span> 
</span><span id="__span-0-2268"><a id="__codelineno-0-2268" name="__codelineno-0-2268"></a>
</span><span id="__span-0-2269"><a id="__codelineno-0-2269" name="__codelineno-0-2269"></a>            <span class="c1"># 2. Execute instruction state 1</span>
</span><span id="__span-0-2270"><a id="__codelineno-0-2270" name="__codelineno-0-2270"></a>            <span class="n">fcn_to_execute</span><span class="p">(</span><span class="s1">&#39;On&#39;</span><span class="p">)</span>
</span><span id="__span-0-2271"><a id="__codelineno-0-2271" name="__codelineno-0-2271"></a>
</span><span id="__span-0-2272"><a id="__codelineno-0-2272" name="__codelineno-0-2272"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DBG_LVL_1</span><span class="p">:</span>
</span><span id="__span-0-2273"><a id="__codelineno-0-2273" name="__codelineno-0-2273"></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">[WARNING]: in iteration &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; of &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">Naz</span><span class="p">)</span>  <span class="o">+</span><span class="s1">&#39;, instruction executed, now block thread for &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">meas_time</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;  [s]&#39;</span><span class="p">)</span>
</span><span id="__span-0-2274"><a id="__codelineno-0-2274" name="__codelineno-0-2274"></a>
</span><span id="__span-0-2275"><a id="__codelineno-0-2275" name="__codelineno-0-2275"></a>            <span class="c1"># 3. Sleep for &#39;meas_time&#39;, waiting for instruction to be executed</span>
</span><span id="__span-0-2276"><a id="__codelineno-0-2276" name="__codelineno-0-2276"></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">meas_time</span><span class="p">)</span>
</span><span id="__span-0-2277"><a id="__codelineno-0-2277" name="__codelineno-0-2277"></a>
</span><span id="__span-0-2278"><a id="__codelineno-0-2278" name="__codelineno-0-2278"></a>            <span class="c1"># 4. Execute instruction state 0</span>
</span><span id="__span-0-2279"><a id="__codelineno-0-2279" name="__codelineno-0-2279"></a>            <span class="n">fcn_to_execute</span><span class="p">(</span><span class="s1">&#39;Off&#39;</span><span class="p">)</span>
</span><span id="__span-0-2280"><a id="__codelineno-0-2280" name="__codelineno-0-2280"></a>
</span><span id="__span-0-2281"><a id="__codelineno-0-2281" name="__codelineno-0-2281"></a>            <span class="c1"># 5. Get last gps coordinates and save them with gimbal info</span>
</span><span id="__span-0-2282"><a id="__codelineno-0-2282" name="__codelineno-0-2282"></a>            <span class="n">coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">get_last_sbf_buffer_info</span><span class="p">(</span><span class="n">what</span><span class="o">=</span><span class="s1">&#39;Coordinates&#39;</span><span class="p">)</span>
</span><span id="__span-0-2283"><a id="__codelineno-0-2283" name="__codelineno-0-2283"></a>
</span><span id="__span-0-2284"><a id="__codelineno-0-2284" name="__codelineno-0-2284"></a>            <span class="k">if</span> <span class="n">coords</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_BUFF_NULL</span><span class="p">:</span>
</span><span id="__span-0-2285"><a id="__codelineno-0-2285" name="__codelineno-0-2285"></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">[ERROR]: gps sbf stream not started or not a single entry in buffer yet&#39;</span><span class="p">)</span>
</span><span id="__span-0-2286"><a id="__codelineno-0-2286" name="__codelineno-0-2286"></a>                <span class="k">return</span> 
</span><span id="__span-0-2287"><a id="__codelineno-0-2287" name="__codelineno-0-2287"></a>            <span class="k">elif</span> <span class="n">coords</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_NO_COORD_AVAIL</span><span class="p">:</span>
</span><span id="__span-0-2288"><a id="__codelineno-0-2288" name="__codelineno-0-2288"></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">[ERROR]: gps stream started but not enough satellites or strong multipath propagation interference&#39;</span><span class="p">)</span>
</span><span id="__span-0-2289"><a id="__codelineno-0-2289" name="__codelineno-0-2289"></a>                <span class="k">return</span> 
</span><span id="__span-0-2290"><a id="__codelineno-0-2290" name="__codelineno-0-2290"></a>            <span class="k">else</span><span class="p">:</span>                    
</span><span id="__span-0-2291"><a id="__codelineno-0-2291" name="__codelineno-0-2291"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">myGimbal</span><span class="o">.</span><span class="n">request_current_position</span><span class="p">()</span>
</span><span id="__span-0-2292"><a id="__codelineno-0-2292" name="__codelineno-0-2292"></a>
</span><span id="__span-0-2293"><a id="__codelineno-0-2293" name="__codelineno-0-2293"></a>                <span class="n">coords</span><span class="p">[</span><span class="s1">&#39;GROUND_GIMBAL_YAW&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">myGimbal</span><span class="o">.</span><span class="n">yaw</span>
</span><span id="__span-0-2294"><a id="__codelineno-0-2294" name="__codelineno-0-2294"></a>                <span class="n">coords</span><span class="p">[</span><span class="s1">&#39;GROUND_GIMBAL_PITCH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">myGimbal</span><span class="o">.</span><span class="n">pitch</span>
</span><span id="__span-0-2295"><a id="__codelineno-0-2295" name="__codelineno-0-2295"></a>                <span class="n">file_to_save</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
</span><span id="__span-0-2296"><a id="__codelineno-0-2296" name="__codelineno-0-2296"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2297"><a id="__codelineno-0-2297" name="__codelineno-0-2297"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">[ERROR]: To call this function, IsGimbal and IsGPS have to be set&#39;</span><span class="p">)</span>
</span><span id="__span-0-2298"><a id="__codelineno-0-2298" name="__codelineno-0-2298"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">[WARNING]: No file with coordinates and gimbal yaw, pitch saved&#39;</span><span class="p">)</span>
</span><span id="__span-0-2299"><a id="__codelineno-0-2299" name="__codelineno-0-2299"></a>        <span class="k">return</span> 
</span><span id="__span-0-2300"><a id="__codelineno-0-2300" name="__codelineno-0-2300"></a>
</span><span id="__span-0-2301"><a id="__codelineno-0-2301" name="__codelineno-0-2301"></a>    <span class="n">file_to_save</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">file_to_save</span><span class="p">)</span>
</span><span id="__span-0-2302"><a id="__codelineno-0-2302" name="__codelineno-0-2302"></a>    <span class="n">fid</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.json&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="c1"># this overwrites the file</span>
</span><span id="__span-0-2303"><a id="__codelineno-0-2303" name="__codelineno-0-2303"></a>    <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">file_to_save</span><span class="p">)</span>
</span><span id="__span-0-2304"><a id="__codelineno-0-2304" name="__codelineno-0-2304"></a>    <span class="n">fid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="__span-0-2305"><a id="__codelineno-0-2305" name="__codelineno-0-2305"></a>
</span><span id="__span-0-2306"><a id="__codelineno-0-2306" name="__codelineno-0-2306"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DBG_LVL_1</span><span class="p">:</span>
</span><span id="__span-0-2307"><a id="__codelineno-0-2307" name="__codelineno-0-2307"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">File &#39;</span> <span class="o">+</span> <span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39; saved&#39;</span><span class="p">)</span>
</span><span id="__span-0-2308"><a id="__codelineno-0-2308" name="__codelineno-0-2308"></a>
</span><span id="__span-0-2309"><a id="__codelineno-0-2309" name="__codelineno-0-2309"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Naz</span><span class="p">):</span>
</span><span id="__span-0-2310"><a id="__codelineno-0-2310" name="__codelineno-0-2310"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">myGimbal</span><span class="o">.</span><span class="n">setPosControl</span><span class="p">(</span><span class="n">yaw</span><span class="o">=-</span><span class="n">ang_step</span><span class="p">,</span> <span class="n">pitch</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">roll</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ctrl_byte</span><span class="o">=</span><span class="mh">0x00</span><span class="p">)</span>
</span><span id="__span-0-2311"><a id="__codelineno-0-2311" name="__codelineno-0-2311"></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">myGimbal</span><span class="o">.</span><span class="n">TIME2MOVE_180_DEG_YAW</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="a2gmeasurements.HelperA2GMeasurements.decode_message" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">decode_message</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Parses an incoming TCP message and calls the appropriate function to handle it. </p>
<p>This function is called by <code>socket_receive</code> (the communication thread callback).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>data</code></td>
            <td>
                  <code>bytes</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>raw data to be decoded</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>a2gmeasurements.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1986">1986</a></span>
<span class="normal"><a href="#__codelineno-0-1987">1987</a></span>
<span class="normal"><a href="#__codelineno-0-1988">1988</a></span>
<span class="normal"><a href="#__codelineno-0-1989">1989</a></span>
<span class="normal"><a href="#__codelineno-0-1990">1990</a></span>
<span class="normal"><a href="#__codelineno-0-1991">1991</a></span>
<span class="normal"><a href="#__codelineno-0-1992">1992</a></span>
<span class="normal"><a href="#__codelineno-0-1993">1993</a></span>
<span class="normal"><a href="#__codelineno-0-1994">1994</a></span>
<span class="normal"><a href="#__codelineno-0-1995">1995</a></span>
<span class="normal"><a href="#__codelineno-0-1996">1996</a></span>
<span class="normal"><a href="#__codelineno-0-1997">1997</a></span>
<span class="normal"><a href="#__codelineno-0-1998">1998</a></span>
<span class="normal"><a href="#__codelineno-0-1999">1999</a></span>
<span class="normal"><a href="#__codelineno-0-2000">2000</a></span>
<span class="normal"><a href="#__codelineno-0-2001">2001</a></span>
<span class="normal"><a href="#__codelineno-0-2002">2002</a></span>
<span class="normal"><a href="#__codelineno-0-2003">2003</a></span>
<span class="normal"><a href="#__codelineno-0-2004">2004</a></span>
<span class="normal"><a href="#__codelineno-0-2005">2005</a></span>
<span class="normal"><a href="#__codelineno-0-2006">2006</a></span>
<span class="normal"><a href="#__codelineno-0-2007">2007</a></span>
<span class="normal"><a href="#__codelineno-0-2008">2008</a></span>
<span class="normal"><a href="#__codelineno-0-2009">2009</a></span>
<span class="normal"><a href="#__codelineno-0-2010">2010</a></span>
<span class="normal"><a href="#__codelineno-0-2011">2011</a></span>
<span class="normal"><a href="#__codelineno-0-2012">2012</a></span>
<span class="normal"><a href="#__codelineno-0-2013">2013</a></span>
<span class="normal"><a href="#__codelineno-0-2014">2014</a></span>
<span class="normal"><a href="#__codelineno-0-2015">2015</a></span>
<span class="normal"><a href="#__codelineno-0-2016">2016</a></span>
<span class="normal"><a href="#__codelineno-0-2017">2017</a></span>
<span class="normal"><a href="#__codelineno-0-2018">2018</a></span>
<span class="normal"><a href="#__codelineno-0-2019">2019</a></span>
<span class="normal"><a href="#__codelineno-0-2020">2020</a></span>
<span class="normal"><a href="#__codelineno-0-2021">2021</a></span>
<span class="normal"><a href="#__codelineno-0-2022">2022</a></span>
<span class="normal"><a href="#__codelineno-0-2023">2023</a></span>
<span class="normal"><a href="#__codelineno-0-2024">2024</a></span>
<span class="normal"><a href="#__codelineno-0-2025">2025</a></span>
<span class="normal"><a href="#__codelineno-0-2026">2026</a></span>
<span class="normal"><a href="#__codelineno-0-2027">2027</a></span>
<span class="normal"><a href="#__codelineno-0-2028">2028</a></span>
<span class="normal"><a href="#__codelineno-0-2029">2029</a></span>
<span class="normal"><a href="#__codelineno-0-2030">2030</a></span>
<span class="normal"><a href="#__codelineno-0-2031">2031</a></span>
<span class="normal"><a href="#__codelineno-0-2032">2032</a></span>
<span class="normal"><a href="#__codelineno-0-2033">2033</a></span>
<span class="normal"><a href="#__codelineno-0-2034">2034</a></span>
<span class="normal"><a href="#__codelineno-0-2035">2035</a></span>
<span class="normal"><a href="#__codelineno-0-2036">2036</a></span>
<span class="normal"><a href="#__codelineno-0-2037">2037</a></span>
<span class="normal"><a href="#__codelineno-0-2038">2038</a></span>
<span class="normal"><a href="#__codelineno-0-2039">2039</a></span>
<span class="normal"><a href="#__codelineno-0-2040">2040</a></span>
<span class="normal"><a href="#__codelineno-0-2041">2041</a></span>
<span class="normal"><a href="#__codelineno-0-2042">2042</a></span>
<span class="normal"><a href="#__codelineno-0-2043">2043</a></span>
<span class="normal"><a href="#__codelineno-0-2044">2044</a></span>
<span class="normal"><a href="#__codelineno-0-2045">2045</a></span>
<span class="normal"><a href="#__codelineno-0-2046">2046</a></span>
<span class="normal"><a href="#__codelineno-0-2047">2047</a></span>
<span class="normal"><a href="#__codelineno-0-2048">2048</a></span>
<span class="normal"><a href="#__codelineno-0-2049">2049</a></span>
<span class="normal"><a href="#__codelineno-0-2050">2050</a></span>
<span class="normal"><a href="#__codelineno-0-2051">2051</a></span>
<span class="normal"><a href="#__codelineno-0-2052">2052</a></span>
<span class="normal"><a href="#__codelineno-0-2053">2053</a></span>
<span class="normal"><a href="#__codelineno-0-2054">2054</a></span>
<span class="normal"><a href="#__codelineno-0-2055">2055</a></span>
<span class="normal"><a href="#__codelineno-0-2056">2056</a></span>
<span class="normal"><a href="#__codelineno-0-2057">2057</a></span>
<span class="normal"><a href="#__codelineno-0-2058">2058</a></span>
<span class="normal"><a href="#__codelineno-0-2059">2059</a></span>
<span class="normal"><a href="#__codelineno-0-2060">2060</a></span>
<span class="normal"><a href="#__codelineno-0-2061">2061</a></span>
<span class="normal"><a href="#__codelineno-0-2062">2062</a></span>
<span class="normal"><a href="#__codelineno-0-2063">2063</a></span>
<span class="normal"><a href="#__codelineno-0-2064">2064</a></span>
<span class="normal"><a href="#__codelineno-0-2065">2065</a></span>
<span class="normal"><a href="#__codelineno-0-2066">2066</a></span>
<span class="normal"><a href="#__codelineno-0-2067">2067</a></span>
<span class="normal"><a href="#__codelineno-0-2068">2068</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1986"><a id="__codelineno-0-1986" name="__codelineno-0-1986"></a><span class="k">def</span> <span class="nf">decode_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span><span id="__span-0-1987"><a id="__codelineno-0-1987" name="__codelineno-0-1987"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-1988"><a id="__codelineno-0-1988" name="__codelineno-0-1988"></a><span class="sd">    Parses an incoming TCP message and calls the appropriate function to handle it. </span>
</span><span id="__span-0-1989"><a id="__codelineno-0-1989" name="__codelineno-0-1989"></a>
</span><span id="__span-0-1990"><a id="__codelineno-0-1990" name="__codelineno-0-1990"></a><span class="sd">    This function is called by ``socket_receive`` (the communication thread callback).</span>
</span><span id="__span-0-1991"><a id="__codelineno-0-1991" name="__codelineno-0-1991"></a>
</span><span id="__span-0-1992"><a id="__codelineno-0-1992" name="__codelineno-0-1992"></a><span class="sd">    Args:</span>
</span><span id="__span-0-1993"><a id="__codelineno-0-1993" name="__codelineno-0-1993"></a><span class="sd">        data (bytes): raw data to be decoded</span>
</span><span id="__span-0-1994"><a id="__codelineno-0-1994" name="__codelineno-0-1994"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-1995"><a id="__codelineno-0-1995" name="__codelineno-0-1995"></a>
</span><span id="__span-0-1996"><a id="__codelineno-0-1996" name="__codelineno-0-1996"></a>    <span class="n">source_id</span><span class="p">,</span> <span class="n">destination_id</span><span class="p">,</span> <span class="n">message_type</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">length</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;BBBBB&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
</span><span id="__span-0-1997"><a id="__codelineno-0-1997" name="__codelineno-0-1997"></a>    <span class="n">data_bytes</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span>
</span><span id="__span-0-1998"><a id="__codelineno-0-1998" name="__codelineno-0-1998"></a>
</span><span id="__span-0-1999"><a id="__codelineno-0-1999" name="__codelineno-0-1999"></a>    <span class="k">if</span> <span class="n">message_type</span> <span class="o">==</span> <span class="mh">0x01</span><span class="p">:</span> <span class="c1"># SHORT cmd type message</span>
</span><span id="__span-0-2000"><a id="__codelineno-0-2000" name="__codelineno-0-2000"></a>        <span class="k">if</span> <span class="n">cmd</span> <span class="o">==</span> <span class="mh">0x01</span> <span class="ow">and</span> <span class="n">length</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># FOLLOWGIMBAL</span>
</span><span id="__span-0-2001"><a id="__codelineno-0-2001" name="__codelineno-0-2001"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG]: THIS </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="si">}</span><span class="s2"> receives FOLLOWGIMBAL cmd&quot;</span><span class="p">)</span>
</span><span id="__span-0-2002"><a id="__codelineno-0-2002" name="__codelineno-0-2002"></a>            <span class="n">data_bytes</span> <span class="o">=</span> <span class="n">data_bytes</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-0-2003"><a id="__codelineno-0-2003" name="__codelineno-0-2003"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">do_follow_mode_gimbal</span><span class="p">(</span><span class="n">fmode</span><span class="o">=</span><span class="n">data_bytes</span><span class="p">)</span>
</span><span id="__span-0-2004"><a id="__codelineno-0-2004" name="__codelineno-0-2004"></a>        <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="mh">0x02</span> <span class="ow">and</span> <span class="n">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># GETGPS</span>
</span><span id="__span-0-2005"><a id="__codelineno-0-2005" name="__codelineno-0-2005"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG]: THIS </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="si">}</span><span class="s2"> receives GETGPS cmd&quot;</span><span class="p">)</span>
</span><span id="__span-0-2006"><a id="__codelineno-0-2006" name="__codelineno-0-2006"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">do_getgps_action</span><span class="p">()</span>
</span><span id="__span-0-2007"><a id="__codelineno-0-2007" name="__codelineno-0-2007"></a>        <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="mh">0x03</span> <span class="ow">and</span> <span class="n">length</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span> <span class="c1"># SETGIMBAL</span>
</span><span id="__span-0-2008"><a id="__codelineno-0-2008" name="__codelineno-0-2008"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG]: THIS </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="si">}</span><span class="s2"> receives SETGIMBAL cmd&quot;</span><span class="p">)</span>
</span><span id="__span-0-2009"><a id="__codelineno-0-2009" name="__codelineno-0-2009"></a>            <span class="n">data_bytes</span> <span class="o">=</span> <span class="n">data_bytes</span><span class="p">[:</span><span class="mi">13</span><span class="p">]</span> <span class="c1"># 3 float32 array entries + 1 byte</span>
</span><span id="__span-0-2010"><a id="__codelineno-0-2010" name="__codelineno-0-2010"></a>            <span class="n">yaw</span><span class="p">,</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">roll</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;fffB&#39;</span><span class="p">,</span> <span class="n">data_bytes</span><span class="p">)</span>
</span><span id="__span-0-2011"><a id="__codelineno-0-2011" name="__codelineno-0-2011"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">do_setgimbal_action</span><span class="p">({</span><span class="s1">&#39;YAW&#39;</span><span class="p">:</span> <span class="n">yaw</span><span class="p">,</span> <span class="s1">&#39;ROLL&#39;</span><span class="p">:</span> <span class="n">roll</span><span class="p">,</span> <span class="s1">&#39;PITCH&#39;</span><span class="p">:</span> <span class="n">pitch</span><span class="p">,</span> <span class="s1">&#39;MODE&#39;</span><span class="p">:</span> <span class="n">mode</span><span class="p">})</span>
</span><span id="__span-0-2012"><a id="__codelineno-0-2012" name="__codelineno-0-2012"></a>        <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="mh">0x04</span> <span class="ow">and</span> <span class="n">length</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span> <span class="c1"># STARTDRONERFSOC</span>
</span><span id="__span-0-2013"><a id="__codelineno-0-2013" name="__codelineno-0-2013"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG]: THIS </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="si">}</span><span class="s2"> receives STARTDRONERFSOC cmd&quot;</span><span class="p">)</span>
</span><span id="__span-0-2014"><a id="__codelineno-0-2014" name="__codelineno-0-2014"></a>            <span class="n">data_bytes</span> <span class="o">=</span> <span class="n">data_bytes</span><span class="p">[:</span><span class="mi">12</span><span class="p">]</span> <span class="c1"># 1 float32 and 4 int16</span>
</span><span id="__span-0-2015"><a id="__codelineno-0-2015" name="__codelineno-0-2015"></a>            <span class="n">carr_freq</span><span class="p">,</span> <span class="n">rx_1</span><span class="p">,</span> <span class="n">rx_2</span><span class="p">,</span> <span class="n">rx_3</span><span class="p">,</span> <span class="n">rx_bfrf</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;fHHHH&#39;</span><span class="p">,</span> <span class="n">data_bytes</span><span class="p">)</span>
</span><span id="__span-0-2016"><a id="__codelineno-0-2016" name="__codelineno-0-2016"></a>
</span><span id="__span-0-2017"><a id="__codelineno-0-2017" name="__codelineno-0-2017"></a>            <span class="c1"># float round-error check</span>
</span><span id="__span-0-2018"><a id="__codelineno-0-2018" name="__codelineno-0-2018"></a>            <span class="k">if</span> <span class="n">carr_freq</span> <span class="o">&gt;</span> <span class="mf">70e9</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">carr_freq</span><span class="o">-</span><span class="mf">70e9</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1500</span><span class="p">:</span> <span class="c1"># float round-error of 1.5 kHz</span>
</span><span id="__span-0-2019"><a id="__codelineno-0-2019" name="__codelineno-0-2019"></a>                <span class="n">carr_freq</span> <span class="o">=</span> <span class="mf">70e9</span>
</span><span id="__span-0-2020"><a id="__codelineno-0-2020" name="__codelineno-0-2020"></a>            <span class="k">elif</span> <span class="n">carr_freq</span> <span class="o">&lt;</span> <span class="mf">57.51e9</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">carr_freq</span><span class="o">-</span><span class="mf">57.51e9</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1500</span><span class="p">:</span> <span class="c1">#float round-error of 1.5 kHz</span>
</span><span id="__span-0-2021"><a id="__codelineno-0-2021" name="__codelineno-0-2021"></a>                <span class="n">carr_freq</span> <span class="o">=</span> <span class="mf">57.51e9</span>
</span><span id="__span-0-2022"><a id="__codelineno-0-2022" name="__codelineno-0-2022"></a>            <span class="n">msg_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;carrier_freq&#39;</span><span class="p">:</span> <span class="n">carr_freq</span><span class="p">,</span>
</span><span id="__span-0-2023"><a id="__codelineno-0-2023" name="__codelineno-0-2023"></a>                        <span class="s1">&#39;rx_gain_ctrl_bb1&#39;</span><span class="p">:</span> <span class="n">rx_1</span><span class="p">,</span>
</span><span id="__span-0-2024"><a id="__codelineno-0-2024" name="__codelineno-0-2024"></a>                        <span class="s1">&#39;rx_gain_ctrl_bb2&#39;</span><span class="p">:</span> <span class="n">rx_2</span><span class="p">,</span>
</span><span id="__span-0-2025"><a id="__codelineno-0-2025" name="__codelineno-0-2025"></a>                        <span class="s1">&#39;rx_gain_ctrl_bb3&#39;</span><span class="p">:</span> <span class="n">rx_3</span><span class="p">,</span>
</span><span id="__span-0-2026"><a id="__codelineno-0-2026" name="__codelineno-0-2026"></a>                        <span class="s1">&#39;rx_gain_ctrl_bfrf&#39;</span><span class="p">:</span> <span class="n">rx_bfrf</span><span class="p">}</span>
</span><span id="__span-0-2027"><a id="__codelineno-0-2027" name="__codelineno-0-2027"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">do_start_meas_drone_rfsoc</span><span class="p">(</span><span class="n">msg_data</span><span class="p">)</span>
</span><span id="__span-0-2028"><a id="__codelineno-0-2028" name="__codelineno-0-2028"></a>        <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="mh">0x05</span> <span class="ow">and</span> <span class="n">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># STOPDRONERFSOC</span>
</span><span id="__span-0-2029"><a id="__codelineno-0-2029" name="__codelineno-0-2029"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG]: THIS </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="si">}</span><span class="s2"> receives STOPDRONERFSOC cmd&quot;</span><span class="p">)</span>
</span><span id="__span-0-2030"><a id="__codelineno-0-2030" name="__codelineno-0-2030"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">do_stop_meas_drone_rfsoc</span><span class="p">()</span>
</span><span id="__span-0-2031"><a id="__codelineno-0-2031" name="__codelineno-0-2031"></a>        <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="mh">0x06</span> <span class="ow">and</span> <span class="n">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># FINISHDRONERFSOC</span>
</span><span id="__span-0-2032"><a id="__codelineno-0-2032" name="__codelineno-0-2032"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG]: THIS </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="si">}</span><span class="s2"> receives FINISHDRONERFSOC cmd&quot;</span><span class="p">)</span>
</span><span id="__span-0-2033"><a id="__codelineno-0-2033" name="__codelineno-0-2033"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">do_finish_meas_drone_rfsoc</span><span class="p">()</span>
</span><span id="__span-0-2034"><a id="__codelineno-0-2034" name="__codelineno-0-2034"></a>        <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="mh">0x07</span> <span class="ow">and</span> <span class="n">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># CLOSEDGUI</span>
</span><span id="__span-0-2035"><a id="__codelineno-0-2035" name="__codelineno-0-2035"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG]: THIS </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="si">}</span><span class="s2"> receives CLOSEDGUI cmd&quot;</span><span class="p">)</span>
</span><span id="__span-0-2036"><a id="__codelineno-0-2036" name="__codelineno-0-2036"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">do_closed_gui_action</span><span class="p">()</span>
</span><span id="__span-0-2037"><a id="__codelineno-0-2037" name="__codelineno-0-2037"></a>        <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="mh">0x08</span> <span class="ow">and</span> <span class="n">length</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span> <span class="c1"># SETREMOTEFMFLAG</span>
</span><span id="__span-0-2038"><a id="__codelineno-0-2038" name="__codelineno-0-2038"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG]: THIS </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="si">}</span><span class="s2"> receives SETREMOTEFMFLAG cmd&quot;</span><span class="p">)</span>
</span><span id="__span-0-2039"><a id="__codelineno-0-2039" name="__codelineno-0-2039"></a>            <span class="n">data_bytes</span> <span class="o">=</span> <span class="n">data_bytes</span><span class="p">[:</span><span class="mi">26</span><span class="p">]</span> <span class="c1"># 3 float64, 2 hex</span>
</span><span id="__span-0-2040"><a id="__codelineno-0-2040" name="__codelineno-0-2040"></a>            <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">fmode</span><span class="p">,</span><span class="n">mobility</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;dddBB&#39;</span><span class="p">,</span> <span class="n">data_bytes</span><span class="p">)</span>
</span><span id="__span-0-2041"><a id="__codelineno-0-2041" name="__codelineno-0-2041"></a>            <span class="n">mydata</span> <span class="o">=</span><span class="p">{</span><span class="s1">&#39;X&#39;</span><span class="p">:</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span><span class="n">y</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">:</span><span class="n">z</span><span class="p">,</span> <span class="s1">&#39;FMODE&#39;</span><span class="p">:</span> <span class="n">fmode</span><span class="p">,</span> <span class="s1">&#39;MOBILITY&#39;</span><span class="p">:</span> <span class="n">mobility</span><span class="p">}</span>
</span><span id="__span-0-2042"><a id="__codelineno-0-2042" name="__codelineno-0-2042"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">do_set_remote_fm_flag</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mydata</span><span class="p">)</span>
</span><span id="__span-0-2043"><a id="__codelineno-0-2043" name="__codelineno-0-2043"></a>        <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="mh">0x09</span> <span class="ow">and</span> <span class="n">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># SETREMOTESTOPFM</span>
</span><span id="__span-0-2044"><a id="__codelineno-0-2044" name="__codelineno-0-2044"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG]: THIS </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="si">}</span><span class="s2"> receives SETREMOTESTOPFM cmd&quot;</span><span class="p">)</span>
</span><span id="__span-0-2045"><a id="__codelineno-0-2045" name="__codelineno-0-2045"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">do_set_remote_stop_fm</span><span class="p">()</span>
</span><span id="__span-0-2046"><a id="__codelineno-0-2046" name="__codelineno-0-2046"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2047"><a id="__codelineno-0-2047" name="__codelineno-0-2047"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[WARNING]: cmd not known when decoding.  No action will be done&quot;</span><span class="p">)</span>
</span><span id="__span-0-2048"><a id="__codelineno-0-2048" name="__codelineno-0-2048"></a>    <span class="k">elif</span> <span class="n">message_type</span> <span class="o">==</span> <span class="mh">0x02</span><span class="p">:</span> <span class="c1"># LONG cmd type msg</span>
</span><span id="__span-0-2049"><a id="__codelineno-0-2049" name="__codelineno-0-2049"></a>        <span class="k">if</span> <span class="n">cmd</span> <span class="o">==</span> <span class="mh">0x01</span><span class="p">:</span> <span class="c1"># SETIRF</span>
</span><span id="__span-0-2050"><a id="__codelineno-0-2050" name="__codelineno-0-2050"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG]: THIS </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="si">}</span><span class="s2"> receives SETIRF cmd. Time snaps: </span><span class="si">{</span><span class="n">length</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-0-2051"><a id="__codelineno-0-2051" name="__codelineno-0-2051"></a>            <span class="n">last</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">length</span><span class="o">*</span><span class="mi">16</span><span class="p">)</span> <span class="c1"># The data type of the array entries is float32 and it will have always 16 beams and variable number of time snapshots</span>
</span><span id="__span-0-2052"><a id="__codelineno-0-2052" name="__codelineno-0-2052"></a>            <span class="n">data_bytes</span> <span class="o">=</span> <span class="n">data_bytes</span><span class="p">[:</span><span class="n">last</span><span class="p">]</span>
</span><span id="__span-0-2053"><a id="__codelineno-0-2053" name="__codelineno-0-2053"></a>            <span class="n">data_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data_bytes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="__span-0-2054"><a id="__codelineno-0-2054" name="__codelineno-0-2054"></a>            <span class="n">data_array</span> <span class="o">=</span> <span class="n">data_array</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">length</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>
</span><span id="__span-0-2055"><a id="__codelineno-0-2055" name="__codelineno-0-2055"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">do_set_irf_action</span><span class="p">(</span><span class="n">data_array</span><span class="p">)</span>
</span><span id="__span-0-2056"><a id="__codelineno-0-2056" name="__codelineno-0-2056"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2057"><a id="__codelineno-0-2057" name="__codelineno-0-2057"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[WARNING]: cmd not known when decoding.  No action will be done&quot;</span><span class="p">)</span>
</span><span id="__span-0-2058"><a id="__codelineno-0-2058" name="__codelineno-0-2058"></a>    <span class="k">elif</span> <span class="n">message_type</span> <span class="o">==</span> <span class="mh">0x03</span><span class="p">:</span> <span class="c1"># ANS type</span>
</span><span id="__span-0-2059"><a id="__codelineno-0-2059" name="__codelineno-0-2059"></a>        <span class="k">if</span> <span class="n">cmd</span> <span class="o">==</span> <span class="mh">0x01</span><span class="p">:</span> <span class="c1"># Response to GETGPS</span>
</span><span id="__span-0-2060"><a id="__codelineno-0-2060" name="__codelineno-0-2060"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;[DEBUG]: THIS (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="si">}</span><span class="s1">) receives ANS to GETGPS cmd&#39;</span><span class="p">)</span>
</span><span id="__span-0-2061"><a id="__codelineno-0-2061" name="__codelineno-0-2061"></a>            <span class="n">data_bytes</span> <span class="o">=</span> <span class="n">data_bytes</span><span class="p">[:</span><span class="mi">27</span><span class="p">]</span>
</span><span id="__span-0-2062"><a id="__codelineno-0-2062" name="__codelineno-0-2062"></a>            <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">datum</span><span class="p">,</span><span class="n">follow_gimbal</span><span class="p">,</span> <span class="n">fmode</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;dddBBB&#39;</span><span class="p">,</span> <span class="n">data_bytes</span><span class="p">)</span>
</span><span id="__span-0-2063"><a id="__codelineno-0-2063" name="__codelineno-0-2063"></a>            <span class="n">msg_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">:</span> <span class="n">z</span><span class="p">,</span> <span class="s1">&#39;Datum&#39;</span><span class="p">:</span> <span class="n">datum</span><span class="p">,</span> <span class="s1">&#39;FOLLOW_GIMBAL&#39;</span><span class="p">:</span> <span class="n">follow_gimbal</span><span class="p">,</span> <span class="s1">&#39;FMODE&#39;</span><span class="p">:</span> <span class="n">fmode</span><span class="p">}</span>
</span><span id="__span-0-2064"><a id="__codelineno-0-2064" name="__codelineno-0-2064"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">process_answer_get_gps</span><span class="p">(</span><span class="n">msg_data</span><span class="p">)</span>
</span><span id="__span-0-2065"><a id="__codelineno-0-2065" name="__codelineno-0-2065"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2066"><a id="__codelineno-0-2066" name="__codelineno-0-2066"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[WARNING]: cmd not known when decoding.  No action will be done&quot;</span><span class="p">)</span>
</span><span id="__span-0-2067"><a id="__codelineno-0-2067" name="__codelineno-0-2067"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2068"><a id="__codelineno-0-2068" name="__codelineno-0-2068"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[WARNING]: message_type not known when decoding. No action will be done&quot;</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="a2gmeasurements.HelperA2GMeasurements.do_closed_gui_action" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">do_closed_gui_action</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Callback function when this node receives a <code>CLOSEDGUI</code> command.</p>
<p>This comand is unidirectional. It is always sent by the ground node to the drone node.</p>
<p>Sets a flag indicating (the drone node) that it can end its main script, since the GUI was closed by the user at the ground node.</p>

            <details class="quote">
              <summary>Source code in <code>a2gmeasurements.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1864">1864</a></span>
<span class="normal"><a href="#__codelineno-0-1865">1865</a></span>
<span class="normal"><a href="#__codelineno-0-1866">1866</a></span>
<span class="normal"><a href="#__codelineno-0-1867">1867</a></span>
<span class="normal"><a href="#__codelineno-0-1868">1868</a></span>
<span class="normal"><a href="#__codelineno-0-1869">1869</a></span>
<span class="normal"><a href="#__codelineno-0-1870">1870</a></span>
<span class="normal"><a href="#__codelineno-0-1871">1871</a></span>
<span class="normal"><a href="#__codelineno-0-1872">1872</a></span>
<span class="normal"><a href="#__codelineno-0-1873">1873</a></span>
<span class="normal"><a href="#__codelineno-0-1874">1874</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1864"><a id="__codelineno-0-1864" name="__codelineno-0-1864"></a><span class="k">def</span> <span class="nf">do_closed_gui_action</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-1865"><a id="__codelineno-0-1865" name="__codelineno-0-1865"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-1866"><a id="__codelineno-0-1866" name="__codelineno-0-1866"></a><span class="sd">    Callback function when this node receives a ``CLOSEDGUI`` command.</span>
</span><span id="__span-0-1867"><a id="__codelineno-0-1867" name="__codelineno-0-1867"></a>
</span><span id="__span-0-1868"><a id="__codelineno-0-1868" name="__codelineno-0-1868"></a><span class="sd">    This comand is unidirectional. It is always sent by the ground node to the drone node.</span>
</span><span id="__span-0-1869"><a id="__codelineno-0-1869" name="__codelineno-0-1869"></a>
</span><span id="__span-0-1870"><a id="__codelineno-0-1870" name="__codelineno-0-1870"></a><span class="sd">    Sets a flag indicating (the drone node) that it can end its main script, since the GUI was closed by the user at the ground node.</span>
</span><span id="__span-0-1871"><a id="__codelineno-0-1871" name="__codelineno-0-1871"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-1872"><a id="__codelineno-0-1872" name="__codelineno-0-1872"></a>
</span><span id="__span-0-1873"><a id="__codelineno-0-1873" name="__codelineno-0-1873"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;DRONE&#39;</span><span class="p">:</span>
</span><span id="__span-0-1874"><a id="__codelineno-0-1874" name="__codelineno-0-1874"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">CONN_MUST_OVER_FLAG</span> <span class="o">=</span> <span class="kc">True</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="a2gmeasurements.HelperA2GMeasurements.do_finish_meas_drone_rfsoc" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">do_finish_meas_drone_rfsoc</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Callback function when this node receives a <code>FINISHDRONERFSOC</code> command.</p>
<p>This comand is unidirectional. It is always sent by the ground node to the drone node.</p>
<p>The purpose is to finish the experiment (as defined in "Manual A2GMeasurements"). When the experiment is finished the GUI allows the user to end (disconnect) the connection between both nodes.</p>

            <details class="quote">
              <summary>Source code in <code>a2gmeasurements.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1836">1836</a></span>
<span class="normal"><a href="#__codelineno-0-1837">1837</a></span>
<span class="normal"><a href="#__codelineno-0-1838">1838</a></span>
<span class="normal"><a href="#__codelineno-0-1839">1839</a></span>
<span class="normal"><a href="#__codelineno-0-1840">1840</a></span>
<span class="normal"><a href="#__codelineno-0-1841">1841</a></span>
<span class="normal"><a href="#__codelineno-0-1842">1842</a></span>
<span class="normal"><a href="#__codelineno-0-1843">1843</a></span>
<span class="normal"><a href="#__codelineno-0-1844">1844</a></span>
<span class="normal"><a href="#__codelineno-0-1845">1845</a></span>
<span class="normal"><a href="#__codelineno-0-1846">1846</a></span>
<span class="normal"><a href="#__codelineno-0-1847">1847</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1836"><a id="__codelineno-0-1836" name="__codelineno-0-1836"></a><span class="k">def</span> <span class="nf">do_finish_meas_drone_rfsoc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-1837"><a id="__codelineno-0-1837" name="__codelineno-0-1837"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-1838"><a id="__codelineno-0-1838" name="__codelineno-0-1838"></a><span class="sd">    Callback function when this node receives a ``FINISHDRONERFSOC`` command.</span>
</span><span id="__span-0-1839"><a id="__codelineno-0-1839" name="__codelineno-0-1839"></a>
</span><span id="__span-0-1840"><a id="__codelineno-0-1840" name="__codelineno-0-1840"></a><span class="sd">    This comand is unidirectional. It is always sent by the ground node to the drone node.</span>
</span><span id="__span-0-1841"><a id="__codelineno-0-1841" name="__codelineno-0-1841"></a>
</span><span id="__span-0-1842"><a id="__codelineno-0-1842" name="__codelineno-0-1842"></a><span class="sd">    The purpose is to finish the experiment (as defined in &quot;Manual A2GMeasurements&quot;). When the experiment is finished the GUI allows the user to end (disconnect) the connection between both nodes.</span>
</span><span id="__span-0-1843"><a id="__codelineno-0-1843" name="__codelineno-0-1843"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-1844"><a id="__codelineno-0-1844" name="__codelineno-0-1844"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;DRONE&#39;</span><span class="p">:</span> <span class="c1"># double check that we are in the drone</span>
</span><span id="__span-0-1845"><a id="__codelineno-0-1845" name="__codelineno-0-1845"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG]: Received REQUEST to FINISH measurement&quot;</span><span class="p">)</span>
</span><span id="__span-0-1846"><a id="__codelineno-0-1846" name="__codelineno-0-1846"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">myrfsoc</span><span class="o">.</span><span class="n">finish_measurement</span><span class="p">()</span>
</span><span id="__span-0-1847"><a id="__codelineno-0-1847" name="__codelineno-0-1847"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">STOP_SEND_SETIRF_FLAG</span> <span class="o">=</span> <span class="kc">True</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="a2gmeasurements.HelperA2GMeasurements.do_follow_mode_gimbal" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">do_follow_mode_gimbal</span><span class="p">(</span><span class="n">fmode</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Callback function when this node receives a <code>FOLLOWGIMBAL</code> command.</p>
<p>The <code>FOLLOWGIMBAL</code> command is sent when the other node asks for this node's GPS information to be able to follow this node's movement.        </p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>fmode</code></td>
            <td>
                  <code>hexadecimal</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>specifies whether the other node shall follow this node's movement in: 0x00, Elevation and azimuth; 0x01, Only elevation; 0x02, Only azimuth. Defaults to 0x00.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>a2gmeasurements.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1692">1692</a></span>
<span class="normal"><a href="#__codelineno-0-1693">1693</a></span>
<span class="normal"><a href="#__codelineno-0-1694">1694</a></span>
<span class="normal"><a href="#__codelineno-0-1695">1695</a></span>
<span class="normal"><a href="#__codelineno-0-1696">1696</a></span>
<span class="normal"><a href="#__codelineno-0-1697">1697</a></span>
<span class="normal"><a href="#__codelineno-0-1698">1698</a></span>
<span class="normal"><a href="#__codelineno-0-1699">1699</a></span>
<span class="normal"><a href="#__codelineno-0-1700">1700</a></span>
<span class="normal"><a href="#__codelineno-0-1701">1701</a></span>
<span class="normal"><a href="#__codelineno-0-1702">1702</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1692"><a id="__codelineno-0-1692" name="__codelineno-0-1692"></a><span class="k">def</span> <span class="nf">do_follow_mode_gimbal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fmode</span><span class="o">=</span><span class="mh">0x00</span><span class="p">):</span>
</span><span id="__span-0-1693"><a id="__codelineno-0-1693" name="__codelineno-0-1693"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-1694"><a id="__codelineno-0-1694" name="__codelineno-0-1694"></a><span class="sd">    Callback function when this node receives a ``FOLLOWGIMBAL`` command.</span>
</span><span id="__span-0-1695"><a id="__codelineno-0-1695" name="__codelineno-0-1695"></a>
</span><span id="__span-0-1696"><a id="__codelineno-0-1696" name="__codelineno-0-1696"></a><span class="sd">    The ``FOLLOWGIMBAL`` command is sent when the other node asks for this node&#39;s GPS information to be able to follow this node&#39;s movement.        </span>
</span><span id="__span-0-1697"><a id="__codelineno-0-1697" name="__codelineno-0-1697"></a>
</span><span id="__span-0-1698"><a id="__codelineno-0-1698" name="__codelineno-0-1698"></a><span class="sd">    Args:</span>
</span><span id="__span-0-1699"><a id="__codelineno-0-1699" name="__codelineno-0-1699"></a><span class="sd">        fmode (hexadecimal, optional): specifies whether the other node shall follow this node&#39;s movement in: 0x00, Elevation and azimuth; 0x01, Only elevation; 0x02, Only azimuth. Defaults to 0x00.</span>
</span><span id="__span-0-1700"><a id="__codelineno-0-1700" name="__codelineno-0-1700"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-1701"><a id="__codelineno-0-1701" name="__codelineno-0-1701"></a>
</span><span id="__span-0-1702"><a id="__codelineno-0-1702" name="__codelineno-0-1702"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">do_getgps_action</span><span class="p">(</span><span class="n">follow_mode_gimbal</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmode</span><span class="o">=</span><span class="mh">0x00</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="a2gmeasurements.HelperA2GMeasurements.do_getgps_action" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">do_getgps_action</span><span class="p">(</span><span class="n">follow_mode_gimbal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fmode</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Callback function when this node receives a <code>GETGPS</code> command.</p>
<p>The <code>GETGPS</code> commmand differentiates from <code>FOLLOWGIMBAL</code> in that when the other node only request GPS information from this node (i.e. for display the coordinates on a panel of the GUI), the <code>follow_mode_gimbal</code> is False as well as the <code>FMODE</code> key of the sent dictionary.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>follow_mode_gimbal</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if other node's gimbal must follow this node's movement. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>fmode</code></td>
            <td>
                  <code>hexadecimal</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>specifies whether the other node shall follow this node's movement in: 0x00, Elevation and azimuth; 0x01, Only elevation; 0x02, Only azimuth. Defaults to 0x00.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>a2gmeasurements.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1704">1704</a></span>
<span class="normal"><a href="#__codelineno-0-1705">1705</a></span>
<span class="normal"><a href="#__codelineno-0-1706">1706</a></span>
<span class="normal"><a href="#__codelineno-0-1707">1707</a></span>
<span class="normal"><a href="#__codelineno-0-1708">1708</a></span>
<span class="normal"><a href="#__codelineno-0-1709">1709</a></span>
<span class="normal"><a href="#__codelineno-0-1710">1710</a></span>
<span class="normal"><a href="#__codelineno-0-1711">1711</a></span>
<span class="normal"><a href="#__codelineno-0-1712">1712</a></span>
<span class="normal"><a href="#__codelineno-0-1713">1713</a></span>
<span class="normal"><a href="#__codelineno-0-1714">1714</a></span>
<span class="normal"><a href="#__codelineno-0-1715">1715</a></span>
<span class="normal"><a href="#__codelineno-0-1716">1716</a></span>
<span class="normal"><a href="#__codelineno-0-1717">1717</a></span>
<span class="normal"><a href="#__codelineno-0-1718">1718</a></span>
<span class="normal"><a href="#__codelineno-0-1719">1719</a></span>
<span class="normal"><a href="#__codelineno-0-1720">1720</a></span>
<span class="normal"><a href="#__codelineno-0-1721">1721</a></span>
<span class="normal"><a href="#__codelineno-0-1722">1722</a></span>
<span class="normal"><a href="#__codelineno-0-1723">1723</a></span>
<span class="normal"><a href="#__codelineno-0-1724">1724</a></span>
<span class="normal"><a href="#__codelineno-0-1725">1725</a></span>
<span class="normal"><a href="#__codelineno-0-1726">1726</a></span>
<span class="normal"><a href="#__codelineno-0-1727">1727</a></span>
<span class="normal"><a href="#__codelineno-0-1728">1728</a></span>
<span class="normal"><a href="#__codelineno-0-1729">1729</a></span>
<span class="normal"><a href="#__codelineno-0-1730">1730</a></span>
<span class="normal"><a href="#__codelineno-0-1731">1731</a></span>
<span class="normal"><a href="#__codelineno-0-1732">1732</a></span>
<span class="normal"><a href="#__codelineno-0-1733">1733</a></span>
<span class="normal"><a href="#__codelineno-0-1734">1734</a></span>
<span class="normal"><a href="#__codelineno-0-1735">1735</a></span>
<span class="normal"><a href="#__codelineno-0-1736">1736</a></span>
<span class="normal"><a href="#__codelineno-0-1737">1737</a></span>
<span class="normal"><a href="#__codelineno-0-1738">1738</a></span>
<span class="normal"><a href="#__codelineno-0-1739">1739</a></span>
<span class="normal"><a href="#__codelineno-0-1740">1740</a></span>
<span class="normal"><a href="#__codelineno-0-1741">1741</a></span>
<span class="normal"><a href="#__codelineno-0-1742">1742</a></span>
<span class="normal"><a href="#__codelineno-0-1743">1743</a></span>
<span class="normal"><a href="#__codelineno-0-1744">1744</a></span>
<span class="normal"><a href="#__codelineno-0-1745">1745</a></span>
<span class="normal"><a href="#__codelineno-0-1746">1746</a></span>
<span class="normal"><a href="#__codelineno-0-1747">1747</a></span>
<span class="normal"><a href="#__codelineno-0-1748">1748</a></span>
<span class="normal"><a href="#__codelineno-0-1749">1749</a></span>
<span class="normal"><a href="#__codelineno-0-1750">1750</a></span>
<span class="normal"><a href="#__codelineno-0-1751">1751</a></span>
<span class="normal"><a href="#__codelineno-0-1752">1752</a></span>
<span class="normal"><a href="#__codelineno-0-1753">1753</a></span>
<span class="normal"><a href="#__codelineno-0-1754">1754</a></span>
<span class="normal"><a href="#__codelineno-0-1755">1755</a></span>
<span class="normal"><a href="#__codelineno-0-1756">1756</a></span>
<span class="normal"><a href="#__codelineno-0-1757">1757</a></span>
<span class="normal"><a href="#__codelineno-0-1758">1758</a></span>
<span class="normal"><a href="#__codelineno-0-1759">1759</a></span>
<span class="normal"><a href="#__codelineno-0-1760">1760</a></span>
<span class="normal"><a href="#__codelineno-0-1761">1761</a></span>
<span class="normal"><a href="#__codelineno-0-1762">1762</a></span>
<span class="normal"><a href="#__codelineno-0-1763">1763</a></span>
<span class="normal"><a href="#__codelineno-0-1764">1764</a></span>
<span class="normal"><a href="#__codelineno-0-1765">1765</a></span>
<span class="normal"><a href="#__codelineno-0-1766">1766</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1704"><a id="__codelineno-0-1704" name="__codelineno-0-1704"></a><span class="k">def</span> <span class="nf">do_getgps_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">follow_mode_gimbal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fmode</span><span class="o">=</span><span class="mh">0x00</span><span class="p">):</span>
</span><span id="__span-0-1705"><a id="__codelineno-0-1705" name="__codelineno-0-1705"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-1706"><a id="__codelineno-0-1706" name="__codelineno-0-1706"></a><span class="sd">    Callback function when this node receives a ``GETGPS`` command.</span>
</span><span id="__span-0-1707"><a id="__codelineno-0-1707" name="__codelineno-0-1707"></a>
</span><span id="__span-0-1708"><a id="__codelineno-0-1708" name="__codelineno-0-1708"></a><span class="sd">    The ``GETGPS`` commmand differentiates from ``FOLLOWGIMBAL`` in that when the other node only request GPS information from this node (i.e. for display the coordinates on a panel of the GUI), the ``follow_mode_gimbal`` is False as well as the ``FMODE`` key of the sent dictionary.</span>
</span><span id="__span-0-1709"><a id="__codelineno-0-1709" name="__codelineno-0-1709"></a>
</span><span id="__span-0-1710"><a id="__codelineno-0-1710" name="__codelineno-0-1710"></a><span class="sd">    Args:</span>
</span><span id="__span-0-1711"><a id="__codelineno-0-1711" name="__codelineno-0-1711"></a><span class="sd">        follow_mode_gimbal (bool, optional): True if other node&#39;s gimbal must follow this node&#39;s movement. Defaults to False.</span>
</span><span id="__span-0-1712"><a id="__codelineno-0-1712" name="__codelineno-0-1712"></a><span class="sd">        fmode (hexadecimal, optional): specifies whether the other node shall follow this node&#39;s movement in: 0x00, Elevation and azimuth; 0x01, Only elevation; 0x02, Only azimuth. Defaults to 0x00.</span>
</span><span id="__span-0-1713"><a id="__codelineno-0-1713" name="__codelineno-0-1713"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-1714"><a id="__codelineno-0-1714" name="__codelineno-0-1714"></a>
</span><span id="__span-0-1715"><a id="__codelineno-0-1715" name="__codelineno-0-1715"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DBG_LVL_1</span><span class="p">:</span>
</span><span id="__span-0-1716"><a id="__codelineno-0-1716" name="__codelineno-0-1716"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;THIS (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="si">}</span><span class="s2">) receives a GETGPS command&quot;</span><span class="p">)</span>
</span><span id="__span-0-1717"><a id="__codelineno-0-1717" name="__codelineno-0-1717"></a>
</span><span id="__span-0-1718"><a id="__codelineno-0-1718" name="__codelineno-0-1718"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">IsGPS</span><span class="p">:</span>            
</span><span id="__span-0-1719"><a id="__codelineno-0-1719" name="__codelineno-0-1719"></a>        <span class="c1"># Only need to send to the OTHER station our last coordinates, NOT heading.</span>
</span><span id="__span-0-1720"><a id="__codelineno-0-1720" name="__codelineno-0-1720"></a>        <span class="c1"># Heading info required by the OTHER station is Heading info from the OTHER station</span>
</span><span id="__span-0-1721"><a id="__codelineno-0-1721" name="__codelineno-0-1721"></a>
</span><span id="__span-0-1722"><a id="__codelineno-0-1722" name="__codelineno-0-1722"></a>        <span class="c1"># It has to send over the socket the geocentric/geodetic coordinates</span>
</span><span id="__span-0-1723"><a id="__codelineno-0-1723" name="__codelineno-0-1723"></a>        <span class="c1"># The only way there are no coordinates available is because:</span>
</span><span id="__span-0-1724"><a id="__codelineno-0-1724" name="__codelineno-0-1724"></a>        <span class="c1"># 1) Didn&#39;t start gps thread with PVTCart and AttEuler type of messages</span>
</span><span id="__span-0-1725"><a id="__codelineno-0-1725" name="__codelineno-0-1725"></a>        <span class="c1"># 2) Messages interval is too long and the program executed first than the first message arrived</span>
</span><span id="__span-0-1726"><a id="__codelineno-0-1726" name="__codelineno-0-1726"></a>        <span class="c1"># 3) The receiver is not connected to enough satellites or multipath propagation is very strong, so that ERROR == 1</span>
</span><span id="__span-0-1727"><a id="__codelineno-0-1727" name="__codelineno-0-1727"></a>
</span><span id="__span-0-1728"><a id="__codelineno-0-1728" name="__codelineno-0-1728"></a>        <span class="n">data_to_send</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">get_last_sbf_buffer_info</span><span class="p">(</span><span class="n">what</span><span class="o">=</span><span class="s1">&#39;Coordinates&#39;</span><span class="p">)</span>
</span><span id="__span-0-1729"><a id="__codelineno-0-1729" name="__codelineno-0-1729"></a>
</span><span id="__span-0-1730"><a id="__codelineno-0-1730" name="__codelineno-0-1730"></a>        <span class="k">if</span> <span class="n">data_to_send</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_BUFF_NULL</span><span class="p">:</span>
</span><span id="__span-0-1731"><a id="__codelineno-0-1731" name="__codelineno-0-1731"></a>            <span class="c1"># More verbose</span>
</span><span id="__span-0-1732"><a id="__codelineno-0-1732" name="__codelineno-0-1732"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[WARNING]: This </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="si">}</span><span class="s2"> has nothing on GPS buffer&quot;</span><span class="p">)</span>
</span><span id="__span-0-1733"><a id="__codelineno-0-1733" name="__codelineno-0-1733"></a>            <span class="k">return</span>
</span><span id="__span-0-1734"><a id="__codelineno-0-1734" name="__codelineno-0-1734"></a>
</span><span id="__span-0-1735"><a id="__codelineno-0-1735" name="__codelineno-0-1735"></a>        <span class="k">elif</span> <span class="n">data_to_send</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_NO_COORD_AVAIL</span><span class="p">:</span>
</span><span id="__span-0-1736"><a id="__codelineno-0-1736" name="__codelineno-0-1736"></a>            <span class="c1"># More verbose</span>
</span><span id="__span-0-1737"><a id="__codelineno-0-1737" name="__codelineno-0-1737"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[WARNING]: This </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="si">}</span><span class="s2"> does not have GPS or GPS signals are not available&quot;</span><span class="p">)</span>
</span><span id="__span-0-1738"><a id="__codelineno-0-1738" name="__codelineno-0-1738"></a>            <span class="k">return</span>
</span><span id="__span-0-1739"><a id="__codelineno-0-1739" name="__codelineno-0-1739"></a>
</span><span id="__span-0-1740"><a id="__codelineno-0-1740" name="__codelineno-0-1740"></a>        <span class="k">if</span> <span class="n">follow_mode_gimbal</span><span class="p">:</span>
</span><span id="__span-0-1741"><a id="__codelineno-0-1741" name="__codelineno-0-1741"></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[DEBUG]: Last coordinates retrieved and followgimbal flag set to True to be sent&#39;</span><span class="p">)</span>
</span><span id="__span-0-1742"><a id="__codelineno-0-1742" name="__codelineno-0-1742"></a>            <span class="n">data_to_send</span><span class="p">[</span><span class="s1">&#39;FOLLOW_GIMBAL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x01</span>
</span><span id="__span-0-1743"><a id="__codelineno-0-1743" name="__codelineno-0-1743"></a>            <span class="n">data_to_send</span><span class="p">[</span><span class="s1">&#39;FMODE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fmode</span>
</span><span id="__span-0-1744"><a id="__codelineno-0-1744" name="__codelineno-0-1744"></a>
</span><span id="__span-0-1745"><a id="__codelineno-0-1745" name="__codelineno-0-1745"></a>        <span class="c1"># data_to_send wont be any of the other error codes, because they are not set for &#39;what&#39;==&#39;Coordinates&#39;</span>
</span><span id="__span-0-1746"><a id="__codelineno-0-1746" name="__codelineno-0-1746"></a>        <span class="k">else</span><span class="p">:</span>            
</span><span id="__span-0-1747"><a id="__codelineno-0-1747" name="__codelineno-0-1747"></a>            <span class="n">data_to_send</span><span class="p">[</span><span class="s1">&#39;FOLLOW_GIMBAL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x02</span>
</span><span id="__span-0-1748"><a id="__codelineno-0-1748" name="__codelineno-0-1748"></a>
</span><span id="__span-0-1749"><a id="__codelineno-0-1749" name="__codelineno-0-1749"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;GROUND&#39;</span><span class="p">:</span>
</span><span id="__span-0-1750"><a id="__codelineno-0-1750" name="__codelineno-0-1750"></a>            <span class="n">frame_to_send</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encode_message</span><span class="p">(</span><span class="n">source_id</span><span class="o">=</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">destination_id</span><span class="o">=</span><span class="mh">0x02</span><span class="p">,</span> <span class="n">message_type</span><span class="o">=</span><span class="mh">0x03</span><span class="p">,</span> <span class="n">cmd</span><span class="o">=</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data_to_send</span><span class="p">)</span>
</span><span id="__span-0-1751"><a id="__codelineno-0-1751" name="__codelineno-0-1751"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;DRONE&#39;</span><span class="p">:</span>
</span><span id="__span-0-1752"><a id="__codelineno-0-1752" name="__codelineno-0-1752"></a>            <span class="n">frame_to_send</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encode_message</span><span class="p">(</span><span class="n">source_id</span><span class="o">=</span><span class="mh">0x02</span><span class="p">,</span> <span class="n">destination_id</span><span class="o">=</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">message_type</span><span class="o">=</span><span class="mh">0x03</span><span class="p">,</span> <span class="n">cmd</span><span class="o">=</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data_to_send</span><span class="p">)</span>
</span><span id="__span-0-1753"><a id="__codelineno-0-1753" name="__codelineno-0-1753"></a>
</span><span id="__span-0-1754"><a id="__codelineno-0-1754" name="__codelineno-0-1754"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DBG_LVL_1</span><span class="p">:</span>
</span><span id="__span-0-1755"><a id="__codelineno-0-1755" name="__codelineno-0-1755"></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">[DEBUG_1]:Received the GETGPS and read the SBF buffer&#39;</span><span class="p">)</span>
</span><span id="__span-0-1756"><a id="__codelineno-0-1756" name="__codelineno-0-1756"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;GROUND&#39;</span><span class="p">:</span>
</span><span id="__span-0-1757"><a id="__codelineno-0-1757" name="__codelineno-0-1757"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">a2g_conn</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">frame_to_send</span><span class="p">)</span>
</span><span id="__span-0-1758"><a id="__codelineno-0-1758" name="__codelineno-0-1758"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;DRONE&#39;</span><span class="p">:</span>
</span><span id="__span-0-1759"><a id="__codelineno-0-1759" name="__codelineno-0-1759"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">frame_to_send</span><span class="p">)</span>
</span><span id="__span-0-1760"><a id="__codelineno-0-1760" name="__codelineno-0-1760"></a>
</span><span id="__span-0-1761"><a id="__codelineno-0-1761" name="__codelineno-0-1761"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DBG_LVL_1</span><span class="p">:</span>
</span><span id="__span-0-1762"><a id="__codelineno-0-1762" name="__codelineno-0-1762"></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">[DEBUG_1]: Sent SBF buffer&#39;</span><span class="p">)</span>
</span><span id="__span-0-1763"><a id="__codelineno-0-1763" name="__codelineno-0-1763"></a>
</span><span id="__span-0-1764"><a id="__codelineno-0-1764" name="__codelineno-0-1764"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1765"><a id="__codelineno-0-1765" name="__codelineno-0-1765"></a>        <span class="c1">#print(&#39;[WARNING]:ASKED for GPS position but no GPS connected: IsGPS is False&#39;)</span>
</span><span id="__span-0-1766"><a id="__codelineno-0-1766" name="__codelineno-0-1766"></a>        <span class="mi">1</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="a2gmeasurements.HelperA2GMeasurements.do_set_irf_action" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">do_set_irf_action</span><span class="p">(</span><span class="n">msg_data</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Callback function when this node receives a <code>SETIRF</code> command.</p>
<p>This comand is unidirectional. It is always sent by the drone node to the ground node.</p>
<p>Receives from the drone a subsampled version of the Power Angular Profile for it to be used by the GUI to continuously plot it in its PAP panel.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>msg_data</code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>attribute value <code>data_to_visualize</code> from <code>RFSoCRemoteControlFromHost</code> class.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>a2gmeasurements.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1849">1849</a></span>
<span class="normal"><a href="#__codelineno-0-1850">1850</a></span>
<span class="normal"><a href="#__codelineno-0-1851">1851</a></span>
<span class="normal"><a href="#__codelineno-0-1852">1852</a></span>
<span class="normal"><a href="#__codelineno-0-1853">1853</a></span>
<span class="normal"><a href="#__codelineno-0-1854">1854</a></span>
<span class="normal"><a href="#__codelineno-0-1855">1855</a></span>
<span class="normal"><a href="#__codelineno-0-1856">1856</a></span>
<span class="normal"><a href="#__codelineno-0-1857">1857</a></span>
<span class="normal"><a href="#__codelineno-0-1858">1858</a></span>
<span class="normal"><a href="#__codelineno-0-1859">1859</a></span>
<span class="normal"><a href="#__codelineno-0-1860">1860</a></span>
<span class="normal"><a href="#__codelineno-0-1861">1861</a></span>
<span class="normal"><a href="#__codelineno-0-1862">1862</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1849"><a id="__codelineno-0-1849" name="__codelineno-0-1849"></a><span class="k">def</span> <span class="nf">do_set_irf_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg_data</span><span class="p">):</span>
</span><span id="__span-0-1850"><a id="__codelineno-0-1850" name="__codelineno-0-1850"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-1851"><a id="__codelineno-0-1851" name="__codelineno-0-1851"></a><span class="sd">    Callback function when this node receives a ``SETIRF`` command.</span>
</span><span id="__span-0-1852"><a id="__codelineno-0-1852" name="__codelineno-0-1852"></a>
</span><span id="__span-0-1853"><a id="__codelineno-0-1853" name="__codelineno-0-1853"></a><span class="sd">    This comand is unidirectional. It is always sent by the drone node to the ground node.</span>
</span><span id="__span-0-1854"><a id="__codelineno-0-1854" name="__codelineno-0-1854"></a>
</span><span id="__span-0-1855"><a id="__codelineno-0-1855" name="__codelineno-0-1855"></a><span class="sd">    Receives from the drone a subsampled version of the Power Angular Profile for it to be used by the GUI to continuously plot it in its PAP panel.</span>
</span><span id="__span-0-1856"><a id="__codelineno-0-1856" name="__codelineno-0-1856"></a>
</span><span id="__span-0-1857"><a id="__codelineno-0-1857" name="__codelineno-0-1857"></a><span class="sd">    Args:</span>
</span><span id="__span-0-1858"><a id="__codelineno-0-1858" name="__codelineno-0-1858"></a><span class="sd">        msg_data (numpy.ndarray): attribute value ``data_to_visualize`` from ``RFSoCRemoteControlFromHost`` class.</span>
</span><span id="__span-0-1859"><a id="__codelineno-0-1859" name="__codelineno-0-1859"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-1860"><a id="__codelineno-0-1860" name="__codelineno-0-1860"></a>
</span><span id="__span-0-1861"><a id="__codelineno-0-1861" name="__codelineno-0-1861"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;GROUND&#39;</span><span class="p">:</span> <span class="c1"># double checj that we are in the gnd</span>
</span><span id="__span-0-1862"><a id="__codelineno-0-1862" name="__codelineno-0-1862"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">PAP_TO_PLOT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">msg_data</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="a2gmeasurements.HelperA2GMeasurements.do_set_remote_fm_flag" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">do_set_remote_fm_flag</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Callback function when this node receives a <code>SETREMOTEFMFLAG</code> command.</p>
<p>This comand is unidirectional. It is always sent by the ground node to the drone node.</p>
<p>Sets the <code>drone_fm_flag</code>. When this flag is set, the drone node can start sending <code>FOLLOWGIMBALL</code> commands to the ground node to get ground node's coordinates and be able to follow (drone node) it (ground node).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>data</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dictionary with keys 'X', 'Y', 'Z', 'FMODE', 'MOBILITY', corresponding to geocentric coordinates. The mentioned keys and their corresponding values refer to the ground node. The coordinates will be available if the ground node <code>MOBILITY</code> is <code>static</code> (0x01). The <code>FMODE</code> key refers to the wheter the drone gimbal follows the ground node in azimuth (0x02), elevation (0x01) or both (0x00) .Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>a2gmeasurements.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1876">1876</a></span>
<span class="normal"><a href="#__codelineno-0-1877">1877</a></span>
<span class="normal"><a href="#__codelineno-0-1878">1878</a></span>
<span class="normal"><a href="#__codelineno-0-1879">1879</a></span>
<span class="normal"><a href="#__codelineno-0-1880">1880</a></span>
<span class="normal"><a href="#__codelineno-0-1881">1881</a></span>
<span class="normal"><a href="#__codelineno-0-1882">1882</a></span>
<span class="normal"><a href="#__codelineno-0-1883">1883</a></span>
<span class="normal"><a href="#__codelineno-0-1884">1884</a></span>
<span class="normal"><a href="#__codelineno-0-1885">1885</a></span>
<span class="normal"><a href="#__codelineno-0-1886">1886</a></span>
<span class="normal"><a href="#__codelineno-0-1887">1887</a></span>
<span class="normal"><a href="#__codelineno-0-1888">1888</a></span>
<span class="normal"><a href="#__codelineno-0-1889">1889</a></span>
<span class="normal"><a href="#__codelineno-0-1890">1890</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1876"><a id="__codelineno-0-1876" name="__codelineno-0-1876"></a><span class="k">def</span> <span class="nf">do_set_remote_fm_flag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="__span-0-1877"><a id="__codelineno-0-1877" name="__codelineno-0-1877"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-1878"><a id="__codelineno-0-1878" name="__codelineno-0-1878"></a><span class="sd">    Callback function when this node receives a ``SETREMOTEFMFLAG`` command.</span>
</span><span id="__span-0-1879"><a id="__codelineno-0-1879" name="__codelineno-0-1879"></a>
</span><span id="__span-0-1880"><a id="__codelineno-0-1880" name="__codelineno-0-1880"></a><span class="sd">    This comand is unidirectional. It is always sent by the ground node to the drone node.</span>
</span><span id="__span-0-1881"><a id="__codelineno-0-1881" name="__codelineno-0-1881"></a>
</span><span id="__span-0-1882"><a id="__codelineno-0-1882" name="__codelineno-0-1882"></a><span class="sd">    Sets the ``drone_fm_flag``. When this flag is set, the drone node can start sending ``FOLLOWGIMBALL`` commands to the ground node to get ground node&#39;s coordinates and be able to follow (drone node) it (ground node).</span>
</span><span id="__span-0-1883"><a id="__codelineno-0-1883" name="__codelineno-0-1883"></a>
</span><span id="__span-0-1884"><a id="__codelineno-0-1884" name="__codelineno-0-1884"></a><span class="sd">    Args:</span>
</span><span id="__span-0-1885"><a id="__codelineno-0-1885" name="__codelineno-0-1885"></a><span class="sd">        data (dict, optional): dictionary with keys &#39;X&#39;, &#39;Y&#39;, &#39;Z&#39;, &#39;FMODE&#39;, &#39;MOBILITY&#39;, corresponding to geocentric coordinates. The mentioned keys and their corresponding values refer to the ground node. The coordinates will be available if the ground node ``MOBILITY`` is ``static`` (0x01). The ``FMODE`` key refers to the wheter the drone gimbal follows the ground node in azimuth (0x02), elevation (0x01) or both (0x00) .Defaults to None.</span>
</span><span id="__span-0-1886"><a id="__codelineno-0-1886" name="__codelineno-0-1886"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-1887"><a id="__codelineno-0-1887" name="__codelineno-0-1887"></a>
</span><span id="__span-0-1888"><a id="__codelineno-0-1888" name="__codelineno-0-1888"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;DRONE&#39;</span><span class="p">:</span>
</span><span id="__span-0-1889"><a id="__codelineno-0-1889" name="__codelineno-0-1889"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">drone_fm_flag</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="__span-0-1890"><a id="__codelineno-0-1890" name="__codelineno-0-1890"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">remote_config_for_drone_fm</span> <span class="o">=</span> <span class="n">data</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="a2gmeasurements.HelperA2GMeasurements.do_set_remote_stop_fm" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">do_set_remote_stop_fm</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Callback function when this node receives a <code>SETREMOTESTOPFM</code> command.</p>
<p>This comand is unidirectional. It is always sent by the ground node to the drone node.</p>
<p>Unsets the <code>drone_fm_flag</code> flag.</p>

            <details class="quote">
              <summary>Source code in <code>a2gmeasurements.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1892">1892</a></span>
<span class="normal"><a href="#__codelineno-0-1893">1893</a></span>
<span class="normal"><a href="#__codelineno-0-1894">1894</a></span>
<span class="normal"><a href="#__codelineno-0-1895">1895</a></span>
<span class="normal"><a href="#__codelineno-0-1896">1896</a></span>
<span class="normal"><a href="#__codelineno-0-1897">1897</a></span>
<span class="normal"><a href="#__codelineno-0-1898">1898</a></span>
<span class="normal"><a href="#__codelineno-0-1899">1899</a></span>
<span class="normal"><a href="#__codelineno-0-1900">1900</a></span>
<span class="normal"><a href="#__codelineno-0-1901">1901</a></span>
<span class="normal"><a href="#__codelineno-0-1902">1902</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1892"><a id="__codelineno-0-1892" name="__codelineno-0-1892"></a><span class="k">def</span> <span class="nf">do_set_remote_stop_fm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-1893"><a id="__codelineno-0-1893" name="__codelineno-0-1893"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-1894"><a id="__codelineno-0-1894" name="__codelineno-0-1894"></a><span class="sd">    Callback function when this node receives a ``SETREMOTESTOPFM`` command.</span>
</span><span id="__span-0-1895"><a id="__codelineno-0-1895" name="__codelineno-0-1895"></a>
</span><span id="__span-0-1896"><a id="__codelineno-0-1896" name="__codelineno-0-1896"></a><span class="sd">    This comand is unidirectional. It is always sent by the ground node to the drone node.</span>
</span><span id="__span-0-1897"><a id="__codelineno-0-1897" name="__codelineno-0-1897"></a>
</span><span id="__span-0-1898"><a id="__codelineno-0-1898" name="__codelineno-0-1898"></a><span class="sd">    Unsets the ``drone_fm_flag`` flag.</span>
</span><span id="__span-0-1899"><a id="__codelineno-0-1899" name="__codelineno-0-1899"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-1900"><a id="__codelineno-0-1900" name="__codelineno-0-1900"></a>
</span><span id="__span-0-1901"><a id="__codelineno-0-1901" name="__codelineno-0-1901"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;DRONE&#39;</span><span class="p">:</span>
</span><span id="__span-0-1902"><a id="__codelineno-0-1902" name="__codelineno-0-1902"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">drone_fm_flag</span> <span class="o">=</span> <span class="kc">False</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="a2gmeasurements.HelperA2GMeasurements.do_setgimbal_action" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">do_setgimbal_action</span><span class="p">(</span><span class="n">msg_data</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Callback function when this node receives a <code>SETGIMBAL</code> command.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>msg_data</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dictionary with keys 'YAW', 'PITCH' and 'MODE'. The 'YAW' values range between [-1800, 1800]. The 'PITCH' values are restricted (by software) to the interval [-600, 600] to avoid hits between the case and the gimbal. The 'MODE' values are: 0x00, consider 'YAW' and/or 'PITCH' values as relative to the actual position of the gimbal; 0x01, consider 'YAW' and/or 'PITCH' values as relative to the absolute 0 (in both azimuth and elevation) position.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>a2gmeasurements.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1768">1768</a></span>
<span class="normal"><a href="#__codelineno-0-1769">1769</a></span>
<span class="normal"><a href="#__codelineno-0-1770">1770</a></span>
<span class="normal"><a href="#__codelineno-0-1771">1771</a></span>
<span class="normal"><a href="#__codelineno-0-1772">1772</a></span>
<span class="normal"><a href="#__codelineno-0-1773">1773</a></span>
<span class="normal"><a href="#__codelineno-0-1774">1774</a></span>
<span class="normal"><a href="#__codelineno-0-1775">1775</a></span>
<span class="normal"><a href="#__codelineno-0-1776">1776</a></span>
<span class="normal"><a href="#__codelineno-0-1777">1777</a></span>
<span class="normal"><a href="#__codelineno-0-1778">1778</a></span>
<span class="normal"><a href="#__codelineno-0-1779">1779</a></span>
<span class="normal"><a href="#__codelineno-0-1780">1780</a></span>
<span class="normal"><a href="#__codelineno-0-1781">1781</a></span>
<span class="normal"><a href="#__codelineno-0-1782">1782</a></span>
<span class="normal"><a href="#__codelineno-0-1783">1783</a></span>
<span class="normal"><a href="#__codelineno-0-1784">1784</a></span>
<span class="normal"><a href="#__codelineno-0-1785">1785</a></span>
<span class="normal"><a href="#__codelineno-0-1786">1786</a></span>
<span class="normal"><a href="#__codelineno-0-1787">1787</a></span>
<span class="normal"><a href="#__codelineno-0-1788">1788</a></span>
<span class="normal"><a href="#__codelineno-0-1789">1789</a></span>
<span class="normal"><a href="#__codelineno-0-1790">1790</a></span>
<span class="normal"><a href="#__codelineno-0-1791">1791</a></span>
<span class="normal"><a href="#__codelineno-0-1792">1792</a></span>
<span class="normal"><a href="#__codelineno-0-1793">1793</a></span>
<span class="normal"><a href="#__codelineno-0-1794">1794</a></span>
<span class="normal"><a href="#__codelineno-0-1795">1795</a></span>
<span class="normal"><a href="#__codelineno-0-1796">1796</a></span>
<span class="normal"><a href="#__codelineno-0-1797">1797</a></span>
<span class="normal"><a href="#__codelineno-0-1798">1798</a></span>
<span class="normal"><a href="#__codelineno-0-1799">1799</a></span>
<span class="normal"><a href="#__codelineno-0-1800">1800</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1768"><a id="__codelineno-0-1768" name="__codelineno-0-1768"></a><span class="k">def</span> <span class="nf">do_setgimbal_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg_data</span><span class="p">):</span>
</span><span id="__span-0-1769"><a id="__codelineno-0-1769" name="__codelineno-0-1769"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-1770"><a id="__codelineno-0-1770" name="__codelineno-0-1770"></a><span class="sd">    Callback function when this node receives a ``SETGIMBAL`` command.</span>
</span><span id="__span-0-1771"><a id="__codelineno-0-1771" name="__codelineno-0-1771"></a>
</span><span id="__span-0-1772"><a id="__codelineno-0-1772" name="__codelineno-0-1772"></a><span class="sd">    Args:</span>
</span><span id="__span-0-1773"><a id="__codelineno-0-1773" name="__codelineno-0-1773"></a><span class="sd">        msg_data (dict): dictionary with keys &#39;YAW&#39;, &#39;PITCH&#39; and &#39;MODE&#39;. The &#39;YAW&#39; values range between [-1800, 1800]. The &#39;PITCH&#39; values are restricted (by software) to the interval [-600, 600] to avoid hits between the case and the gimbal. The &#39;MODE&#39; values are: 0x00, consider &#39;YAW&#39; and/or &#39;PITCH&#39; values as relative to the actual position of the gimbal; 0x01, consider &#39;YAW&#39; and/or &#39;PITCH&#39; values as relative to the absolute 0 (in both azimuth and elevation) position.</span>
</span><span id="__span-0-1774"><a id="__codelineno-0-1774" name="__codelineno-0-1774"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-1775"><a id="__codelineno-0-1775" name="__codelineno-0-1775"></a>
</span><span id="__span-0-1776"><a id="__codelineno-0-1776" name="__codelineno-0-1776"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">IsGimbal</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
</span><span id="__span-0-1777"><a id="__codelineno-0-1777" name="__codelineno-0-1777"></a>        <span class="c1"># Unwrap the dictionary containing the yaw and pitch values to be set.</span>
</span><span id="__span-0-1778"><a id="__codelineno-0-1778" name="__codelineno-0-1778"></a>        <span class="c1">#msg_data = json.loads(msg_data)</span>
</span><span id="__span-0-1779"><a id="__codelineno-0-1779" name="__codelineno-0-1779"></a>
</span><span id="__span-0-1780"><a id="__codelineno-0-1780" name="__codelineno-0-1780"></a>        <span class="c1"># Error checking</span>
</span><span id="__span-0-1781"><a id="__codelineno-0-1781" name="__codelineno-0-1781"></a>        <span class="c1">#if &#39;YAW&#39; not in msg_data or &#39;PITCH&#39; not in msg_data or &#39;MODE&#39; not in msg_data:</span>
</span><span id="__span-0-1782"><a id="__codelineno-0-1782" name="__codelineno-0-1782"></a>        <span class="k">if</span> <span class="s1">&#39;YAW&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">msg_data</span> <span class="ow">or</span> <span class="s1">&#39;PITCH&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">msg_data</span><span class="p">:</span>
</span><span id="__span-0-1783"><a id="__codelineno-0-1783" name="__codelineno-0-1783"></a>            <span class="k">if</span> <span class="s1">&#39;MODE&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">msg_data</span><span class="p">:</span>
</span><span id="__span-0-1784"><a id="__codelineno-0-1784" name="__codelineno-0-1784"></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[ERROR]: no YAW or PITCH provided&#39;</span><span class="p">)</span>
</span><span id="__span-0-1785"><a id="__codelineno-0-1785" name="__codelineno-0-1785"></a>                <span class="k">return</span>
</span><span id="__span-0-1786"><a id="__codelineno-0-1786" name="__codelineno-0-1786"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1787"><a id="__codelineno-0-1787" name="__codelineno-0-1787"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">myGimbal</span><span class="o">.</span><span class="n">change_gimbal_mode</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">msg_data</span><span class="p">[</span><span class="s1">&#39;MODE&#39;</span><span class="p">])</span>                    
</span><span id="__span-0-1788"><a id="__codelineno-0-1788" name="__codelineno-0-1788"></a>        <span class="k">elif</span> <span class="s1">&#39;YAW&#39;</span> <span class="ow">in</span> <span class="n">msg_data</span> <span class="ow">and</span> <span class="s1">&#39;PITCH&#39;</span> <span class="ow">in</span> <span class="n">msg_data</span><span class="p">:</span>
</span><span id="__span-0-1789"><a id="__codelineno-0-1789" name="__codelineno-0-1789"></a>            <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">msg_data</span><span class="p">[</span><span class="s1">&#39;YAW&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1800</span> <span class="ow">or</span> <span class="nb">float</span><span class="p">(</span><span class="n">msg_data</span><span class="p">[</span><span class="s1">&#39;PITCH&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">600</span> <span class="ow">or</span> <span class="nb">float</span><span class="p">(</span><span class="n">msg_data</span><span class="p">[</span><span class="s1">&#39;YAW&#39;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1800</span> <span class="ow">or</span> <span class="nb">float</span><span class="p">(</span><span class="n">msg_data</span><span class="p">[</span><span class="s1">&#39;PITCH&#39;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">600</span><span class="p">:</span>
</span><span id="__span-0-1790"><a id="__codelineno-0-1790" name="__codelineno-0-1790"></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[ERROR]: Yaw or pitch angles are outside of range&#39;</span><span class="p">)</span>
</span><span id="__span-0-1791"><a id="__codelineno-0-1791" name="__codelineno-0-1791"></a>                <span class="k">return</span>
</span><span id="__span-0-1792"><a id="__codelineno-0-1792" name="__codelineno-0-1792"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1793"><a id="__codelineno-0-1793" name="__codelineno-0-1793"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">IsGimbal</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># RS2</span>
</span><span id="__span-0-1794"><a id="__codelineno-0-1794" name="__codelineno-0-1794"></a>                    <span class="c1"># Cast to int values as a double check, but values are send as numbers and not as strings.</span>
</span><span id="__span-0-1795"><a id="__codelineno-0-1795" name="__codelineno-0-1795"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">myGimbal</span><span class="o">.</span><span class="n">setPosControl</span><span class="p">(</span><span class="n">yaw</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">msg_data</span><span class="p">[</span><span class="s1">&#39;YAW&#39;</span><span class="p">]),</span> <span class="n">roll</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">pitch</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">msg_data</span><span class="p">[</span><span class="s1">&#39;PITCH&#39;</span><span class="p">]),</span> <span class="n">ctrl_byte</span><span class="o">=</span><span class="n">msg_data</span><span class="p">[</span><span class="s1">&#39;MODE&#39;</span><span class="p">])</span>
</span><span id="__span-0-1796"><a id="__codelineno-0-1796" name="__codelineno-0-1796"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">IsGimbal</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span> <span class="c1"># Gremsy</span>
</span><span id="__span-0-1797"><a id="__codelineno-0-1797" name="__codelineno-0-1797"></a>                    <span class="c1"># Cast to int values as a double check, but values are send as numbers and not as strings.</span>
</span><span id="__span-0-1798"><a id="__codelineno-0-1798" name="__codelineno-0-1798"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">myGimbal</span><span class="o">.</span><span class="n">setPosControl</span><span class="p">(</span><span class="n">yaw</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">msg_data</span><span class="p">[</span><span class="s1">&#39;YAW&#39;</span><span class="p">]),</span> <span class="n">pitch</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">msg_data</span><span class="p">[</span><span class="s1">&#39;PITCH&#39;</span><span class="p">]),</span> <span class="n">mode</span><span class="o">=</span><span class="n">msg_data</span><span class="p">[</span><span class="s1">&#39;MODE&#39;</span><span class="p">])</span>
</span><span id="__span-0-1799"><a id="__codelineno-0-1799" name="__codelineno-0-1799"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1800"><a id="__codelineno-0-1800" name="__codelineno-0-1800"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">[WARNING]: Action to SET Gimbal not posible cause there is no gimbal: IsGimbal is False&#39;</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="a2gmeasurements.HelperA2GMeasurements.do_start_meas_drone_rfsoc" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">do_start_meas_drone_rfsoc</span><span class="p">(</span><span class="n">msg_data</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Callback function when this node receives a <code>STARTDRONERFSOC</code> command.</p>
<p>This comand is unidirectional. It is always sent by the ground node to the drone node.</p>
<p>The purpose is to start the RFSoC thread (created in <code>RFSoCRemoteControlFromHost</code> class) responsible for retrieving the measured Channel Impulse Response from the RFSoC.</p>
<p>It is assumed that prior to this callback, the ground rfsoc (tx) has started sending the its sounding signal and there were no issues.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>msg_data</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dictionary with keys 'carrier_freq', 'rx_gain_ctrl_bb1', 'rx_gain_ctrl_bb2', 'rx_gain_ctrl_bb3', 'rx_gain_ctrl_bfrf'. More information about these keys can be found in method <code>set_rx_rf</code> from <code>RFSoCRemoteControlFromHost</code> class.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>a2gmeasurements.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1802">1802</a></span>
<span class="normal"><a href="#__codelineno-0-1803">1803</a></span>
<span class="normal"><a href="#__codelineno-0-1804">1804</a></span>
<span class="normal"><a href="#__codelineno-0-1805">1805</a></span>
<span class="normal"><a href="#__codelineno-0-1806">1806</a></span>
<span class="normal"><a href="#__codelineno-0-1807">1807</a></span>
<span class="normal"><a href="#__codelineno-0-1808">1808</a></span>
<span class="normal"><a href="#__codelineno-0-1809">1809</a></span>
<span class="normal"><a href="#__codelineno-0-1810">1810</a></span>
<span class="normal"><a href="#__codelineno-0-1811">1811</a></span>
<span class="normal"><a href="#__codelineno-0-1812">1812</a></span>
<span class="normal"><a href="#__codelineno-0-1813">1813</a></span>
<span class="normal"><a href="#__codelineno-0-1814">1814</a></span>
<span class="normal"><a href="#__codelineno-0-1815">1815</a></span>
<span class="normal"><a href="#__codelineno-0-1816">1816</a></span>
<span class="normal"><a href="#__codelineno-0-1817">1817</a></span>
<span class="normal"><a href="#__codelineno-0-1818">1818</a></span>
<span class="normal"><a href="#__codelineno-0-1819">1819</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1802"><a id="__codelineno-0-1802" name="__codelineno-0-1802"></a><span class="k">def</span> <span class="nf">do_start_meas_drone_rfsoc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg_data</span><span class="p">):</span>
</span><span id="__span-0-1803"><a id="__codelineno-0-1803" name="__codelineno-0-1803"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-1804"><a id="__codelineno-0-1804" name="__codelineno-0-1804"></a><span class="sd">    Callback function when this node receives a ``STARTDRONERFSOC`` command.</span>
</span><span id="__span-0-1805"><a id="__codelineno-0-1805" name="__codelineno-0-1805"></a>
</span><span id="__span-0-1806"><a id="__codelineno-0-1806" name="__codelineno-0-1806"></a><span class="sd">    This comand is unidirectional. It is always sent by the ground node to the drone node.</span>
</span><span id="__span-0-1807"><a id="__codelineno-0-1807" name="__codelineno-0-1807"></a>
</span><span id="__span-0-1808"><a id="__codelineno-0-1808" name="__codelineno-0-1808"></a><span class="sd">    The purpose is to start the RFSoC thread (created in ``RFSoCRemoteControlFromHost`` class) responsible for retrieving the measured Channel Impulse Response from the RFSoC.</span>
</span><span id="__span-0-1809"><a id="__codelineno-0-1809" name="__codelineno-0-1809"></a>
</span><span id="__span-0-1810"><a id="__codelineno-0-1810" name="__codelineno-0-1810"></a><span class="sd">    It is assumed that prior to this callback, the ground rfsoc (tx) has started sending the its sounding signal and there were no issues.</span>
</span><span id="__span-0-1811"><a id="__codelineno-0-1811" name="__codelineno-0-1811"></a>
</span><span id="__span-0-1812"><a id="__codelineno-0-1812" name="__codelineno-0-1812"></a><span class="sd">    Args:</span>
</span><span id="__span-0-1813"><a id="__codelineno-0-1813" name="__codelineno-0-1813"></a><span class="sd">        msg_data (dict): dictionary with keys &#39;carrier_freq&#39;, &#39;rx_gain_ctrl_bb1&#39;, &#39;rx_gain_ctrl_bb2&#39;, &#39;rx_gain_ctrl_bb3&#39;, &#39;rx_gain_ctrl_bfrf&#39;. More information about these keys can be found in method ``set_rx_rf`` from ``RFSoCRemoteControlFromHost`` class.</span>
</span><span id="__span-0-1814"><a id="__codelineno-0-1814" name="__codelineno-0-1814"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-1815"><a id="__codelineno-0-1815" name="__codelineno-0-1815"></a>
</span><span id="__span-0-1816"><a id="__codelineno-0-1816" name="__codelineno-0-1816"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;DRONE&#39;</span><span class="p">:</span> <span class="c1"># double check that we are in the drone</span>
</span><span id="__span-0-1817"><a id="__codelineno-0-1817" name="__codelineno-0-1817"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG]: Received REQUEST to START measurement&quot;</span><span class="p">)</span>
</span><span id="__span-0-1818"><a id="__codelineno-0-1818" name="__codelineno-0-1818"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">myrfsoc</span><span class="o">.</span><span class="n">start_thread_receive_meas_data</span><span class="p">(</span><span class="n">msg_data</span><span class="p">)</span>
</span><span id="__span-0-1819"><a id="__codelineno-0-1819" name="__codelineno-0-1819"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">STOP_SEND_SETIRF_FLAG</span> <span class="o">=</span> <span class="kc">False</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="a2gmeasurements.HelperA2GMeasurements.do_stop_meas_drone_rfsoc" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">do_stop_meas_drone_rfsoc</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Callback function when this node receives a <code>STOPDRONERFSOC</code> command.</p>
<p>This comand is unidirectional. It is always sent by the ground node to the drone node.</p>
<p>The purpose is to stop the RFSoC thread.</p>
<p>It is assumed that prior to this function, the ground rfsoc (tx) has started sending the its sounding signal and there were no issues.</p>

            <details class="quote">
              <summary>Source code in <code>a2gmeasurements.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1821">1821</a></span>
<span class="normal"><a href="#__codelineno-0-1822">1822</a></span>
<span class="normal"><a href="#__codelineno-0-1823">1823</a></span>
<span class="normal"><a href="#__codelineno-0-1824">1824</a></span>
<span class="normal"><a href="#__codelineno-0-1825">1825</a></span>
<span class="normal"><a href="#__codelineno-0-1826">1826</a></span>
<span class="normal"><a href="#__codelineno-0-1827">1827</a></span>
<span class="normal"><a href="#__codelineno-0-1828">1828</a></span>
<span class="normal"><a href="#__codelineno-0-1829">1829</a></span>
<span class="normal"><a href="#__codelineno-0-1830">1830</a></span>
<span class="normal"><a href="#__codelineno-0-1831">1831</a></span>
<span class="normal"><a href="#__codelineno-0-1832">1832</a></span>
<span class="normal"><a href="#__codelineno-0-1833">1833</a></span>
<span class="normal"><a href="#__codelineno-0-1834">1834</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1821"><a id="__codelineno-0-1821" name="__codelineno-0-1821"></a><span class="k">def</span> <span class="nf">do_stop_meas_drone_rfsoc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-1822"><a id="__codelineno-0-1822" name="__codelineno-0-1822"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-1823"><a id="__codelineno-0-1823" name="__codelineno-0-1823"></a><span class="sd">    Callback function when this node receives a ``STOPDRONERFSOC`` command.</span>
</span><span id="__span-0-1824"><a id="__codelineno-0-1824" name="__codelineno-0-1824"></a>
</span><span id="__span-0-1825"><a id="__codelineno-0-1825" name="__codelineno-0-1825"></a><span class="sd">    This comand is unidirectional. It is always sent by the ground node to the drone node.</span>
</span><span id="__span-0-1826"><a id="__codelineno-0-1826" name="__codelineno-0-1826"></a>
</span><span id="__span-0-1827"><a id="__codelineno-0-1827" name="__codelineno-0-1827"></a><span class="sd">    The purpose is to stop the RFSoC thread.</span>
</span><span id="__span-0-1828"><a id="__codelineno-0-1828" name="__codelineno-0-1828"></a>
</span><span id="__span-0-1829"><a id="__codelineno-0-1829" name="__codelineno-0-1829"></a><span class="sd">    It is assumed that prior to this function, the ground rfsoc (tx) has started sending the its sounding signal and there were no issues.</span>
</span><span id="__span-0-1830"><a id="__codelineno-0-1830" name="__codelineno-0-1830"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-1831"><a id="__codelineno-0-1831" name="__codelineno-0-1831"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;DRONE&#39;</span><span class="p">:</span> <span class="c1"># double check that we are in the drone</span>
</span><span id="__span-0-1832"><a id="__codelineno-0-1832" name="__codelineno-0-1832"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG]: Received REQUEST to STOP measurement&quot;</span><span class="p">)</span>
</span><span id="__span-0-1833"><a id="__codelineno-0-1833" name="__codelineno-0-1833"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">myrfsoc</span><span class="o">.</span><span class="n">stop_thread_receive_meas_data</span><span class="p">()</span>
</span><span id="__span-0-1834"><a id="__codelineno-0-1834" name="__codelineno-0-1834"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">STOP_SEND_SETIRF_FLAG</span> <span class="o">=</span> <span class="kc">True</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="a2gmeasurements.HelperA2GMeasurements.encode_message" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">encode_message</span><span class="p">(</span><span class="n">source_id</span><span class="p">,</span> <span class="n">destination_id</span><span class="p">,</span> <span class="n">message_type</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Encodes a TCP message to be sent. More information about the specific commands is in the section "Communication Protocol" of the "Manual A2GMeasurements".</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>source_id</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>identifies the sender node with a number (this parameter is provided for -potential- future improvements but does not have any functionality).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>destination_id</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>identifies the receiver node with a number (this parameter is provided for -potential- future improvements but does not have any functionality).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>message_type</code></td>
            <td>
                  <code>hexadecimal</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>0x01, for a short type of message; 0x02, for a long type of message; 0x03, to answer/acknowledge a received request. More information about this is in "Manual A2GMeasurements".</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>cmd</code></td>
            <td>
                  <code>hexadecimal</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>one of the supported requests/commands for each <code>message_type</code>. The list of commands is provided in "Manual A2GMeasurements" (Communication Protocol chapter).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>data</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>additional data required by the request/command. The particular data sent depends on the <code>message_type</code> and the <code>cmd</code>. More information on "Manual A2GMeasurements" (Communication Protocol chapter). Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>
      <p>Returns:
    message (bytes): the bytes object representing the message to be sent.</p>

            <details class="quote">
              <summary>Source code in <code>a2gmeasurements.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-2070">2070</a></span>
<span class="normal"><a href="#__codelineno-0-2071">2071</a></span>
<span class="normal"><a href="#__codelineno-0-2072">2072</a></span>
<span class="normal"><a href="#__codelineno-0-2073">2073</a></span>
<span class="normal"><a href="#__codelineno-0-2074">2074</a></span>
<span class="normal"><a href="#__codelineno-0-2075">2075</a></span>
<span class="normal"><a href="#__codelineno-0-2076">2076</a></span>
<span class="normal"><a href="#__codelineno-0-2077">2077</a></span>
<span class="normal"><a href="#__codelineno-0-2078">2078</a></span>
<span class="normal"><a href="#__codelineno-0-2079">2079</a></span>
<span class="normal"><a href="#__codelineno-0-2080">2080</a></span>
<span class="normal"><a href="#__codelineno-0-2081">2081</a></span>
<span class="normal"><a href="#__codelineno-0-2082">2082</a></span>
<span class="normal"><a href="#__codelineno-0-2083">2083</a></span>
<span class="normal"><a href="#__codelineno-0-2084">2084</a></span>
<span class="normal"><a href="#__codelineno-0-2085">2085</a></span>
<span class="normal"><a href="#__codelineno-0-2086">2086</a></span>
<span class="normal"><a href="#__codelineno-0-2087">2087</a></span>
<span class="normal"><a href="#__codelineno-0-2088">2088</a></span>
<span class="normal"><a href="#__codelineno-0-2089">2089</a></span>
<span class="normal"><a href="#__codelineno-0-2090">2090</a></span>
<span class="normal"><a href="#__codelineno-0-2091">2091</a></span>
<span class="normal"><a href="#__codelineno-0-2092">2092</a></span>
<span class="normal"><a href="#__codelineno-0-2093">2093</a></span>
<span class="normal"><a href="#__codelineno-0-2094">2094</a></span>
<span class="normal"><a href="#__codelineno-0-2095">2095</a></span>
<span class="normal"><a href="#__codelineno-0-2096">2096</a></span>
<span class="normal"><a href="#__codelineno-0-2097">2097</a></span>
<span class="normal"><a href="#__codelineno-0-2098">2098</a></span>
<span class="normal"><a href="#__codelineno-0-2099">2099</a></span>
<span class="normal"><a href="#__codelineno-0-2100">2100</a></span>
<span class="normal"><a href="#__codelineno-0-2101">2101</a></span>
<span class="normal"><a href="#__codelineno-0-2102">2102</a></span>
<span class="normal"><a href="#__codelineno-0-2103">2103</a></span>
<span class="normal"><a href="#__codelineno-0-2104">2104</a></span>
<span class="normal"><a href="#__codelineno-0-2105">2105</a></span>
<span class="normal"><a href="#__codelineno-0-2106">2106</a></span>
<span class="normal"><a href="#__codelineno-0-2107">2107</a></span>
<span class="normal"><a href="#__codelineno-0-2108">2108</a></span>
<span class="normal"><a href="#__codelineno-0-2109">2109</a></span>
<span class="normal"><a href="#__codelineno-0-2110">2110</a></span>
<span class="normal"><a href="#__codelineno-0-2111">2111</a></span>
<span class="normal"><a href="#__codelineno-0-2112">2112</a></span>
<span class="normal"><a href="#__codelineno-0-2113">2113</a></span>
<span class="normal"><a href="#__codelineno-0-2114">2114</a></span>
<span class="normal"><a href="#__codelineno-0-2115">2115</a></span>
<span class="normal"><a href="#__codelineno-0-2116">2116</a></span>
<span class="normal"><a href="#__codelineno-0-2117">2117</a></span>
<span class="normal"><a href="#__codelineno-0-2118">2118</a></span>
<span class="normal"><a href="#__codelineno-0-2119">2119</a></span>
<span class="normal"><a href="#__codelineno-0-2120">2120</a></span>
<span class="normal"><a href="#__codelineno-0-2121">2121</a></span>
<span class="normal"><a href="#__codelineno-0-2122">2122</a></span>
<span class="normal"><a href="#__codelineno-0-2123">2123</a></span>
<span class="normal"><a href="#__codelineno-0-2124">2124</a></span>
<span class="normal"><a href="#__codelineno-0-2125">2125</a></span>
<span class="normal"><a href="#__codelineno-0-2126">2126</a></span>
<span class="normal"><a href="#__codelineno-0-2127">2127</a></span>
<span class="normal"><a href="#__codelineno-0-2128">2128</a></span>
<span class="normal"><a href="#__codelineno-0-2129">2129</a></span>
<span class="normal"><a href="#__codelineno-0-2130">2130</a></span>
<span class="normal"><a href="#__codelineno-0-2131">2131</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-2070"><a id="__codelineno-0-2070" name="__codelineno-0-2070"></a><span class="k">def</span> <span class="nf">encode_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_id</span><span class="p">,</span> <span class="n">destination_id</span><span class="p">,</span> <span class="n">message_type</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="__span-0-2071"><a id="__codelineno-0-2071" name="__codelineno-0-2071"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-2072"><a id="__codelineno-0-2072" name="__codelineno-0-2072"></a><span class="sd">    Encodes a TCP message to be sent. More information about the specific commands is in the section &quot;Communication Protocol&quot; of the &quot;Manual A2GMeasurements&quot;.</span>
</span><span id="__span-0-2073"><a id="__codelineno-0-2073" name="__codelineno-0-2073"></a>
</span><span id="__span-0-2074"><a id="__codelineno-0-2074" name="__codelineno-0-2074"></a><span class="sd">    Args:</span>
</span><span id="__span-0-2075"><a id="__codelineno-0-2075" name="__codelineno-0-2075"></a><span class="sd">        source_id (int): identifies the sender node with a number (this parameter is provided for -potential- future improvements but does not have any functionality).</span>
</span><span id="__span-0-2076"><a id="__codelineno-0-2076" name="__codelineno-0-2076"></a><span class="sd">        destination_id (int): identifies the receiver node with a number (this parameter is provided for -potential- future improvements but does not have any functionality).</span>
</span><span id="__span-0-2077"><a id="__codelineno-0-2077" name="__codelineno-0-2077"></a><span class="sd">        message_type (hexadecimal): 0x01, for a short type of message; 0x02, for a long type of message; 0x03, to answer/acknowledge a received request. More information about this is in &quot;Manual A2GMeasurements&quot;.</span>
</span><span id="__span-0-2078"><a id="__codelineno-0-2078" name="__codelineno-0-2078"></a><span class="sd">        cmd (hexadecimal): one of the supported requests/commands for each ``message_type``. The list of commands is provided in &quot;Manual A2GMeasurements&quot; (Communication Protocol chapter).</span>
</span><span id="__span-0-2079"><a id="__codelineno-0-2079" name="__codelineno-0-2079"></a><span class="sd">        data (dict, optional): additional data required by the request/command. The particular data sent depends on the ``message_type`` and the ``cmd``. More information on &quot;Manual A2GMeasurements&quot; (Communication Protocol chapter). Defaults to None.</span>
</span><span id="__span-0-2080"><a id="__codelineno-0-2080" name="__codelineno-0-2080"></a><span class="sd">    Returns:</span>
</span><span id="__span-0-2081"><a id="__codelineno-0-2081" name="__codelineno-0-2081"></a><span class="sd">        message (bytes): the bytes object representing the message to be sent.</span>
</span><span id="__span-0-2082"><a id="__codelineno-0-2082" name="__codelineno-0-2082"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-2083"><a id="__codelineno-0-2083" name="__codelineno-0-2083"></a>
</span><span id="__span-0-2084"><a id="__codelineno-0-2084" name="__codelineno-0-2084"></a>    <span class="k">if</span> <span class="n">message_type</span> <span class="o">==</span> <span class="mh">0x01</span><span class="p">:</span> <span class="c1"># SHORT type of message</span>
</span><span id="__span-0-2085"><a id="__codelineno-0-2085" name="__codelineno-0-2085"></a>        <span class="k">if</span> <span class="n">cmd</span> <span class="o">==</span> <span class="mh">0x01</span><span class="p">:</span> <span class="c1"># FOLLOWGIMBAL</span>
</span><span id="__span-0-2086"><a id="__codelineno-0-2086" name="__codelineno-0-2086"></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;FMODE&#39;</span><span class="p">])</span>
</span><span id="__span-0-2087"><a id="__codelineno-0-2087" name="__codelineno-0-2087"></a>            <span class="n">length</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="__span-0-2088"><a id="__codelineno-0-2088" name="__codelineno-0-2088"></a>            <span class="n">message</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;BBBBB&#39;</span><span class="p">,</span> <span class="n">source_id</span><span class="p">,</span> <span class="n">destination_id</span><span class="p">,</span> <span class="n">message_type</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span> <span class="o">+</span> <span class="n">data</span>
</span><span id="__span-0-2089"><a id="__codelineno-0-2089" name="__codelineno-0-2089"></a>        <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="mh">0x02</span><span class="p">:</span> <span class="c1"># GETGPS</span>
</span><span id="__span-0-2090"><a id="__codelineno-0-2090" name="__codelineno-0-2090"></a>            <span class="n">length</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-0-2091"><a id="__codelineno-0-2091" name="__codelineno-0-2091"></a>            <span class="n">message</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;BBBBB&#39;</span><span class="p">,</span> <span class="n">source_id</span><span class="p">,</span> <span class="n">destination_id</span><span class="p">,</span> <span class="n">message_type</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span>
</span><span id="__span-0-2092"><a id="__codelineno-0-2092" name="__codelineno-0-2092"></a>        <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="mh">0x03</span> <span class="ow">and</span> <span class="n">data</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span> <span class="c1"># SETGIMBAL</span>
</span><span id="__span-0-2093"><a id="__codelineno-0-2093" name="__codelineno-0-2093"></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;fffB&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;YAW&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;PITCH&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;ROLL&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;MODE&#39;</span><span class="p">])</span>
</span><span id="__span-0-2094"><a id="__codelineno-0-2094" name="__codelineno-0-2094"></a>            <span class="n">length</span> <span class="o">=</span> <span class="mi">4</span>
</span><span id="__span-0-2095"><a id="__codelineno-0-2095" name="__codelineno-0-2095"></a>            <span class="n">message</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;BBBBB&#39;</span><span class="p">,</span> <span class="n">source_id</span><span class="p">,</span> <span class="n">destination_id</span><span class="p">,</span> <span class="n">message_type</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span> <span class="o">+</span> <span class="n">data</span>
</span><span id="__span-0-2096"><a id="__codelineno-0-2096" name="__codelineno-0-2096"></a>        <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="mh">0x04</span> <span class="ow">and</span> <span class="n">data</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span> <span class="c1"># STARTDRONERFSOC</span>
</span><span id="__span-0-2097"><a id="__codelineno-0-2097" name="__codelineno-0-2097"></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;fHHHH&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;carrier_freq&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;rx_gain_ctrl_bb1&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;rx_gain_ctrl_bb2&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;rx_gain_ctrl_bb3&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;rx_gain_ctrl_bfrf&#39;</span><span class="p">])</span>
</span><span id="__span-0-2098"><a id="__codelineno-0-2098" name="__codelineno-0-2098"></a>            <span class="n">length</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="__span-0-2099"><a id="__codelineno-0-2099" name="__codelineno-0-2099"></a>            <span class="n">message</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;BBBBB&#39;</span><span class="p">,</span> <span class="n">source_id</span><span class="p">,</span> <span class="n">destination_id</span><span class="p">,</span> <span class="n">message_type</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span> <span class="o">+</span> <span class="n">data</span>
</span><span id="__span-0-2100"><a id="__codelineno-0-2100" name="__codelineno-0-2100"></a>        <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="mh">0x05</span><span class="p">:</span> <span class="c1"># STOPDRONERFSOC</span>
</span><span id="__span-0-2101"><a id="__codelineno-0-2101" name="__codelineno-0-2101"></a>            <span class="n">length</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-0-2102"><a id="__codelineno-0-2102" name="__codelineno-0-2102"></a>            <span class="n">message</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;BBBBB&#39;</span><span class="p">,</span> <span class="n">source_id</span><span class="p">,</span> <span class="n">destination_id</span><span class="p">,</span> <span class="n">message_type</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span>
</span><span id="__span-0-2103"><a id="__codelineno-0-2103" name="__codelineno-0-2103"></a>        <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="mh">0x06</span><span class="p">:</span> <span class="c1"># FINISHDRONERFSOC</span>
</span><span id="__span-0-2104"><a id="__codelineno-0-2104" name="__codelineno-0-2104"></a>            <span class="n">length</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-0-2105"><a id="__codelineno-0-2105" name="__codelineno-0-2105"></a>            <span class="n">message</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;BBBBB&#39;</span><span class="p">,</span> <span class="n">source_id</span><span class="p">,</span> <span class="n">destination_id</span><span class="p">,</span> <span class="n">message_type</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span>
</span><span id="__span-0-2106"><a id="__codelineno-0-2106" name="__codelineno-0-2106"></a>        <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="mh">0x07</span><span class="p">:</span> <span class="c1"># CLOSEDGUI</span>
</span><span id="__span-0-2107"><a id="__codelineno-0-2107" name="__codelineno-0-2107"></a>            <span class="n">length</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-0-2108"><a id="__codelineno-0-2108" name="__codelineno-0-2108"></a>            <span class="n">message</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;BBBBB&#39;</span><span class="p">,</span> <span class="n">source_id</span><span class="p">,</span> <span class="n">destination_id</span><span class="p">,</span> <span class="n">message_type</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span>
</span><span id="__span-0-2109"><a id="__codelineno-0-2109" name="__codelineno-0-2109"></a>        <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="mh">0x08</span><span class="p">:</span> <span class="c1"># SETREMOTEFMFLAG</span>
</span><span id="__span-0-2110"><a id="__codelineno-0-2110" name="__codelineno-0-2110"></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;dddBB&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;FMODE&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;MOBILITY&#39;</span><span class="p">])</span>
</span><span id="__span-0-2111"><a id="__codelineno-0-2111" name="__codelineno-0-2111"></a>            <span class="n">length</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="__span-0-2112"><a id="__codelineno-0-2112" name="__codelineno-0-2112"></a>            <span class="n">message</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;BBBBB&#39;</span><span class="p">,</span> <span class="n">source_id</span><span class="p">,</span> <span class="n">destination_id</span><span class="p">,</span> <span class="n">message_type</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span> <span class="o">+</span> <span class="n">data</span>
</span><span id="__span-0-2113"><a id="__codelineno-0-2113" name="__codelineno-0-2113"></a>        <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="mh">0x09</span><span class="p">:</span> <span class="c1"># SETREMOTESTOPFM</span>
</span><span id="__span-0-2114"><a id="__codelineno-0-2114" name="__codelineno-0-2114"></a>            <span class="n">length</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-0-2115"><a id="__codelineno-0-2115" name="__codelineno-0-2115"></a>            <span class="n">message</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;BBBBB&#39;</span><span class="p">,</span> <span class="n">source_id</span><span class="p">,</span> <span class="n">destination_id</span><span class="p">,</span> <span class="n">message_type</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span>
</span><span id="__span-0-2116"><a id="__codelineno-0-2116" name="__codelineno-0-2116"></a>    <span class="k">elif</span> <span class="n">message_type</span> <span class="o">==</span> <span class="mh">0x02</span><span class="p">:</span> <span class="c1">#LONG type message</span>
</span><span id="__span-0-2117"><a id="__codelineno-0-2117" name="__codelineno-0-2117"></a>        <span class="k">if</span> <span class="n">cmd</span> <span class="o">==</span> <span class="mh">0x01</span><span class="p">:</span> <span class="c1"># SETIRF</span>
</span><span id="__span-0-2118"><a id="__codelineno-0-2118" name="__codelineno-0-2118"></a>            <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-2119"><a id="__codelineno-0-2119" name="__codelineno-0-2119"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG]: An array must be provided&quot;</span><span class="p">)</span>
</span><span id="__span-0-2120"><a id="__codelineno-0-2120" name="__codelineno-0-2120"></a>                <span class="k">return</span>
</span><span id="__span-0-2121"><a id="__codelineno-0-2121" name="__codelineno-0-2121"></a>            <span class="n">data_bytes</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
</span><span id="__span-0-2122"><a id="__codelineno-0-2122" name="__codelineno-0-2122"></a>            <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-0-2123"><a id="__codelineno-0-2123" name="__codelineno-0-2123"></a>            <span class="n">message</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;BBBBB&#39;</span><span class="p">,</span> <span class="n">source_id</span><span class="p">,</span> <span class="n">destination_id</span><span class="p">,</span> <span class="n">message_type</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span> <span class="o">+</span> <span class="n">data_bytes</span>
</span><span id="__span-0-2124"><a id="__codelineno-0-2124" name="__codelineno-0-2124"></a>    <span class="k">elif</span> <span class="n">message_type</span> <span class="o">==</span> <span class="mh">0x03</span><span class="p">:</span> <span class="c1"># ANS message type</span>
</span><span id="__span-0-2125"><a id="__codelineno-0-2125" name="__codelineno-0-2125"></a>        <span class="k">if</span> <span class="n">cmd</span> <span class="o">==</span> <span class="mh">0x01</span><span class="p">:</span> <span class="c1"># Response to GETGPS</span>
</span><span id="__span-0-2126"><a id="__codelineno-0-2126" name="__codelineno-0-2126"></a>            <span class="n">message</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;dddBBB&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Datum&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;FOLLOW_GIMBAL&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;FMODE&#39;</span><span class="p">])</span>
</span><span id="__span-0-2127"><a id="__codelineno-0-2127" name="__codelineno-0-2127"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2128"><a id="__codelineno-0-2128" name="__codelineno-0-2128"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DEBUG]: message_type not known when encoding.&quot;</span><span class="p">)</span>
</span><span id="__span-0-2129"><a id="__codelineno-0-2129" name="__codelineno-0-2129"></a>        <span class="k">return</span>
</span><span id="__span-0-2130"><a id="__codelineno-0-2130" name="__codelineno-0-2130"></a>
</span><span id="__span-0-2131"><a id="__codelineno-0-2131" name="__codelineno-0-2131"></a>    <span class="k">return</span> <span class="n">message</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="a2gmeasurements.HelperA2GMeasurements.gimbal_follows_drone" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">gimbal_follows_drone</span><span class="p">(</span><span class="n">heading</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lat_ground</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lon_ground</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">height_ground</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lat_drone</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lon_drone</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">height_drone</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fmode</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Computes the yaw, pitch and roll angles required to move the gimbal in this node towards the other node.</p>
<p>The caller of this function must guarantee that if <code>self.ID == 'GROUND'</code>, the arguments passed to this function are drone coords. The ground coords SHOULD NOT be passed as they will be obtained from this node Septentrio's receiver.</p>
<p>The caller of this function must guarantee that if <code>self.ID == 'DRONE'</code>, the arguments passed to this function are ground coords. The drone coords SHOULD NOT be passed as they will be obtained from this node Septentrio's receiver.</p>
<p>If <code>IsGPS</code> is False (no GPS connected), then <code>heading</code>, <code>lat_ground</code>, <code>lon_ground</code>, <code>height_ground</code>, <code>lat_drone</code>, <code>lon_drone</code>, <code>height_drone</code> must be provided. </p>
<p>In that case, all coordinates provided must be geodetic (lat, lon, alt).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>heading</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>angle between [0, 2*pi] (rads) corresponding to the heading of the line between the two antennas connected to Septentrio's receiver in this node. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>lat_ground</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>latitude of the GPS antenna 1 connected to Septentrio's receiver at the GROUND node. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>lon_ground</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>longitude of the GPS antenna 1 connected to Septentrio's receiver at the GROUND node. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>height_ground</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>height of the GPS antenna 1 connected to Septentrio's receiver at the GROUND node. Assuming both antennas are placed at the same height, is the altitude (in meters above sea level) of the either of the antennas. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>lat_drone</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>latitude of the GPS antenna 1 connected to Septentrio's receiver at the DRONE node. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>lon_drone</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>longitude of the GPS antenna 1 connected to Septentrio's receiver at the DRONE node. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>height_drone</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>height of the GPS antenna 1 connected to Septentrio's receiver at the DRONE node. Assuming both antennas are placed at the same height, is the altitude (in meters above sea level) of the either of the antennas. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>fmode</code></td>
            <td>
                  <code>hexadecimal</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>defines if the gimbal will follow the other node in Azimuth, elevation or both of them. Options are: 0x00, for Azimuth and elevation; 0x01, for Elevation, 0x02, for Azimuth. Defaults to 0x00.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>yaw_to_set</code></td>            <td>
                  <code>(int, optional)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>yaw angle to be set at the gimbal of this node, in degrees multiplied by 10 and rounded to the closest integer (i.e. a yaw to set of 45.78 degrees is returned as the yaw value 458)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>pitch_to_set</code></td>            <td>
                  <code>(int, optional)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pitch angle to be set at the gimbal of this node, to follow the other node. The actual value is the angle value in degrees multiplied by 10 and rounded to the closest integer (i.e. a yaw to set of 45.78 degrees is returned as the yaw value 458).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>a2gmeasurements.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1578">1578</a></span>
<span class="normal"><a href="#__codelineno-0-1579">1579</a></span>
<span class="normal"><a href="#__codelineno-0-1580">1580</a></span>
<span class="normal"><a href="#__codelineno-0-1581">1581</a></span>
<span class="normal"><a href="#__codelineno-0-1582">1582</a></span>
<span class="normal"><a href="#__codelineno-0-1583">1583</a></span>
<span class="normal"><a href="#__codelineno-0-1584">1584</a></span>
<span class="normal"><a href="#__codelineno-0-1585">1585</a></span>
<span class="normal"><a href="#__codelineno-0-1586">1586</a></span>
<span class="normal"><a href="#__codelineno-0-1587">1587</a></span>
<span class="normal"><a href="#__codelineno-0-1588">1588</a></span>
<span class="normal"><a href="#__codelineno-0-1589">1589</a></span>
<span class="normal"><a href="#__codelineno-0-1590">1590</a></span>
<span class="normal"><a href="#__codelineno-0-1591">1591</a></span>
<span class="normal"><a href="#__codelineno-0-1592">1592</a></span>
<span class="normal"><a href="#__codelineno-0-1593">1593</a></span>
<span class="normal"><a href="#__codelineno-0-1594">1594</a></span>
<span class="normal"><a href="#__codelineno-0-1595">1595</a></span>
<span class="normal"><a href="#__codelineno-0-1596">1596</a></span>
<span class="normal"><a href="#__codelineno-0-1597">1597</a></span>
<span class="normal"><a href="#__codelineno-0-1598">1598</a></span>
<span class="normal"><a href="#__codelineno-0-1599">1599</a></span>
<span class="normal"><a href="#__codelineno-0-1600">1600</a></span>
<span class="normal"><a href="#__codelineno-0-1601">1601</a></span>
<span class="normal"><a href="#__codelineno-0-1602">1602</a></span>
<span class="normal"><a href="#__codelineno-0-1603">1603</a></span>
<span class="normal"><a href="#__codelineno-0-1604">1604</a></span>
<span class="normal"><a href="#__codelineno-0-1605">1605</a></span>
<span class="normal"><a href="#__codelineno-0-1606">1606</a></span>
<span class="normal"><a href="#__codelineno-0-1607">1607</a></span>
<span class="normal"><a href="#__codelineno-0-1608">1608</a></span>
<span class="normal"><a href="#__codelineno-0-1609">1609</a></span>
<span class="normal"><a href="#__codelineno-0-1610">1610</a></span>
<span class="normal"><a href="#__codelineno-0-1611">1611</a></span>
<span class="normal"><a href="#__codelineno-0-1612">1612</a></span>
<span class="normal"><a href="#__codelineno-0-1613">1613</a></span>
<span class="normal"><a href="#__codelineno-0-1614">1614</a></span>
<span class="normal"><a href="#__codelineno-0-1615">1615</a></span>
<span class="normal"><a href="#__codelineno-0-1616">1616</a></span>
<span class="normal"><a href="#__codelineno-0-1617">1617</a></span>
<span class="normal"><a href="#__codelineno-0-1618">1618</a></span>
<span class="normal"><a href="#__codelineno-0-1619">1619</a></span>
<span class="normal"><a href="#__codelineno-0-1620">1620</a></span>
<span class="normal"><a href="#__codelineno-0-1621">1621</a></span>
<span class="normal"><a href="#__codelineno-0-1622">1622</a></span>
<span class="normal"><a href="#__codelineno-0-1623">1623</a></span>
<span class="normal"><a href="#__codelineno-0-1624">1624</a></span>
<span class="normal"><a href="#__codelineno-0-1625">1625</a></span>
<span class="normal"><a href="#__codelineno-0-1626">1626</a></span>
<span class="normal"><a href="#__codelineno-0-1627">1627</a></span>
<span class="normal"><a href="#__codelineno-0-1628">1628</a></span>
<span class="normal"><a href="#__codelineno-0-1629">1629</a></span>
<span class="normal"><a href="#__codelineno-0-1630">1630</a></span>
<span class="normal"><a href="#__codelineno-0-1631">1631</a></span>
<span class="normal"><a href="#__codelineno-0-1632">1632</a></span>
<span class="normal"><a href="#__codelineno-0-1633">1633</a></span>
<span class="normal"><a href="#__codelineno-0-1634">1634</a></span>
<span class="normal"><a href="#__codelineno-0-1635">1635</a></span>
<span class="normal"><a href="#__codelineno-0-1636">1636</a></span>
<span class="normal"><a href="#__codelineno-0-1637">1637</a></span>
<span class="normal"><a href="#__codelineno-0-1638">1638</a></span>
<span class="normal"><a href="#__codelineno-0-1639">1639</a></span>
<span class="normal"><a href="#__codelineno-0-1640">1640</a></span>
<span class="normal"><a href="#__codelineno-0-1641">1641</a></span>
<span class="normal"><a href="#__codelineno-0-1642">1642</a></span>
<span class="normal"><a href="#__codelineno-0-1643">1643</a></span>
<span class="normal"><a href="#__codelineno-0-1644">1644</a></span>
<span class="normal"><a href="#__codelineno-0-1645">1645</a></span>
<span class="normal"><a href="#__codelineno-0-1646">1646</a></span>
<span class="normal"><a href="#__codelineno-0-1647">1647</a></span>
<span class="normal"><a href="#__codelineno-0-1648">1648</a></span>
<span class="normal"><a href="#__codelineno-0-1649">1649</a></span>
<span class="normal"><a href="#__codelineno-0-1650">1650</a></span>
<span class="normal"><a href="#__codelineno-0-1651">1651</a></span>
<span class="normal"><a href="#__codelineno-0-1652">1652</a></span>
<span class="normal"><a href="#__codelineno-0-1653">1653</a></span>
<span class="normal"><a href="#__codelineno-0-1654">1654</a></span>
<span class="normal"><a href="#__codelineno-0-1655">1655</a></span>
<span class="normal"><a href="#__codelineno-0-1656">1656</a></span>
<span class="normal"><a href="#__codelineno-0-1657">1657</a></span>
<span class="normal"><a href="#__codelineno-0-1658">1658</a></span>
<span class="normal"><a href="#__codelineno-0-1659">1659</a></span>
<span class="normal"><a href="#__codelineno-0-1660">1660</a></span>
<span class="normal"><a href="#__codelineno-0-1661">1661</a></span>
<span class="normal"><a href="#__codelineno-0-1662">1662</a></span>
<span class="normal"><a href="#__codelineno-0-1663">1663</a></span>
<span class="normal"><a href="#__codelineno-0-1664">1664</a></span>
<span class="normal"><a href="#__codelineno-0-1665">1665</a></span>
<span class="normal"><a href="#__codelineno-0-1666">1666</a></span>
<span class="normal"><a href="#__codelineno-0-1667">1667</a></span>
<span class="normal"><a href="#__codelineno-0-1668">1668</a></span>
<span class="normal"><a href="#__codelineno-0-1669">1669</a></span>
<span class="normal"><a href="#__codelineno-0-1670">1670</a></span>
<span class="normal"><a href="#__codelineno-0-1671">1671</a></span>
<span class="normal"><a href="#__codelineno-0-1672">1672</a></span>
<span class="normal"><a href="#__codelineno-0-1673">1673</a></span>
<span class="normal"><a href="#__codelineno-0-1674">1674</a></span>
<span class="normal"><a href="#__codelineno-0-1675">1675</a></span>
<span class="normal"><a href="#__codelineno-0-1676">1676</a></span>
<span class="normal"><a href="#__codelineno-0-1677">1677</a></span>
<span class="normal"><a href="#__codelineno-0-1678">1678</a></span>
<span class="normal"><a href="#__codelineno-0-1679">1679</a></span>
<span class="normal"><a href="#__codelineno-0-1680">1680</a></span>
<span class="normal"><a href="#__codelineno-0-1681">1681</a></span>
<span class="normal"><a href="#__codelineno-0-1682">1682</a></span>
<span class="normal"><a href="#__codelineno-0-1683">1683</a></span>
<span class="normal"><a href="#__codelineno-0-1684">1684</a></span>
<span class="normal"><a href="#__codelineno-0-1685">1685</a></span>
<span class="normal"><a href="#__codelineno-0-1686">1686</a></span>
<span class="normal"><a href="#__codelineno-0-1687">1687</a></span>
<span class="normal"><a href="#__codelineno-0-1688">1688</a></span>
<span class="normal"><a href="#__codelineno-0-1689">1689</a></span>
<span class="normal"><a href="#__codelineno-0-1690">1690</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1578"><a id="__codelineno-0-1578" name="__codelineno-0-1578"></a><span class="k">def</span> <span class="nf">gimbal_follows_drone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">heading</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lat_ground</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lon_ground</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">height_ground</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
</span><span id="__span-0-1579"><a id="__codelineno-0-1579" name="__codelineno-0-1579"></a>                                <span class="n">lat_drone</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lon_drone</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">height_drone</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fmode</span><span class="o">=</span><span class="mh">0x00</span><span class="p">):</span>
</span><span id="__span-0-1580"><a id="__codelineno-0-1580" name="__codelineno-0-1580"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-1581"><a id="__codelineno-0-1581" name="__codelineno-0-1581"></a><span class="sd">    Computes the yaw, pitch and roll angles required to move the gimbal in this node towards the other node.</span>
</span><span id="__span-0-1582"><a id="__codelineno-0-1582" name="__codelineno-0-1582"></a>
</span><span id="__span-0-1583"><a id="__codelineno-0-1583" name="__codelineno-0-1583"></a><span class="sd">    The caller of this function must guarantee that if ``self.ID == &#39;GROUND&#39;``, the arguments passed to this function are drone coords. The ground coords SHOULD NOT be passed as they will be obtained from this node Septentrio&#39;s receiver.</span>
</span><span id="__span-0-1584"><a id="__codelineno-0-1584" name="__codelineno-0-1584"></a>
</span><span id="__span-0-1585"><a id="__codelineno-0-1585" name="__codelineno-0-1585"></a><span class="sd">    The caller of this function must guarantee that if ``self.ID == &#39;DRONE&#39;``, the arguments passed to this function are ground coords. The drone coords SHOULD NOT be passed as they will be obtained from this node Septentrio&#39;s receiver.</span>
</span><span id="__span-0-1586"><a id="__codelineno-0-1586" name="__codelineno-0-1586"></a>
</span><span id="__span-0-1587"><a id="__codelineno-0-1587" name="__codelineno-0-1587"></a><span class="sd">    If ``IsGPS`` is False (no GPS connected), then ``heading``, ``lat_ground``, ``lon_ground``, ``height_ground``, ``lat_drone``, ``lon_drone``, ``height_drone`` must be provided. </span>
</span><span id="__span-0-1588"><a id="__codelineno-0-1588" name="__codelineno-0-1588"></a>
</span><span id="__span-0-1589"><a id="__codelineno-0-1589" name="__codelineno-0-1589"></a><span class="sd">    In that case, all coordinates provided must be geodetic (lat, lon, alt).</span>
</span><span id="__span-0-1590"><a id="__codelineno-0-1590" name="__codelineno-0-1590"></a>
</span><span id="__span-0-1591"><a id="__codelineno-0-1591" name="__codelineno-0-1591"></a><span class="sd">    Args:</span>
</span><span id="__span-0-1592"><a id="__codelineno-0-1592" name="__codelineno-0-1592"></a><span class="sd">        heading (float, optional): angle between [0, 2*pi] (rads) corresponding to the heading of the line between the two antennas connected to Septentrio&#39;s receiver in this node. Defaults to None.</span>
</span><span id="__span-0-1593"><a id="__codelineno-0-1593" name="__codelineno-0-1593"></a><span class="sd">        lat_ground (float, optional): latitude of the GPS antenna 1 connected to Septentrio&#39;s receiver at the GROUND node. Defaults to None.</span>
</span><span id="__span-0-1594"><a id="__codelineno-0-1594" name="__codelineno-0-1594"></a><span class="sd">        lon_ground (float, optional): longitude of the GPS antenna 1 connected to Septentrio&#39;s receiver at the GROUND node. Defaults to None.</span>
</span><span id="__span-0-1595"><a id="__codelineno-0-1595" name="__codelineno-0-1595"></a><span class="sd">        height_ground (float, optional): height of the GPS antenna 1 connected to Septentrio&#39;s receiver at the GROUND node. Assuming both antennas are placed at the same height, is the altitude (in meters above sea level) of the either of the antennas. Defaults to None.</span>
</span><span id="__span-0-1596"><a id="__codelineno-0-1596" name="__codelineno-0-1596"></a><span class="sd">        lat_drone (float, optional): latitude of the GPS antenna 1 connected to Septentrio&#39;s receiver at the DRONE node. Defaults to None.</span>
</span><span id="__span-0-1597"><a id="__codelineno-0-1597" name="__codelineno-0-1597"></a><span class="sd">        lon_drone (float, optional): longitude of the GPS antenna 1 connected to Septentrio&#39;s receiver at the DRONE node. Defaults to None.</span>
</span><span id="__span-0-1598"><a id="__codelineno-0-1598" name="__codelineno-0-1598"></a><span class="sd">        height_drone (float, optional): height of the GPS antenna 1 connected to Septentrio&#39;s receiver at the DRONE node. Assuming both antennas are placed at the same height, is the altitude (in meters above sea level) of the either of the antennas. Defaults to None.</span>
</span><span id="__span-0-1599"><a id="__codelineno-0-1599" name="__codelineno-0-1599"></a><span class="sd">        fmode (hexadecimal, optional): defines if the gimbal will follow the other node in Azimuth, elevation or both of them. Options are: 0x00, for Azimuth and elevation; 0x01, for Elevation, 0x02, for Azimuth. Defaults to 0x00.</span>
</span><span id="__span-0-1600"><a id="__codelineno-0-1600" name="__codelineno-0-1600"></a>
</span><span id="__span-0-1601"><a id="__codelineno-0-1601" name="__codelineno-0-1601"></a><span class="sd">    Returns:</span>
</span><span id="__span-0-1602"><a id="__codelineno-0-1602" name="__codelineno-0-1602"></a><span class="sd">        yaw_to_set (int, optional): yaw angle to be set at the gimbal of this node, in degrees multiplied by 10 and rounded to the closest integer (i.e. a yaw to set of 45.78 degrees is returned as the yaw value 458)</span>
</span><span id="__span-0-1603"><a id="__codelineno-0-1603" name="__codelineno-0-1603"></a><span class="sd">        pitch_to_set(int, optional): pitch angle to be set at the gimbal of this node, to follow the other node. The actual value is the angle value in degrees multiplied by 10 and rounded to the closest integer (i.e. a yaw to set of 45.78 degrees is returned as the yaw value 458).</span>
</span><span id="__span-0-1604"><a id="__codelineno-0-1604" name="__codelineno-0-1604"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-1605"><a id="__codelineno-0-1605" name="__codelineno-0-1605"></a>
</span><span id="__span-0-1606"><a id="__codelineno-0-1606" name="__codelineno-0-1606"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">IsGPS</span><span class="p">:</span>
</span><span id="__span-0-1607"><a id="__codelineno-0-1607" name="__codelineno-0-1607"></a>        <span class="k">if</span> <span class="n">fmode</span> <span class="o">==</span> <span class="mh">0x00</span> <span class="ow">or</span> <span class="n">fmode</span> <span class="o">==</span> <span class="mh">0x02</span><span class="p">:</span>
</span><span id="__span-0-1608"><a id="__codelineno-0-1608" name="__codelineno-0-1608"></a>            <span class="n">coords</span><span class="p">,</span> <span class="n">head_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">get_last_sbf_buffer_info</span><span class="p">(</span><span class="n">what</span><span class="o">=</span><span class="s1">&#39;Both&#39;</span><span class="p">)</span>
</span><span id="__span-0-1609"><a id="__codelineno-0-1609" name="__codelineno-0-1609"></a>
</span><span id="__span-0-1610"><a id="__codelineno-0-1610" name="__codelineno-0-1610"></a>            <span class="k">if</span> <span class="n">coords</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_BUFF_NULL</span><span class="p">:</span>
</span><span id="__span-0-1611"><a id="__codelineno-0-1611" name="__codelineno-0-1611"></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_BUFF_NULL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_BUFF_NULL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_BUFF_NULL</span>
</span><span id="__span-0-1612"><a id="__codelineno-0-1612" name="__codelineno-0-1612"></a>            <span class="k">elif</span> <span class="n">coords</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_SMALL_BUFF_SZ</span><span class="p">:</span>
</span><span id="__span-0-1613"><a id="__codelineno-0-1613" name="__codelineno-0-1613"></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_SMALL_BUFF_SZ</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_SMALL_BUFF_SZ</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_SMALL_BUFF_SZ</span>
</span><span id="__span-0-1614"><a id="__codelineno-0-1614" name="__codelineno-0-1614"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1615"><a id="__codelineno-0-1615" name="__codelineno-0-1615"></a>                <span class="n">heading</span> <span class="o">=</span> <span class="n">head_info</span><span class="p">[</span><span class="s1">&#39;Heading&#39;</span><span class="p">]</span>
</span><span id="__span-0-1616"><a id="__codelineno-0-1616" name="__codelineno-0-1616"></a>                <span class="n">time_tag_heading</span> <span class="o">=</span> <span class="n">head_info</span><span class="p">[</span><span class="s1">&#39;TOW&#39;</span><span class="p">]</span>
</span><span id="__span-0-1617"><a id="__codelineno-0-1617" name="__codelineno-0-1617"></a>                <span class="n">time_tag_coords</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="s1">&#39;TOW&#39;</span><span class="p">]</span>
</span><span id="__span-0-1618"><a id="__codelineno-0-1618" name="__codelineno-0-1618"></a>                <span class="n">datum_coordinates</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="s1">&#39;Datum&#39;</span><span class="p">]</span>
</span><span id="__span-0-1619"><a id="__codelineno-0-1619" name="__codelineno-0-1619"></a>        <span class="k">elif</span> <span class="n">fmode</span> <span class="o">==</span> <span class="mh">0x01</span><span class="p">:</span>
</span><span id="__span-0-1620"><a id="__codelineno-0-1620" name="__codelineno-0-1620"></a>            <span class="n">coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">get_last_sbf_buffer_info</span><span class="p">(</span><span class="n">what</span><span class="o">=</span><span class="s1">&#39;Coordinates&#39;</span><span class="p">)</span>
</span><span id="__span-0-1621"><a id="__codelineno-0-1621" name="__codelineno-0-1621"></a>
</span><span id="__span-0-1622"><a id="__codelineno-0-1622" name="__codelineno-0-1622"></a>            <span class="k">if</span> <span class="n">coords</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_BUFF_NULL</span><span class="p">:</span>
</span><span id="__span-0-1623"><a id="__codelineno-0-1623" name="__codelineno-0-1623"></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_BUFF_NULL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_BUFF_NULL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_BUFF_NULL</span>
</span><span id="__span-0-1624"><a id="__codelineno-0-1624" name="__codelineno-0-1624"></a>            <span class="k">elif</span> <span class="n">coords</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_SMALL_BUFF_SZ</span><span class="p">:</span>
</span><span id="__span-0-1625"><a id="__codelineno-0-1625" name="__codelineno-0-1625"></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_SMALL_BUFF_SZ</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_SMALL_BUFF_SZ</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_SMALL_BUFF_SZ</span>
</span><span id="__span-0-1626"><a id="__codelineno-0-1626" name="__codelineno-0-1626"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1627"><a id="__codelineno-0-1627" name="__codelineno-0-1627"></a>                <span class="n">time_tag_coords</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="s1">&#39;TOW&#39;</span><span class="p">]</span>
</span><span id="__span-0-1628"><a id="__codelineno-0-1628" name="__codelineno-0-1628"></a>                <span class="n">datum_coordinates</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="s1">&#39;Datum&#39;</span><span class="p">]</span>
</span><span id="__span-0-1629"><a id="__codelineno-0-1629" name="__codelineno-0-1629"></a>
</span><span id="__span-0-1630"><a id="__codelineno-0-1630" name="__codelineno-0-1630"></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="__span-0-1631"><a id="__codelineno-0-1631" name="__codelineno-0-1631"></a><span class="sd">        Check if the time difference (ms) between the heading and the coordinates info is less</span>
</span><span id="__span-0-1632"><a id="__codelineno-0-1632" name="__codelineno-0-1632"></a><span class="sd">        than the time it takes the node to move a predefined distance with the actual speed.           </span>
</span><span id="__span-0-1633"><a id="__codelineno-0-1633" name="__codelineno-0-1633"></a><span class="sd">        If the node is not moving (self.SPEED = 0) it means the heading info will be always the same</span>
</span><span id="__span-0-1634"><a id="__codelineno-0-1634" name="__codelineno-0-1634"></a><span class="sd">        and the check is not required.</span>
</span><span id="__span-0-1635"><a id="__codelineno-0-1635" name="__codelineno-0-1635"></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="__span-0-1636"><a id="__codelineno-0-1636" name="__codelineno-0-1636"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">SPEED_NODE</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-0-1637"><a id="__codelineno-0-1637" name="__codelineno-0-1637"></a>            <span class="n">time_distance_allowed</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># meters</span>
</span><span id="__span-0-1638"><a id="__codelineno-0-1638" name="__codelineno-0-1638"></a>            <span class="k">if</span>  <span class="nb">abs</span><span class="p">(</span><span class="n">time_tag_coords</span> <span class="o">-</span> <span class="n">time_tag_heading</span><span class="p">)</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">time_distance_allowed</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">SPEED_NODE</span><span class="p">)</span><span class="o">*</span><span class="mi">1000</span><span class="p">:</span>
</span><span id="__span-0-1639"><a id="__codelineno-0-1639" name="__codelineno-0-1639"></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">[WARNING]: for the time_distance_allowed the heading info of the grounde node does not correspond to the coordinates&#39;</span><span class="p">)</span>
</span><span id="__span-0-1640"><a id="__codelineno-0-1640" name="__codelineno-0-1640"></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ERR_HELPER_CODE_GPS_HEAD_UNRELATED_2_COORD</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ERR_HELPER_CODE_GPS_HEAD_UNRELATED_2_COORD</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ERR_HELPER_CODE_GPS_HEAD_UNRELATED_2_COORD</span>
</span><span id="__span-0-1641"><a id="__codelineno-0-1641" name="__codelineno-0-1641"></a>
</span><span id="__span-0-1642"><a id="__codelineno-0-1642" name="__codelineno-0-1642"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;GROUND&#39;</span><span class="p">:</span>
</span><span id="__span-0-1643"><a id="__codelineno-0-1643" name="__codelineno-0-1643"></a>        <span class="c1"># Convert Geocentric WGS84 to Geodetic to compute distance and Inverse Transform Forward Azimuth (ITFA) </span>
</span><span id="__span-0-1644"><a id="__codelineno-0-1644" name="__codelineno-0-1644"></a>            <span class="k">if</span> <span class="n">datum_coordinates</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-0-1645"><a id="__codelineno-0-1645" name="__codelineno-0-1645"></a>                <span class="n">lat_ground</span><span class="p">,</span> <span class="n">lon_ground</span><span class="p">,</span> <span class="n">height_ground</span> <span class="o">=</span> <span class="n">geocentric2geodetic</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">])</span>
</span><span id="__span-0-1646"><a id="__codelineno-0-1646" name="__codelineno-0-1646"></a>            <span class="c1"># Geocentric ETRS89</span>
</span><span id="__span-0-1647"><a id="__codelineno-0-1647" name="__codelineno-0-1647"></a>            <span class="k">elif</span> <span class="n">datum_coordinates</span> <span class="o">==</span> <span class="mi">30</span><span class="p">:</span>
</span><span id="__span-0-1648"><a id="__codelineno-0-1648" name="__codelineno-0-1648"></a>                <span class="n">lat_ground</span><span class="p">,</span> <span class="n">lon_ground</span><span class="p">,</span> <span class="n">height_ground</span> <span class="o">=</span> <span class="n">geocentric2geodetic</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">],</span> <span class="n">EPSG_GEOCENTRIC</span><span class="o">=</span><span class="mi">4346</span><span class="p">)</span>
</span><span id="__span-0-1649"><a id="__codelineno-0-1649" name="__codelineno-0-1649"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1650"><a id="__codelineno-0-1650" name="__codelineno-0-1650"></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">[ERROR]: Not known geocentric datum&#39;</span><span class="p">)</span>
</span><span id="__span-0-1651"><a id="__codelineno-0-1651" name="__codelineno-0-1651"></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ERR_HELPER_CODE_GPS_NOT_KNOWN_DATUM</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ERR_HELPER_CODE_GPS_NOT_KNOWN_DATUM</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ERR_HELPER_CODE_GPS_NOT_KNOWN_DATUM</span>
</span><span id="__span-0-1652"><a id="__codelineno-0-1652" name="__codelineno-0-1652"></a>
</span><span id="__span-0-1653"><a id="__codelineno-0-1653" name="__codelineno-0-1653"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;DRONE&#39;</span><span class="p">:</span>
</span><span id="__span-0-1654"><a id="__codelineno-0-1654" name="__codelineno-0-1654"></a>            <span class="c1"># Convert Geocentric WGS84 to Geodetic to compute distance and Inverse Transform Forward Azimuth (ITFA) </span>
</span><span id="__span-0-1655"><a id="__codelineno-0-1655" name="__codelineno-0-1655"></a>            <span class="k">if</span> <span class="n">datum_coordinates</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-0-1656"><a id="__codelineno-0-1656" name="__codelineno-0-1656"></a>                <span class="n">lat_drone</span><span class="p">,</span> <span class="n">lon_drone</span><span class="p">,</span> <span class="n">height_drone</span> <span class="o">=</span> <span class="n">geocentric2geodetic</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">])</span>
</span><span id="__span-0-1657"><a id="__codelineno-0-1657" name="__codelineno-0-1657"></a>            <span class="c1"># Geocentric ETRS89</span>
</span><span id="__span-0-1658"><a id="__codelineno-0-1658" name="__codelineno-0-1658"></a>            <span class="k">elif</span> <span class="n">datum_coordinates</span> <span class="o">==</span> <span class="mi">30</span><span class="p">:</span>
</span><span id="__span-0-1659"><a id="__codelineno-0-1659" name="__codelineno-0-1659"></a>                <span class="n">lat_drone</span><span class="p">,</span> <span class="n">lon_drone</span><span class="p">,</span> <span class="n">height_drone</span> <span class="o">=</span> <span class="n">geocentric2geodetic</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">],</span> <span class="n">EPSG_GEOCENTRIC</span><span class="o">=</span><span class="mi">4346</span><span class="p">)</span>
</span><span id="__span-0-1660"><a id="__codelineno-0-1660" name="__codelineno-0-1660"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1661"><a id="__codelineno-0-1661" name="__codelineno-0-1661"></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">[ERROR]: Not known geocentric datum&#39;</span><span class="p">)</span>
</span><span id="__span-0-1662"><a id="__codelineno-0-1662" name="__codelineno-0-1662"></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ERR_HELPER_CODE_GPS_NOT_KNOWN_DATUM</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ERR_HELPER_CODE_GPS_NOT_KNOWN_DATUM</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ERR_HELPER_CODE_GPS_NOT_KNOWN_DATUM</span>
</span><span id="__span-0-1663"><a id="__codelineno-0-1663" name="__codelineno-0-1663"></a>    <span class="c1"># Testing mode</span>
</span><span id="__span-0-1664"><a id="__codelineno-0-1664" name="__codelineno-0-1664"></a>    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">IsGPS</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="__span-0-1665"><a id="__codelineno-0-1665" name="__codelineno-0-1665"></a>        <span class="c1"># Both coordinates must be provided and must be in geodetic format</span>
</span><span id="__span-0-1666"><a id="__codelineno-0-1666" name="__codelineno-0-1666"></a>        <span class="mi">1</span>
</span><span id="__span-0-1667"><a id="__codelineno-0-1667" name="__codelineno-0-1667"></a>
</span><span id="__span-0-1668"><a id="__codelineno-0-1668" name="__codelineno-0-1668"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">lat_ground</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">lat_drone</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">lon_ground</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">lon_drone</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">height_ground</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">height_drone</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="__span-0-1669"><a id="__codelineno-0-1669" name="__codelineno-0-1669"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[ERROR]: Either ground or drone coordinates MUST be provided&quot;</span><span class="p">)</span>
</span><span id="__span-0-1670"><a id="__codelineno-0-1670" name="__codelineno-0-1670"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ERR_HELPER_CODE_BOTH_NODES_COORDS_CANTBE_EMPTY</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ERR_HELPER_CODE_BOTH_NODES_COORDS_CANTBE_EMPTY</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ERR_HELPER_CODE_BOTH_NODES_COORDS_CANTBE_EMPTY</span>       
</span><span id="__span-0-1671"><a id="__codelineno-0-1671" name="__codelineno-0-1671"></a>
</span><span id="__span-0-1672"><a id="__codelineno-0-1672" name="__codelineno-0-1672"></a>    <span class="k">if</span> <span class="n">fmode</span> <span class="o">==</span> <span class="mh">0x00</span><span class="p">:</span> <span class="c1"># Azimuth and elevation</span>
</span><span id="__span-0-1673"><a id="__codelineno-0-1673" name="__codelineno-0-1673"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;DRONE&#39;</span><span class="p">:</span>
</span><span id="__span-0-1674"><a id="__codelineno-0-1674" name="__codelineno-0-1674"></a>            <span class="n">yaw_to_set</span> <span class="o">=</span> <span class="n">azimuth_difference_between_coordinates</span><span class="p">(</span><span class="n">heading</span><span class="p">,</span> <span class="n">lat_drone</span><span class="p">,</span> <span class="n">lon_drone</span><span class="p">,</span> <span class="n">lat_ground</span><span class="p">,</span> <span class="n">lon_ground</span><span class="p">)</span>
</span><span id="__span-0-1675"><a id="__codelineno-0-1675" name="__codelineno-0-1675"></a>            <span class="n">pitch_to_set</span> <span class="o">=</span> <span class="n">elevation_difference_between_coordinates</span><span class="p">(</span><span class="n">lat_drone</span><span class="p">,</span> <span class="n">lon_drone</span><span class="p">,</span> <span class="n">height_drone</span><span class="p">,</span> <span class="n">lat_ground</span><span class="p">,</span> <span class="n">lon_ground</span><span class="p">,</span> <span class="n">height_ground</span><span class="p">)</span>
</span><span id="__span-0-1676"><a id="__codelineno-0-1676" name="__codelineno-0-1676"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;GROUND&#39;</span><span class="p">:</span>
</span><span id="__span-0-1677"><a id="__codelineno-0-1677" name="__codelineno-0-1677"></a>            <span class="n">yaw_to_set</span> <span class="o">=</span> <span class="n">azimuth_difference_between_coordinates</span><span class="p">(</span><span class="n">heading</span><span class="p">,</span> <span class="n">lat_ground</span><span class="p">,</span> <span class="n">lon_ground</span><span class="p">,</span> <span class="n">lat_drone</span><span class="p">,</span> <span class="n">lon_drone</span><span class="p">)</span>
</span><span id="__span-0-1678"><a id="__codelineno-0-1678" name="__codelineno-0-1678"></a>            <span class="n">pitch_to_set</span> <span class="o">=</span> <span class="n">elevation_difference_between_coordinates</span><span class="p">(</span><span class="n">lat_ground</span><span class="p">,</span> <span class="n">lon_ground</span><span class="p">,</span> <span class="n">height_ground</span><span class="p">,</span> <span class="n">lat_drone</span><span class="p">,</span> <span class="n">lon_drone</span><span class="p">,</span> <span class="n">height_drone</span><span class="p">)</span>
</span><span id="__span-0-1679"><a id="__codelineno-0-1679" name="__codelineno-0-1679"></a>    <span class="k">elif</span> <span class="n">fmode</span> <span class="o">==</span> <span class="mh">0x02</span><span class="p">:</span> <span class="c1"># Azimuth</span>
</span><span id="__span-0-1680"><a id="__codelineno-0-1680" name="__codelineno-0-1680"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;DRONE&#39;</span><span class="p">:</span>
</span><span id="__span-0-1681"><a id="__codelineno-0-1681" name="__codelineno-0-1681"></a>            <span class="n">yaw_to_set</span> <span class="o">=</span> <span class="n">azimuth_difference_between_coordinates</span><span class="p">(</span><span class="n">heading</span><span class="p">,</span> <span class="n">lat_drone</span><span class="p">,</span> <span class="n">lon_drone</span><span class="p">,</span> <span class="n">lat_ground</span><span class="p">,</span> <span class="n">lon_ground</span><span class="p">)</span>
</span><span id="__span-0-1682"><a id="__codelineno-0-1682" name="__codelineno-0-1682"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;GROUND&#39;</span><span class="p">:</span>
</span><span id="__span-0-1683"><a id="__codelineno-0-1683" name="__codelineno-0-1683"></a>            <span class="n">yaw_to_set</span> <span class="o">=</span> <span class="n">azimuth_difference_between_coordinates</span><span class="p">(</span><span class="n">heading</span><span class="p">,</span> <span class="n">lat_ground</span><span class="p">,</span> <span class="n">lon_ground</span><span class="p">,</span> <span class="n">lat_drone</span><span class="p">,</span> <span class="n">lon_drone</span><span class="p">)</span>
</span><span id="__span-0-1684"><a id="__codelineno-0-1684" name="__codelineno-0-1684"></a>    <span class="k">elif</span> <span class="n">fmode</span> <span class="o">==</span> <span class="mh">0x01</span><span class="p">:</span> <span class="c1"># Elevation</span>
</span><span id="__span-0-1685"><a id="__codelineno-0-1685" name="__codelineno-0-1685"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;DRONE&#39;</span><span class="p">:</span>
</span><span id="__span-0-1686"><a id="__codelineno-0-1686" name="__codelineno-0-1686"></a>            <span class="n">pitch_to_set</span> <span class="o">=</span> <span class="n">elevation_difference_between_coordinates</span><span class="p">(</span><span class="n">lat_drone</span><span class="p">,</span> <span class="n">lon_drone</span><span class="p">,</span> <span class="n">height_drone</span><span class="p">,</span> <span class="n">lat_ground</span><span class="p">,</span> <span class="n">lon_ground</span><span class="p">,</span> <span class="n">height_ground</span><span class="p">)</span>
</span><span id="__span-0-1687"><a id="__codelineno-0-1687" name="__codelineno-0-1687"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;GROUND&#39;</span><span class="p">:</span>
</span><span id="__span-0-1688"><a id="__codelineno-0-1688" name="__codelineno-0-1688"></a>            <span class="n">pitch_to_set</span> <span class="o">=</span> <span class="n">elevation_difference_between_coordinates</span><span class="p">(</span><span class="n">lat_ground</span><span class="p">,</span> <span class="n">lon_ground</span><span class="p">,</span> <span class="n">height_ground</span><span class="p">,</span> <span class="n">lat_drone</span><span class="p">,</span> <span class="n">lon_drone</span><span class="p">,</span> <span class="n">height_drone</span><span class="p">)</span>
</span><span id="__span-0-1689"><a id="__codelineno-0-1689" name="__codelineno-0-1689"></a>
</span><span id="__span-0-1690"><a id="__codelineno-0-1690" name="__codelineno-0-1690"></a>    <span class="k">return</span> <span class="n">yaw_to_set</span><span class="p">,</span> <span class="n">pitch_to_set</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="a2gmeasurements.HelperA2GMeasurements.process_answer_get_gps" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_answer_get_gps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Callback function when this node receives an <code>ANS</code> type of message (the equivalent to an acknowledment) from the other node, after this node sent to the other node a <code>GETGPS</code> or a <code>FOLLOWGIMBAL</code> command.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>data</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dictionary with keys 'X', 'Y', 'Z', 'FMODE', 'FOLLOW_GIMBAL'. The values of 'X', 'Y', 'Z' are the geocentric coordinates from the other node. 'FMODE' is either 0x00 (Elevation and Azimuth), 0x01 (Elevation) or 0x02 (Azimuth). 'FOLLOW_GIMBAL' is either True (when the sent command by this node was <code>FOLLOWGIMBAL</code>) or False (when the sent command by this node was <code>GETGPS</code>)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>a2gmeasurements.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1904">1904</a></span>
<span class="normal"><a href="#__codelineno-0-1905">1905</a></span>
<span class="normal"><a href="#__codelineno-0-1906">1906</a></span>
<span class="normal"><a href="#__codelineno-0-1907">1907</a></span>
<span class="normal"><a href="#__codelineno-0-1908">1908</a></span>
<span class="normal"><a href="#__codelineno-0-1909">1909</a></span>
<span class="normal"><a href="#__codelineno-0-1910">1910</a></span>
<span class="normal"><a href="#__codelineno-0-1911">1911</a></span>
<span class="normal"><a href="#__codelineno-0-1912">1912</a></span>
<span class="normal"><a href="#__codelineno-0-1913">1913</a></span>
<span class="normal"><a href="#__codelineno-0-1914">1914</a></span>
<span class="normal"><a href="#__codelineno-0-1915">1915</a></span>
<span class="normal"><a href="#__codelineno-0-1916">1916</a></span>
<span class="normal"><a href="#__codelineno-0-1917">1917</a></span>
<span class="normal"><a href="#__codelineno-0-1918">1918</a></span>
<span class="normal"><a href="#__codelineno-0-1919">1919</a></span>
<span class="normal"><a href="#__codelineno-0-1920">1920</a></span>
<span class="normal"><a href="#__codelineno-0-1921">1921</a></span>
<span class="normal"><a href="#__codelineno-0-1922">1922</a></span>
<span class="normal"><a href="#__codelineno-0-1923">1923</a></span>
<span class="normal"><a href="#__codelineno-0-1924">1924</a></span>
<span class="normal"><a href="#__codelineno-0-1925">1925</a></span>
<span class="normal"><a href="#__codelineno-0-1926">1926</a></span>
<span class="normal"><a href="#__codelineno-0-1927">1927</a></span>
<span class="normal"><a href="#__codelineno-0-1928">1928</a></span>
<span class="normal"><a href="#__codelineno-0-1929">1929</a></span>
<span class="normal"><a href="#__codelineno-0-1930">1930</a></span>
<span class="normal"><a href="#__codelineno-0-1931">1931</a></span>
<span class="normal"><a href="#__codelineno-0-1932">1932</a></span>
<span class="normal"><a href="#__codelineno-0-1933">1933</a></span>
<span class="normal"><a href="#__codelineno-0-1934">1934</a></span>
<span class="normal"><a href="#__codelineno-0-1935">1935</a></span>
<span class="normal"><a href="#__codelineno-0-1936">1936</a></span>
<span class="normal"><a href="#__codelineno-0-1937">1937</a></span>
<span class="normal"><a href="#__codelineno-0-1938">1938</a></span>
<span class="normal"><a href="#__codelineno-0-1939">1939</a></span>
<span class="normal"><a href="#__codelineno-0-1940">1940</a></span>
<span class="normal"><a href="#__codelineno-0-1941">1941</a></span>
<span class="normal"><a href="#__codelineno-0-1942">1942</a></span>
<span class="normal"><a href="#__codelineno-0-1943">1943</a></span>
<span class="normal"><a href="#__codelineno-0-1944">1944</a></span>
<span class="normal"><a href="#__codelineno-0-1945">1945</a></span>
<span class="normal"><a href="#__codelineno-0-1946">1946</a></span>
<span class="normal"><a href="#__codelineno-0-1947">1947</a></span>
<span class="normal"><a href="#__codelineno-0-1948">1948</a></span>
<span class="normal"><a href="#__codelineno-0-1949">1949</a></span>
<span class="normal"><a href="#__codelineno-0-1950">1950</a></span>
<span class="normal"><a href="#__codelineno-0-1951">1951</a></span>
<span class="normal"><a href="#__codelineno-0-1952">1952</a></span>
<span class="normal"><a href="#__codelineno-0-1953">1953</a></span>
<span class="normal"><a href="#__codelineno-0-1954">1954</a></span>
<span class="normal"><a href="#__codelineno-0-1955">1955</a></span>
<span class="normal"><a href="#__codelineno-0-1956">1956</a></span>
<span class="normal"><a href="#__codelineno-0-1957">1957</a></span>
<span class="normal"><a href="#__codelineno-0-1958">1958</a></span>
<span class="normal"><a href="#__codelineno-0-1959">1959</a></span>
<span class="normal"><a href="#__codelineno-0-1960">1960</a></span>
<span class="normal"><a href="#__codelineno-0-1961">1961</a></span>
<span class="normal"><a href="#__codelineno-0-1962">1962</a></span>
<span class="normal"><a href="#__codelineno-0-1963">1963</a></span>
<span class="normal"><a href="#__codelineno-0-1964">1964</a></span>
<span class="normal"><a href="#__codelineno-0-1965">1965</a></span>
<span class="normal"><a href="#__codelineno-0-1966">1966</a></span>
<span class="normal"><a href="#__codelineno-0-1967">1967</a></span>
<span class="normal"><a href="#__codelineno-0-1968">1968</a></span>
<span class="normal"><a href="#__codelineno-0-1969">1969</a></span>
<span class="normal"><a href="#__codelineno-0-1970">1970</a></span>
<span class="normal"><a href="#__codelineno-0-1971">1971</a></span>
<span class="normal"><a href="#__codelineno-0-1972">1972</a></span>
<span class="normal"><a href="#__codelineno-0-1973">1973</a></span>
<span class="normal"><a href="#__codelineno-0-1974">1974</a></span>
<span class="normal"><a href="#__codelineno-0-1975">1975</a></span>
<span class="normal"><a href="#__codelineno-0-1976">1976</a></span>
<span class="normal"><a href="#__codelineno-0-1977">1977</a></span>
<span class="normal"><a href="#__codelineno-0-1978">1978</a></span>
<span class="normal"><a href="#__codelineno-0-1979">1979</a></span>
<span class="normal"><a href="#__codelineno-0-1980">1980</a></span>
<span class="normal"><a href="#__codelineno-0-1981">1981</a></span>
<span class="normal"><a href="#__codelineno-0-1982">1982</a></span>
<span class="normal"><a href="#__codelineno-0-1983">1983</a></span>
<span class="normal"><a href="#__codelineno-0-1984">1984</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1904"><a id="__codelineno-0-1904" name="__codelineno-0-1904"></a><span class="k">def</span> <span class="nf">process_answer_get_gps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span><span id="__span-0-1905"><a id="__codelineno-0-1905" name="__codelineno-0-1905"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-1906"><a id="__codelineno-0-1906" name="__codelineno-0-1906"></a><span class="sd">    Callback function when this node receives an ``ANS`` type of message (the equivalent to an acknowledment) from the other node, after this node sent to the other node a ``GETGPS`` or a ``FOLLOWGIMBAL`` command.</span>
</span><span id="__span-0-1907"><a id="__codelineno-0-1907" name="__codelineno-0-1907"></a>
</span><span id="__span-0-1908"><a id="__codelineno-0-1908" name="__codelineno-0-1908"></a><span class="sd">    Args:</span>
</span><span id="__span-0-1909"><a id="__codelineno-0-1909" name="__codelineno-0-1909"></a><span class="sd">        data (dict): dictionary with keys &#39;X&#39;, &#39;Y&#39;, &#39;Z&#39;, &#39;FMODE&#39;, &#39;FOLLOW_GIMBAL&#39;. The values of &#39;X&#39;, &#39;Y&#39;, &#39;Z&#39; are the geocentric coordinates from the other node. &#39;FMODE&#39; is either 0x00 (Elevation and Azimuth), 0x01 (Elevation) or 0x02 (Azimuth). &#39;FOLLOW_GIMBAL&#39; is either True (when the sent command by this node was ``FOLLOWGIMBAL``) or False (when the sent command by this node was ``GETGPS``)</span>
</span><span id="__span-0-1910"><a id="__codelineno-0-1910" name="__codelineno-0-1910"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-1911"><a id="__codelineno-0-1911" name="__codelineno-0-1911"></a>
</span><span id="__span-0-1912"><a id="__codelineno-0-1912" name="__codelineno-0-1912"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DBG_LVL_1</span><span class="p">:</span>
</span><span id="__span-0-1913"><a id="__codelineno-0-1913" name="__codelineno-0-1913"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;THIS (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="si">}</span><span class="s2">) receives protocol ANS&quot;</span><span class="p">)</span>
</span><span id="__span-0-1914"><a id="__codelineno-0-1914" name="__codelineno-0-1914"></a>
</span><span id="__span-0-1915"><a id="__codelineno-0-1915" name="__codelineno-0-1915"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span><span class="s1">&#39;DRONE&#39;</span><span class="p">:</span>
</span><span id="__span-0-1916"><a id="__codelineno-0-1916" name="__codelineno-0-1916"></a>        <span class="n">y_gnd</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span>
</span><span id="__span-0-1917"><a id="__codelineno-0-1917" name="__codelineno-0-1917"></a>        <span class="n">x_gnd</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span>
</span><span id="__span-0-1918"><a id="__codelineno-0-1918" name="__codelineno-0-1918"></a>
</span><span id="__span-0-1919"><a id="__codelineno-0-1919" name="__codelineno-0-1919"></a>        <span class="n">datum_coordinates</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Datum&#39;</span><span class="p">]</span>
</span><span id="__span-0-1920"><a id="__codelineno-0-1920" name="__codelineno-0-1920"></a>
</span><span id="__span-0-1921"><a id="__codelineno-0-1921" name="__codelineno-0-1921"></a>        <span class="k">if</span> <span class="n">y_gnd</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_NO_COORD_AVAIL</span> <span class="ow">or</span> <span class="n">x_gnd</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_NO_COORD_AVAIL</span><span class="p">:</span>
</span><span id="__span-0-1922"><a id="__codelineno-0-1922" name="__codelineno-0-1922"></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[ERROR]: no GPS coordinates received from DRONE through socket link&#39;</span><span class="p">)</span>
</span><span id="__span-0-1923"><a id="__codelineno-0-1923" name="__codelineno-0-1923"></a>            <span class="k">return</span>
</span><span id="__span-0-1924"><a id="__codelineno-0-1924" name="__codelineno-0-1924"></a>
</span><span id="__span-0-1925"><a id="__codelineno-0-1925" name="__codelineno-0-1925"></a>            <span class="c1"># THE HEIGHT VALUE IS THE ALTITUDE VALUE OVER THE SEA LEVEL</span>
</span><span id="__span-0-1926"><a id="__codelineno-0-1926" name="__codelineno-0-1926"></a>            <span class="c1"># Z is in geocentric coordinates and does not correspond to the actual height:</span>
</span><span id="__span-0-1927"><a id="__codelineno-0-1927" name="__codelineno-0-1927"></a>            <span class="c1"># Geocentric WGS84</span>
</span><span id="__span-0-1928"><a id="__codelineno-0-1928" name="__codelineno-0-1928"></a>        <span class="k">if</span> <span class="n">datum_coordinates</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-0-1929"><a id="__codelineno-0-1929" name="__codelineno-0-1929"></a>            <span class="n">lat_gnd</span><span class="p">,</span> <span class="n">lon_gnd</span><span class="p">,</span> <span class="n">height_gnd</span> <span class="o">=</span> <span class="n">geocentric2geodetic</span><span class="p">(</span><span class="n">x_gnd</span><span class="p">,</span> <span class="n">y_gnd</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">])</span>
</span><span id="__span-0-1930"><a id="__codelineno-0-1930" name="__codelineno-0-1930"></a>            <span class="c1"># Geocentric ETRS89</span>
</span><span id="__span-0-1931"><a id="__codelineno-0-1931" name="__codelineno-0-1931"></a>        <span class="k">elif</span> <span class="n">datum_coordinates</span> <span class="o">==</span> <span class="mi">30</span><span class="p">:</span>
</span><span id="__span-0-1932"><a id="__codelineno-0-1932" name="__codelineno-0-1932"></a>            <span class="n">lat_gnd</span><span class="p">,</span> <span class="n">lon_gnd</span><span class="p">,</span> <span class="n">height_gnd</span> <span class="o">=</span> <span class="n">geocentric2geodetic</span><span class="p">(</span><span class="n">x_gnd</span><span class="p">,</span> <span class="n">y_gnd</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">],</span> <span class="n">EPSG_GEOCENTRIC</span><span class="o">=</span><span class="mi">4346</span><span class="p">)</span>
</span><span id="__span-0-1933"><a id="__codelineno-0-1933" name="__codelineno-0-1933"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1934"><a id="__codelineno-0-1934" name="__codelineno-0-1934"></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[ERROR]: Not known geocentric datum&#39;</span><span class="p">)</span>
</span><span id="__span-0-1935"><a id="__codelineno-0-1935" name="__codelineno-0-1935"></a>            <span class="k">return</span>
</span><span id="__span-0-1936"><a id="__codelineno-0-1936" name="__codelineno-0-1936"></a>
</span><span id="__span-0-1937"><a id="__codelineno-0-1937" name="__codelineno-0-1937"></a>        <span class="n">yaw_to_set</span><span class="p">,</span> <span class="n">pitch_to_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gimbal_follows_drone</span><span class="p">(</span><span class="n">lat_ground</span><span class="o">=</span><span class="n">lat_gnd</span><span class="p">,</span> <span class="n">lon_ground</span><span class="o">=</span><span class="n">lon_gnd</span><span class="p">,</span> <span class="n">height_ground</span><span class="o">=</span><span class="n">height_gnd</span><span class="p">,</span> <span class="n">fmode</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;FMODE&#39;</span><span class="p">])</span>
</span><span id="__span-0-1938"><a id="__codelineno-0-1938" name="__codelineno-0-1938"></a>
</span><span id="__span-0-1939"><a id="__codelineno-0-1939" name="__codelineno-0-1939"></a>        <span class="k">while</span> <span class="p">((</span><span class="n">yaw_to_set</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_SMALL_BUFF_SZ</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">pitch_to_set</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_SMALL_BUFF_SZ</span><span class="p">)):</span>
</span><span id="__span-0-1940"><a id="__codelineno-0-1940" name="__codelineno-0-1940"></a>            <span class="n">yaw_to_set</span><span class="p">,</span> <span class="n">pitch_to_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gimbal_follows_drone</span><span class="p">(</span><span class="n">lat_ground</span><span class="o">=</span><span class="n">lat_gnd</span><span class="p">,</span> <span class="n">lon_ground</span><span class="o">=</span><span class="n">lon_gnd</span><span class="p">,</span> <span class="n">height_ground</span><span class="o">=</span><span class="n">height_gnd</span><span class="p">,</span> <span class="n">fmode</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;FMODE&#39;</span><span class="p">])</span>
</span><span id="__span-0-1941"><a id="__codelineno-0-1941" name="__codelineno-0-1941"></a>    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;GROUND&#39;</span><span class="p">:</span>
</span><span id="__span-0-1942"><a id="__codelineno-0-1942" name="__codelineno-0-1942"></a>        <span class="n">y_drone</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span>
</span><span id="__span-0-1943"><a id="__codelineno-0-1943" name="__codelineno-0-1943"></a>        <span class="n">x_drone</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span>
</span><span id="__span-0-1944"><a id="__codelineno-0-1944" name="__codelineno-0-1944"></a>
</span><span id="__span-0-1945"><a id="__codelineno-0-1945" name="__codelineno-0-1945"></a>        <span class="n">datum_coordinates</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Datum&#39;</span><span class="p">]</span>
</span><span id="__span-0-1946"><a id="__codelineno-0-1946" name="__codelineno-0-1946"></a>
</span><span id="__span-0-1947"><a id="__codelineno-0-1947" name="__codelineno-0-1947"></a>        <span class="k">if</span> <span class="n">y_drone</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_NO_COORD_AVAIL</span> <span class="ow">or</span> <span class="n">x_drone</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_NO_COORD_AVAIL</span><span class="p">:</span>
</span><span id="__span-0-1948"><a id="__codelineno-0-1948" name="__codelineno-0-1948"></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[ERROR]: no GPS coordinates received from DRONE through socket link&#39;</span><span class="p">)</span>
</span><span id="__span-0-1949"><a id="__codelineno-0-1949" name="__codelineno-0-1949"></a>            <span class="k">return</span>
</span><span id="__span-0-1950"><a id="__codelineno-0-1950" name="__codelineno-0-1950"></a>
</span><span id="__span-0-1951"><a id="__codelineno-0-1951" name="__codelineno-0-1951"></a>            <span class="c1"># Z is in geocentric coordinates and does not correspond to the actual height:</span>
</span><span id="__span-0-1952"><a id="__codelineno-0-1952" name="__codelineno-0-1952"></a>            <span class="c1"># Geocentric WGS84</span>
</span><span id="__span-0-1953"><a id="__codelineno-0-1953" name="__codelineno-0-1953"></a>        <span class="k">if</span> <span class="n">datum_coordinates</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-0-1954"><a id="__codelineno-0-1954" name="__codelineno-0-1954"></a>            <span class="n">lat_drone</span><span class="p">,</span> <span class="n">lon_drone</span><span class="p">,</span> <span class="n">height_drone</span> <span class="o">=</span> <span class="n">geocentric2geodetic</span><span class="p">(</span><span class="n">x_drone</span><span class="p">,</span> <span class="n">y_drone</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">])</span>
</span><span id="__span-0-1955"><a id="__codelineno-0-1955" name="__codelineno-0-1955"></a>            <span class="c1"># Geocentric ETRS89</span>
</span><span id="__span-0-1956"><a id="__codelineno-0-1956" name="__codelineno-0-1956"></a>        <span class="k">elif</span> <span class="n">datum_coordinates</span> <span class="o">==</span> <span class="mi">30</span><span class="p">:</span>
</span><span id="__span-0-1957"><a id="__codelineno-0-1957" name="__codelineno-0-1957"></a>            <span class="n">lat_drone</span><span class="p">,</span> <span class="n">lon_drone</span><span class="p">,</span> <span class="n">height_drone</span> <span class="o">=</span> <span class="n">geocentric2geodetic</span><span class="p">(</span><span class="n">x_drone</span><span class="p">,</span> <span class="n">y_drone</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Z&#39;</span><span class="p">],</span> <span class="n">EPSG_GEOCENTRIC</span><span class="o">=</span><span class="mi">4346</span><span class="p">)</span>
</span><span id="__span-0-1958"><a id="__codelineno-0-1958" name="__codelineno-0-1958"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1959"><a id="__codelineno-0-1959" name="__codelineno-0-1959"></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[ERROR]: Not known geocentric datum&#39;</span><span class="p">)</span>
</span><span id="__span-0-1960"><a id="__codelineno-0-1960" name="__codelineno-0-1960"></a>            <span class="k">return</span>
</span><span id="__span-0-1961"><a id="__codelineno-0-1961" name="__codelineno-0-1961"></a>
</span><span id="__span-0-1962"><a id="__codelineno-0-1962" name="__codelineno-0-1962"></a>        <span class="c1"># This is for GUI GPS panel to show drone coordinates</span>
</span><span id="__span-0-1963"><a id="__codelineno-0-1963" name="__codelineno-0-1963"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">last_drone_coords_requested</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;LAT&#39;</span><span class="p">:</span> <span class="n">lat_drone</span><span class="p">,</span> <span class="s1">&#39;LON&#39;</span><span class="p">:</span> <span class="n">lon_drone</span><span class="p">}</span>
</span><span id="__span-0-1964"><a id="__codelineno-0-1964" name="__codelineno-0-1964"></a>
</span><span id="__span-0-1965"><a id="__codelineno-0-1965" name="__codelineno-0-1965"></a>        <span class="n">yaw_to_set</span><span class="p">,</span> <span class="n">pitch_to_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gimbal_follows_drone</span><span class="p">(</span><span class="n">lat_drone</span><span class="o">=</span><span class="n">lat_drone</span><span class="p">,</span> <span class="n">lon_drone</span><span class="o">=</span><span class="n">lon_drone</span><span class="p">,</span> <span class="n">height_drone</span><span class="o">=</span><span class="n">height_drone</span><span class="p">,</span> <span class="n">fmode</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;FMODE&#39;</span><span class="p">])</span>
</span><span id="__span-0-1966"><a id="__codelineno-0-1966" name="__codelineno-0-1966"></a>
</span><span id="__span-0-1967"><a id="__codelineno-0-1967" name="__codelineno-0-1967"></a>            <span class="c1"># If error [yaw, pitch] values because not enough gps buffer entries (but gps already has entries, meaning is working), call again the gimbal_follows_drone method</span>
</span><span id="__span-0-1968"><a id="__codelineno-0-1968" name="__codelineno-0-1968"></a>        <span class="k">while</span> <span class="p">((</span><span class="n">yaw_to_set</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_SMALL_BUFF_SZ</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">pitch_to_set</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_SMALL_BUFF_SZ</span><span class="p">)):</span>
</span><span id="__span-0-1969"><a id="__codelineno-0-1969" name="__codelineno-0-1969"></a>            <span class="n">yaw_to_set</span><span class="p">,</span> <span class="n">pitch_to_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gimbal_follows_drone</span><span class="p">(</span><span class="n">lat_drone</span><span class="o">=</span><span class="n">lat_drone</span><span class="p">,</span> <span class="n">lon_drone</span><span class="o">=</span><span class="n">lon_drone</span><span class="p">,</span> <span class="n">height_drone</span><span class="o">=</span><span class="n">height_drone</span><span class="p">,</span> <span class="n">fmode</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;FMODE&#39;</span><span class="p">])</span>
</span><span id="__span-0-1970"><a id="__codelineno-0-1970" name="__codelineno-0-1970"></a>
</span><span id="__span-0-1971"><a id="__codelineno-0-1971" name="__codelineno-0-1971"></a>    <span class="k">if</span> <span class="n">yaw_to_set</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ERR_HELPER_CODE_GPS_HEAD_UNRELATED_2_COORD</span> <span class="ow">or</span> <span class="n">yaw_to_set</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ERR_HELPER_CODE_GPS_NOT_KNOWN_DATUM</span> <span class="ow">or</span> <span class="n">yaw_to_set</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ERR_HELPER_CODE_BOTH_NODES_COORDS_CANTBE_EMPTY</span> <span class="ow">or</span> <span class="n">yaw_to_set</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">mySeptentrioGPS</span><span class="o">.</span><span class="n">ERR_GPS_CODE_BUFF_NULL</span><span class="p">:</span>
</span><span id="__span-0-1972"><a id="__codelineno-0-1972" name="__codelineno-0-1972"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[ERROR]: one of the error codes of gimbal_follows_drone persists&#39;</span><span class="p">)</span>
</span><span id="__span-0-1973"><a id="__codelineno-0-1973" name="__codelineno-0-1973"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG]: This </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="si">}</span><span class="s2"> gimbal will NOT follow its pair node due to ERROR&quot;</span><span class="p">)</span>
</span><span id="__span-0-1974"><a id="__codelineno-0-1974" name="__codelineno-0-1974"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1975"><a id="__codelineno-0-1975" name="__codelineno-0-1975"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG]: This </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="si">}</span><span class="s2"> YAW to set is: </span><span class="si">{</span><span class="n">yaw_to_set</span><span class="si">}</span><span class="s2">, and PITCH to set is: </span><span class="si">{</span><span class="n">pitch_to_set</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-0-1976"><a id="__codelineno-0-1976" name="__codelineno-0-1976"></a>
</span><span id="__span-0-1977"><a id="__codelineno-0-1977" name="__codelineno-0-1977"></a>        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;FOLLOW_GIMBAL&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x01</span><span class="p">:</span> <span class="c1"># True, Follow gimbal</span>
</span><span id="__span-0-1978"><a id="__codelineno-0-1978" name="__codelineno-0-1978"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">IsGimbal</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="c1"># There is a gimbal at the node that receives the answer to its command request.</span>
</span><span id="__span-0-1979"><a id="__codelineno-0-1979" name="__codelineno-0-1979"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">myGimbal</span><span class="o">.</span><span class="n">setPosControl</span><span class="p">(</span><span class="n">yaw</span><span class="o">=</span><span class="n">yaw_to_set</span><span class="p">,</span> <span class="n">pitch</span><span class="o">=</span><span class="n">pitch_to_set</span><span class="p">)</span> 
</span><span id="__span-0-1980"><a id="__codelineno-0-1980" name="__codelineno-0-1980"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG]: This </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="si">}</span><span class="s2"> gimbal WILL follow its pair node as stated by user&quot;</span><span class="p">)</span>
</span><span id="__span-0-1981"><a id="__codelineno-0-1981" name="__codelineno-0-1981"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1982"><a id="__codelineno-0-1982" name="__codelineno-0-1982"></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[WARNING]: No gimbal available, so no rotation will happen&#39;</span><span class="p">)</span>
</span><span id="__span-0-1983"><a id="__codelineno-0-1983" name="__codelineno-0-1983"></a>        <span class="k">elif</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;FOLLOW_GIMBAL&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x02</span><span class="p">:</span> <span class="c1"># False</span>
</span><span id="__span-0-1984"><a id="__codelineno-0-1984" name="__codelineno-0-1984"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG]: This </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="si">}</span><span class="s2"> gimbal will NOT follow its pair node as stated by user&quot;</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="a2gmeasurements.HelperA2GMeasurements.socket_receive" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">socket_receive</span><span class="p">(</span><span class="n">stop_event</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>The communication thread callback. Calls the parser to decode the most recent TCP message received.</p>
<p>The time between calls of this function is OS and hardware dependent.</p>
<p>As both nodes can send and receive messages, this thread</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>stop_event</code></td>
            <td>
                  <code><span title="threading.Event">Event</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>when this is set, this function has nothing to execute.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>a2gmeasurements.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-2133">2133</a></span>
<span class="normal"><a href="#__codelineno-0-2134">2134</a></span>
<span class="normal"><a href="#__codelineno-0-2135">2135</a></span>
<span class="normal"><a href="#__codelineno-0-2136">2136</a></span>
<span class="normal"><a href="#__codelineno-0-2137">2137</a></span>
<span class="normal"><a href="#__codelineno-0-2138">2138</a></span>
<span class="normal"><a href="#__codelineno-0-2139">2139</a></span>
<span class="normal"><a href="#__codelineno-0-2140">2140</a></span>
<span class="normal"><a href="#__codelineno-0-2141">2141</a></span>
<span class="normal"><a href="#__codelineno-0-2142">2142</a></span>
<span class="normal"><a href="#__codelineno-0-2143">2143</a></span>
<span class="normal"><a href="#__codelineno-0-2144">2144</a></span>
<span class="normal"><a href="#__codelineno-0-2145">2145</a></span>
<span class="normal"><a href="#__codelineno-0-2146">2146</a></span>
<span class="normal"><a href="#__codelineno-0-2147">2147</a></span>
<span class="normal"><a href="#__codelineno-0-2148">2148</a></span>
<span class="normal"><a href="#__codelineno-0-2149">2149</a></span>
<span class="normal"><a href="#__codelineno-0-2150">2150</a></span>
<span class="normal"><a href="#__codelineno-0-2151">2151</a></span>
<span class="normal"><a href="#__codelineno-0-2152">2152</a></span>
<span class="normal"><a href="#__codelineno-0-2153">2153</a></span>
<span class="normal"><a href="#__codelineno-0-2154">2154</a></span>
<span class="normal"><a href="#__codelineno-0-2155">2155</a></span>
<span class="normal"><a href="#__codelineno-0-2156">2156</a></span>
<span class="normal"><a href="#__codelineno-0-2157">2157</a></span>
<span class="normal"><a href="#__codelineno-0-2158">2158</a></span>
<span class="normal"><a href="#__codelineno-0-2159">2159</a></span>
<span class="normal"><a href="#__codelineno-0-2160">2160</a></span>
<span class="normal"><a href="#__codelineno-0-2161">2161</a></span>
<span class="normal"><a href="#__codelineno-0-2162">2162</a></span>
<span class="normal"><a href="#__codelineno-0-2163">2163</a></span>
<span class="normal"><a href="#__codelineno-0-2164">2164</a></span>
<span class="normal"><a href="#__codelineno-0-2165">2165</a></span>
<span class="normal"><a href="#__codelineno-0-2166">2166</a></span>
<span class="normal"><a href="#__codelineno-0-2167">2167</a></span>
<span class="normal"><a href="#__codelineno-0-2168">2168</a></span>
<span class="normal"><a href="#__codelineno-0-2169">2169</a></span>
<span class="normal"><a href="#__codelineno-0-2170">2170</a></span>
<span class="normal"><a href="#__codelineno-0-2171">2171</a></span>
<span class="normal"><a href="#__codelineno-0-2172">2172</a></span>
<span class="normal"><a href="#__codelineno-0-2173">2173</a></span>
<span class="normal"><a href="#__codelineno-0-2174">2174</a></span>
<span class="normal"><a href="#__codelineno-0-2175">2175</a></span>
<span class="normal"><a href="#__codelineno-0-2176">2176</a></span>
<span class="normal"><a href="#__codelineno-0-2177">2177</a></span>
<span class="normal"><a href="#__codelineno-0-2178">2178</a></span>
<span class="normal"><a href="#__codelineno-0-2179">2179</a></span>
<span class="normal"><a href="#__codelineno-0-2180">2180</a></span>
<span class="normal"><a href="#__codelineno-0-2181">2181</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-2133"><a id="__codelineno-0-2133" name="__codelineno-0-2133"></a><span class="k">def</span> <span class="nf">socket_receive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stop_event</span><span class="p">):</span>
</span><span id="__span-0-2134"><a id="__codelineno-0-2134" name="__codelineno-0-2134"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-2135"><a id="__codelineno-0-2135" name="__codelineno-0-2135"></a><span class="sd">    The communication thread callback. Calls the parser to decode the most recent TCP message received.</span>
</span><span id="__span-0-2136"><a id="__codelineno-0-2136" name="__codelineno-0-2136"></a>
</span><span id="__span-0-2137"><a id="__codelineno-0-2137" name="__codelineno-0-2137"></a><span class="sd">    The time between calls of this function is OS and hardware dependent.</span>
</span><span id="__span-0-2138"><a id="__codelineno-0-2138" name="__codelineno-0-2138"></a>
</span><span id="__span-0-2139"><a id="__codelineno-0-2139" name="__codelineno-0-2139"></a><span class="sd">    As both nodes can send and receive messages, this thread</span>
</span><span id="__span-0-2140"><a id="__codelineno-0-2140" name="__codelineno-0-2140"></a>
</span><span id="__span-0-2141"><a id="__codelineno-0-2141" name="__codelineno-0-2141"></a><span class="sd">    Args:</span>
</span><span id="__span-0-2142"><a id="__codelineno-0-2142" name="__codelineno-0-2142"></a><span class="sd">        stop_event (threading.Event): when this is set, this function has nothing to execute.</span>
</span><span id="__span-0-2143"><a id="__codelineno-0-2143" name="__codelineno-0-2143"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-2144"><a id="__codelineno-0-2144" name="__codelineno-0-2144"></a>
</span><span id="__span-0-2145"><a id="__codelineno-0-2145" name="__codelineno-0-2145"></a>    <span class="c1"># Polling policy for detecting if there has been any message sent.</span>
</span><span id="__span-0-2146"><a id="__codelineno-0-2146" name="__codelineno-0-2146"></a>    <span class="c1"># As th thread is scheduled often in the order of ms, this implementation will raise an exception (if nothing is send) quite often</span>
</span><span id="__span-0-2147"><a id="__codelineno-0-2147" name="__codelineno-0-2147"></a>    <span class="k">while</span> <span class="ow">not</span> <span class="n">stop_event</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
</span><span id="__span-0-2148"><a id="__codelineno-0-2148" name="__codelineno-0-2148"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-2149"><a id="__codelineno-0-2149" name="__codelineno-0-2149"></a>            <span class="c1"># Send everything in a json serialized packet</span>
</span><span id="__span-0-2150"><a id="__codelineno-0-2150" name="__codelineno-0-2150"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;GROUND&#39;</span><span class="p">:</span>
</span><span id="__span-0-2151"><a id="__codelineno-0-2151" name="__codelineno-0-2151"></a>                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a2g_conn</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">4096</span><span class="p">)</span> <span class="c1"># Up to 1 message of 63 rows and 16 cols of float32 entries</span>
</span><span id="__span-0-2152"><a id="__codelineno-0-2152" name="__codelineno-0-2152"></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;DRONE&#39;</span><span class="p">:</span>
</span><span id="__span-0-2153"><a id="__codelineno-0-2153" name="__codelineno-0-2153"></a>                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">4096</span><span class="p">)</span>
</span><span id="__span-0-2154"><a id="__codelineno-0-2154" name="__codelineno-0-2154"></a>            <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
</span><span id="__span-0-2155"><a id="__codelineno-0-2155" name="__codelineno-0-2155"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DBG_LVL_0</span><span class="p">:</span>
</span><span id="__span-0-2156"><a id="__codelineno-0-2156" name="__codelineno-0-2156"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">[DEBUG_0]: This is the data received: &#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span><span id="__span-0-2157"><a id="__codelineno-0-2157" name="__codelineno-0-2157"></a>                <span class="c1">#print(&#39;[DEBUG]: This is the data received: &#39;, len(data[&#39;DATA&#39;]), len(data[&#39;DATA&#39;][0]))</span>
</span><span id="__span-0-2158"><a id="__codelineno-0-2158" name="__codelineno-0-2158"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">decode_message</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-0-2159"><a id="__codelineno-0-2159" name="__codelineno-0-2159"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2160"><a id="__codelineno-0-2160" name="__codelineno-0-2160"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DBG_LVL_0</span><span class="p">:</span>
</span><span id="__span-0-2161"><a id="__codelineno-0-2161" name="__codelineno-0-2161"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">[DEBUG_0]: &quot;data&quot; in &quot;if data&quot; in &quot;socket_receive&quot; is None&#39;</span><span class="p">)</span>
</span><span id="__span-0-2162"><a id="__codelineno-0-2162" name="__codelineno-0-2162"></a>        <span class="c1"># i.e.  Didn&#39;t receive anything</span>
</span><span id="__span-0-2163"><a id="__codelineno-0-2163" name="__codelineno-0-2163"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-2164"><a id="__codelineno-0-2164" name="__codelineno-0-2164"></a>            <span class="c1"># Handle the assumed connection lost</span>
</span><span id="__span-0-2165"><a id="__codelineno-0-2165" name="__codelineno-0-2165"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rxEmptySockCounter</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">MAX_NUM_RX_EMPTY_SOCKETS</span><span class="p">:</span>
</span><span id="__span-0-2166"><a id="__codelineno-0-2166" name="__codelineno-0-2166"></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">[WARNING]:SOCKETS HAVE BEEN EMPTY FOR LONG TIME. DRONE MUST COME CLOSER &#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="__span-0-2167"><a id="__codelineno-0-2167" name="__codelineno-0-2167"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">rxEmptySockCounter</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-0-2168"><a id="__codelineno-0-2168" name="__codelineno-0-2168"></a>
</span><span id="__span-0-2169"><a id="__codelineno-0-2169" name="__codelineno-0-2169"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">rxEmptySockCounter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rxEmptySockCounter</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="__span-0-2170"><a id="__codelineno-0-2170" name="__codelineno-0-2170"></a>
</span><span id="__span-0-2171"><a id="__codelineno-0-2171" name="__codelineno-0-2171"></a>            <span class="c1">#traceback.print_exc()</span>
</span><span id="__span-0-2172"><a id="__codelineno-0-2172" name="__codelineno-0-2172"></a><span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="__span-0-2173"><a id="__codelineno-0-2173" name="__codelineno-0-2173"></a><span class="sd">            Types of known errors:</span>
</span><span id="__span-0-2174"><a id="__codelineno-0-2174" name="__codelineno-0-2174"></a><span class="sd">            1. &#39;timed out&#39;</span>
</span><span id="__span-0-2175"><a id="__codelineno-0-2175" name="__codelineno-0-2175"></a>
</span><span id="__span-0-2176"><a id="__codelineno-0-2176" name="__codelineno-0-2176"></a><span class="sd">            *This error is reported in the client but not in the server. Happens when the client hasn&#39;t received anything in a while, so that &#39;recv&#39; function raises the exception.</span>
</span><span id="__span-0-2177"><a id="__codelineno-0-2177" name="__codelineno-0-2177"></a><span class="sd">            *The conn is open and if any node send something again the other node will receive it</span>
</span><span id="__span-0-2178"><a id="__codelineno-0-2178" name="__codelineno-0-2178"></a><span class="sd">            &#39;&#39;&#39;</span>
</span><span id="__span-0-2179"><a id="__codelineno-0-2179" name="__codelineno-0-2179"></a>
</span><span id="__span-0-2180"><a id="__codelineno-0-2180" name="__codelineno-0-2180"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DBG_LVL_0</span><span class="p">:</span>
</span><span id="__span-0-2181"><a id="__codelineno-0-2181" name="__codelineno-0-2181"></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[SOCKET RECEIVE EXCEPTION]: &#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="a2gmeasurements.HelperA2GMeasurements.socket_send_cmd" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">socket_send_cmd</span><span class="p">(</span><span class="n">type_cmd</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Creates a message by the name of the request/command. Wrapper to <code>encode_message</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>type_cmd</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>refers to the <code>cmd</code> parameter in <code>encode_message</code>. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>data</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>refers to the <code>data</code> parameter in <code>encode_message</code>. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>a2gmeasurements.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-2183">2183</a></span>
<span class="normal"><a href="#__codelineno-0-2184">2184</a></span>
<span class="normal"><a href="#__codelineno-0-2185">2185</a></span>
<span class="normal"><a href="#__codelineno-0-2186">2186</a></span>
<span class="normal"><a href="#__codelineno-0-2187">2187</a></span>
<span class="normal"><a href="#__codelineno-0-2188">2188</a></span>
<span class="normal"><a href="#__codelineno-0-2189">2189</a></span>
<span class="normal"><a href="#__codelineno-0-2190">2190</a></span>
<span class="normal"><a href="#__codelineno-0-2191">2191</a></span>
<span class="normal"><a href="#__codelineno-0-2192">2192</a></span>
<span class="normal"><a href="#__codelineno-0-2193">2193</a></span>
<span class="normal"><a href="#__codelineno-0-2194">2194</a></span>
<span class="normal"><a href="#__codelineno-0-2195">2195</a></span>
<span class="normal"><a href="#__codelineno-0-2196">2196</a></span>
<span class="normal"><a href="#__codelineno-0-2197">2197</a></span>
<span class="normal"><a href="#__codelineno-0-2198">2198</a></span>
<span class="normal"><a href="#__codelineno-0-2199">2199</a></span>
<span class="normal"><a href="#__codelineno-0-2200">2200</a></span>
<span class="normal"><a href="#__codelineno-0-2201">2201</a></span>
<span class="normal"><a href="#__codelineno-0-2202">2202</a></span>
<span class="normal"><a href="#__codelineno-0-2203">2203</a></span>
<span class="normal"><a href="#__codelineno-0-2204">2204</a></span>
<span class="normal"><a href="#__codelineno-0-2205">2205</a></span>
<span class="normal"><a href="#__codelineno-0-2206">2206</a></span>
<span class="normal"><a href="#__codelineno-0-2207">2207</a></span>
<span class="normal"><a href="#__codelineno-0-2208">2208</a></span>
<span class="normal"><a href="#__codelineno-0-2209">2209</a></span>
<span class="normal"><a href="#__codelineno-0-2210">2210</a></span>
<span class="normal"><a href="#__codelineno-0-2211">2211</a></span>
<span class="normal"><a href="#__codelineno-0-2212">2212</a></span>
<span class="normal"><a href="#__codelineno-0-2213">2213</a></span>
<span class="normal"><a href="#__codelineno-0-2214">2214</a></span>
<span class="normal"><a href="#__codelineno-0-2215">2215</a></span>
<span class="normal"><a href="#__codelineno-0-2216">2216</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-2183"><a id="__codelineno-0-2183" name="__codelineno-0-2183"></a><span class="k">def</span> <span class="nf">socket_send_cmd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">type_cmd</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="__span-0-2184"><a id="__codelineno-0-2184" name="__codelineno-0-2184"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-2185"><a id="__codelineno-0-2185" name="__codelineno-0-2185"></a><span class="sd">    Creates a message by the name of the request/command. Wrapper to ``encode_message``.</span>
</span><span id="__span-0-2186"><a id="__codelineno-0-2186" name="__codelineno-0-2186"></a>
</span><span id="__span-0-2187"><a id="__codelineno-0-2187" name="__codelineno-0-2187"></a><span class="sd">    Args:</span>
</span><span id="__span-0-2188"><a id="__codelineno-0-2188" name="__codelineno-0-2188"></a><span class="sd">        type_cmd (int, optional): refers to the ``cmd`` parameter in ``encode_message``. Defaults to None.</span>
</span><span id="__span-0-2189"><a id="__codelineno-0-2189" name="__codelineno-0-2189"></a><span class="sd">        data (int, optional): refers to the ``data`` parameter in ``encode_message``. Defaults to None.</span>
</span><span id="__span-0-2190"><a id="__codelineno-0-2190" name="__codelineno-0-2190"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-2191"><a id="__codelineno-0-2191" name="__codelineno-0-2191"></a>
</span><span id="__span-0-2192"><a id="__codelineno-0-2192" name="__codelineno-0-2192"></a>    <span class="k">if</span> <span class="n">type_cmd</span> <span class="o">==</span> <span class="s1">&#39;SETGIMBAL&#39;</span><span class="p">:</span>
</span><span id="__span-0-2193"><a id="__codelineno-0-2193" name="__codelineno-0-2193"></a>        <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encode_message</span><span class="p">(</span><span class="n">source_id</span><span class="o">=</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">destination_id</span><span class="o">=</span><span class="mh">0x02</span><span class="p">,</span> <span class="n">message_type</span><span class="o">=</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">cmd</span><span class="o">=</span><span class="mh">0x03</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-0-2194"><a id="__codelineno-0-2194" name="__codelineno-0-2194"></a>    <span class="k">elif</span> <span class="n">type_cmd</span> <span class="o">==</span> <span class="s1">&#39;FOLLOWGIMBAL&#39;</span><span class="p">:</span>
</span><span id="__span-0-2195"><a id="__codelineno-0-2195" name="__codelineno-0-2195"></a>        <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encode_message</span><span class="p">(</span><span class="n">source_id</span><span class="o">=</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">destination_id</span><span class="o">=</span><span class="mh">0x02</span><span class="p">,</span> <span class="n">message_type</span><span class="o">=</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">cmd</span><span class="o">=</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-0-2196"><a id="__codelineno-0-2196" name="__codelineno-0-2196"></a>    <span class="k">elif</span> <span class="n">type_cmd</span> <span class="o">==</span> <span class="s1">&#39;GETGPS&#39;</span><span class="p">:</span>
</span><span id="__span-0-2197"><a id="__codelineno-0-2197" name="__codelineno-0-2197"></a>        <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encode_message</span><span class="p">(</span><span class="n">source_id</span><span class="o">=</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">destination_id</span><span class="o">=</span><span class="mh">0x02</span><span class="p">,</span> <span class="n">message_type</span><span class="o">=</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">cmd</span><span class="o">=</span><span class="mh">0x02</span><span class="p">)</span>
</span><span id="__span-0-2198"><a id="__codelineno-0-2198" name="__codelineno-0-2198"></a>    <span class="k">elif</span> <span class="n">type_cmd</span> <span class="o">==</span> <span class="s1">&#39;CLOSEDGUI&#39;</span><span class="p">:</span>
</span><span id="__span-0-2199"><a id="__codelineno-0-2199" name="__codelineno-0-2199"></a>        <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encode_message</span><span class="p">(</span><span class="n">source_id</span><span class="o">=</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">destination_id</span><span class="o">=</span><span class="mh">0x02</span><span class="p">,</span> <span class="n">message_type</span><span class="o">=</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">cmd</span><span class="o">=</span><span class="mh">0x07</span><span class="p">)</span>
</span><span id="__span-0-2200"><a id="__codelineno-0-2200" name="__codelineno-0-2200"></a>    <span class="k">elif</span> <span class="n">type_cmd</span> <span class="o">==</span> <span class="s1">&#39;STARTDRONERFSOC&#39;</span><span class="p">:</span>
</span><span id="__span-0-2201"><a id="__codelineno-0-2201" name="__codelineno-0-2201"></a>        <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encode_message</span><span class="p">(</span><span class="n">source_id</span><span class="o">=</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">destination_id</span><span class="o">=</span><span class="mh">0x02</span><span class="p">,</span> <span class="n">message_type</span><span class="o">=</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">cmd</span><span class="o">=</span><span class="mh">0x04</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-0-2202"><a id="__codelineno-0-2202" name="__codelineno-0-2202"></a>    <span class="k">elif</span> <span class="n">type_cmd</span> <span class="o">==</span> <span class="s1">&#39;STOPDRONERFSOC&#39;</span><span class="p">:</span>
</span><span id="__span-0-2203"><a id="__codelineno-0-2203" name="__codelineno-0-2203"></a>        <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encode_message</span><span class="p">(</span><span class="n">source_id</span><span class="o">=</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">destination_id</span><span class="o">=</span><span class="mh">0x02</span><span class="p">,</span> <span class="n">message_type</span><span class="o">=</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">cmd</span><span class="o">=</span><span class="mh">0x05</span><span class="p">)</span>
</span><span id="__span-0-2204"><a id="__codelineno-0-2204" name="__codelineno-0-2204"></a>    <span class="k">elif</span> <span class="n">type_cmd</span> <span class="o">==</span> <span class="s1">&#39;FINISHDRONERFSOC&#39;</span><span class="p">:</span>
</span><span id="__span-0-2205"><a id="__codelineno-0-2205" name="__codelineno-0-2205"></a>        <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encode_message</span><span class="p">(</span><span class="n">source_id</span><span class="o">=</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">destination_id</span><span class="o">=</span><span class="mh">0x02</span><span class="p">,</span> <span class="n">message_type</span><span class="o">=</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">cmd</span><span class="o">=</span><span class="mh">0x06</span><span class="p">)</span>
</span><span id="__span-0-2206"><a id="__codelineno-0-2206" name="__codelineno-0-2206"></a>    <span class="k">elif</span> <span class="n">type_cmd</span> <span class="o">==</span> <span class="s1">&#39;SETIRF&#39;</span><span class="p">:</span>
</span><span id="__span-0-2207"><a id="__codelineno-0-2207" name="__codelineno-0-2207"></a>        <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encode_message</span><span class="p">(</span><span class="n">source_id</span><span class="o">=</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">destination_id</span><span class="o">=</span><span class="mh">0x02</span><span class="p">,</span> <span class="n">message_type</span><span class="o">=</span><span class="mh">0x02</span><span class="p">,</span> <span class="n">cmd</span><span class="o">=</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-0-2208"><a id="__codelineno-0-2208" name="__codelineno-0-2208"></a>    <span class="k">elif</span> <span class="n">type_cmd</span> <span class="o">==</span> <span class="s1">&#39;SETREMOTEFMFLAG&#39;</span><span class="p">:</span>
</span><span id="__span-0-2209"><a id="__codelineno-0-2209" name="__codelineno-0-2209"></a>        <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encode_message</span><span class="p">(</span><span class="n">source_id</span><span class="o">=</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">destination_id</span><span class="o">=</span><span class="mh">0x02</span><span class="p">,</span> <span class="n">message_type</span><span class="o">=</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">cmd</span><span class="o">=</span><span class="mh">0x08</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-0-2210"><a id="__codelineno-0-2210" name="__codelineno-0-2210"></a>    <span class="k">elif</span> <span class="n">type_cmd</span> <span class="o">==</span> <span class="s1">&#39;SETREMOTESTOPFM&#39;</span><span class="p">:</span>
</span><span id="__span-0-2211"><a id="__codelineno-0-2211" name="__codelineno-0-2211"></a>        <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encode_message</span><span class="p">(</span><span class="n">source_id</span><span class="o">=</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">destination_id</span><span class="o">=</span><span class="mh">0x02</span><span class="p">,</span> <span class="n">message_type</span><span class="o">=</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">cmd</span><span class="o">=</span><span class="mh">0x09</span><span class="p">)</span>
</span><span id="__span-0-2212"><a id="__codelineno-0-2212" name="__codelineno-0-2212"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;DRONE&#39;</span><span class="p">:</span>
</span><span id="__span-0-2213"><a id="__codelineno-0-2213" name="__codelineno-0-2213"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
</span><span id="__span-0-2214"><a id="__codelineno-0-2214" name="__codelineno-0-2214"></a>    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID</span> <span class="o">==</span> <span class="s1">&#39;GROUND&#39;</span><span class="p">:</span>
</span><span id="__span-0-2215"><a id="__codelineno-0-2215" name="__codelineno-0-2215"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">a2g_conn</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
</span><span id="__span-0-2216"><a id="__codelineno-0-2216" name="__codelineno-0-2216"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG]: This </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ID</span><span class="si">}</span><span class="s2"> node sends </span><span class="si">{</span><span class="n">type_cmd</span><span class="si">}</span><span class="s2"> cmd&quot;</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.sections", "navigation.expand", "navigation.path", "content.footnote.tooltips", "content.code.copy", "content.code.select", "content.code.annotate"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.081f42fc.min.js"></script>
      
        <script src="../javascripts/katex.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/contrib/auto-render.min.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>